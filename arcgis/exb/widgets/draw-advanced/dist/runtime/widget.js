System.register(["jimu-core","jimu-core/react","jimu-ui","jimu-arcgis","esri/widgets/Sketch/SketchViewModel","jimu-ui/advanced/map","jimu-ui/advanced/style-setting-components","jimu-ui/basic/color-picker","esri/Color","esri/layers/GraphicsLayer","esri/Graphic","esri/symbols/TextSymbol","esri/geometry/Point","esri/geometry/Polyline","esri/geometry/SpatialReference","esri/geometry/operators/projectOperator","esri/geometry/operators/geodeticAreaOperator","esri/geometry/operators/geodeticLengthOperator","esri/geometry/operators/areaOperator","esri/geometry/operators/lengthOperator","esri/symbols/SimpleMarkerSymbol","esri/symbols/SimpleLineSymbol","esri/symbols/SimpleFillSymbol","esri/symbols/Font","esri/geometry/geometryEngineAsync","esri/geometry/projection","esri/geometry/support/webMercatorUtils","esri/views/interactive/snapping/FeatureSnappingLayerSource","esri/layers/FeatureLayer","esri/core/Collection","jimu-ui/advanced/setting-components"],(function(e,t){var i={},r={},n={},o={},a={},s={},l={},c={},u={},d={},h={},m={},p={},g={},f={},y={},v={},w={},b={},x={},M={},L={},S={},C={},N={},A={},T={},E={},j={},I={},D={};return Object.defineProperty(N,"__esModule",{value:!0}),Object.defineProperty(T,"__esModule",{value:!0}),{setters:[function(e){i.React=e.React,i.WidgetState=e.WidgetState,i.classNames=e.classNames,i.css=e.css,i.jsx=e.jsx},function(e){r.default=e.default,r.useCallback=e.useCallback,r.useEffect=e.useEffect,r.useRef=e.useRef,r.useState=e.useState},function(e){n.AdvancedButtonGroup=e.AdvancedButtonGroup,n.Alert=e.Alert,n.Button=e.Button,n.ButtonGroup=e.ButtonGroup,n.Checkbox=e.Checkbox,n.CollapsableCheckbox=e.CollapsableCheckbox,n.CollapsablePanel=e.CollapsablePanel,n.Icon=e.Icon,n.Label=e.Label,n.NumericInput=e.NumericInput,n.Option=e.Option,n.Popper=e.Popper,n.Select=e.Select,n.Slider=e.Slider,n.Switch=e.Switch,n.TextAlignValue=e.TextAlignValue,n.TextInput=e.TextInput,n.defaultMessages=e.defaultMessages},function(e){o.JimuMapViewComponent=e.JimuMapViewComponent},function(e){a.default=e.default},function(e){s.JimuSymbolType=e.JimuSymbolType,s.SymbolSelector=e.SymbolSelector},function(e){l.InputUnit=e.InputUnit},function(e){c.ColorPicker=e.ColorPicker},function(e){u.default=e.default},function(e){d.default=e.default},function(e){h.default=e.default},function(e){m.default=e.default},function(e){p.default=e.default},function(e){g.default=e.default},function(e){f.default=e.default},function(e){y.default=e.default},function(e){v.default=e.default},function(e){w.default=e.default},function(e){b.default=e.default},function(e){x.default=e.default},function(e){M.default=e.default},function(e){L.default=e.default},function(e){S.default=e.default},function(e){C.default=e.default},function(e){Object.keys(e).forEach((function(t){N[t]=e[t]}))},function(e){A.load=e.load,A.project=e.project},function(e){Object.keys(e).forEach((function(t){T[t]=e[t]}))},function(e){E.default=e.default},function(e){j.default=e.default},function(e){I.default=e.default},function(e){D.CollapsableCheckbox=e.CollapsableCheckbox}],execute:function(){e((()=>{var e={2480:(e,t,i)=>{"use strict";i.d(t,{A:()=>s});var r=i(1601),n=i.n(r),o=i(6314),a=i.n(o)()(n());a.push([e.id,"@import url(https://fonts.googleapis.com/css2?family=Alegreya:ital,wght@0,400..900;1,400..900&family=Josefin+Slab:ital,wght@0,100..700;1,100..700&family=Merriweather:ital,opsz,wght@0,18..144,300..900;1,18..144,300..900&family=Montserrat:ital,wght@0,100..900;1,100..900&family=Noto+Sans:ital,wght@0,100..900;1,100..900&family=Noto+Serif:ital,wght@0,100..900;1,100..900&family=Playfair+Display:ital,wght@0,400..900;1,400..900&family=Roboto:ital,wght@0,100..900;1,100..900&family=Ubuntu:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&display=swap);"]),a.push([e.id,".inner-popper{z-index:2002 !important}.color-picker-popper{z-index:2002 !important}.drawToolbarDiv{width:95% !important;margin:0 auto !important}.buttonRow{width:fit-content;margin:0 auto}.decimalInput{width:100px}.text-style-editor{padding:0 !important}.pc-btn{min-height:34px;text-align:center;flex:1 1 0 !important;min-width:0 !important;white-space:nowrap !important;overflow:hidden !important;text-overflow:ellipsis !important}.widget-draw{display:flex;flex-direction:column;height:100%;overflow:hidden}.tab-header{flex-shrink:0;display:flex;border-bottom:2px solid #ccc;background:#fff;z-index:10;position:relative;margin:0}.tab-button{flex:1;padding:.5rem 1rem;text-align:center;cursor:pointer;font-weight:500;color:#003a55;border-bottom:2px solid transparent;background:#f8f9fa;transition:all .2s ease}.tab-button:hover{background-color:#e9ecef}.tab-button.active{background:#fff;border-bottom:2px solid #003a55;font-weight:600;color:#003a55}.tab-content{flex:1;overflow-y:auto;overflow-x:hidden;min-height:0;scrollbar-width:thin;scrollbar-color:#c1c1c1 #f1f1f1}.tab-content::-webkit-scrollbar{width:6px}.tab-content::-webkit-scrollbar-track{background:#f1f1f1;border-radius:3px}.tab-content::-webkit-scrollbar-thumb{background:#c1c1c1;border-radius:3px}.tab-content::-webkit-scrollbar-thumb:hover{background:#a8a8a8}.draw-panel-content,.my-drawings-tab-container{padding:16px;min-height:min-content}.mode-message{margin:0}.mode-message h5{margin:.5rem 0 .25rem 0;color:#003a55}.mode-message h6{margin:0;color:#666;font-weight:normal}.drawing-tools-section{margin:0}.main-checkbox-stack{display:flex;flex-direction:column;gap:0}.measure-toggle-stack{display:flex;flex-direction:column;gap:0}.main-checkbox-stack .jimu-collapsable-panel,.measure-toggle-stack .jimu-collapsable-panel{margin:0 !important}.collapsible-section{margin:0 !important;padding:0 !important}.collapsible-section+.collapsible-section{margin-top:0 !important}.collapsible-section .jimu-collapsable-panel{margin:0 !important;border-radius:4px;overflow:hidden;background:#fff}.collapsible-section .jimu-collapsable-panel>.header{background:#f8f9fa;border-bottom:1px solid #dee2e6;padding:12px 16px;font-weight:500;display:flex;align-items:center;justify-content:space-between;min-height:44px}.collapsible-section .jimu-collapsable-panel>.body{padding:16px}.collapsible-section>*{margin:0 !important}.collapsible-section>div{margin:0 !important}.collapsible-section .mb-1,.collapsible-section .mb-2,.collapsible-section .mb-3,.collapsible-section .mt-1,.collapsible-section .mt-2,.collapsible-section .mt-3,.collapsible-section [class*=margin],.collapsible-section [class*=mb-],.collapsible-section [class*=mt-],.collapsible-section [class*=my-]{margin-top:0 !important;margin-bottom:0 !important}.measurement-section,.tooltip-controls,.snapping-controls,.buffer-controls{margin:0 !important;padding:0 !important}.measurement-section .body,.snapping-controls .body,.buffer-controls .body{padding-bottom:0 !important}.arrow-controls{padding:0;background:transparent;border:none;border-radius:0}.arrow-controls .drawToolbarDiv{margin-bottom:0}.myss{margin:0}.myss .border{border:1px solid #dee2e6 !important;border-radius:4px}.drawToolbarBottomDiv{margin:0;flex-wrap:wrap;padding-top:8px}@media(max-height: 400px){.draw-panel-content,.my-drawings-tab-container{padding:8px}.collapsible-section .jimu-collapsable-panel>.header{padding:10px 12px;min-height:40px}.collapsible-section .jimu-collapsable-panel>.body{padding:12px}.tab-button{padding:6px 12px;font-size:.9rem}.mode-message h5{font-size:1rem}.mode-message h6{font-size:.875rem}.drawToolbarBottomDiv{margin:0;padding-top:8px}}@media(max-height: 300px){.draw-panel-content,.my-drawings-tab-container{padding:6px}.tab-button{padding:4px 8px;font-size:.8rem}.buttonRow{margin-bottom:0}}",""]);const s=a},6314:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var i="",r=void 0!==t[5];return t[4]&&(i+="@supports (".concat(t[4],") {")),t[2]&&(i+="@media ".concat(t[2]," {")),r&&(i+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),i+=e(t),r&&(i+="}"),t[2]&&(i+="}"),t[4]&&(i+="}"),i})).join("")},t.i=function(e,i,r,n,o){"string"==typeof e&&(e=[[null,e,void 0]]);var a={};if(r)for(var s=0;s<this.length;s++){var l=this[s][0];null!=l&&(a[l]=!0)}for(var c=0;c<e.length;c++){var u=[].concat(e[c]);r&&a[u[0]]||(void 0!==o&&(void 0===u[5]||(u[1]="@layer".concat(u[5].length>0?" ".concat(u[5]):""," {").concat(u[1],"}")),u[5]=o),i&&(u[2]?(u[1]="@media ".concat(u[2]," {").concat(u[1],"}"),u[2]=i):u[2]=i),n&&(u[4]?(u[1]="@supports (".concat(u[4],") {").concat(u[1],"}"),u[4]=n):u[4]="".concat(n)),t.push(u))}},t}},1601:e=>{"use strict";e.exports=function(e){return e[1]}},5072:e=>{"use strict";var t=[];function i(e){for(var i=-1,r=0;r<t.length;r++)if(t[r].identifier===e){i=r;break}return i}function r(e,r){for(var o={},a=[],s=0;s<e.length;s++){var l=e[s],c=r.base?l[0]+r.base:l[0],u=o[c]||0,d="".concat(c," ").concat(u);o[c]=u+1;var h=i(d),m={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==h)t[h].references++,t[h].updater(m);else{var p=n(m,r);r.byIndex=s,t.splice(s,0,{identifier:d,updater:p,references:1})}a.push(d)}return a}function n(e,t){var i=t.domAPI(t);i.update(e);return function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;i.update(e=t)}else i.remove()}}e.exports=function(e,n){var o=r(e=e||[],n=n||{});return function(e){e=e||[];for(var a=0;a<o.length;a++){var s=i(o[a]);t[s].references--}for(var l=r(e,n),c=0;c<o.length;c++){var u=i(o[c]);0===t[u].references&&(t[u].updater(),t.splice(u,1))}o=l}}},7659:e=>{"use strict";var t={};e.exports=function(e,i){var r=function(e){if(void 0===t[e]){var i=document.querySelector(e);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(e){i=null}t[e]=i}return t[e]}(e);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(i)}},540:e=>{"use strict";e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},5056:(e,t,i)=>{"use strict";e.exports=function(e){var t=i.nc;t&&e.setAttribute("nonce",t)}},7825:e=>{"use strict";e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(i){!function(e,t,i){var r="";i.supports&&(r+="@supports (".concat(i.supports,") {")),i.media&&(r+="@media ".concat(i.media," {"));var n=void 0!==i.layer;n&&(r+="@layer".concat(i.layer.length>0?" ".concat(i.layer):""," {")),r+=i.css,n&&(r+="}"),i.media&&(r+="}"),i.supports&&(r+="}");var o=i.sourceMap;o&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),t.styleTagTransform(r,e,t.options)}(t,e,i)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},1113:e=>{"use strict";e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},3303:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M9.438.994c.213 0 .397.146.44.35q.227 1.084.316 1.852.562.242 1.048.599l1.728-.676a.455.455 0 0 1 .556.188l1.42 2.394a.43.43 0 0 1-.091.547 22 22 0 0 1-1.49 1.194q.03.27.03.552 0 .32-.038.63l1.465 1.12a.43.43 0 0 1 .111.563l-1.42 2.394a.454.454 0 0 1-.53.197 23 23 0 0 1-1.807-.66q-.49.35-1.055.586l-.263 1.794a.446.446 0 0 1-.445.376H6.574a.446.446 0 0 1-.44-.35 21 21 0 0 1-.317-1.853 5.3 5.3 0 0 1-1.047-.598l-1.728.675a.455.455 0 0 1-.556-.187l-1.42-2.395a.43.43 0 0 1 .091-.546q.85-.735 1.49-1.194a5.167 5.167 0 0 1 .008-1.183L1.19 6.243a.43.43 0 0 1-.112-.562l1.42-2.395a.455.455 0 0 1 .531-.196q1.078.35 1.807.66c.324-.233.679-.43 1.056-.587l.262-1.794A.446.446 0 0 1 6.6.994zm-.365 1H6.985l-.28 1.866-.467.19q-.353.144-.672.34l-.207.136-.42.293-.476-.197q-.492-.205-1.169-.433l-.221-.074-1.045 1.719L3.59 6.999l-.06.479a4 4 0 0 0-.021.816l.014.144.058.492-.419.294q-.433.304-.979.746l-.177.145 1.043 1.72 1.845-.703.406.29q.307.219.645.384l.228.103.474.199.059.49q.06.507.19 1.177l.043.219h2.088l.282-1.867.466-.19q.354-.144.672-.34l.207-.136.419-.293.476.198q.495.204 1.17.433l.22.072 1.044-1.718-1.56-1.165.06-.479a4 4 0 0 0 .02-.815l-.013-.144-.06-.492.42-.295a18 18 0 0 0 .98-.746l.176-.146-1.043-1.72-1.844.705-.406-.29a4.5 4.5 0 0 0-.646-.385l-.228-.103-.474-.199-.058-.49q-.049-.405-.14-.916zm-1.067 3a3 3 0 1 1 0 6 3 3 0 0 1 0-6m0 1a2 2 0 1 0 0 4 2 2 0 0 0 0-4" clip-rule="evenodd"></path></svg>'},5031:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8.454 10.268a.875.875 0 0 0 1.364.725l.087-.067 4.796-4.196a.875.875 0 0 0 .078-1.24l-.078-.077-4.796-4.197a.875.875 0 0 0-1.445.557l-.006.102v1.78q-7.317.616-7.432 8.277L1 12.374v.64l.006.35q.006.186.016.396l.034.503c.089.525.433.757.82.736.305-.018.532-.302.607-.6l.103-.398.109-.388q.183-.63.324-.901c1.09-2.103 2.706-3.272 4.435-3.676q.496-.115 1-.148zM2 12.54a3 3 0 0 1 .131-.29c1.452-2.8 3.8-4.198 6.257-4.36l1.066-.071v2.172l4.481-3.92L9.454 2.15l-.001 2.423-.916.078c-2.268.191-3.836.914-4.855 2.05-1.026 1.142-1.624 2.843-1.66 5.246v.017L2 12.398zm-.487 1.615v-.003z" clip-rule="evenodd"></path></svg>'},9609:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M7.547 3.654v-1.78l-.007-.101a.875.875 0 0 0-1.445-.557L1.299 5.413l-.078.077a.875.875 0 0 0 .078 1.24l4.796 4.196.087.067a.875.875 0 0 0 1.364-.726V8.889q.504.033 1 .148c1.729.404 3.345 1.573 4.435 3.676q.14.272.325.9l.108.389.103.399c.075.297.302.581.608.599.386.021.73-.21.82-.736l.033-.503q.02-.421.022-.745v-.641l-.022-.442q-.116-7.66-7.431-8.278M14 12.398l-.021-.434v-.017c-.037-2.403-.635-4.104-1.66-5.246-1.02-1.136-2.588-1.859-4.856-2.05l-.916-.078V2.15L2.064 6.071l4.481 3.92V7.82l1.066.07c2.457.163 4.805 1.561 6.257 4.362q.067.13.13.289zm.487 1.758v-.003z" clip-rule="evenodd"></path></svg>'},2838:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m8.745 8 6.1 6.1a.527.527 0 1 1-.745.746L8 8.746l-6.1 6.1a.527.527 0 1 1-.746-.746l6.1-6.1-6.1-6.1a.527.527 0 0 1 .746-.746l6.1 6.1 6.1-6.1a.527.527 0 0 1 .746.746z"></path></svg>'},3:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M5.5 3a.5.5 0 0 0 0 1h5a.5.5 0 0 0 0-1zm0 6a.5.5 0 0 0 0 1h5a.5.5 0 0 0 0-1zM2 6.5a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5m.5 5.5a.5.5 0 0 0 0 1h11a.5.5 0 0 0 0-1z" clip-rule="evenodd"></path></svg>'},3659:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M9.5 3h-7a.5.5 0 0 0 0 1h7a.5.5 0 0 0 0-1m-7 3h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1 0-1m6 3h-6a.5.5 0 0 0 0 1h6a.5.5 0 0 0 0-1m5 3h-11a.5.5 0 0 0 0 1h11a.5.5 0 0 0 0-1" clip-rule="evenodd"></path></svg>'},7038:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M6.5 3a.5.5 0 0 0 0 1h7a.5.5 0 0 0 0-1zm1 6a.5.5 0 0 0 0 1h6a.5.5 0 0 0 0-1zM4 6.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5M2.5 12a.5.5 0 0 0 0 1h11a.5.5 0 0 0 0-1z" clip-rule="evenodd"></path></svg>'},9044:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M6 6.5a.5.5 0 0 1 1 0v6a.5.5 0 0 1-1 0zM9.5 6a.5.5 0 0 0-.5.5v6a.5.5 0 0 0 1 0v-6a.5.5 0 0 0-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M11 0H5a1 1 0 0 0-1 1v2H.5a.5.5 0 0 0 0 1h1.6l.81 11.1a1 1 0 0 0 .995.9h8.19a1 1 0 0 0 .995-.9L13.9 4h1.6a.5.5 0 0 0 0-1H12V1a1 1 0 0 0-1-1m0 3V1H5v2zm1.895 1h-9.79l.8 11h8.19z" clip-rule="evenodd"></path></svg>'},2167:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M4 4.796 4.796 4 8.02 7.224l3.184-3.184.796.796L8.816 8.02l3.144 3.144-.796.796L8.02 8.816 4.836 12l-.796-.796L7.224 8.02z"></path><path fill="#000" fill-rule="evenodd" d="m0 4 4-4h8l4 4v8l-4 4H4l-4-4zm1 .414L4.414 1h7.172L15 4.414v7.172L11.586 15H4.414L1 11.586z" clip-rule="evenodd"></path></svg>'},4809:e=>{e.exports="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMiIgaGVpZ2h0PSIxMiIgdmlld0JveD0iMCAwIDEyIDEyIiBmaWxsPSJub25lIj4NCgk8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTkuMjI0LDYuNTMzYzAuMjUsMC4xNzIsMC40NTMsMC4zODksMC42MDksMC42NDhzMC4yMzQsMC41NjQsMC4yMzQsMC45MTZjMCwwLjQyMi0wLjA4OSwwLjc3OS0wLjI2NiwxLjA3DQoJCWMtMC4xNzksMC4yOTEtMC40MzQsMC41Mi0wLjc2NiwwLjY4OGMtMC4zNTIsMC4xOC0wLjc1NywwLjMwNy0xLjIxNSwwLjM4MWMtMC40NiwwLjA3NC0xLDAuMTExLTEuNjIxLDAuMTExSDEuODgyVjkuODkxDQoJCWMwLjEyMS0wLjAxMiwwLjI3My0wLjAyOSwwLjQ1Ny0wLjA1M3MwLjMxMy0wLjA1MSwwLjM4Ny0wLjA4MmMwLjE0NS0wLjA1OSwwLjI0My0wLjEzNSwwLjI5Ni0wLjIzczAuMDc5LTAuMjIxLDAuMDc5LTAuMzczVjMuMjkzDQoJCWMwLTAuMTQxLTAuMDIxLTAuMjU4LTAuMDY0LTAuMzUyUzIuODksMi43NjYsMi43MjYsMi42OTZDMi42MDUsMi42NDUsMi40NjQsMi42MDMsMi4zMDQsMi41N1MyLjAwMywyLjUxLDEuODgyLDIuNDkxVjIuMDM0aDQuNTE3DQoJCWMxLjEzNywwLDEuOTU3LDAuMTU2LDIuNDYxLDAuNDY5czAuNzU2LDAuNzczLDAuNzU2LDEuMzgzYzAsMC4yODEtMC4wNTcsMC41MjgtMC4xNywwLjc0MVM5LjE3MSw1LjAyNCw4Ljk2LDUuMTgNCgkJQzguNzY5LDUuMzI1LDguNTQsNS40NSw4LjI3NCw1LjU1NVM3LjcyNCw1Ljc0OSw3LjQxOSw1LjgxOVY1LjkzQzcuNzI0LDUuOTYxLDguMDQsNi4wMjksOC4zNjgsNi4xMzJTOC45ODEsNi4zNyw5LjIyNCw2LjUzM3oNCgkJIE03LjMzNyw0LjAzMmMwLTAuNDYxLTAuMTMtMC44Mi0wLjM4OS0xLjA3OGMtMC4yNjEtMC4yNTgtMC42NS0wLjM4Ny0xLjE3LTAuMzg3Yy0wLjA3NCwwLTAuMTcxLDAuMDAzLTAuMjg5LDAuMDA5DQoJCUM1LjM2OSwyLjU4Miw1LjI2NywyLjU4Niw1LjE4MSwyLjU5djMuMDgyaDAuMzA1YzAuNjMzLDAsMS4xLTAuMTQ3LDEuNC0wLjQ0MlM3LjMzNyw0LjUzNiw3LjMzNyw0LjAzMnogTTcuNzQ3LDguMDI1DQoJCWMwLTAuNTgtMC4xNzItMS4wMjMtMC41MTYtMS4zMzJjLTAuMzQ0LTAuMzEtMC44MzgtMC40NjQtMS40ODItMC40NjRjLTAuMDc0LDAtMC4xNzIsMC4wMDMtMC4yOTUsMC4wMDlTNS4yMzksNi4yNDksNS4xODEsNi4yNTINCgkJdjMuMDQ2YzAuMDM1LDAuMTQ1LDAuMTQ1LDAuMjY3LDAuMzI4LDAuMzY3YzAuMTg0LDAuMSwwLjQwNiwwLjE0OCwwLjY2OCwwLjE0OGMwLjQ2NSwwLDAuODQzLTAuMTU2LDEuMTM1LTAuNDY5DQoJCUM3LjYwMiw5LjAzMiw3Ljc0Nyw4LjU5Miw3Ljc0Nyw4LjAyNXoiIGZpbGw9ImJsYWNrIi8+DQo8L3N2Zz4NCg=="},3180:e=>{e.exports="data:image/svg+xml;base64,PCEtLSBHZW5lcmF0ZWQgYnkgSWNvTW9vbi5pbyAtLT4KPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjMyIiBoZWlnaHQ9IjMyIiB2aWV3Qm94PSIwIDAgMzIgMzIiPgo8dGl0bGU+Y2lyY2xlPC90aXRsZT4KPHBhdGggZD0iTTMyIDE2YzAgOC44MzctNy4xNjMgMTYtMTYgMTZzLTE2LTcuMTYzLTE2LTE2IDcuMTYzLTE2IDE2LTE2IDE2IDcuMTYzIDE2IDE2eiI+PC9wYXRoPgo8L3N2Zz4K"},1265:e=>{e.exports="data:image/svg+xml;base64,PCEtLSBHZW5lcmF0ZWQgYnkgSWNvTW9vbi5pbyAtLT4KPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjI5IiBoZWlnaHQ9IjMyIiB2aWV3Qm94PSIwIDAgMjkgMzIiPgo8dGl0bGU+Y3VydmU8L3RpdGxlPgo8cGF0aCBkPSJNMy4zNjggMzEuMTU4aC0zLjM2OGMwLjA4NC0xMi4wNDIgNi40ODQtMTMuODExIDEyLjEyNi0xNS4zMjYgNS44OTUtMS42IDExLjUzNy0zLjIgMTMuMTM3LTE1LjI0MmwzLjM2OCAwLjQyMWMtMS45MzcgMTQuMjMyLTkuNTE2IDE2LjMzNy0xNS41NzkgMTguMDIxLTUuNjQyIDEuNi05LjYgMi42OTUtOS42ODQgMTIuMTI2eiI+PC9wYXRoPgo8L3N2Zz4K"},5407:e=>{e.exports="data:image/svg+xml;base64,PCEtLSBHZW5lcmF0ZWQgYnkgSWNvTW9vbi5pbyAtLT4KPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjM4IiBoZWlnaHQ9IjMyIiB2aWV3Qm94PSIwIDAgMzggMzIiPgo8dGl0bGU+aXJyZWd1bGFyPC90aXRsZT4KPHBhdGggZD0iTTYuMjMgNi4xOTNjLTMuMjM1IDMuMyAzLjcwNCA0Ljg1OSAxLjg4OCA5LjU1OHMtMTEuNjY5IDcuODY2LTYuNzYxIDEzLjUyMSA4LjM4NC0zLjE0NiAxNC42MTMtMi4xMjkgNS4xNjUgNi42MDYgMTEuMTI1IDQuMzA2YzUuOTYtMi4zLTIuNTU0LTEwLjI5NiAxLjA3MC0xMy4wNDZzMTEuMDIxLTUuMDIxIDkuMTk5LTguNzVjLTEuODIyLTMuNzI5LTQuNC0xLjUxMy04LjY2NS0xLjA4M3MtMC4zMjMtOC41Ny00LjU5Mi04LjU3LTMuNjczIDIuNzIzLTcuMjU2IDYuNjYxLTcuMzg1LTMuNzY4LTEwLjYxOS0wLjQ2OHoiPjwvcGF0aD4KPC9zdmc+Cg=="},9768:e=>{e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAxNS4wLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+DQo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4Ig0KCSB3aWR0aD0iMTJweCIgaGVpZ2h0PSIxMnB4IiB2aWV3Qm94PSIwIDAgMTIgMTIiIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDEyIDEyIiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjx0aXRsZT5ib2xkPC90aXRsZT4NCjxkZXNjPkNyZWF0ZWQgd2l0aCBTa2V0Y2guPC9kZXNjPg0KPHJlY3QgaWQ9IlJlY3RhbmdsZSIgZmlsbD0ibm9uZSIgd2lkdGg9IjEyIiBoZWlnaHQ9IjEyIi8+DQo8Zz4NCgk8cGF0aCBkPSJNOC41NzgsMi4wMzNMOC40OSwyLjQyQzguMzY5LDIuNDI0LDguMjExLDIuNDQxLDguMDE2LDIuNDczcy0wLjM0LDAuMDYxLTAuNDM0LDAuMDg4QzcuNDE4LDIuNjExLDcuMzAxLDIuNjg5LDcuMjMsMi43OTUNCgkJUzcuMTA5LDMuMDE3LDcuMDc4LDMuMTQzTDUuNjY3LDkuMjE5QzUuNjU5LDkuMjQ0LDUuNjUzLDkuMjc1LDUuNjQ5LDkuMzExUzUuNjQ0LDkuMzc3LDUuNjQ0LDkuNDA0YzAsMC4wOSwwLjAyLDAuMTY2LDAuMDU5LDAuMjI5DQoJCVM1LjgxMiw5Ljc1LDUuOTEzLDkuNzk3QzUuOTcyLDkuODI0LDYuMTAxLDkuODU2LDYuMyw5Ljg5NHMwLjM0OCwwLjA2LDAuNDQ1LDAuMDY3bC0wLjA4OCwwLjM4N2gtMy43NWwwLjA4OC0wLjM4Nw0KCQljMC4xMDktMC4wMDgsMC4yNjYtMC4wMiwwLjQ2OS0wLjAzNXMwLjM0OC0wLjAzOSwwLjQzNC0wLjA3QzQuMDUsOS44MDEsNC4xNjYsOS43MjYsNC4yNDQsOS42M3MwLjEzMS0wLjIxMiwwLjE1OC0wLjM0OQ0KCQlsMS40MDYtNi4wODJjMC4wMDgtMC4wMzUsMC4wMTQtMC4wNywwLjAxOC0wLjEwNXMwLjAwNi0wLjA3LDAuMDA2LTAuMTA1YzAtMC4wNzgtMC4wMTctMC4xNDYtMC4wNS0wLjIwNVM1LjY3OSwyLjY3Miw1LjU3MywyLjYyNQ0KCQlTNS4zMjQsMi41MzQsNS4xNDMsMi40OTNTNC44MjcsMi40MjgsNC43NDEsMi40MmwwLjA4OC0wLjM4N0g4LjU3OHoiLz4NCjwvZz4NCjwvc3ZnPg0K"},6869:e=>{e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAxNS4wLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+DQo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4Ig0KCSB3aWR0aD0iMThweCIgaGVpZ2h0PSIzMnB4IiB2aWV3Qm94PSIwIDAgMTggMzIiIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDE4IDMyIiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCgk8dGl0bGU+cGluPC90aXRsZT4NCgk8ZyBpZD0iU3R5bGUiIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIxIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPg0KCQk8ZyBpZD0iMC1VSS1pY29ucyIgZmlsbD0iIzAwMDAwMCIgZmlsbC1ydWxlPSJub256ZXJvIj4NCgkJCTxwYXRoIGQ9Ik0wLDYuMjU0QzAsNi4yNTQsMC4xNDQsMCw5LjA1MSwwYzguOTA3LDAsOC43MjcsNi4yNTQsOC43MjcsNi4yNTR2MTguNjA0TDkuMDUxLDMyTDAsMjQuODU3VjYuMjU0eg0KCQkJCU04Ljg4OSwxMy43MTRjMi44NDEsMCw1LjE0Ni0yLjI1MSw1LjE0Ni01LjAyOVMxMS43MywzLjY1Niw4Ljg4OSwzLjY1NmMtMi44NDIsMC01LjE0NiwyLjI1MS01LjE0Niw1LjAyOQ0KCQkJCVM2LjA0NywxMy43MTQsOC44ODksMTMuNzE0eiIvPg0KCQk8L2c+DQoJPC9nPg0KPC9zdmc+DQo="},6698:e=>{e.exports="data:image/svg+xml;base64,PCEtLSBHZW5lcmF0ZWQgYnkgSWNvTW9vbi5pbyAtLT4KPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjM2IiBoZWlnaHQ9IjMyIiB2aWV3Qm94PSIwIDAgMzYgMzIiPgo8dGl0bGU+cG9seWdvbjwvdGl0bGU+CjxwYXRoIGQ9Ik0wIDEzLjcxNnYxNy45NDJoMzEuNzIzdi03LjIxOWwtMTAuMTg4LTEwLjE4OCAxNC4yNS0xNC4yNWgtMjMuNzg1eiI+PC9wYXRoPgo8L3N2Zz4K"},1281:e=>{e.exports="data:image/svg+xml;base64,PCEtLSBHZW5lcmF0ZWQgYnkgSWNvTW9vbi5pbyAtLT4KPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjM0IiBoZWlnaHQ9IjMyIiB2aWV3Qm94PSIwIDAgMzQgMzIiPgo8dGl0bGU+cG9seWdvbmFsPC90aXRsZT4KPHBhdGggZD0iTTMuMjg0IDMxLjY2M2wtMy4yLTEuMDExIDcuMTU4LTIxLjIyMSAxNi4xNjggMTAuODYzIDYuOTg5LTIwLjA0MiAzLjIgMS4xNzktOC40MjEgMjQuMDg0LTE2LjE2OC0xMC44NjN6Ij48L3BhdGg+Cjwvc3ZnPgo="},5799:e=>{e.exports="data:image/svg+xml;base64,PCEtLSBHZW5lcmF0ZWQgYnkgSWNvTW9vbi5pbyAtLT4KPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjMyIiBoZWlnaHQ9IjMyIiB2aWV3Qm94PSIwIDAgMzIgMzIiPgo8dGl0bGU+cmVjdGFuZ2xlPC90aXRsZT4KPHBhdGggZD0iTTEuNiA2LjRoMjguODg5djE4Ljc1NmgtMjguODg5di0xOC43NTZ6Ij48L3BhdGg+Cjwvc3ZnPgo="},7701:e=>{e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAxNS4wLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+DQo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4Ig0KCSB3aWR0aD0iMTJweCIgaGVpZ2h0PSIxMnB4IiB2aWV3Qm94PSIwIDAgMTIgMTIiIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDEyIDEyIiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjx0aXRsZT5hbGlnbi12LWI8L3RpdGxlPg0KPGRlc2M+Q3JlYXRlZCB3aXRoIFNrZXRjaC48L2Rlc2M+DQo8cmVjdCBpZD0iUmVjdGFuZ2xlIiBmaWxsPSJub25lIiB3aWR0aD0iMTIiIGhlaWdodD0iMTIiLz4NCjxwYXRoIGQ9Ik0xMSwxMWMwLjI3NiwwLDAuNSwwLjIyNCwwLjUsMC41UzExLjI3NiwxMiwxMSwxMkgxYy0wLjI3NiwwLTAuNS0wLjIyNC0wLjUtMC41UzAuNzI0LDExLDEsMTFIMTF6Ii8+DQo8cGF0aCBkPSJNMTAsMGMwLjI3NiwwLDAuNSwwLjIyNCwwLjUsMC41VjlsMC42LTAuNzk5YzAuMTQ3LTAuMTk3LDAuNDEyLTAuMjU0LDAuNjIzLTAuMTQ4TDExLjgsOC4xDQoJYzAuMTk2LDAuMTQ4LDAuMjU0LDAuNDEyLDAuMTQ3LDAuNjIzTDExLjksOC44MDFsLTEuNSwyYy0wLjE4LDAuMjQtMC41MjIsMC4yNjQtMC43MzQsMC4wNzJMOS42LDEwLjgwMWwtMS41LTINCglDNy45MzUsOC41OCw3Ljk3OSw4LjI2Niw4LjIsOC4xYzAuMTk2LTAuMTQ2LDAuNDY2LTAuMTI3LDAuNjQsMC4wMzNMOC45LDguMjAxTDkuNSw5VjAuNUM5LjUsMC4yMjQsOS43MjQsMCwxMCwweiIvPg0KPGc+DQoJPHBhdGggZD0iTTAuOSw5LjA3OGwyLjc0OS03LjE1N2gxLjAyMUw3LjYsOS4wNzhINi41MjFMNS42ODUsNi45MUgyLjY5MkwxLjkwNiw5LjA3OEgwLjl6IE0yLjk2NSw2LjEzOWgyLjQyN0w0LjY0NSw0LjE1OA0KCQlDNC40MTcsMy41NTYsNC4yNDgsMy4wNjEsNC4xMzcsMi42NzNjLTAuMDkxLDAuNDU5LTAuMjIsMC45MTUtMC4zODYsMS4zNjdMMi45NjUsNi4xMzl6Ii8+DQo8L2c+DQo8ZyBkaXNwbGF5PSJub25lIj4NCgk8cGF0aCBkaXNwbGF5PSJpbmxpbmUiIGQ9Ik05LjYsMC41MDFjMC4yNzYsMCwwLjUsMC4yMjQsMC41LDAuNXYyLjVsMC42LTAuOGMwLjE0Ny0wLjE5NiwwLjQxMi0wLjI1NCwwLjYyMy0wLjE0N2wwLjA3NywwLjA0Nw0KCQljMC4yMjIsMC4xNjYsMC4yNjcsMC40NzksMC4xMDEsMC43bC0xLjUsMmMtMC4yLDAuMjY3LTAuNjAxLDAuMjY3LTAuODAxLDBsLTEuNS0yQzcuNTM0LDMuMDgsNy41NzksMi43NjcsNy44LDIuNjAxDQoJCXMwLjUzNC0wLjEyMSwwLjcsMC4xbDAuNiwwLjh2LTIuNUM5LjEsMC43MjUsOS4zMjMsMC41MDEsOS42LDAuNTAxeiIvPg0KCTxwYXRoIGRpc3BsYXk9ImlubGluZSIgZD0iTTkuNjAxLDExLjc3M2MtMC4yNzYsMC0wLjUtMC4yMjUtMC41LTAuNXYtMi41bC0wLjYsMC43OTlDOC4zNTQsOS43Nyw4LjA4OSw5LjgyNiw3Ljg3OCw5LjcyMQ0KCQlMNy44MDEsOS42NzJDNy41NzksOS41MDgsNy41MzQsOS4xOTMsNy43LDguOTczbDEuNS0yYzAuMi0wLjI2NiwwLjYwMS0wLjI2NiwwLjgwMSwwbDEuNSwyYzAuMTY1LDAuMjIxLDAuMTIsMC41MzUtMC4xMDEsMC42OTkNCgkJYy0wLjIyMSwwLjE2Ni0wLjUzNCwwLjEyMS0wLjctMC4xbC0wLjYtMC43OTl2Mi41QzEwLjEwMSwxMS41NDksOS44NzcsMTEuNzczLDkuNjAxLDExLjc3M3oiLz4NCgkNCgkJPGxpbmUgZGlzcGxheT0iaW5saW5lIiBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAwMDAiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiB4MT0iNy43MjUiIHkxPSI2LjE0NyIgeDI9IjExLjQ3NSIgeTI9IjYuMTQ3Ii8+DQo8L2c+DQo8L3N2Zz4NCg=="},2558:e=>{e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAxNS4wLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+DQo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4Ig0KCSB3aWR0aD0iMTJweCIgaGVpZ2h0PSIxMnB4IiB2aWV3Qm94PSIwIDAgMTIgMTIiIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDEyIDEyIiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjx0aXRsZT5hbGlnbi12LWI8L3RpdGxlPg0KPGRlc2M+Q3JlYXRlZCB3aXRoIFNrZXRjaC48L2Rlc2M+DQo8cmVjdCBpZD0iUmVjdGFuZ2xlIiBmaWxsPSJub25lIiB3aWR0aD0iMTIiIGhlaWdodD0iMTIiLz4NCjxwYXRoIGQ9Ik0xMSw5LjE4OGMwLjI3NiwwLDAuNSwwLjIyNCwwLjUsMC41cy0wLjIyNCwwLjUtMC41LDAuNUgxYy0wLjI3NiwwLTAuNS0wLjIyNC0wLjUtMC41czAuMjI0LTAuNSwwLjUtMC41SDExeiIvPg0KPHBhdGggZD0iTTEwLDAuNDE3YzAuMjc2LDAsMC41LDAuMTc2LDAuNSwwLjM5NHY2LjY5MmwwLjYtMC42MjljMC4xNDctMC4xNTUsMC40MTItMC4xOTksMC42MjMtMC4xMTdMMTEuOCw2Ljc5Mw0KCWMwLjE5NiwwLjExNywwLjI1NCwwLjMyNSwwLjE0NywwLjQ5MUwxMS45LDcuMzQ2bC0xLjUsMS41NzVjLTAuMTgsMC4xODgtMC41MjIsMC4yMDctMC43MzQsMC4wNTdMOS42LDguOTIxTDguMSw3LjM0Ng0KCUM3LjkzNSw3LjE3Miw3Ljk3OSw2LjkyNSw4LjIsNi43OTNjMC4xOTYtMC4xMTQsMC40NjYtMC4xLDAuNjQsMC4wMjZMOC45LDYuODczbDAuNiwwLjYyOVYwLjgxQzkuNSwwLjU5Myw5LjcyNCwwLjQxNywxMCwwLjQxN3oiLz4NCjxnPg0KCTxwYXRoIGQ9Ik0wLjksOS4wNzhsMi43NDktNy4xNTdoMS4wMjFMNy42LDkuMDc4SDYuNTIxTDUuNjg1LDYuOTFIMi42OTJMMS45MDYsOS4wNzhIMC45eiBNMi45NjUsNi4xMzloMi40MjdMNC42NDUsNC4xNTgNCgkJQzQuNDE3LDMuNTU2LDQuMjQ4LDMuMDYxLDQuMTM3LDIuNjczYy0wLjA5MSwwLjQ1OS0wLjIyLDAuOTE1LTAuMzg2LDEuMzY3TDIuOTY1LDYuMTM5eiIvPg0KPC9nPg0KPGcgZGlzcGxheT0ibm9uZSI+DQoJPHBhdGggZGlzcGxheT0iaW5saW5lIiBkPSJNOS42LDAuNTAxYzAuMjc2LDAsMC41LDAuMjI0LDAuNSwwLjV2Mi41bDAuNi0wLjhjMC4xNDctMC4xOTYsMC40MTItMC4yNTQsMC42MjMtMC4xNDdsMC4wNzcsMC4wNDcNCgkJYzAuMjIyLDAuMTY2LDAuMjY3LDAuNDc5LDAuMTAxLDAuN2wtMS41LDJjLTAuMiwwLjI2Ny0wLjYwMSwwLjI2Ny0wLjgwMSwwbC0xLjUtMkM3LjUzNCwzLjA4LDcuNTc5LDIuNzY3LDcuOCwyLjYwMQ0KCQlzMC41MzQtMC4xMjEsMC43LDAuMWwwLjYsMC44di0yLjVDOS4xLDAuNzI1LDkuMzIzLDAuNTAxLDkuNiwwLjUwMXoiLz4NCgk8cGF0aCBkaXNwbGF5PSJpbmxpbmUiIGQ9Ik05LjYwMSwxMS43NzNjLTAuMjc2LDAtMC41LTAuMjI1LTAuNS0wLjV2LTIuNWwtMC42LDAuNzk5QzguMzU0LDkuNzcsOC4wODksOS44MjYsNy44NzgsOS43MjENCgkJTDcuODAxLDkuNjcyQzcuNTc5LDkuNTA4LDcuNTM0LDkuMTkzLDcuNyw4Ljk3M2wxLjUtMmMwLjItMC4yNjYsMC42MDEtMC4yNjYsMC44MDEsMGwxLjUsMmMwLjE2NSwwLjIyMSwwLjEyLDAuNTM1LTAuMTAxLDAuNjk5DQoJCWMtMC4yMjEsMC4xNjYtMC41MzQsMC4xMjEtMC43LTAuMWwtMC42LTAuNzk5djIuNUMxMC4xMDEsMTEuNTQ5LDkuODc3LDExLjc3Myw5LjYwMSwxMS43NzN6Ii8+DQoJDQoJCTxsaW5lIGRpc3BsYXk9ImlubGluZSIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDAwMDAwIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgeDE9IjcuNzI1IiB5MT0iNi4xNDciIHgyPSIxMS40NzUiIHkyPSI2LjE0NyIvPg0KPC9nPg0KPC9zdmc+DQo="},9234:e=>{e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAxNS4wLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+DQo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4Ig0KCSB3aWR0aD0iMTJweCIgaGVpZ2h0PSIxMnB4IiB2aWV3Qm94PSIwIDAgMTIgMTIiIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDEyIDEyIiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjx0aXRsZT5hbGlnbi12LWI8L3RpdGxlPg0KPGRlc2M+Q3JlYXRlZCB3aXRoIFNrZXRjaC48L2Rlc2M+DQo8cmVjdCBpZD0iUmVjdGFuZ2xlIiBmaWxsPSJub25lIiB3aWR0aD0iMTIiIGhlaWdodD0iMTIiLz4NCjxwYXRoIGRpc3BsYXk9Im5vbmUiIGQ9Ik0xMSwxMWMwLjI3NiwwLDAuNSwwLjIyNCwwLjUsMC41UzExLjI3NiwxMiwxMSwxMkgxYy0wLjI3NiwwLTAuNS0wLjIyNC0wLjUtMC41UzAuNzI0LDExLDEsMTFIMTF6Ii8+DQo8cGF0aCBkaXNwbGF5PSJub25lIiBkPSJNMTAsMGMwLjI3NiwwLDAuNSwwLjIyNCwwLjUsMC41VjlsMC42LTAuNzk5YzAuMTQ3LTAuMTk3LDAuNDEyLTAuMjU0LDAuNjIzLTAuMTQ4TDExLjgsOC4xDQoJYzAuMTk2LDAuMTQ4LDAuMjU0LDAuNDEyLDAuMTQ3LDAuNjIzTDExLjksOC44MDFsLTEuNSwyYy0wLjE4LDAuMjQtMC41MjIsMC4yNjQtMC43MzQsMC4wNzJMOS42LDEwLjgwMWwtMS41LTINCglDNy45MzUsOC41OCw3Ljk3OSw4LjI2Niw4LjIsOC4xYzAuMTk2LTAuMTQ2LDAuNDY2LTAuMTI3LDAuNjQsMC4wMzNMOC45LDguMjAxTDkuNSw5VjAuNUM5LjUsMC4yMjQsOS43MjQsMCwxMCwweiIvPg0KPGc+DQoJPHBhdGggZD0iTTAuOSw5LjA3OGwyLjc0OS03LjE1N2gxLjAyMUw3LjYsOS4wNzhINi41MjFMNS42ODUsNi45MUgyLjY5MkwxLjkwNiw5LjA3OEgwLjl6IE0yLjk2NSw2LjEzOWgyLjQyN0w0LjY0NSw0LjE1OA0KCQlDNC40MTcsMy41NTYsNC4yNDgsMy4wNjEsNC4xMzcsMi42NzNjLTAuMDkxLDAuNDU5LTAuMjIsMC45MTUtMC4zODYsMS4zNjdMMi45NjUsNi4xMzl6Ii8+DQo8L2c+DQo8Zz4NCgk8cGF0aCBkPSJNOS42LDAuNTAxYzAuMjc2LDAsMC41LDAuMjI0LDAuNSwwLjV2Mi41bDAuNi0wLjhjMC4xNDctMC4xOTYsMC40MTItMC4yNTQsMC42MjMtMC4xNDdsMC4wNzcsMC4wNDcNCgkJYzAuMjIyLDAuMTY2LDAuMjY3LDAuNDc5LDAuMTAxLDAuN2wtMS41LDJjLTAuMiwwLjI2Ny0wLjYwMSwwLjI2Ny0wLjgwMSwwbC0xLjUtMkM3LjUzNCwzLjA4LDcuNTc5LDIuNzY3LDcuOCwyLjYwMQ0KCQlzMC41MzQtMC4xMjEsMC43LDAuMWwwLjYsMC44di0yLjVDOS4xLDAuNzI1LDkuMzIzLDAuNTAxLDkuNiwwLjUwMXoiLz4NCgk8cGF0aCBkPSJNOS42MDEsMTEuNzczYy0wLjI3NiwwLTAuNS0wLjIyNS0wLjUtMC41di0yLjVsLTAuNiwwLjc5OUM4LjM1NCw5Ljc3LDguMDg5LDkuODI2LDcuODc4LDkuNzIxTDcuODAxLDkuNjcyDQoJCUM3LjU3OSw5LjUwOCw3LjUzNCw5LjE5Myw3LjcsOC45NzNsMS41LTJjMC4yLTAuMjY2LDAuNjAxLTAuMjY2LDAuODAxLDBsMS41LDJjMC4xNjUsMC4yMjEsMC4xMiwwLjUzNS0wLjEwMSwwLjY5OQ0KCQljLTAuMjIxLDAuMTY2LTAuNTM0LDAuMTIxLTAuNy0wLjFsLTAuNi0wLjc5OXYyLjVDMTAuMTAxLDExLjU0OSw5Ljg3NywxMS43NzMsOS42MDEsMTEuNzczeiIvPg0KCTxsaW5lIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzAwMDAwMCIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIHgxPSI3LjcyNSIgeTE9IjYuMTQ3IiB4Mj0iMTEuNDc1IiB5Mj0iNi4xNDciLz4NCjwvZz4NCjwvc3ZnPg0K"},2715:e=>{e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAxNS4wLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+DQo8c3ZnIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiIHdpZHRoPSIxMnB4Ig0KCSBoZWlnaHQ9IjEycHgiIHZpZXdCb3g9IjAgMCAxMiAxMiIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMTIgMTIiIHhtbDpzcGFjZT0icHJlc2VydmUiPg0KPGcgaWQ9IkxheWVyXzEiPg0KCTx0aXRsZT5hbGlnbi12LXQ8L3RpdGxlPg0KCTxkZXNjPkNyZWF0ZWQgd2l0aCBTa2V0Y2guPC9kZXNjPg0KCTxyZWN0IGlkPSJSZWN0YW5nbGUiIGZpbGw9Im5vbmUiIHdpZHRoPSIxMiIgaGVpZ2h0PSIxMiIvPg0KCTxwYXRoIGQ9Ik0xMSwxYzAuMjc2LDAsMC41LTAuMjI0LDAuNS0wLjVTMTEuMjc2LDAsMTEsMEgxQzAuNzI0LDAsMC41LDAuMjI0LDAuNSwwLjVTMC43MjQsMSwxLDFIMTF6Ii8+DQoJPHBhdGggZD0iTTEwLDEyYzAuMjc2LDAsMC41LTAuMjIzLDAuNS0wLjVWM2wwLjYsMC44YzAuMTQ3LDAuMTk2LDAuNDEyLDAuMjU0LDAuNjIzLDAuMTQ3TDExLjgsMy45DQoJCWMwLjE5Ni0wLjE0NywwLjI1NC0wLjQxMSwwLjE0Ny0wLjYyM0wxMS45LDMuMmwtMS41LTJjLTAuMTgtMC4yNC0wLjUyMi0wLjI2NC0wLjczNC0wLjA3Mkw5LjYsMS4ybC0xLjUsMg0KCQlDNy45MzUsMy40MjEsNy45NzksMy43MzQsOC4yLDMuOWMwLjE5NiwwLjE0NywwLjQ2NiwwLjEyOCwwLjY0LTAuMDMzTDguOSwzLjhMOS41LDN2OC41QzkuNSwxMS43NzcsOS43MjQsMTIsMTAsMTJ6Ii8+DQo8L2c+DQo8ZyBpZD0iTGF5ZXJfMiI+DQoJPGc+DQoJCTxwYXRoIGQ9Ik0wLjksOS4wNzhsMi43NDktNy4xNTdoMS4wMjFsMi45MjksNy4xNTdINi41Mkw1LjY4NSw2LjkxSDIuNjkyTDEuOTA2LDkuMDc4SDAuOXogTTIuOTY1LDYuMTM5aDIuNDI3TDQuNjQ1LDQuMTU3DQoJCQlDNC40MTcsMy41NTUsNC4yNDgsMy4wNiw0LjEzNywyLjY3M0M0LjA0NiwzLjEzMiwzLjkxNywzLjU4NywzLjc1MSw0LjA0TDIuOTY1LDYuMTM5eiIvPg0KCTwvZz4NCjwvZz4NCjwvc3ZnPg0K"},4365:e=>{e.exports="data:image/svg+xml;base64,PCEtLSBHZW5lcmF0ZWQgYnkgSWNvTW9vbi5pbyAtLT4KPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjMyIiBoZWlnaHQ9IjMyIiB2aWV3Qm94PSIwIDAgMzIgMzIiPgo8dGl0bGU+dGV4dDwvdGl0bGU+CjxwYXRoIGQ9Ik01LjAyMSAzMmgtNS4wMjFsMTQuMDE0LTMyaDQuMTA4bDEzLjg3NyAzMmgtNS4xMTNsLTMuMjg3LTcuODY0aC0xNS4zMzhsLTMuMjQxIDcuODY0ek05Ljg2IDIwLjIwM2gxMi4wOTdsLTYuMDI2LTE1LjAwNi02LjA3MSAxNS4wMDZ6Ij48L3BhdGg+Cjwvc3ZnPgo="},8148:e=>{e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAxNS4wLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+DQo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4Ig0KCSB3aWR0aD0iMTJweCIgaGVpZ2h0PSIxMnB4IiB2aWV3Qm94PSIwIDAgMTIgMTIiIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDEyIDEyIiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjx0aXRsZT5ib2xkPC90aXRsZT4NCjxkZXNjPkNyZWF0ZWQgd2l0aCBTa2V0Y2guPC9kZXNjPg0KPHJlY3QgaWQ9IlJlY3RhbmdsZSIgZmlsbD0ibm9uZSIgd2lkdGg9IjEyIiBoZWlnaHQ9IjEyIi8+DQo8Zz4NCgk8cGF0aCBkPSJNMTAuNTUzLDEuNjAzYy0wLjEwOSwwLjAwNC0wLjI3LDAuMDI3LTAuNDgsMC4wN1M5LjY4OSwxLjc4MSw5LjU1NywxLjg2N2MtMC4xMzMsMC4wOS0wLjIyNSwwLjI3NS0wLjI3NSwwLjU1Nw0KCQlTOS4yMDUsMy4wNDgsOS4yMDUsMy40NTVWNy4wN2MwLDAuNDYxLTAuMDk2LDAuODYxLTAuMjg3LDEuMjAxUzguNDc1LDguODkxLDguMTYyLDkuMTA5QzcuODU0LDkuMzIsNy41MjcsOS40NzEsNy4xODgsOS41NjMNCgkJQzYuODQ0LDkuNjU0LDYuNTE3LDkuNzAxLDYuMjA0LDkuNzAxYy0wLjUsMC0wLjk0NS0wLjA2Ni0xLjMzNi0wLjE5N1M0LjE0OSw5LjE5NywzLjg4NCw4Ljk3NQ0KCQlDMy42MjIsOC43NTIsMy40MjUsOC40OTYsMy4yOTIsOC4yMDlDMy4xNiw3LjkyMiwzLjA5Myw3LjYyMywzLjA5Myw3LjMxMVYyLjM5NGMwLTAuMTM3LTAuMDIyLTAuMjUxLTAuMDY3LTAuMzQzDQoJCVMyLjg5LDEuODc1LDIuNzUzLDEuNzk2QzIuNjU2LDEuNzQyLDIuNTMxLDEuNjk4LDIuMzc4LDEuNjY1UzIuMTAxLDEuNjExLDIuMDAzLDEuNjAzVjEuMTg3aDMuNDYydjAuNDE2DQoJCUM1LjM1NiwxLjYwNyw1LjIxOSwxLjYyNSw1LjA1NCwxLjY1NkM0Ljg4NywxLjY4Nyw0Ljc2NSwxLjcxNiw0LjY4NywxLjc0NEM0LjU1NCwxLjc5MSw0LjQ2NSwxLjg2OSw0LjQyMSwxLjk3OA0KCQlDNC4zNzUsMi4wODcsNC4zNTMsMi4yMDYsNC4zNTMsMi4zMzV2NC41ODljMCwwLjIyMywwLjAyNCwwLjQ1NywwLjA3NCwwLjcwMWMwLjA0OCwwLjI0NCwwLjE0NSwwLjQ3MSwwLjI4OSwwLjY4Mg0KCQljMC4xNTIsMC4yMTUsMC4zNTksMC4zOTEsMC42MjEsMC41MjdzMC42MjEsMC4yMDUsMS4wNzgsMC4yMDVjMC40MzEsMCwwLjc5LTAuMDY4LDEuMDgzLTAuMjA1YzAuMjg5LTAuMTM3LDAuNTItMC4zMTYsMC42ODgtMC41MzkNCgkJYzAuMTYtMC4yMTEsMC4yNzMtMC40MzIsMC4zNC0wLjY2MnMwLjEtMC40NjMsMC4xLTAuNjk3VjMuNTI5YzAtMC40MzMtMC4wMzEtMC43ODgtMC4wOTQtMS4wNjMNCgkJQzguNDY5LDIuMTkxLDguMzc3LDIuMDExLDguMjU2LDEuOTI1QzguMTE5LDEuODI4LDcuOTMyLDEuNzUxLDcuNjk3LDEuNjk3QzcuNDU5LDEuNjQyLDcuMjc5LDEuNjExLDcuMTU0LDEuNjAzVjEuMTg3aDMuMzk4VjEuNjAzDQoJCXoiLz4NCgk8cGF0aCBkPSJNMS41NywxMC44NTd2LTAuNTkyaDkuMDc3djAuNTkySDEuNTd6Ii8+DQo8L2c+DQo8L3N2Zz4NCg=="},7442:e=>{"use strict";e.exports=u},2089:e=>{"use strict";e.exports=h},3321:e=>{"use strict";e.exports=I},422:e=>{"use strict";e.exports=p},196:e=>{"use strict";e.exports=g},3205:e=>{"use strict";e.exports=f},7050:e=>{"use strict";e.exports=N},3751:e=>{"use strict";e.exports=b},8717:e=>{"use strict";e.exports=v},9028:e=>{"use strict";e.exports=w},1082:e=>{"use strict";e.exports=x},7835:e=>{"use strict";e.exports=y},6333:e=>{"use strict";e.exports=A},4272:e=>{"use strict";if(void 0===T){var t=new Error("Cannot find module 'esri/geometry/support/webMercatorUtils'");throw t.code="MODULE_NOT_FOUND",t}e.exports=T},5633:e=>{"use strict";e.exports=j},9620:e=>{"use strict";e.exports=d},600:e=>{"use strict";e.exports=C},26:e=>{"use strict";e.exports=S},8897:e=>{"use strict";e.exports=L},7417:e=>{"use strict";e.exports=M},8114:e=>{"use strict";e.exports=m},1252:e=>{"use strict";e.exports=E},624:e=>{"use strict";e.exports=a},2686:e=>{"use strict";e.exports=o},9244:e=>{"use strict";e.exports=i},8972:e=>{"use strict";e.exports=r},4321:e=>{"use strict";e.exports=n},8993:e=>{"use strict";e.exports=s},9298:e=>{"use strict";e.exports=D},5562:e=>{"use strict";e.exports=l},4337:e=>{"use strict";e.exports=c}},t={};function k(i){var r=t[i];if(void 0!==r)return r.exports;var n=t[i]={id:i,exports:{}};return e[i](n,n.exports,k),n.exports}k.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return k.d(t,{a:t}),t},k.d=(e,t)=>{for(var i in t)k.o(t,i)&&!k.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},k.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),k.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},k.p="",k.nc=void 0;var z={};return k.p=window.jimuConfig.baseUrl,(()=>{"use strict";k.r(z),k.d(z,{ScrollableContainer:()=>pt,__set_webpack_public_path__:()=>ft,default:()=>gt});var e,t=k(9244),i=k(8972);!function(e){e.SINGLE="single",e.CONTINUOUS="continuous",e.UPDATE="update"}(e||(e={}));var r=k(4321),n=k(9044),o=k.n(n),a=function(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(i[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(r=Object.getOwnPropertySymbols(e);n<r.length;n++)t.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(e,r[n])&&(i[r[n]]=e[r[n]])}return i};const s=e=>{const i=window.SVG,{className:r}=e,n=a(e,["className"]),s=(0,t.classNames)("jimu-icon jimu-icon-component",r);return i?t.React.createElement(i,Object.assign({className:s,src:o()},n)):t.React.createElement("svg",Object.assign({className:s},n))};var l=k(5031),c=k.n(l),u=function(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(i[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(r=Object.getOwnPropertySymbols(e);n<r.length;n++)t.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(e,r[n])&&(i[r[n]]=e[r[n]])}return i};const d=e=>{const i=window.SVG,{className:r}=e,n=u(e,["className"]),o=(0,t.classNames)("jimu-icon jimu-icon-component",r);return i?t.React.createElement(i,Object.assign({className:o,src:c()},n)):t.React.createElement("svg",Object.assign({className:o},n))};var h=k(9609),m=k.n(h),p=function(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(i[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(r=Object.getOwnPropertySymbols(e);n<r.length;n++)t.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(e,r[n])&&(i[r[n]]=e[r[n]])}return i};const g=e=>{const i=window.SVG,{className:r}=e,n=p(e,["className"]),o=(0,t.classNames)("jimu-icon jimu-icon-component",r);return i?t.React.createElement(i,Object.assign({className:o,src:m()},n)):t.React.createElement("svg",Object.assign({className:o},n))};var f=k(2167),y=k.n(f),v=function(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(i[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(r=Object.getOwnPropertySymbols(e);n<r.length;n++)t.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(e,r[n])&&(i[r[n]]=e[r[n]])}return i};const w=e=>{const i=window.SVG,{className:r}=e,n=v(e,["className"]),o=(0,t.classNames)("jimu-icon jimu-icon-component",r);return i?t.React.createElement(i,Object.assign({className:o,src:y()},n)):t.React.createElement("svg",Object.assign({className:o},n))};var b=k(2838),x=k.n(b),M=function(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(i[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(r=Object.getOwnPropertySymbols(e);n<r.length;n++)t.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(e,r[n])&&(i[r[n]]=e[r[n]])}return i};const L=e=>{const i=window.SVG,{className:r}=e,n=M(e,["className"]),o=(0,t.classNames)("jimu-icon jimu-icon-component",r);return i?t.React.createElement(i,Object.assign({className:o,src:x()},n)):t.React.createElement("svg",Object.assign({className:o},n))};var S=k(3303),C=k.n(S),N=k(2686);function A(e,i){e.surfaces[1].bg;return t.css`
  .drawToolbarDiv {
    margin: 8px;
  }

  .drawToolbarBottomDiv {
    display: flex;
    justify-content: center;
    padding-top: 12px;
  }

  .drawToolbarDiv button,
  .drawToolbarBottomDiv button {
    margin: 4px;
  }

  .drawToolbarDiv>button>Img.jimu-icon,
  .drawToolbarBottomDiv>button>Img.jimu-icon {
    margin: 0;
  }

  .jimu-btn.btn.btn-default.btn-sm.active img,
  .jimu-btn.btn.btn-primary.btn-sm img {
    filter: invert(1);
  }
  .jimu-draw-symbol-divide-line {
    border-right: 1px solid rgb(182, 182, 182);
    height: 26px;
  }
  .color-presenter {
    inset: 2px;
  }

  .symbol-wapper.outer-preview-btn {
    height: 26px;
    width: 26px;
  }
  `}const T={_widgetLabel:"Draw",drawPoint:"Draw point",drawLine:"Draw polyline",drawFreeLine:"Draw freehand polyline",drawRectangle:"Draw rectangle",drawPolygon:"Draw polygon",drawFreePolygon:"Draw freehand polygon",drawUndo:"Undo",drawRedo:"Redo",drawClear:"Clear all graphics",drawClearSelected:"Clear selected graphic",drawCircle:"Draw circle",drawText:"Draw text",preview:"Preview",fontColor:"Font color",fontSize:"Font size",fontHaloSize:"Font halo size",fontHaloColor:"Font halo color",enableFontHalo:"Enable font halo",fontHalo:"Font halo",fontRotation:"Font angle",fontVAbase:"Font vertical align baseline",fontVAtop:"Font vertical align top",fontVAbottom:"Font vertical align bottom",fontVAmid:"Font vertical align middle",fontBold:"Bold",fontItalic:"Italic",fontUnderline:"Underline",fontHAleft:"Font horizontal align left",fontHAcenter:"Font horizontal align center",fontHAright:"Font horizontal align right",kilometers:"Kilometers",miles:"Miles",meters:"Meters",nauticals:"Nautical Miles",feet:"Feet",yards:"Yards",squareKilometers:"Square Kilometers",squareMiles:"Square Miles",acres:"Acres",hectares:"Hectares",squareMeters:"Square Meters",squareFeet:"Square Feet",squareYards:"Square Yards"};var E=k(624),j=k(8993),I=k(5562),D=k(4337),O=k(7442),B=k(9620),P=k(2089),R=k(8114),G=k(3659),_=k.n(G),V=k(3),U=k.n(V),W=k(7038),F=k.n(W),H=k(5072),Q=k.n(H),Y=k(7825),Z=k.n(Y),J=k(7659),$=k.n(J),q=k(5056),X=k.n(q),K=k(540),ee=k.n(K),te=k(1113),ie=k.n(te),re=k(2480),ne={};ne.styleTagTransform=ie(),ne.setAttributes=X(),ne.insert=$().bind(null,"head"),ne.domAPI=Z(),ne.insertStyleElement=ee();Q()(re.A,ne);re.A&&re.A.locals&&re.A.locals;var oe=k(422),ae=k(196),se=k(3205),le=k(7835),ce=k(8717),ue=k(9028),de=k(3751),he=k(1082),me=k(7417),pe=function(e,t,i,r){return new(i||(i=Promise))((function(n,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,s)}l((r=r.apply(e,t||[])).next())}))};const{useState:ge,useEffect:fe,useRef:ye,useImperativeHandle:ve,forwardRef:we}=t.React,be=we(((e,i)=>{var n,o,a;const s=e.drawLayer,l=e.currentTextSymbol,c=e.sketchViewModel,u=e.currentTool,d=e.showTextPreview;let h=null;const m=ye(!1),p=ye(!1),g=ye(null),f=ye(null),y=(ye(null),ye(!0)),v=ye({distanceUnit:null,areaUnit:null,segmentsOn:!1,lengthOn:!0,areaOn:!0,perimeterOn:!0,radiusOn:!0,pointRound:5,otherRound:2,rotateSegments:!0}),w=ye(new Set),b=ye(!1),x=(e,t)=>{let i;return function(...r){clearTimeout(i),i=setTimeout((()=>{clearTimeout(i),e(...r)}),t)}},M=e=>e&&"object"==typeof e&&"text"===e.type&&"string"==typeof e.text,L=[{unit:"square-kilometers",label:e.nls("squareKilometers")||"Square Kilometers",abbreviation:"km\xb2",conversion:1e-6},{unit:"square-miles",label:e.nls("squareMiles")||"Square Miles",abbreviation:"mi\xb2",conversion:3.86102e-7},{unit:"acres",label:e.nls("acres")||"Acres",abbreviation:"ac",conversion:247105e-9},{unit:"hectares",label:e.nls("hectares")||"Hectares",abbreviation:"ha",conversion:1e-4},{unit:"square-meters",label:e.nls("squareMeters")||"Square Meters",abbreviation:"m\xb2",conversion:1},{unit:"square-feet",label:e.nls("squareFeet")||"Square Feet",abbreviation:"ft\xb2",conversion:10.7639},{unit:"square-yards",label:e.nls("squareYards")||"Square Yards",abbreviation:"yd\xb2",conversion:1.19599}],S=[{unit:"kilometers",label:e.nls("kilometers")||"Kilometers",abbreviation:"km",conversion:.001},{unit:"miles",label:e.nls("miles")||"Miles",abbreviation:"mi",conversion:621371e-9},{unit:"meters",label:e.nls("meters")||"Meters",abbreviation:"m",conversion:1},{unit:"nautical-miles",label:e.nls("nauticals")||"Nautical Miles",abbreviation:"NM",conversion:539957e-9},{unit:"feet",label:e.nls("feet")||"Feet",abbreviation:"ft",conversion:3.28084},{unit:"yards",label:e.nls("yards")||"Yards",abbreviation:"yd",conversion:1.09361}],C=[...S,...e.config.userDistances],N=[...L,...e.config.userAreas],[A,T]=ge(C[e.config.defaultDistance]||C[0]),[E,j]=ge(N[e.config.defaultArea]||N[0]),[I,k]=ge(C),[z,B]=ge(N),[G,_]=ge(!1),V=e=>{_(e)},[U,W]=ge(null),[F,H]=ge(null),[Q,Y]=ge(null),[Z,J]=ge(!1),[$,q]=ge(!0),[X,K]=ge(!1),[ee,te]=ge(!0),[ie,re]=ge(!0),[ne,we]=ge(!0),[be,xe]=ge(!0),[Me,Le]=ge(!1),[Se,Ce]=ge(!0),[Ne,Ae]=ge(null),[Te,Ee]=ge(u),[je,Ie]=ge(!1),[De,ke]=ge(5),[ze,Oe]=ge(2),[Be,Pe]=ge(new Set),[Re,Ge]=ge(!1),[_e,Ve]=ge(new Set),[Ue,We]=ge(new Map),[Fe,He]=ge(null),[Qe,Ye]=ge(!1),[Ze,Je]=ge(null),[$e,qe]=ge(null),[Xe,Ke]=ge(null),[et,tt]=ge("rgba(0,0,0,1)"),[it,rt]=ge(14),[nt,ot]=ge(0),[at,st]=ge(!0),[lt,ct]=ge("rgba(255,255,255,1)"),[ut,dt]=ge(2),ht=e=>{if(!Ze)return;const t=e||$e;if(t)try{const e=Ze.symbol.text,i=new R.default({text:e,color:t.color,font:{size:t.font.size,weight:t.font.weight,style:t.font.style,decoration:t.font.decoration,family:t.font.family||"Arial"},angle:t.angle,haloColor:t.haloColor,haloSize:t.haloSize,verticalAlignment:t.verticalAlignment,horizontalAlignment:t.horizontalAlignment,xoffset:t.xoffset,yoffset:t.yoffset,backgroundColor:t.backgroundColor});Ze.symbol=i,Ze.attributes||(Ze.attributes={}),Ze.attributes.customized=!0,Ze.attributes.lastModified=Date.now();try{Ze.visible=!1,setTimeout((()=>{Ze&&(Ze.visible=!0)}),50)}catch(e){console.warn("Visibility toggle refresh failed:",e)}if(s&&"function"==typeof s.refresh)try{s.refresh()}catch(e){console.warn("Layer refresh failed:",e)}if(s&&Ze.layer===s)try{const e=Ze.visible,t=Ze.geometry;s.remove(Ze),Ze.visible=e,Ze.geometry=t,s.add(Ze)}catch(e){console.warn("Remove/add refresh failed:",e)}if(h)try{"function"==typeof h.redraw&&h.redraw()}catch(e){console.warn("Map redraw failed:",e)}}catch(e){console.error("\u274c Error applying measurement text changes:",e)}},[mt,pt]=ge(!1),[gt,ft]=ge(null),[yt,vt]=ge(null),[wt,bt]=ge(null),[xt,Mt]=ge(null),Lt=ye(!1),St=ye(null),Ct=e=>{if(!Me)return!1;if("polyline"!==e.type&&"polygon"!==e.type)return!1;if("polyline"===e.type){const t=e;if(!t.paths||0===t.paths.length)return!1;return t.paths.some((e=>e.length>2))}if("polygon"===e.type){const t=e;if(!t.rings||0===t.rings.length||!t.rings[0])return!1;return!(61===t.rings[0].length)}return!1},Nt=e=>{var t,i,r,n;if(!e)return!1;if((null===(t=e.attributes)||void 0===t?void 0:t.isMeasurementLabel)||(null===(i=e.attributes)||void 0===i?void 0:i.hideFromList)||(null===(r=e.attributes)||void 0===r?void 0:r.measurementType))return!0;if(e.measureParent)return!0;if("text"===(null===(n=e.symbol)||void 0===n?void 0:n.type)){const t=e.symbol.text;return[/\d+(\.\d+)?\s*(km|mi|m|ft|yd|km\xb2|mi\xb2|ac|ha|m\xb2|ft\xb2|yd\xb2)/,/Area:|Perimeter:|Radius:|Total:/,/Lat:|Lon:|X:|Y:/,/^[\d,]+(\.\d+)?\s*(km|mi|m|ft|yd)$/].some((e=>e.test(t)))}return!1},At=(e,t)=>{var i;if(null===(i=e.attributes)||void 0===i?void 0:i.parentGraphicId){const i=t.find((t=>{var i;return(null===(i=t.attributes)||void 0===i?void 0:i.uniqueId)===e.attributes.parentGraphicId}));if(i)return i}const r=e.geometry;if(!r)return null;let n=null,o=1/0;return t.forEach((t=>{var i,a;if(t===e)return;if("text"===(null===(i=t.symbol)||void 0===i?void 0:i.type))return;if(!t.geometry)return;const s=(null===(a=t.geometry.extent)||void 0===a?void 0:a.center)||t.geometry;if(s){const e=Math.sqrt(Math.pow(r.x-s.x,2)+Math.pow(r.y-s.y,2));e<o&&(o=e,n=t)}})),n},Tt=e=>{var t;if(!e||!e.geometry)return!1;if(Nt(e))return!1;if(!["polyline","polygon","point"].includes(e.geometry.type))return!1;const i=(null===(t=e.attributes)||void 0===t?void 0:t.name)||"";return!(i.includes("_temp_")||i.includes("_system_")||/^temp_\d+$/.test(i)||/^system_\d+$/.test(i))},Et=ye(x((e=>{!Re&&m.current&&vi(e,null,!0)}),200)),jt=()=>s&&"object"==typeof s&&"function"==typeof s.add,It=e=>{if(!s||!e)return!1;try{return"function"==typeof s.remove?(s.remove(e),!0):!(!s.graphics||"function"!=typeof s.graphics.remove)&&(s.graphics.remove(e),!0)}catch(e){return console.warn("Error removing graphic from layer:",e),!1}},Dt=e=>{if(!s||!e)return!1;try{if(s.graphics&&"function"==typeof s.graphics.includes)return s.graphics.includes(e);if("function"==typeof s.contains)return s.contains(e);if(s.graphics&&Array.isArray(s.graphics.items))return s.graphics.items.includes(e);if(s.graphics&&s.graphics.toArray){return s.graphics.toArray().includes(e)}return!1}catch(e){return console.warn("Error checking if layer contains graphic:",e),!1}},kt=e=>{var t,i,r;if(null===(t=e.attributes)||void 0===t?void 0:t.uniqueId)return e.attributes.uniqueId;return`${(null===(i=e.geometry)||void 0===i?void 0:i.type)||"unknown"}_${(null===(r=e.geometry)||void 0===r?void 0:r.extent)?`${e.geometry.extent.xmin}_${e.geometry.extent.ymin}`:"nocoords"}_${Date.now()}`};let zt=null,Ot=null;const Bt=(e,t)=>{if(h&&e&&!Lt.current){Lt.current=!0,St.current=e,pt(!0),Mt(e),ft(t);try{h.navigation.mouseWheelZoomEnabled=!1,h.navigation.browserTouchPanEnabled=!1}catch(e){console.error("\u274c Error disabling map navigation:",e)}try{const e=h.container;e&&(e.style.cursor="move")}catch(e){console.error("\u274c Error setting cursor:",e)}try{zt&&(zt.remove(),zt=null),Ot&&(Ot.remove(),Ot=null),zt=h.on("pointer-move",(e=>{Pt(e)})),Ot=h.on("pointer-up",(e=>{Gt(e)}))}catch(e){console.error("\u274c Error setting up drag listeners:",e),Lt.current=!1,St.current=null,pt(!1),Mt(null)}}},Pt=e=>{if(Lt.current&&St.current&&h)try{const t=h.toMap({x:e.x,y:e.y});t&&St.current&&(St.current.geometry=t,St.current._dragHandle&&(St.current._dragHandle.geometry=t),St.current._selectionOverlay&&(St.current._selectionOverlay.geometry=t),St.current.attributes||(St.current.attributes={}),St.current.attributes.hasCustomPosition=!0,St.current.attributes.lastMoved=Date.now())}catch(e){console.error("\u274c Error during label drag move:",e)}},Rt=e=>{var t,i;return!!((null===(t=null==e?void 0:e.attributes)||void 0===t?void 0:t.isMeasurementLabel)||(null===(i=null==e?void 0:e.attributes)||void 0===i?void 0:i.isDragHandle)||(null==e?void 0:e._selectionOverlay)||(null==e?void 0:e.measureParent))},Gt=e=>{if(!Lt.current||!St.current)return;const t=St.current;e&&e.stopPropagation&&e.stopPropagation(),e&&e.preventDefault&&e.preventDefault();try{if(zt&&(zt.remove(),zt=null),Ot&&(Ot.remove(),Ot=null),yt&&(yt.remove(),vt(null)),wt&&(wt.remove(),bt(null)),h){h.navigation.mouseWheelZoomEnabled=!0,h.navigation.browserTouchPanEnabled=!0;const e=h.container;e&&(e.style.cursor="default")}if(t.attributes&&t.geometry){const e=t.geometry;t.attributes.customized=!0,t.attributes.lastModified=Date.now(),t.attributes.hasCustomPosition=!0,t.attributes.customPosition={x:e.x,y:e.y,spatialReference:e.spatialReference},t.attributes.lastMoved=Date.now()}setTimeout((()=>{Ut()}),100)}catch(e){console.error("\u274c Error ending label drag:",e)}finally{Lt.current=!1,St.current=null,pt(!1),Mt(null),ft(null),setTimeout((()=>{t&&p.current&&Qt(t)}),250)}},_t=e=>{if(mt&&xt)try{if(h){h.navigation.mouseWheelZoomEnabled=!0,h.navigation.browserTouchPanEnabled=!0;const e=h.container;e&&(e.style.cursor="default")}yt&&(yt.remove(),vt(null)),wt&&(wt.remove(),bt(null)),xt.attributes&&(xt.attributes.customized=!0,xt.attributes.lastModified=Date.now())}catch(e){console.error("\u274c Error ending label drag:",e)}finally{pt(!1),Mt(null),ft(null)}},Vt=(e,t)=>{var i,r;if((null===(i=e.attributes)||void 0===i?void 0:i.hasCustomPosition)&&(null===(r=e.attributes)||void 0===r?void 0:r.customPosition))try{const t=e.attributes.customPosition;return new oe.default({x:t.x,y:t.y,spatialReference:t.spatialReference})}catch(t){console.warn("Error loading custom position, falling back to default:",t),e.attributes.hasCustomPosition=!1,e.attributes.customPosition=null}return t},Ut=()=>{if(s&&jt())try{const e=s.graphics.toArray(),t=e.filter((e=>{var t,i,r;return(null===(t=e.attributes)||void 0===t?void 0:t.isSelectionOverlay)&&(null===(i=e.attributes)||void 0===i?void 0:i.isMeasurementOverlay)||(null===(r=e.attributes)||void 0===r?void 0:r.isDragHandle)}));t.forEach((e=>{try{s.remove(e)}catch(e){console.warn("Error removing measurement overlay:",e)}})),e.forEach((e=>{Nt(e)&&(e._selectionOverlay&&(e._selectionOverlay=null),e._dragHandle&&(e._dragHandle=null))}))}catch(e){console.error("Error in cleanupAllMeasurementOverlays:",e)}},Wt=e=>pe(void 0,void 0,void 0,(function*(){if(u&&""!==u&&"text"!==u)return;if(p.current&&h)try{const t=(yield h.hitTest(e,{})).results.filter((e=>{var t;if(!e||!("graphic"in e)||!e.graphic)return!1;const i=e.graphic;if(!i.symbol||"text"!==i.symbol.type)return!1;const r=i.symbol.text||"";return/(\d+(\.\d+)?\s*(km|mi|m|ft|yd|km\xb2|mi\xb2|ac|ha|m\xb2|ft\xb2|yd\xb2))|Area:|Perimeter:|Radius:|Total:|Lat:|Lon:|X:|Y:/.test(r)||(null===(t=i.attributes)||void 0===t?void 0:t.isMeasurementLabel)}));if(t.length>0){const e=t[0].graphic;Qt(e)}else Zt()}catch(e){console.error("Error in measurement label click handler:",e)}})),Ft=t=>{var i;const r=t;if(s){if(!r){if(Zt(),c&&c.view)try{c.updateOnGraphicClick=!0}catch(e){console.warn("Error re-enabling SketchViewModel:",e)}let t=h;!t&&(null==c?void 0:c.view)&&(t=c.view),!t&&(null===(i=e.jimuMapView)||void 0===i?void 0:i.view)&&(t=e.jimuMapView.view),(null==t?void 0:t.container)&&(t.container.style.cursor="default"),Lt&&(Lt.current=!1),St&&(St.current=null),yt&&(yt.remove(),vt(null)),wt&&(wt.remove(),bt(null))}if(r&&c&&c.view)try{"active"===c.state&&c.activeTool&&c.cancel(),c.updateOnGraphicClick=!1}catch(e){console.warn("Error disabling SketchViewModel:",e)}Ye(r)}else console.error("DrawLayer is null - cannot set up measurement editing")},Ht=()=>{Xe&&(Xe.remove(),Ke(null))},Qt=e=>{var t,i;if(Qe)try{if(!("text"===(null===(t=e.symbol)||void 0===t?void 0:t.type)))return;const r=e.symbol;if(!(null===(i=e.attributes)||void 0===i?void 0:i.isMeasurementLabel)){const t=r.text||"";if(!/(\d+(\.\d+)?\s*(km|mi|m|ft|yd|km\xb2|mi\xb2|ac|ha|m\xb2|ft\xb2|yd\xb2))|Area:|Perimeter:|Radius:|Total:|Lat:|Lon:|X:|Y:/.test(t))return;e.attributes||(e.attributes={}),e.attributes.isMeasurementLabel=!0,e.attributes.hideFromList=!0,e.attributes.drawMode="text",t.includes("Area:")||t.includes("Perimeter:")||t.includes("Radius:")||t.includes("Total:")?e.attributes.measurementType="main":t.includes("Lat:")||t.includes("Lon:")||t.includes("X:")||t.includes("Y:")?e.attributes.measurementType="coordinate":/^\d+(\.\d+)?\s*(km|mi|m|ft|yd)$/.test(t.trim())?e.attributes.measurementType="segment":e.attributes.measurementType="main"}Zt(),Je(e);const n=r;qe(n.clone()),tt($t(n.color)),rt(n.font.size||14),ot(n.angle||0);const o=!!(n.haloSize&&n.haloSize>0);st(o),n.haloColor?ct($t(n.haloColor)):ct("rgba(255,255,255,1)"),dt(n.haloSize||2),Yt(e),(e=>{var t;if(!h||!e||!Qe)return;const i=new me.default({style:"circle",size:12,color:[0,150,255,.3],outline:{color:[0,150,255,.8],width:2,style:"solid"}});if(e._dragHandle){try{s.remove(e._dragHandle)}catch(e){}e._dragHandle=null}const r=new P.default({geometry:e.geometry,symbol:i,attributes:{isDragHandle:!0,parentLabelId:(null===(t=e.attributes)||void 0===t?void 0:t.uniqueId)||"unknown"}});try{s.add(r),e._dragHandle=r}catch(e){console.error("Error creating drag handle:",e)}})(e)}catch(e){console.error("Error selecting measurement label:",e)}},Yt=e=>{var t;if(!s||!e.geometry)return;if(e._selectionOverlay){try{s.remove(e._selectionOverlay)}catch(e){}e._selectionOverlay=null}const i=new me.default({style:"diamond",size:24,color:[255,165,0,.2],outline:{color:[255,165,0,.8],width:2,style:"dash"}}),r=new P.default({geometry:e.geometry,symbol:i,attributes:{isSelectionOverlay:!0,isMeasurementOverlay:!0,parentGraphicId:(null===(t=e.attributes)||void 0===t?void 0:t.uniqueId)||"measurement_overlay"}});try{s.add(r),e._selectionOverlay=r}catch(e){console.error("Error creating measurement label overlay:",e)}},Zt=()=>{if(Ze){if(Ze._selectionOverlay){try{s.remove(Ze._selectionOverlay)}catch(e){console.warn("Error removing overlay:",e)}Ze._selectionOverlay=null}(e=>{if(null==e?void 0:e._dragHandle){try{s.remove(e._dragHandle)}catch(e){}e._dragHandle=null}})(Ze),Je(null),qe(null)}if(mt&&_t(),s&&jt())try{const e=s.graphics.toArray(),t=e.filter((e=>{var t,i;return(null===(t=e.attributes)||void 0===t?void 0:t.isSelectionOverlay)&&(null===(i=e.attributes)||void 0===i?void 0:i.isMeasurementOverlay)}));t.forEach((e=>{try{s.remove(e)}catch(e){console.warn("Error removing orphaned overlay:",e)}})),e.forEach((e=>{Nt(e)&&e._selectionOverlay&&(e._selectionOverlay=null)}))}catch(e){console.error("Error in comprehensive overlay cleanup:",e)}},Jt=()=>{var e,t;if(Ze&&Ze.measureParent)try{Ze.attributes.hasCustomPosition=!1,Ze.attributes.customPosition=null;const i=Ze.measureParent;let r;if("segment"===(null===(e=Ze.attributes)||void 0===e?void 0:e.measurementType)){const e=null===(t=Ze.attributes)||void 0===t?void 0:t.segmentInfo;r=e&&e.point1&&e.point2?ri(e.point1,e.point2,i.geometry):ii(i.geometry)}else r=ii(i.geometry);r&&(Ze.geometry=r,Ze._dragHandle&&(Ze._dragHandle.geometry=r),Ze._selectionOverlay&&(Ze._selectionOverlay.geometry=r))}catch(e){console.error("Error resetting label position:",e)}},$t=e=>{if(e&&e.toRgba){const t=e.toRgba();return`rgba(${t[0]},${t[1]},${t[2]},${t[3]})`}return"rgba(0,0,0,1)"},qt=(e,t,i)=>{if(!$e||!Ze)return;const r=e,n=void 0!==t?t:lt,o=void 0!==i?i:ut;st(r),void 0!==t&&ct(t),void 0!==i&&dt(i);const a=$e.clone();r?(a.haloColor=new O.default(n),a.haloSize=o):(a.haloColor=null,a.haloSize=null),qe(a),ht(a)},Xt=e=>{if(!$e||!Ze)return;tt(e);const t=$e.clone();t.color=new O.default(e),qe(t),ht(t)},Kt=e=>{if(!$e||!Ze)return;rt(e);const t=$e.clone();t.font=t.font.clone(),t.font.size=e,qe(t),ht(t)},ei=e=>{if(!$e||!Ze)return;ot(e);const t=$e.clone();t.angle=e,qe(t),ht(t)},ti=(e,t,i,r)=>{const n=i-e,o=r-t;let a=-180*Math.atan2(o,n)/Math.PI;return(a>90||a<-90)&&(a=(a+180)%360),a},ii=e=>{var t;return e?"point"===e.type?new oe.default({x:e.x,y:e.y,spatialReference:e.spatialReference}):"centroid"in e&&e.centroid?e.centroid:(null===(t=e.extent)||void 0===t?void 0:t.center)?e.extent.center:(console.warn("Unable to determine label point for geometry type:",e.type),null):null},ri=(e,t,i)=>{try{const r=(e[0]+t[0])/2,n=(e[1]+t[1])/2;return new oe.default({x:r,y:n,spatialReference:i.spatialReference})}catch(e){return console.error("Error calculating segment midpoint:",e),null}},ni=e=>{if(e&&s)try{e.visible=!0,s.graphics.includes(e)&&(s.remove(e),s.add(e)),setTimeout((()=>{(()=>{if(h)try{if("function"==typeof h.redraw&&h.redraw(),s&&void 0!==s.visible){const e=s.visible;s.visible=!1,requestAnimationFrame((()=>{s&&(s.visible=e)}))}s&&"function"==typeof s.refresh&&s.refresh()}catch(e){console.warn("Error forcing map refresh:",e)}})()}),100)}catch(e){console.warn("Error ensuring label visibility:",e)}},oi=e=>{if(!e||!e.geometry||Nt(e))return;const t=kt(e),i=Ue.get(t);i&&clearTimeout(i);const r=setTimeout((()=>{vi(e,null,!0),We((e=>{const i=new Map(e);return i.delete(t),i}))}),100);We((e=>new Map(e).set(t,r)))},ai=e=>{if(!e)return;const t=kt(e),i=Ue.get(t);i&&(clearTimeout(i),We((e=>{const i=new Map(e);return i.delete(t),i})))},si=e=>!(!m.current||e&&Nt(e)),li=(t,i,r=null,n=null,o=null)=>{if(!t)return"";try{const o=r||A.unit,a=n||E.unit;switch(t.type){case"polyline":{const r=ci(t),n=I.find((e=>e.unit===o)),a=n?n.abbreviation:o;let s=ee?e.config.measurePolylineLabel||"{{length}} {{lengthUnit}}":"";return Ct(t)&&(s="Total: "+s),i&&(s=e.config.measurePolylineLabel||"{{length}} {{lengthUnit}}"),s.replace(/{{length}}/g,gi(r,ze).toLocaleString()).replace(/{{lengthUnit}}/g,a)}case"polygon":{const i=di(t),r=ui(t),n=N.find((e=>e.unit===a)),s=n?n.abbreviation:a,l=I.find((e=>e.unit===o)),c=l?l.abbreviation:o;let u="";ie&&ne?u="Area: {{area}} {{areaUnit}}\nPerimeter: {{length}} {{lengthUnit}}":ie?u="Area: {{area}} {{areaUnit}}":ne&&(u="Perimeter: {{length}} {{lengthUnit}}");let d=(e.config.measurePolygonLabel||u).replace(/{{area}}/g,gi(i,ze).toLocaleString()).replace(/{{areaUnit}}/g,s).replace(/{{length}}/g,gi(r,ze).toLocaleString()).replace(/{{lengthUnit}}/g,c);if(61===t.rings[0].length&&be){const e=Math.abs(r/(2*Math.PI));d+=`\nRadius: ${gi(e,ze).toLocaleString()} ${l.abbreviation}`}return d}default:return console.warn(`Unsupported geometry type for measurement: ${t.type}`),""}}catch(e){return console.error("Error calculating measurement:",e),"Error calculating measurement"}},ci=e=>{let t=0;try{return t=e.spatialReference.isWGS84||e.spatialReference.isWebMercator?ue.default.execute(e,{unit:"meters"}):he.default.execute(e,{unit:"meters"}),hi(Math.abs(t),A)}catch(e){return console.error("Error calculating polyline length:",e),0}},ui=e=>{let t=0;try{const i=e.rings||[];for(let r=0;r<i.length;r++){const n=i[r];for(let i=1;i<n.length;i++){const r=fi(n[i-1],n[i],e);let o=0;o=e.spatialReference.isWGS84||e.spatialReference.isWebMercator?ue.default.execute(r.geometry,{unit:"meters"}):he.default.execute(r.geometry,{unit:"meters"}),t+=Math.abs(o)}}return hi(t,A)}catch(e){return console.error("Error calculating polygon perimeter:",e),0}},di=e=>{let t=0;try{return t=e.spatialReference.isWGS84||e.spatialReference.isWebMercator?ce.default.execute(e,{unit:"square-meters"}):de.default.execute(e,{unit:"square-meters"}),mi(t,E)}catch(e){return console.error("Error calculating polygon area:",e),0}},hi=(e,t)=>e*(t.conversion||1),mi=(e,t)=>e*(t.conversion||1),pi=(e,t,i)=>{try{const r=new ae.default({paths:[[e,t]],spatialReference:i.spatialReference});let n=0;return n=i.spatialReference.isWGS84||i.spatialReference.isWebMercator?ue.default.execute(r,{unit:"meters"}):he.default.execute(r,{unit:"meters"}),hi(Math.abs(n),A)}catch(e){return console.error("Error calculating segment length:",e),0}},gi=(e,t=0)=>Number(Math.abs(e).toFixed(t)),fi=(e,t,i)=>{const r=new ae.default({paths:[[e,t]],spatialReference:i.spatialReference});return new P.default({geometry:r,symbol:{type:"simple-line"},visible:!1})};fe((()=>{"boolean"==typeof e.measurementEnabled&&(m.current=e.measurementEnabled,V(e.measurementEnabled),!e.measurementEnabled&&p.current&&Ye(!1))}),[e.measurementEnabled]),fe((()=>{y.current=!1}),[]),fe((()=>()=>{if(g.current){try{g.current.remove()}catch(e){}g.current=null}if(f.current){try{f.current.remove()}catch(e){}f.current=null}if(U)try{U.remove()}catch(e){}if(F)try{F.remove()}catch(e){}m&&(m.current=!1)}),[]),ve(i,(()=>({updateMeasurementsForGraphic:e=>{c&&c.view?s&&jt()?m.current&&e&&!Nt(e)&&(Et.current=x((e=>{si(e)&&vi(e,null,!1)}),120)):console.warn("DrawLayer not available for updateMeasurementsForGraphic"):console.warn("SketchViewModel not available for updateMeasurementsForGraphic")},isMeasurementEnabled:()=>!!m.current,setMeasurementEnabled:e=>{const t=!!e;if(m.current=t,!t){if(g.current){try{g.current.remove()}catch(e){}g.current=null}if(f.current){try{f.current.remove()}catch(e){}f.current=null}if(U){try{U.remove()}catch(e){}W(null)}if(F){try{F.remove()}catch(e){}H(null)}p.current&&Ye(!1),(()=>{var e,t;try{null===(t=null===(e=w.current)||void 0===e?void 0:e.clear)||void 0===t||t.call(e)}catch(e){}try{Et.current=x((e=>{si(e)&&vi(e,null,!1)}),120)}catch(e){}})()}V(t)},enableMeasurements:()=>{c&&c.view?s&&jt()?(m.current=!0,V(!0)):console.warn("DrawLayer not available - cannot enable measurements"):console.warn("SketchViewModel not ready - cannot enable measurements")},disableMeasurements:()=>{if(m.current=!1,g.current){try{g.current.remove()}catch(e){}g.current=null}if(f.current){try{f.current.remove()}catch(e){}f.current=null}V(!1),p.current&&Ye(!1);try{if(s&&s.graphics){const e=s.graphics.toArray();if(e.forEach((e=>{var t,i;if((null===(t=null==e?void 0:e.attributes)||void 0===t?void 0:t.isMeasurementLabel)||(null===(i=null==e?void 0:e.attributes)||void 0===i?void 0:i.measurementType)||(null==e?void 0:e.measureParent))try{s.remove(e)}catch(e){}})),e.forEach((e=>{var t;e&&e.measure&&(e.measure=null),(null===(t=null==e?void 0:e.attributes)||void 0===t?void 0:t.relatedSegmentLabels)&&(e.attributes.relatedSegmentLabels=[])})),"function"==typeof s.refresh)try{s.refresh()}catch(e){}}}catch(e){console.warn("Error removing measurement labels on disable:",e)}},disableMeasurementEditing:()=>{p.current&&Ye(!1)},refreshAllMeasurements:()=>{if(!c||!c.view)return void console.warn("SketchViewModel not available for refreshAllMeasurements");if(!s||!jt())return void console.warn("DrawLayer not available for refreshAllMeasurements");if(!m.current||Re)return void console.warn("Cannot refresh measurements - disabled or currently processing");s.graphics.toArray().filter((e=>Tt(e)&&!e.measure)).forEach(((e,t)=>{setTimeout((()=>{m.current&&!w.current.has(kt(e))&&vi(e,null,!0)}),50*t)}))},isBusy:()=>Re||w.current.size>0,isEditingMeasurements:()=>p.current,handleMeasurementLabelSelection:e=>{p.current?Qt(e):console.warn("Measurement editing not enabled")},cleanupMeasurementLabelSelection:()=>{Zt()},autoSelectCurrentGraphicMeasurementLabel:()=>{(()=>{var e,t;let i=null;if((null===(e=null==c?void 0:c.updateGraphics)||void 0===e?void 0:e.length)>0&&(i=c.updateGraphics.getItemAt(0)),!i&&Ne&&(i=Ne),!i&&s){const e=s.graphics.toArray().filter((e=>Tt(e)&&!Nt(e)));1===e.length&&(i=e[0])}i&&(null===(t=i.measure)||void 0===t?void 0:t.graphic)&&Qt(i.measure.graphic)})()},selectGraphicMeasurementLabel:e=>{var t;p.current?(null===(t=null==e?void 0:e.measure)||void 0===t?void 0:t.graphic)?Qt(e.measure.graphic):console.warn("No measurement label found for provided graphic"):console.warn("Measurement editing not enabled")},startLabelDrag:(e,t)=>Bt(e,t),stopLabelDrag:()=>_t(),resetLabelPosition:()=>Jt(),isDragging:()=>mt}))),fe((()=>{m.current=G,p.current=Qe,v.current={distanceUnit:A,areaUnit:E,segmentsOn:Me,lengthOn:ee,areaOn:ie,perimeterOn:ne,radiusOn:be,pointRound:De,otherRound:ze,rotateSegments:Se}}),[G,Qe,A,E,Me,ee,ie,ne,be,De,ze,Se]),fe((()=>{Qe?(null==c?void 0:c.view)&&(h=c.view,Xe&&(Xe.remove(),Ke(null)),setTimeout((()=>{if(Qe)try{const e=h.on("pointer-down",(e=>pe(void 0,void 0,void 0,(function*(){try{if(u&&""!==u&&"text"!==u)return;e.stopPropagation();const t=(yield h.hitTest({x:e.x,y:e.y})).results.filter((e=>{var t,i;if(!e||!("graphic"in e))return!1;const r=e.graphic;if("text"!==(null===(t=null==r?void 0:r.symbol)||void 0===t?void 0:t.type))return!1;const n=r.symbol.text||"";return/(\d+(\.\d+)?\s*(km|mi|m|ft|yd|km\xb2|mi\xb2|ac|ha|m\xb2|ft\xb2|yd\xb2))|Area:|Perimeter:|Radius:|Total:|Lat:|Lon:|X:|Y:/.test(n)||(null===(i=r.attributes)||void 0===i?void 0:i.isMeasurementLabel)}));if(t.length>0){const e=t[0];Qt(e.graphic)}else Zt()}catch(e){console.warn("Isolated measurement handler error:",e)}}))));Ke(e)}catch(e){console.error("Error setting up isolated measurement handler:",e)}}),1500)):(Xe&&(Xe.remove(),Ke(null)),Zt())}),[Qe,c]),fe((()=>{Qe&&u&&""!==u&&"text"!==u&&(Ye(!1),Zt(),Ht()),"text"===u&&V(!1),Ee("extent"===u?"polygon":u)}),[u,Qe]),fe((()=>{pe(void 0,void 0,void 0,(function*(){var t;let i=null;if((null===(t=e.jimuMapView)||void 0===t?void 0:t.view)?i=e.jimuMapView.view:(null==c?void 0:c.view)&&(i=c.view),i&&i!==h)try{yield i.when(),h=i,Qe&&h&&(null==c?void 0:c.view)&&(Ht(),setTimeout((()=>{Qe&&(()=>{if(h)if(c&&c.view){Ht();try{const e=h.on("immediate-click",Wt);Ke(e)}catch(e){console.error("Error setting up click listener:",e)}}else console.error("Cannot setup click listener - SketchViewModel not ready");else console.error("Cannot setup click listener - currentMapView is null")})()}),300))}catch(e){console.error("Error initializing map view:",e)}}))}),[e.jimuMapView,c,Qe]),fe((()=>{var t;(null===(t=e.jimuMapView)||void 0===t?void 0:t.view)&&(h=e.jimuMapView.view)}),[e.jimuMapView]),fe((()=>{if(c&&c.view)e();else if(c&&!c.view){const t=setTimeout((()=>{(null==c?void 0:c.view)&&e()}),500);return()=>clearTimeout(t)}function e(){if(null==c?void 0:c.view)try{c.tooltipOptions.enabled=!!je;const e=S.find((e=>e.unit===A.unit)),t=L.find((e=>e.unit===E.unit));c.valueOptions={displayUnits:{length:(null==e?void 0:e.unit)||"meters",area:(null==t?void 0:t.unit)||"square-meters"},inputUnits:{length:(null==e?void 0:e.unit)||"meters",area:(null==t?void 0:t.unit)||"square-meters"}}}catch(e){console.warn("Error configuring SketchViewModel:",e)}}}),[c,null==c?void 0:c.view,je,A.unit,E.unit]),fe((()=>{if(m&&(m.current=G),G){if(ce.default.load(),ue.default.load(),wi(),Q){try{Q.remove()}catch(e){}Y(null)}}else{if(g.current){try{g.current.remove()}catch(e){}g.current=null}if(f.current){try{f.current.remove()}catch(e){}f.current=null}if(U){try{U.remove()}catch(e){}W(null)}if(F){try{F.remove()}catch(e){}H(null)}c&&(()=>{if(!c||!c.view)return void console.warn("SketchViewModel not available for removeMeasurementsOnUpdate");const e=c.on("update",(e=>{var t,i,r;if(!c||!c.view)return void console.warn("SketchViewModel not available during removal update");if(!(null===(t=null==e?void 0:e.graphics)||void 0===t?void 0:t.length))return;const n=e.graphics[0];if(n&&!G)if(jt()){if(null===(i=n.measure)||void 0===i?void 0:i.graphic)try{Dt(n.measure.graphic)&&It(n.measure.graphic)}catch(e){console.warn("Failed to remove measurement graphic:",e)}if(Array.isArray(null===(r=n.attributes)||void 0===r?void 0:r.relatedSegmentLabels))try{n.attributes.relatedSegmentLabels.forEach((e=>{e&&Dt(e)&&It(e)})),n.attributes.relatedSegmentLabels=[]}catch(e){console.warn("Failed to remove segment labels:",e)}}else console.warn("DrawLayer is not available for removal operations")}));Y(e)})()}}),[G,c]),fe((()=>{U&&F&&G&&(U.remove(),F.remove(),wi())}),[A.unit,E.unit,X,$,Z,ee,Me,ie,ne,be,De,ze,Se,G]),fe((()=>{d&&V(!1)}),[d]),fe((()=>{if(u&&""!==u){let e=u;return"extent"===u?e="polygon":"freepolyline"===u?e="polyline":"freepolygon"===u&&(e="polygon"),void(Te!==e&&Ee(e))}if((null==c?void 0:c.updateGraphics)&&c.updateGraphics.length>0){const e=c.updateGraphics.items[0];if((null==e?void 0:e.visible)&&(null==e?void 0:e.geometry)){const t=e.geometry.type;let i=t;"polygon"===t&&(e.geometry.rings&&e.geometry.rings[0]&&61===e.geometry.rings[0].length?(i="circle",Le(!1)):i="polygon"),Te!==i&&Ee(i)}}else if((null==Ne?void 0:Ne.visible)&&(null==Ne?void 0:Ne.geometry)){const e=Ne.geometry.type;let t=e;"polygon"===e&&(Ne.geometry.rings&&Ne.geometry.rings[0]&&61===Ne.geometry.rings[0].length?(t="circle",Le(!1)):t="polygon"),Te!==t&&Ee(t)}}),[u,null===(n=null==c?void 0:c.updateGraphics)||void 0===n?void 0:n.length,Ne,Te]),fe((()=>{if(s&&s.graphics.length>0){const e=setTimeout((()=>{(()=>{if(!s||!jt())return;const e=s.graphics.toArray();e.forEach((t=>{var i,r,n,o,a,s;if(!(null===(i=t.attributes)||void 0===i?void 0:i.isMeasurementLabel)&&"text"===(null===(r=t.symbol)||void 0===r?void 0:r.type)){const i=t.symbol.text;if(/(\d+(\.\d+)?\s*(km|mi|m|ft|yd|km\xb2|mi\xb2|ac|ha|m\xb2|ft\xb2|yd\xb2))|Area:|Perimeter:|Radius:|Total:|Lat:|Lon:|X:|Y:/.test(i)){t.attributes||(t.attributes={}),t.attributes.isMeasurementLabel=!0,t.attributes.hideFromList=!0,t.attributes.drawMode="text";const i=At(t,e);i&&(t.attributes.parentGraphicId=null===(n=i.attributes)||void 0===n?void 0:n.uniqueId,t.measureParent=i,i.measure||(null===(o=t.attributes.measurementType)||void 0===o?void 0:o.includes("segment"))||(i.measure={graphic:t,lengthUnit:(null===(a=t.attributes)||void 0===a?void 0:a.lengthUnit)||"meters",areaUnit:(null===(s=t.attributes)||void 0===s?void 0:s.areaUnit)||"square-meters"}))}}}))})()}),500);return()=>clearTimeout(e)}}),[null===(o=null==s?void 0:s.graphics)||void 0===o?void 0:o.length]),fe((()=>{!G&&Qe&&Ft(!1)}),[G,Qe]),fe((()=>()=>{if(Ue.forEach((e=>{clearTimeout(e)})),Fe&&Fe.remove(),w.current.clear(),b.current=!1,Zt(),Ht(),U)try{U.remove()}catch(e){}if(F)try{F.remove()}catch(e){}if(Q)try{Q.remove()}catch(e){}}),[]),fe((()=>{Qe||(Xe&&(Xe.remove(),Ke(null)),Zt(),Ut())}),[Qe,c]);const yi=e=>pe(void 0,void 0,void 0,(function*(){var t,i,r,n;if(!c||!c.view)return console.warn("SketchViewModel not available for live measurements"),!1;if(Nt(e))return!1;if(!e||!e.geometry)return!1;if("text"===(null===(t=e.symbol)||void 0===t?void 0:t.type))return!0;if(!jt())return!1;const o=e.geometry,a=ii(o);if(!a)return!1;const u="point"===o.type;let d;try{if(u){let e="",t="";Z&&(e=`X: ${a.x.toFixed(De)} \nY: ${a.y.toFixed(De)}`,X&&(t="\nWKID: "+(null===(i=a.spatialReference)||void 0===i?void 0:i.latestWkid)||0));let r="";try{le.default.isLoaded()||(yield le.default.load());const[e]=le.default.executeMany([a],se.default.WGS84);e&&$&&(r=`\nLat: ${e.y.toFixed(De)}\nLon: ${e.x.toFixed(De)}`,X&&(r+="\nWKID: 4326"))}catch(e){console.warn("Projection to WGS84 failed:",e)}d=`${e}${t}${r}`}else d=li(o,null);if(!d||""===d.trim())return!1}catch(e){return console.error("Error generating measurement text:",e),!1}const h=!(!e.measure||!e.measure.graphic)&&e.measure.graphic;if(h)try{M(h.symbol)&&(h.symbol.text=d),h.attributes.name=d;const e=Vt(h,a);h.geometry=e}catch(e){return console.error("Error updating existing measurement:",e),!1}else try{const t=l.clone();if(t.text=d,u){let e=0;Z&&(e=-1.5,X&&(e-=.75)),$&&(e-=1.5,X&&(e-=.75));const i=t.font.size*e;t.yoffset=i}t.haloSize||(t.haloSize=2,t.haloColor="white"),(null===(r=t.backgroundColor)||void 0===r?void 0:r.a)>0&&(t.backgroundColor.a=0);const i=new P.default({geometry:a,symbol:t,visible:!0,attributes:{name:d,description:u?"Coordinate Label":"Measurement Label",isMeasurementLabel:!0,hideFromList:!0,drawMode:"text",lengthUnit:A.unit,areaUnit:E.unit,parentGraphicId:null===(n=e.attributes)||void 0===n?void 0:n.uniqueId,measurementType:u?"coordinate":"main"}});s&&"function"==typeof s.add&&(i.visible=!0,s.add(i),i.measureParent=e,e.measure={graphic:i,lengthUnit:A.unit,areaUnit:E.unit})}catch(e){return console.error("Failed to add measurement label:",e),!1}return Ae(e),!0})),vi=(e,t,...i)=>pe(void 0,[e,t,...i],void 0,(function*(e,t,i=!1,r=null){var n,o,a,d,h,m,p,g,f,y,v,x,L,S,C,N,T,j,D,k,z,O,B,R,G,_,V,U,W,F,H;if(!si(e))return;if(!e||!e.geometry)return console.warn("Invalid graphic or geometry in _addMeasurement"),!1;if(!e.layer||e.layer&&e.layer!==s)return!1;if(Nt(e)||"text"===(null===(n=e.symbol)||void 0===n?void 0:n.type))return!0;if(!c||!c.view)return console.warn("SketchViewModel not available for measurements"),!1;if(!jt())return console.warn("DrawLayer is not available for measurement processing"),!1;const Q=!!(null===(o=e.attributes)||void 0===o?void 0:o.uniqueId);if(!t&&!Q)return i||setTimeout((()=>vi(e,t,!0,r)),180),!1;if(b.current&&!i&&!t)return!1;const Y=kt(e);if(w.current.has(Y)&&!i)return!1;w.current.add(Y),t||i||(b.current=!0,Ge(!0));try{const n=c.view;try{e.attributes=e.attributes||{},e.attributes.isDrawing=!0;if(!(s.graphics&&s.graphics.includes&&s.graphics.includes(e)))try{s.add(e)}catch(e){console.warn("Could not re-add graphic to layer:",e)}!1===e.visible&&(e.visible=!0);try{yield n.whenLayerView(s)}catch(e){console.warn("Layer view not ready, proceeding anyway:",e)}yield new Promise((e=>requestAnimationFrame((()=>e(null)))))}catch(e){console.warn("Failed to ensure parent graphic is visible/present:",e)}const o=e.geometry,w=ii(o);if(!w)return console.warn("Could not determine label point for graphic"),!1;const b=Be.has(Y),Q=!!(i||!t&&b);let J=null;const q=new Map;let K;t||!Q&&b&&!i||((null===(h=null===(d=null===(a=e.measure)||void 0===a?void 0:a.graphic)||void 0===d?void 0:d.attributes)||void 0===h?void 0:h.customized)&&(null===(p=null===(m=e.measure)||void 0===m?void 0:m.graphic)||void 0===p?void 0:p.symbol)&&(J={symbol:e.measure.graphic.symbol.clone(),attributes:{customized:e.measure.graphic.attributes.customized,lastModified:e.measure.graphic.attributes.lastModified,hasCustomPosition:e.measure.graphic.attributes.hasCustomPosition,customPosition:e.measure.graphic.attributes.customPosition}}),Array.isArray(null===(g=e.attributes)||void 0===g?void 0:g.relatedSegmentLabels)&&e.attributes.relatedSegmentLabels.forEach((e=>{var t;if((null===(t=null==e?void 0:e.attributes)||void 0===t?void 0:t.customized)&&(null==e?void 0:e.symbol)&&(null==e?void 0:e.geometry)){const t=`${Math.round(e.geometry.x)}_${Math.round(e.geometry.y)}`;q.set(t,{symbol:e.symbol.clone(),attributes:{customized:e.attributes.customized,lastModified:e.attributes.lastModified,hasCustomPosition:e.attributes.hasCustomPosition,customPosition:e.attributes.customPosition}})}})),(e=>{var t,i,r,n;if(e){if(!jt())return console.warn("DrawLayer not available for cleanup - clearing references only"),(null===(t=e.measure)||void 0===t?void 0:t.graphic)&&(e.measure=null),void(Array.isArray(null===(i=e.attributes)||void 0===i?void 0:i.relatedSegmentLabels)&&(e.attributes.relatedSegmentLabels=[]));if(null===(r=e.measure)||void 0===r?void 0:r.graphic)try{const t=e.measure.graphic;t&&Rt(t)&&Dt(t)&&It(t)}catch(e){console.warn("Failed to remove measurement label:",e)}finally{e.measure=null}if(Array.isArray(null===(n=e.attributes)||void 0===n?void 0:n.relatedSegmentLabels))try{e.attributes.relatedSegmentLabels.forEach((e=>{if(e&&Rt(e))try{Dt(e)&&It(e)}catch(e){console.warn("Failed to remove a segment label:",e)}}))}finally{e.attributes.relatedSegmentLabels=[]}}})(e),Pe((e=>{const t=new Set(e);return t.add(Y),t})));const ee="point"===o.type,te="freepolyline"===(null===(f=e.attributes)||void 0===f?void 0:f.drawMode)||"freepolyline"===u||"freepolyline"===Te;try{if(ee){let e="",t="";if(Z&&(e=`X: ${w.x.toFixed(De)} \nY: ${w.y.toFixed(De)}`,X)){t=`\nWKID: ${(null===(y=w.spatialReference)||void 0===y?void 0:y.latestWkid)||(null===(v=w.spatialReference)||void 0===v?void 0:v.wkid)||"unknown"}`}let i="";try{le.default.isLoaded()||(yield le.default.load());const[e]=le.default.executeMany([w],se.default.WGS84);e&&$&&(i=`\nLat: ${e.y.toFixed(De)}\nLon: ${e.x.toFixed(De)}`,X&&(i=`${i}\nWKID: 4326`))}catch(e){console.warn("Projection to WGS84 failed:",e)}K=`${e}${t}${i}`}else K=li(o,t);if(!K||""===K.trim())return console.warn("No measurement text generated for graphic"),!1}catch(e){return console.error("Error generating measurement text:",e),!1}const ie=(null===(x=e.measure)||void 0===x?void 0:x.graphic)||null;if(ie)try{if(M(ie.symbol))if(J){const e=J.symbol.clone();e.text=K,ie.symbol=e,ie.attributes.customized=!!J.attributes.customized,ie.attributes.lastModified=J.attributes.lastModified||Date.now(),ie.attributes.hasCustomPosition=!!J.attributes.hasCustomPosition,ie.attributes.customPosition=J.attributes.customPosition||null}else ie.symbol.text=K;ie.attributes.name=K,ie.geometry=Vt(ie,w),ni(ie)}catch(e){return console.error("Error updating existing measurement:",e),!1}else try{const i=l.clone();if(i.text=K,J){const e=J.symbol;i.color=e.color,i.font=e.font,i.angle=e.angle,i.haloSize=e.haloSize,i.haloColor=e.haloColor,i.verticalAlignment=e.verticalAlignment,i.xoffset=e.xoffset,i.yoffset=e.yoffset,e.backgroundColor&&(i.backgroundColor=e.backgroundColor)}else{if(null!==r&&Se){i.angle=r,i.verticalAlignment="bottom";const e=4,t=r*Math.PI/180+Math.PI/2;i.yoffset=Math.sin(t)*e,i.xoffset=Math.cos(t)*e*-1.5}else if("polyline"===o.type&&!t&&!te&&!Ct(o)&&Se){if(o.paths&&o.paths.length>0&&o.paths[0]&&2===o.paths[0].length){const e=(e=>{if(!e||!e.paths||0===e.paths.length)return null;const t=e.paths[0];if(!t||t.length<2)return null;let i=0,r=null;for(let e=1;e<t.length;e++){const n=t[e-1],o=t[e],a=o[0]-n[0],s=o[1]-n[1],l=Math.sqrt(a*a+s*s);l>i&&(i=l,r=ti(n[0],n[1],o[0],o[1]))}return r})(o);if(null!==e){i.angle=e,i.verticalAlignment="bottom";const t=12,r=e*Math.PI/180+Math.PI/2;i.yoffset=Math.sin(r)*t,i.xoffset=Math.cos(r)*t*-1.5}}}if(ee){let e=0;Z&&(e=-1.5,X&&(e-=.75)),$&&(e-=1.5,X&&(e-=.75)),i.yoffset=i.font.size*e}i.haloSize||(i.haloSize=2,i.haloColor="white"),(null===(L=i.backgroundColor)||void 0===L?void 0:L.a)>0&&(i.backgroundColor.a=0)}let n=w;if((null===(S=null==J?void 0:J.attributes)||void 0===S?void 0:S.hasCustomPosition)&&(null===(C=null==J?void 0:J.attributes)||void 0===C?void 0:C.customPosition))try{const e=J.attributes.customPosition;n=new oe.default({x:e.x,y:e.y,spatialReference:e.spatialReference})}catch(e){console.warn("Error loading preserved custom position, using default:",e)}const a=new P.default({geometry:n,symbol:i,visible:!0,attributes:{name:K,description:ee?"Coordinate Label":"Measurement Label",isMeasurementLabel:!0,hideFromList:!0,drawMode:"text",lengthUnit:A.unit,areaUnit:E.unit,parentGraphicId:null===(N=e.attributes)||void 0===N?void 0:N.uniqueId,measurementType:ee?"coordinate":t?"segment":"main",customized:!!(null===(T=null==J?void 0:J.attributes)||void 0===T?void 0:T.customized),lastModified:(null===(j=null==J?void 0:J.attributes)||void 0===j?void 0:j.lastModified)||null,hasCustomPosition:!!(null===(D=null==J?void 0:J.attributes)||void 0===D?void 0:D.hasCustomPosition),customPosition:(null===(k=null==J?void 0:J.attributes)||void 0===k?void 0:k.customPosition)||null}});s.add(a),a.measureParent=e,e.measure={graphic:a,lengthUnit:A.unit,areaUnit:E.unit},t&&(t.attributes.relatedSegmentLabels?t.attributes.relatedSegmentLabels.push(a):t.attributes.relatedSegmentLabels=[a],a.attributes.parentGraphicId=null===(z=t.attributes)||void 0===z?void 0:z.uniqueId,a.measureParent=t),ni(a)}catch(e){return console.error("Failed to add measurement label:",e),!1}if(!t&&Ct(o))try{const t=(e=>{if("polyline"===e.type)return e.paths||[];if("polygon"===e.type)return e.rings||[];return[]})(o);for(let i=0;i<t.length;i++){const r=t[i];for(let t=1;t<r.length;t++){const i=pi(r[t-1],r[t],o),n=ri(r[t-1],r[t],o);if(!n||i<=0)continue;const a=I.find((e=>e.unit===A.unit)),c=a?a.abbreviation:A.unit,d=`${gi(i,ze).toLocaleString()} ${c}`,h=ti(r[t-1][0],r[t-1][1],r[t][0],r[t][1]);let m=l.clone();m.text=d;const p=`${Math.round(n.x)}_${Math.round(n.y)}`,g=q.get(p);let f=n;if(g){const e=g.symbol;if(m.color=e.color,m.font=e.font,m.angle=e.angle,m.haloSize=e.haloSize,m.haloColor=e.haloColor,m.verticalAlignment=e.verticalAlignment,m.xoffset=e.xoffset,m.yoffset=e.yoffset,e.backgroundColor&&(m.backgroundColor=e.backgroundColor),(null===(O=g.attributes)||void 0===O?void 0:O.hasCustomPosition)&&(null===(B=g.attributes)||void 0===B?void 0:B.customPosition))try{const e=g.attributes.customPosition;f=new oe.default({x:e.x,y:e.y,spatialReference:e.spatialReference})}catch(e){console.warn("Error loading preserved segment custom position, using default:",e)}}else if(Se&&"freepolyline"!==(null===(R=e.attributes)||void 0===R?void 0:R.drawMode)&&"freepolyline"!==u&&"freepolyline"!==Te){m.angle=h,m.verticalAlignment="bottom";const e=4,t=h*Math.PI/180+Math.PI/2;m.yoffset=Math.sin(t)*e,m.xoffset=Math.cos(t)*e*-1.5}m.haloSize||(m.haloSize=2,m.haloColor="white"),(null===(G=m.backgroundColor)||void 0===G?void 0:G.a)>0&&(m.backgroundColor.a=0);const y=new P.default({geometry:f,symbol:m,visible:!0,attributes:{name:d,description:"Segment Label",isMeasurementLabel:!0,hideFromList:!0,drawMode:"text",measurementType:"segment",parentGraphicId:null===(_=e.attributes)||void 0===_?void 0:_.uniqueId,customized:!!(null===(V=null==g?void 0:g.attributes)||void 0===V?void 0:V.customized),lastModified:(null===(U=null==g?void 0:g.attributes)||void 0===U?void 0:U.lastModified)||null,hasCustomPosition:!!(null===(W=null==g?void 0:g.attributes)||void 0===W?void 0:W.hasCustomPosition),customPosition:(null===(F=null==g?void 0:g.attributes)||void 0===F?void 0:F.customPosition)||null,segmentInfo:(null===(H=null==g?void 0:g.attributes)||void 0===H?void 0:H.segmentInfo)||{point1:r[t-1],point2:r[t]}}});s.add(y),y.measureParent=e,e.attributes.relatedSegmentLabels?e.attributes.relatedSegmentLabels.push(y):e.attributes.relatedSegmentLabels=[y]}}}catch(e){console.error("Error adding segment measurements:",e)}try{!1===e.visible&&(e.visible=!0);if(!(s.graphics&&s.graphics.includes&&s.graphics.includes(e)))try{s.add(e)}catch(e){console.warn("Final add attempt failed:",e)}"redraw"in n&&"function"==typeof n.redraw?n.redraw():"refresh"in s&&"function"==typeof s.refresh&&s.refresh()}catch(e){console.warn("Final sanity check failed, but continuing:",e)}return Ae(e),!0}finally{w.current.delete(Y),t||i||setTimeout((()=>{b.current=!1,Ge(!1)}),100)}})),wi=()=>{if(!c||!c.view)return;if(g.current){try{g.current.remove()}catch(e){}g.current=null}if(f.current){try{f.current.remove()}catch(e){}f.current=null}if(U){try{U.remove()}catch(e){}W(null)}if(F){try{F.remove()}catch(e){}H(null)}const e=c.on("update",(e=>pe(void 0,void 0,void 0,(function*(){var t;if(!c||!c.view||!jt())return;const i=null===(t=e.graphics)||void 0===t?void 0:t[0];if(!i||Nt(i))return;if(!m.current&&!i.measure)return;const r=kt(i);if(!_e.has(r)){Ve((e=>new Set(e).add(r)));try{"active"===e.state?yield yi(i):"complete"===e.state&&(ai(i),yield oi(i))}finally{setTimeout((()=>{Ve((e=>{const t=new Set(e);return t.delete(r),t}))}),200)}}})))),t=c.on("create",(e=>pe(void 0,void 0,void 0,(function*(){if(!c||!c.view||!jt())return;if(!m.current||"cancel"===e.state)return;const t=e.graphic;if(!t||Nt(t))return;const i=kt(t);if("complete"===e.state){if(_e.has(i))return;Ve((e=>new Set(e).add(i)))}try{if("active"===e.state)try{yield yi(t)}catch(e){console.warn("Error in live measurement during create:",e)}else"complete"===e.state&&setTimeout((()=>{ai(t),oi(t),setTimeout((()=>{var e;(null===(e=t.measure)||void 0===e?void 0:e.graphic)&&ni(t.measure.graphic),!1===t.visible&&(t.visible=!0)}),100)}),100)}finally{"complete"===e.state&&setTimeout((()=>{Ve((e=>{const t=new Set(e);return t.delete(i),t}))}),200)}}))));c.on("delete",(e=>{var t,i,r,n;const o=null===(t=e.graphics)||void 0===t?void 0:t[0];if(!o)return;const a=kt(o);if(ai(o),Pe((e=>{const t=new Set(e);return t.delete(a),t})),Ve((e=>{const t=new Set(e);return t.delete(a),t})),jt()){if((null===(i=o.measure)||void 0===i?void 0:i.graphic)&&Dt(o.measure.graphic))try{It(o.measure.graphic)}catch(e){console.warn("Couldn't remove measurement label:",e)}if(Array.isArray(null===(r=o.attributes)||void 0===r?void 0:r.relatedSegmentLabels))try{o.attributes.relatedSegmentLabels.forEach((e=>{if(e&&Dt(e))try{It(e)}catch(e){console.warn("Couldn't remove segment label:",e)}})),o.attributes.relatedSegmentLabels=[]}catch(e){console.warn("Couldn't remove segment labels:",e)}}else o.measure&&(o.measure=null),(null===(n=o.attributes)||void 0===n?void 0:n.relatedSegmentLabels)&&(o.attributes.relatedSegmentLabels=[]);console.log("\u{1f5d1}\ufe0f Graphic deletion cleanup complete:",a)}));g.current=e,f.current=t,W(e),H(t)};return t.React.createElement("div",{className:"drawToolbarDiv"},t.React.createElement("div",{className:"d-flex flex-column"},t.React.createElement("div",{className:"measure-toggle-stack"},d?t.React.createElement(t.React.Fragment,null):t.React.createElement(t.React.Fragment,null,Qe?t.React.createElement(t.React.Fragment,null):t.React.createElement(r.CollapsableCheckbox,{label:(null===(a=null==s?void 0:s.graphics)||void 0===a?void 0:a.length)<1?"Enable Measurements":G?"Measurements [Adding Measurements]":"Measurements [Removing Measurements]",onCheckedChange:e=>{V(e)},checked:G,disableActionForUnchecked:!0,openForCheck:!0,closeForUncheck:!0,className:"w-100"},t.React.createElement("div",{className:"d-flex flex-column"},"point"===Te||""===Te||"text"===Te?t.React.createElement(t.React.Fragment,null):t.React.createElement(r.Label,{className:"drawToolbarDiv"},"Linear Units:",t.React.createElement(r.Select,{title:"Linear Units",onChange:e=>T(e.target.value),defaultValue:I[e.config.defaultDistance]},I.map(((e,i)=>t.React.createElement(r.Option,{key:i,value:e},e.label+" ("+e.abbreviation+")"))))),"point"===Te||"polyline"===Te||"freepolyline"===Te||""===Te||"text"===Te?t.React.createElement(t.React.Fragment,null):t.React.createElement(r.Label,{className:"drawToolbarDiv"},"Area Units:",t.React.createElement(r.Select,{title:"Area Units",onChange:e=>j(e.target.value),defaultValue:z[e.config.defaultArea]},z.map(((e,i)=>t.React.createElement(r.Option,{key:i,value:e},e.label+" ("+e.abbreviation+")"))))),"point"===Te?t.React.createElement("div",null,t.React.createElement("div",{className:"d-flex justify-content-center"},t.React.createElement(r.Label,{centric:!0},t.React.createElement(r.Checkbox,{className:"mr-2 mt-2 mb-2 ml-4",checked:Z,onChange:()=>J(!Z)}),"XY"),t.React.createElement(r.Label,{centric:!0},t.React.createElement(r.Checkbox,{className:"mr-2 mt-2 mb-2 ml-4",checked:$,onChange:()=>q(!$)}),"Lat/Long"),Z||$?t.React.createElement(r.Label,{centric:!0},t.React.createElement(r.Checkbox,{className:"mr-2 mt-2 mb-2 ml-4",checked:X,onChange:()=>K(!X)}),"WKID"):t.React.createElement(t.React.Fragment,null)),t.React.createElement(r.Label,{centric:!0,className:"d-flex justify-content-center"},"Decimal Places:",t.React.createElement(r.NumericInput,{className:"decimalInput ml-2",size:"sm",max:10,min:0,step:1,value:De,onChange:e=>ke(e)}))):t.React.createElement(t.React.Fragment,null),"polyline"===Te||"freepolyline"===Te?t.React.createElement("div",null,t.React.createElement("div",{className:"d-flex justify-content-center"},t.React.createElement(r.Label,{centric:!0},t.React.createElement(r.Checkbox,{className:"mr-2 mt-2 mb-2 ml-4",checked:ee,onChange:()=>te(!ee)}),"Length"),t.React.createElement(r.Label,{centric:!0},t.React.createElement(r.Checkbox,{className:"mr-2 mt-2 mb-2 ml-4",checked:Me,onChange:()=>Le(!Me)}),"Line Segments")),Me&&t.React.createElement("div",{className:"d-flex justify-content-center w-100"},t.React.createElement(r.Label,{centric:!0},t.React.createElement(r.Switch,{className:"mr-2",checked:Se,onChange:()=>Ce(!Se)}),"Rotate Line Segment Labels")),t.React.createElement(r.Label,{centric:!0,className:"d-flex justify-content-center"},"Decimal Places:",t.React.createElement(r.NumericInput,{className:"decimalInput ml-2",size:"sm",max:10,min:0,step:1,value:ze,onChange:e=>Oe(e)})),"freepolyline"===Te?t.React.createElement(r.Alert,{className:"w-100"},"Line Segments not recommended for freehand tools."):t.React.createElement(t.React.Fragment,null)):t.React.createElement(t.React.Fragment,null),"polygon"===Te||"freepolygon"===Te||"circle"===Te?t.React.createElement("div",null,t.React.createElement("div",{className:"d-flex justify-content-center"},t.React.createElement(r.Label,{centric:!0},t.React.createElement(r.Checkbox,{className:"mr-2 mt-2 mb-2 ml-4",checked:ie,onChange:()=>re(!ie)}),"Area"),t.React.createElement(r.Label,{centric:!0},t.React.createElement(r.Checkbox,{className:"mr-2 mt-2 mb-2 ml-4",checked:ne,onChange:()=>we(!ne)}),"Perimeter"),"circle"===Te?t.React.createElement(r.Label,{centric:!0},t.React.createElement(r.Checkbox,{className:"mr-2 mt-2 mb-2 ml-4",checked:be,onChange:()=>xe(!be)}),"Radius"):t.React.createElement(t.React.Fragment,null),"polygon"===Te||"freepolygon"===Te?t.React.createElement(r.Label,{centric:!0},t.React.createElement(r.Checkbox,{className:"mr-2 mt-2 mb-2 ml-4",checked:Me,onChange:()=>Le(!Me)}),"Line Segments"):t.React.createElement(t.React.Fragment,null)),Me&&("polygon"===Te||"freepolygon"===Te)&&t.React.createElement("div",{className:"d-flex justify-content-center w-100"},t.React.createElement(r.Label,{centric:!0},t.React.createElement(r.Switch,{className:"mr-2",checked:Se,onChange:()=>Ce(!Se)}),"Rotate Line Segment Labels")),t.React.createElement(r.Label,{centric:!0,className:"d-flex justify-content-center"},"Decimal Places:",t.React.createElement(r.NumericInput,{className:"decimalInput ml-2",size:"sm",max:10,min:0,step:1,value:ze,onChange:e=>Oe(e)})),"freepolygon"===Te?t.React.createElement(r.Alert,{className:"w-100"},"Line Segments not recommended for freehand tools."):t.React.createElement(t.React.Fragment,null)):t.React.createElement(t.React.Fragment,null))),(()=>{var i,n,o,a;if(e.isDrawingActive||!G)return null;const l=s&&s.graphics&&s.graphics.toArray().some((e=>{var t,i,r,n;return!((null===(t=e.attributes)||void 0===t?void 0:t.isMeasurementLabel)||(null===(i=e.attributes)||void 0===i?void 0:i.isBuffer)||(null===(r=e.attributes)||void 0===r?void 0:r.isPreviewBuffer)||(null===(n=e.attributes)||void 0===n?void 0:n.hideFromList))}));return l&&""===u?t.React.createElement(r.CollapsableCheckbox,{label:"Edit Measurement Labels",onCheckedChange:e=>{y.current||Ft(e)},checked:Qe,disableActionForUnchecked:!0,openForCheck:!0,closeForUncheck:!0,className:"w-100"},t.React.createElement("div",{className:"d-flex flex-column"},t.React.createElement("div",{className:"ml-3 my-1"},t.React.createElement("ul",{className:"text-dark m-0 pl-3 small"},!Ze&&t.React.createElement("li",null,"Click a measurement label to select it and begin editing"),Qe&&Ze&&!mt&&t.React.createElement("li",{className:"text-success"},t.React.createElement("strong",null,"Label selected")),mt&&t.React.createElement("li",{className:"text-info"},t.React.createElement("strong",null,"Dragging active - move mouse and click to place"))))),Ze&&t.React.createElement("div",{className:"ml-3 my-1"},t.React.createElement("div",{className:"d-flex mb-1",style:{gap:"12px"}},t.React.createElement("div",{style:{flex:"1"}},t.React.createElement("h6",{className:"mb-2"},"Font"),t.React.createElement("div",{className:"d-flex align-items-center justify-content-between mb-2"},t.React.createElement(r.Label,{className:"mb-0",style:{minWidth:"70px",fontSize:"12px"}},"Color:"),t.React.createElement(D.ColorPicker,{color:et,onChange:Xt,width:24,height:24})),t.React.createElement("div",{className:"d-flex align-items-center justify-content-between mb-2"},t.React.createElement(r.Label,{className:"mb-0",style:{minWidth:"70px",fontSize:"12px"}},"Size:"),t.React.createElement(r.NumericInput,{size:"sm",value:it,onChange:Kt,min:8,max:48,step:1,style:{width:"60px"}})),t.React.createElement("div",{className:"d-flex align-items-center justify-content-between mb-2"},t.React.createElement(r.Label,{className:"mb-0",style:{minWidth:"70px",fontSize:"12px"}},"Rotation:"),t.React.createElement(r.NumericInput,{size:"sm",value:nt,onChange:ei,min:-180,max:180,step:5,style:{width:"60px"}}))),t.React.createElement("div",{style:{flex:"1"}},t.React.createElement("h6",{className:"mb-2"},"Halo"),t.React.createElement("div",{className:"d-flex align-items-center justify-content-between mb-2"},t.React.createElement(r.Label,{className:"mb-0",style:{minWidth:"70px",fontSize:"12px"}},"Enable:"),t.React.createElement(r.Switch,{size:"sm",checked:at,onChange:e=>qt(e.target.checked)})),t.React.createElement("div",{className:"d-flex align-items-center justify-content-between mb-2"},t.React.createElement(r.Label,{className:"mb-0",style:{minWidth:"70px",fontSize:"12px",opacity:at?1:.5}},"Color:"),t.React.createElement(D.ColorPicker,{color:lt,onChange:e=>qt(!0,e),width:24,height:24,disabled:!at})),t.React.createElement("div",{className:"d-flex align-items-center justify-content-between mb-2"},t.React.createElement(r.Label,{className:"mb-0",style:{minWidth:"70px",fontSize:"12px",opacity:at?1:.5}},"Size:"),t.React.createElement(r.NumericInput,{size:"sm",value:ut,onChange:e=>qt(!0,void 0,e),min:1,max:10,step:1,style:{width:"60px"},disabled:!at})))),t.React.createElement("div",{className:"d-flex justify-content-between"},t.React.createElement(r.Label,{centric:!0,style:{minWidth:"70px",fontSize:"12px"}},"Bold:",t.React.createElement(r.Switch,{size:"sm",checked:"bold"===(null===(i=null==$e?void 0:$e.font)||void 0===i?void 0:i.weight),onChange:e=>(e=>{if($e&&Ze){const t=$e.clone();t.font=t.font.clone(),t.font.weight=e?"bold":"normal",qe(t),ht(t)}})(e.target.checked),className:"ml-1"})),t.React.createElement(r.Label,{centric:!0,style:{minWidth:"70px",fontSize:"12px"}},"Italic:",t.React.createElement(r.Switch,{size:"sm",checked:"italic"===(null===(n=null==$e?void 0:$e.font)||void 0===n?void 0:n.style),onChange:e=>(e=>{if($e&&Ze){const t=$e.clone();t.font=t.font.clone(),t.font.style=e?"italic":"normal",qe(t),ht(t)}})(e.target.checked),className:"ml-1"})),t.React.createElement(r.Label,{centric:!0,style:{minWidth:"70px",fontSize:"12px"}},"Underline:",t.React.createElement(r.Switch,{size:"sm",checked:"underline"===(null===(o=null==$e?void 0:$e.font)||void 0===o?void 0:o.decoration),onChange:e=>(e=>{if($e&&Ze){const t=$e.clone();t.font=t.font.clone(),t.font.decoration=e?"underline":"none",qe(t),ht(t)}})(e.target.checked),className:"ml-1"}))),t.React.createElement(r.ButtonGroup,{block:!0,variant:"contained",size:"sm"},t.React.createElement(r.Button,{color:"primary",onClick:()=>{var t;h||((null==c?void 0:c.view)?h=c.view:(null===(t=e.jimuMapView)||void 0===t?void 0:t.view)&&(h=e.jimuMapView.view)),Ze&&h&&Bt(Ze,null)},disabled:mt,title:"Click to start moving this label",style:{margin:0}},mt?"Dragging...":"Move Label"),t.React.createElement(r.Button,{onClick:Jt,title:"Reset label to default calculated position",disabled:!(null===(a=Ze.attributes)||void 0===a?void 0:a.hasCustomPosition),style:{margin:0},variant:"outlined"},"Reset Position")),t.React.createElement(r.Button,{size:"sm",variant:"contained",onClick:Zt,title:"Clear selection and select a different graphic",block:!0,style:{margin:0}},"Clear Selection"))):null})()),t.React.createElement(r.CollapsableCheckbox,{className:"w-100",checked:je,onCheckedChange:()=>Ie(!je),disableActionForUnchecked:!0,openForCheck:!0,closeForUncheck:!0,label:je?"Disable Tooltips":"Enable Tooltips"},t.React.createElement("div",{className:"ml-3 my-1"},t.React.createElement("ul",{className:"text-dark m-0 pl-3 small"},t.React.createElement("li",null,"Press ",t.React.createElement("strong",null,"Tab")," to manually enter values.")))))))})),xe=be;var Me=k(8897),Le=k(26),Se=k(600),Ce=k(7050),Ne=k(4809),Ae=k.n(Ne),Te=k(9768),Ee=k.n(Te),je=k(8148),Ie=k.n(je),De=k(2715),ke=k.n(De),ze=k(9234),Oe=k.n(ze),Be=k(7701),Pe=k.n(Be),Re=k(2558),Ge=k.n(Re);const _e=({currentTextSymbol:e,updateSymbol:t,show:n,onClose:o,graphic:a})=>{const s=i.default.useRef(""),[l,c]=i.default.useState(null),[u,d]=i.default.useState(!1),[h,m]=i.default.useState(""),[p,g]=i.default.useState(12),[f,y]=i.default.useState("#000000"),[v,w]=i.default.useState("Arial"),[b,x]=i.default.useState("normal"),[M,L]=i.default.useState("normal"),[S,C]=i.default.useState("none"),[N,A]=i.default.useState(0),[T,E]=i.default.useState("center"),[j,I]=i.default.useState("middle"),k=()=>{var e,t,i,r,n;if("undefined"==typeof document)return null;try{if(!window._textChangeObserver){const e=new MutationObserver((e=>{for(const t of e)if("childList"===t.type||"characterData"===t.type){const e=t.target;if(e.classList&&(e.classList.contains("esri-text-symbol")||"text"===e.tagName.toLowerCase()||"tspan"===e.tagName.toLowerCase())){const t=e.textContent;t&&""!==t.trim()&&"text"!==t.trim().toLowerCase()&&(window._lastTextChangeValue=t.trim())}}}));e.observe(document.body,{childList:!0,characterData:!0,subtree:!0}),window._textChangeObserver=e}if(window._lastTextChangeValue&&""!==window._lastTextChangeValue.trim()&&"text"!==window._lastTextChangeValue.trim().toLowerCase())return window._lastTextChangeValue;const o=document.querySelectorAll('.esri-view .esri-feature-table__selection-indicator, .esri-view .esri-feature__selection-indicator, .esri-view .esri-selection-handle, .esri-view .esri-editor__selection-handle, .esri-view .esri-view-surface-selection, .esri-view [class*="selection"], .esri-view [class*="selected"]');if(o.length>0)for(let t=0;t<o.length;t++){const i=o[t];if(i.textContent&&""!==i.textContent.trim()&&"text"!==i.textContent.trim().toLowerCase())return i.textContent.trim();let r=i;for(;r&&r.parentNode;){const t=Array.from(r.parentNode.childNodes);for(const e of t)if(e!==r&&e.textContent&&""!==e.textContent.trim()&&"text"!==e.textContent.trim().toLowerCase())return e.textContent.trim();if(r=r.parentNode,r.textContent&&""!==r.textContent.trim()&&"text"!==r.textContent.trim().toLowerCase()&&("text"===r.nodeName||"tspan"===r.nodeName||(null===(e=r.classList)||void 0===e?void 0:e.contains("esri-text-symbol"))))return r.textContent.trim()}}const a=document.querySelectorAll('.esri-view .esri-text-editing-cursor, .esri-view .esri-caret, .esri-view [class*="cursor"], .esri-view [class*="caret"]');if(a.length>0)for(const e of a){let i=e.parentElement;for(;i;){if(("text"===i.nodeName||"tspan"===i.nodeName||(null===(t=i.classList)||void 0===t?void 0:t.contains("esri-text-symbol")))&&i.textContent&&""!==i.textContent.trim()&&"text"!==i.textContent.trim().toLowerCase())return i.textContent.trim();i=i.parentElement}}const s=Array.from(document.querySelectorAll(".esri-view svg text, .esri-view svg tspan")).sort(((e,t)=>{const i=parseInt(e.getAttribute("data-timestamp")||"0",10);return parseInt(t.getAttribute("data-timestamp")||"0",10)-i}));for(const e of s){const t=e.textContent;if(!t||""===t.trim()||"text"===t.trim().toLowerCase()||t.includes("NaN"))continue;let i=e.parentElement,r=!1;for(;i&&i.classList;){if(i.classList.contains("esri-basemap-layer")||i.classList.contains("esri-legend")||i.classList.contains("esri-attribution")||i.classList.contains("esri-scale-bar")||i.classList.contains("esri-ui")||i.classList.contains("esri-widget")){r=!0;break}i=i.parentElement}if(!r)return t.trim()}const l=document.querySelectorAll(".esri-view .esri-text-symbol, .esri-view .esri-text-graphic, .esri-view .esri-graphic-text");for(const e of l)if(e.textContent&&""!==e.textContent.trim()&&"text"!==e.textContent.trim().toLowerCase())return e.textContent.trim();const c=document.querySelectorAll('input[type="text"], textarea');for(const e of c){const t=e;if(t.value&&""!==t.value.trim()&&"text"!==t.value.trim().toLowerCase()){if((null===(i=t.id)||void 0===i?void 0:i.toLowerCase().includes("text"))||(null===(r=t.name)||void 0===r?void 0:r.toLowerCase().includes("text"))||t.className.toLowerCase().includes("text")||(null===(n=t.placeholder)||void 0===n?void 0:n.toLowerCase().includes("text"))||t.closest('[class*="text-editor"]')||t.closest('[class*="label-editor"]'))return t.value.trim()}}const u=document.querySelectorAll(".esri-popup__content");for(const e of u)if(e.textContent&&""!==e.textContent.trim()&&"text"!==e.textContent.trim().toLowerCase())return e.textContent.trim()}catch(e){}return null},z=(e,t="")=>{if(!e)return null;if(null==e)return null;if("esri.symbols.TextSymbol"===e.declaredClass&&e.text&&"text"!==e.text.trim().toLowerCase()&&""!==e.text.trim())return{text:e.text,path:`${t}.text`};const i=["text","label","value","displayValue","displayText","textString","content","description","name","title","innerHTML","textContent","innerText","labelText","caption","heading"];for(const r of i)if(void 0!==e[r]&&null!==e[r]){const i="string"==typeof e[r]?e[r]:String(e[r]);if("text"!==i.trim().toLowerCase()&&""!==i.trim())return{text:i,path:`${t}.${r}`}}if(e.graphic&&"object"==typeof e.graphic){const i=z(e.graphic,`${t}.graphic`);if(i)return i}if(e.attributes&&"object"==typeof e.attributes){const i=["name","label","text","description","title","displayName","display","caption","value","content","textString","NAME","LABEL","TEXT","DESCRIPTION","TITLE","DISPLAY_NAME","DISPLAY"];for(const r of i)if(void 0!==e.attributes[r]&&null!==e.attributes[r]){const i="string"==typeof e.attributes[r]?e.attributes[r]:String(e.attributes[r]);if("text"!==i.trim().toLowerCase()&&""!==i.trim())return{text:i,path:`${t}.attributes.${r}`}}for(const i in e.attributes)if(void 0!==e.attributes[i]&&null!==e.attributes[i]&&("string"==typeof e.attributes[i]||"number"==typeof e.attributes[i])){const r=String(e.attributes[i]);if("text"!==r.trim().toLowerCase()&&""!==r.trim())return{text:r,path:`${t}.attributes.${i}`}}}if(e.symbol&&"object"==typeof e.symbol){const i=z(e.symbol,`${t}.symbol`);if(i)return i}if(e.textContent&&"string"==typeof e.textContent&&""!==e.textContent.trim()&&"text"!==e.textContent.trim().toLowerCase())return{text:e.textContent,path:`${t}.textContent`};if(e.innerText&&"string"==typeof e.innerText&&""!==e.innerText.trim()&&"text"!==e.innerText.trim().toLowerCase())return{text:e.innerText,path:`${t}.innerText`};if(e.innerHTML&&"string"==typeof e.innerHTML&&""!==e.innerHTML.trim()&&"text"!==e.innerHTML.trim().toLowerCase()){const i=document.createElement("div");i.innerHTML=e.innerHTML;const r=i.textContent||i.innerText||"";if(""!==r.trim()&&"text"!==r.trim().toLowerCase())return{text:r,path:`${t}.innerHTML`}}for(const i in e)if(Object.prototype.propertyIsEnumerable.call(e,i)&&"function"!=typeof e[i]){if(i.startsWith("_")&&("string"==typeof e[i]||"number"==typeof e[i])){const r=String(e[i]);if("text"!==r.trim().toLowerCase()&&""!==r.trim())return{text:r,path:`${t}.${i}`}}if(i.startsWith("_")&&"object"==typeof e[i]&&null!==e[i]&&!Array.isArray(e[i])){const r=z(e[i],`${t}.${i}`);if(r)return r}}const r=["items","graphics","features","elements","_items","_graphics"];for(const i of r)if(e[i]&&Array.isArray(e[i])&&e[i].length>0)for(let r=e[i].length-1;r>=0;r--){const n=e[i][r];if(n){const e=z(n,`${t}.${i}[${r}]`);if(e)return e}}return null},B=()=>{var e,t,i,r;if("undefined"==typeof window)return null;try{if(window.textBeingEdited)return window.textBeingEdited;if(window._textElementJustAdded||window._lastAddedTextContent||window._recentlyAddedText){const e=window._textElementJustAdded||window._lastAddedTextContent||window._recentlyAddedText;if(e&&"string"==typeof e&&""!==e.trim()&&"text"!==e.trim().toLowerCase())return e}if("undefined"!=typeof document){const e=Date.now(),t=5e3,i=document.querySelectorAll(".esri-text-symbol[data-timestamp]");for(let r=0;r<i.length;r++){const n=i[r];if(e-parseInt(n.getAttribute("data-timestamp")||"0",10)<t){const e=n.textContent;if(e&&""!==e.trim()&&"text"!==e.trim().toLowerCase())return e}}const r=document.querySelectorAll(".esri-text-symbol.esri-view__animation-delay, .esri-text-symbol.esri-effect, .esri-text-symbol:not([data-processed]), .esri-view text:not([data-processed]), .esri-view tspan:not([data-processed])");for(let e=0;e<r.length;e++){const t=r[e],i=t.textContent;if(i&&""!==i.trim()&&"text"!==i.trim().toLowerCase())return t.setAttribute("data-processed","true"),i}}let n=null,o=null;if(window.jimuMapView&&(n=window.jimuMapView.view,o=null==n?void 0:n.map),!n)if(window.activeView)n=window.activeView,o=null==n?void 0:n.map;else if(window.view)n=window.view,o=null==n?void 0:n.map;else if(window.map&&(o=window.map,o.infoWindow)){const e=o.infoWindow.getContent();if("string"==typeof e&&""!==e.trim()&&"text"!==e.trim().toLowerCase())return e}if(window.view&&window.view._stage&&window.view._stage.graphics&&window.view._stage.graphics._items){const e=window.view._stage.graphics._items;for(let t=e.length-1;t>=0;t--){const i=e[t];if(i&&i.symbol&&i.symbol.text&&""!==i.symbol.text.trim()&&"text"!==i.symbol.text.trim().toLowerCase())return i.symbol.text}}if(window.sketch||window.activeSketch||window.drawingTool||window.activeDrawingTool){const e=window.sketch||window.activeSketch||window.drawingTool||window.activeDrawingTool;if(e){if(e.viewModel&&"text"===e.viewModel.activeTool&&e.viewModel.textSymbol&&e.viewModel.textSymbol.text&&""!==e.viewModel.textSymbol.text.trim()&&"text"!==e.viewModel.textSymbol.text.trim().toLowerCase())return e.viewModel.textSymbol.text;if(e.viewModel&&e.viewModel.graphic){const t=e.viewModel.graphic;if(t.symbol&&t.symbol.text&&""!==t.symbol.text.trim()&&"text"!==t.symbol.text.trim().toLowerCase())return t.symbol.text}}}if(n){if(n.popup&&n.popup.visible){const e=n.popup.title;if("string"==typeof e&&""!==e.trim()&&"text"!==e.trim().toLowerCase())return e;const t=n.popup.content;if("string"==typeof t&&""!==t.trim()&&"text"!==t.trim().toLowerCase())return t;if(n.popup.selectedFeature){const e=n.popup.selectedFeature;if(e.symbol&&"esri.symbols.TextSymbol"===e.symbol.declaredClass&&e.symbol.text&&""!==e.symbol.text.trim()&&"text"!==e.symbol.text.trim().toLowerCase())return e.symbol.text;if(e.attributes){const t=["NAME","name","LABEL","label","TEXT","text","DESCRIPTION","description","TITLE","title","DISPLAY_NAME","display_name","DISPLAYNAME","displayname","DISPLAY","display"];for(const i of t)if(e.attributes[i]&&""!==e.attributes[i].toString().trim()&&"text"!==e.attributes[i].toString().trim().toLowerCase())return e.attributes[i].toString();for(const t in e.attributes)if("string"==typeof e.attributes[t]&&""!==e.attributes[t].trim()&&"text"!==e.attributes[t].trim().toLowerCase())return e.attributes[t]}}}if(n.graphics&&n.graphics.items&&n.graphics.items.length>0){let e=n.graphics.items.filter((e=>e.selected));e.length||(e=n.graphics.items.filter((e=>{var t;return e._selected||(null===(t=e.attributes)||void 0===t?void 0:t.selected)})));for(const t of e){if(t.symbol&&"esri.symbols.TextSymbol"===t.symbol.declaredClass&&t.symbol.text&&""!==t.symbol.text.trim()&&"text"!==t.symbol.text.trim().toLowerCase())return t.symbol.text;if(t.attributes)for(const e in t.attributes)if("string"==typeof t.attributes[e]&&""!==t.attributes[e].trim()&&"text"!==t.attributes[e].trim().toLowerCase())return t.attributes[e];if(t.text&&""!==t.text.trim()&&"text"!==t.text.trim().toLowerCase())return t.text}const t=Array.from(n.graphics.items).sort(((e,t)=>{const i=e._creationTime||e.timestamp||e._timestamp||0;return(t._creationTime||t.timestamp||t._timestamp||0)-i})),i=t.filter((e=>e.symbol&&"esri.symbols.TextSymbol"===e.symbol.declaredClass));for(const e of i)if(e.symbol.text&&""!==e.symbol.text.trim()&&"text"!==e.symbol.text.trim().toLowerCase())return e.symbol.text;for(const e of t){if(e.text&&""!==e.text.trim()&&"text"!==e.text.trim().toLowerCase())return e.text;if(e.attributes)for(const t in e.attributes)if("string"==typeof e.attributes[t]&&""!==e.attributes[t].trim()&&"text"!==e.attributes[t].trim().toLowerCase())return e.attributes[t]}}const t=[n._graphicsCollection,n.graphicsCollection,n.layerCollection,n.graphics,null===(e=n._layers)||void 0===e?void 0:e.items];for(const e of t){if(!e)continue;const t=e.items||e._items||e;if(t&&t.length)for(let e=t.length-1;e>=0;e--){const i=t[e];if(i){if(i.symbol&&i.symbol.text&&""!==i.symbol.text.trim()&&"text"!==i.symbol.text.trim().toLowerCase())return i.symbol.text;if(i.text&&""!==i.text.trim()&&"text"!==i.text.trim().toLowerCase())return i.text}}}}let a=null;if(window.activeEditorWidget)a=window.activeEditorWidget;else if(window.editor)a=window.editor;else if(n&&n.ui&&n.ui.components)for(const e of n.ui.components)if(e.widget&&("esri.widgets.Editor"===e.widget.declaredClass||"esri.widgets.TextEditor"===e.widget.declaredClass)){a=e.widget;break}if(a&&a.viewModel){const e=a.viewModel,t=e.activeFeature||e.editFeature||e.editingFeature||e.feature||e.currentFeature;if(t){if(t.symbol&&"esri.symbols.TextSymbol"===t.symbol.declaredClass&&t.symbol.text&&""!==t.symbol.text.trim()&&"text"!==t.symbol.text.trim().toLowerCase())return t.symbol.text;if(t.attributes)for(const e in t.attributes)if("string"==typeof t.attributes[e]&&""!==t.attributes[e].trim()&&"text"!==t.attributes[e].trim().toLowerCase())return t.attributes[e];if(t.text&&""!==t.text.trim()&&"text"!==t.text.trim().toLowerCase())return t.text}if("editing"===e.state||"creating"===e.state){const t=e.activeTemplate||e.template;if(t){if(t.label&&""!==t.label.trim()&&"text"!==t.label.trim().toLowerCase())return t.label;if(t.description&&""!==t.description.trim()&&"text"!==t.description.trim().toLowerCase())return t.description}}}if(window.widgetState&&window.widgetState.textContent)return window.widgetState.textContent;if("undefined"!=typeof document){let e="";const n=document.querySelectorAll('input[type="text"], textarea');for(let o=0;o<n.length;o++){const a=n[o];if(a.value&&""!==a.value.trim()&&"text"!==a.value.trim().toLowerCase()){if((null===(t=a.id)||void 0===t?void 0:t.toLowerCase().includes("text"))||(null===(i=a.name)||void 0===i?void 0:i.toLowerCase().includes("text"))||(null===(r=a.placeholder)||void 0===r?void 0:r.toLowerCase().includes("text"))||a.className.toLowerCase().includes("text")){e=a.value;break}}}if(e)return e}}catch(e){}return null};i.default.useEffect((()=>{if(!n)return;const t=(t=0,i=3)=>{var r,n,o,a,l,c,u;try{const t=k();if(t)return m(t),s.current=t,e&&(e.text=t),!0;if("undefined"!=typeof window){if(null===(a=null===(o=null===(n=null===(r=window.jimuMapView)||void 0===r?void 0:r.view)||void 0===n?void 0:n.popup)||void 0===o?void 0:o.selectedFeature)||void 0===a?void 0:a.attributes){const t=window.jimuMapView.view.popup.selectedFeature.attributes,i=["name","label","text","description","title","display_name","displayname"];for(const r of i)if(t[r]&&""!==t[r].trim()&&"text"!==t[r].trim().toLowerCase())return m(t[r]),s.current=t[r],e&&(e.text=t[r]),!0}if(window.selectedGraphicText){const t=window.selectedGraphicText;if(t&&""!==t.trim()&&"text"!==t.trim().toLowerCase())return m(t),s.current=t,e&&(e.text=t),!0}if(null===(u=null===(c=null===(l=window.jimuMapView)||void 0===l?void 0:l.view)||void 0===c?void 0:c.graphics)||void 0===u?void 0:u.items){const t=window.jimuMapView.view;if(t.popup&&t.popup.selectedFeature){const i=t.popup.selectedFeature;if(i.symbol&&i.symbol.text&&""!==i.symbol.text.trim()&&"text"!==i.symbol.text.trim().toLowerCase())return m(i.symbol.text),s.current=i.symbol.text,e&&(e.text=i.symbol.text),!0;const r=z(i,"view.popup.selectedFeature");if(null==r?void 0:r.text)return m(r.text),s.current=r.text,e&&(e.text=r.text),!0}const i=t.graphics.items.filter((e=>e.selected));for(const t of i){const i=z(t,"view.graphics.selected");if(null==i?void 0:i.text)return m(i.text),s.current=i.text,e&&(e.text=i.text),!0}for(const i of t.graphics.items){const t=z(i,"view.graphics");if(null==t?void 0:t.text)return m(t.text),s.current=t.text,e&&(e.text=t.text),!0}}if(window.activeEditorWidget&&window.activeEditorWidget.viewModel){const t=window.activeEditorWidget.viewModel;if(t.activeFeature||t.editFeature){const i=t.activeFeature||t.editFeature;if(i){const t=z(i,"editorVM.feature");if(null==t?void 0:t.text)return m(t.text),s.current=t.text,e&&(e.text=t.text),!0}}if(t.state&&"editing"===t.state){const i=t.editingFeature||t.editFeature;if(i){const t=z(i,"editorVM.editingFeature");if(null==t?void 0:t.text)return m(t.text),s.current=t.text,e&&(e.text=t.text),!0}}}}return!1}catch(e){return!1}};if(t())return;const i=setTimeout((()=>{t(1)||setTimeout((()=>t(2)),500)}),100);return()=>clearTimeout(i)}),[n,e]),i.default.useEffect((()=>{var t,i,r,o,l,u,h,p,f,v;if(e&&n)try{c(e),d(!1);const n=k(),b=B();let M=null!==(i=null===(t=null==a?void 0:a.symbol)||void 0===t?void 0:t.text)&&void 0!==i?i:e.text;const S=!M||"text"===M.trim().toLowerCase()||""===M.trim();if(n&&"text"!==n.trim().toLowerCase())M=n;else if(b&&"text"!==b.trim().toLowerCase())M=b;else if(S){if(a){const e=z(a,"graphic");(null==e?void 0:e.text)&&(M=e.text)}if((!M||""===M.trim())&&e){const t=z(e,"symbol");(null==t?void 0:t.text)&&"symbol.text"!==t.path&&(M=t.text)}M&&""!==M.trim()||"undefined"==typeof window||window.selectedGraphicText&&(M=window.selectedGraphicText)}if(M=M||"",s.current=M,M!==e.text&&(e.text=M),m(M),e.font&&(g(null!==(r=e.font.size)&&void 0!==r?r:12),w(null!==(o=e.font.family)&&void 0!==o?o:"Arial"),x(null!==(l=e.font.weight)&&void 0!==l?l:"normal"),L(null!==(u=e.font.style)&&void 0!==u?u:"normal"),C(null!==(h=e.font.decoration)&&void 0!==h?h:"none")),e.color){const t=e.color.toCss?e.color.toCss(!0):"#000000";y(t)}else y("#000000");A(null!==(p=e.angle)&&void 0!==p?p:0),E(null!==(f=e.horizontalAlignment)&&void 0!==f?f:"center"),I(null!==(v=e.verticalAlignment)&&void 0!==v?v:"middle"),""!==M.trim()&&"text"!==M.trim().toLowerCase()||setTimeout((()=>{const t=k();if(t&&"text"!==t.trim().toLowerCase())m(t),s.current=t,e&&(e.text=t,d(!0));else{const t=B();t&&"text"!==t.trim().toLowerCase()&&(m(t),s.current=t,e&&(e.text=t,d(!0)))}}),300)}catch(e){}}),[e,n,a]);const P=e=>{if(l){m(e);try{if(l.text=e,s.current=e,"undefined"!=typeof window&&(void 0!==window.selectedGraphicText&&(window.selectedGraphicText=e),window.jimuMapView&&window.jimuMapView.view)){const t=window.jimuMapView.view;if(t.graphics&&t.graphics.items){const i=t.graphics.items.filter((e=>e.selected));for(const t of i)void 0!==t.text&&(t.text=e),t.attributes&&void 0!==t.attributes.text&&(t.attributes.text=e),t.symbol&&void 0!==t.symbol.text&&(t.symbol.text=e)}}d(!0)}catch(e){}}},R=e=>{if(l){E(e);try{l.horizontalAlignment=e,d(!0)}catch(e){}}},G=e=>{if(l){I(e);try{l.verticalAlignment=e,d(!0)}catch(e){}}};return n?i.default.createElement("div",{className:"text-style-editor p-3"},i.default.createElement(r.Label,{className:"font-weight-semibold"},"Label Text"),i.default.createElement(r.TextInput,{className:"mb-2",value:h,onChange:e=>P(e.target.value),onAcceptValue:e=>P(e),onKeyDown:e=>{" "===e.key&&(e.preventDefault(),P(h+" "))},"aria-label":"Edit label text"}),i.default.createElement(r.Label,{className:"font-weight-semibold"},"Font Size"),i.default.createElement(r.NumericInput,{className:"mb-2",value:p,min:1,max:120,onChange:e=>{if(l&&l.font){g(e);try{const t=l.font.clone();t.size=e,l.font=t,d(!0)}catch(e){}}},"aria-label":"Font size"}),i.default.createElement(r.Label,{className:"font-weight-semibold"},"Font Color"),i.default.createElement(D.ColorPicker,{color:f,onChange:e=>{if(l){y(e);try{l.color=new O.default(e),d(!0)}catch(e){}}},className:"mb-2","aria-label":"Font color picker"}),i.default.createElement(r.Label,{className:"font-weight-semibold"},"Font Family"),i.default.createElement(r.Select,{value:v,onChange:e=>(e=>{if(l&&l.font){w(e);try{const t=l.font.clone();t.family=e,l.font=t,d(!0)}catch(e){}}})(e.target.value),className:"mb-2","aria-label":"Font family"},["Arial","Avenir Next","Josefin Slab","Merriweather","Montserrat","Noto Sans","Noto Serif","Open Sans","Playfair Display","Roboto","Ubuntu"].map((e=>i.default.createElement(r.Option,{key:e,value:e,style:{fontFamily:e}},e)))),i.default.createElement(r.Label,{className:"font-weight-semibold"},"Font Style"),i.default.createElement(r.AdvancedButtonGroup,{className:"mb-2 d-flex"},i.default.createElement(r.Button,{icon:!0,active:"bold"===b,onClick:()=>(e=>{if(l&&l.font){x(e);try{const t=l.font.clone();t.weight=e,l.font=t,d(!0)}catch(e){}}})("bold"===b?"normal":"bold"),title:"Bold","aria-label":"Bold"},i.default.createElement(r.Icon,{icon:Ae()})),i.default.createElement(r.Button,{icon:!0,active:"italic"===M,onClick:()=>(e=>{if(l&&l.font){L(e);try{const t=l.font.clone();t.style=e,l.font=t,d(!0)}catch(e){}}})("italic"===M?"normal":"italic"),title:"Italic","aria-label":"Italic"},i.default.createElement(r.Icon,{icon:Ee()})),i.default.createElement(r.Button,{icon:!0,active:"underline"===S,onClick:()=>(e=>{if(l&&l.font){C(e);try{const t=l.font.clone();t.decoration=e,l.font=t,d(!0)}catch(e){}}})("underline"===S?"none":"underline"),title:"Underline","aria-label":"Underline"},i.default.createElement(r.Icon,{icon:Ie()}))),i.default.createElement(r.Label,{className:"font-weight-semibold"},"Horizontal Alignment"),i.default.createElement(r.AdvancedButtonGroup,{className:"mb-2 d-flex"},i.default.createElement(r.Button,{icon:!0,active:"left"===T,onClick:()=>R("left"),title:"Align Left","aria-label":"Align Left"},i.default.createElement(r.Icon,{icon:_()})),i.default.createElement(r.Button,{icon:!0,active:"center"===T,onClick:()=>R("center"),title:"Align Center","aria-label":"Align Center"},i.default.createElement(r.Icon,{icon:U()})),i.default.createElement(r.Button,{icon:!0,active:"right"===T,onClick:()=>R("right"),title:"Align Right","aria-label":"Align Right"},i.default.createElement(r.Icon,{icon:F()}))),i.default.createElement(r.Label,{className:"font-weight-semibold"},"Vertical Alignment"),i.default.createElement(r.AdvancedButtonGroup,{className:"mb-3 d-flex"},i.default.createElement(r.Button,{icon:!0,active:"top"===j,onClick:()=>G("top"),title:"Align Top","aria-label":"Align Top"},i.default.createElement(r.Icon,{icon:ke()})),i.default.createElement(r.Button,{icon:!0,active:"middle"===j,onClick:()=>G("middle"),title:"Align Middle","aria-label":"Align Middle"},i.default.createElement(r.Icon,{icon:Oe()})),i.default.createElement(r.Button,{icon:!0,active:"bottom"===j,onClick:()=>G("bottom"),title:"Align Bottom","aria-label":"Align Bottom"},i.default.createElement(r.Icon,{icon:Pe()})),i.default.createElement(r.Button,{icon:!0,active:"baseline"===j,onClick:()=>G("baseline"),title:"Align Baseline","aria-label":"Align Baseline"},i.default.createElement(r.Icon,{icon:Ge()}))),i.default.createElement(r.Label,{className:"font-weight-semibold"},"Rotation"),i.default.createElement(r.NumericInput,{className:"mb-3",value:N,min:-360,max:360,onChange:e=>{if(l){A(e);try{l.angle=e,d(!0)}catch(e){}}},"aria-label":"Rotation angle"}),i.default.createElement(r.Button,{onClick:()=>{if(l)try{if(!u)return void o();s.current&&l.text!==s.current&&(l.text=s.current),t(l),o()}catch(e){}},type:"primary",className:"w-100",title:"Apply changes and close","aria-label":"Apply and close"},"Apply and Close")):null};var Ve=k(6333),Ue=function(e,t,i,r){return new(i||(i=Promise))((function(n,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,s)}l((r=r.apply(e,t||[])).next())}))};class We extends i.default.PureComponent{constructor(e){super(e),this.sketchViewModel=null,this.isDeletingGraphics=!1,this.ignoreNextGraphicsUpdate=!1,this.internalSketchVM=!0,this.measurementStylesInitialized=!1,this._mapClickSyncEnabled=!0,this._drawingMap=new Map,this._cleanMeasurementLabelsHandler=null,this._measurementStyleWatcher=null,this._positionWatchers={},this._savePositionTimeout=null,this._loadChoiceMadeThisSession=!1,this._afterRefreshDrawings=null,this._graphicsWatchHandles=[],this._goToController=null,this._measurementWasEnabled=!1,this._originalQuality="high",this._isInteracting=!1,this.processedMeasurementGraphics=new Set,this.projectGeometryToWGS84=e=>Ue(this,void 0,void 0,(function*(){try{yield Ve.load();const t=new se.default({wkid:4326});if(e.spatialReference&&4326===e.spatialReference.wkid)return e;return Ve.project(e,t)}catch(e){return console.error("Error projecting geometry to WGS84:",e),null}})),this.convertGeometryToWGS84=e=>{const t=e.spatialReference;if(!t)return console.warn("No spatial reference found, assuming WGS84"),e;if(4326===t.wkid)return e;try{switch(e.type){case"point":const i=e,r=this.convertCoordinateManually(i.x,i.y,t.wkid);return{type:"point",x:r.lon,y:r.lat,longitude:r.lon,latitude:r.lat,spatialReference:{wkid:4326}};case"polyline":return{type:"polyline",paths:e.paths.map((e=>e.map((e=>{const i=this.convertCoordinateManually(e[0],e[1],t.wkid);return[i.lon,i.lat]})))),spatialReference:{wkid:4326}};case"polygon":return{type:"polygon",rings:e.rings.map((e=>e.map((e=>{const i=this.convertCoordinateManually(e[0],e[1],t.wkid);return[i.lon,i.lat]})))),spatialReference:{wkid:4326}};case"extent":const n=e,o=this.convertCoordinateManually(n.xmin,n.ymin,t.wkid),a=this.convertCoordinateManually(n.xmax,n.ymax,t.wkid);return{type:"extent",xmin:o.lon,ymin:o.lat,xmax:a.lon,ymax:a.lat,spatialReference:{wkid:4326}};default:return console.warn(`Cannot convert geometry type: ${e.type}`),null}}catch(e){return console.error("Error in geometry conversion:",e),null}},this.convertCoordinateManually=(e,t,i)=>{if(3857===i||102100===i){return{lon:e/20037508.34*180,lat:360*Math.atan(Math.exp(t/20037508.34*Math.PI))/Math.PI-90}}if(i>=32601&&i<=32660){const r=6*(i-32600-1)-180+3+(e-5e5)/111320,n=t/110540;return{lon:Math.max(-180,Math.min(180,r)),lat:Math.max(-90,Math.min(90,n))}}if(i>=32701&&i<=32760){const r=6*(i-32700-1)-180+3+(e-5e5)/111320,n=(t-1e7)/110540;return{lon:Math.max(-180,Math.min(180,r)),lat:Math.max(-90,Math.min(90,n))}}if(i>=2001&&i<=5e3){let r=1;(Math.abs(e)>1e6||Math.abs(t)>1e6)&&(r=.3048);let n=e*r/111320,o=t*r/110540;return i>=2001&&i<=2099?(n+=-98,o+=39):i>=3001&&i<=3999&&(n+=-100,o+=40),{lon:Math.max(-180,Math.min(180,n)),lat:Math.max(-90,Math.min(90,o))}}if(Math.abs(e)<=180&&Math.abs(t)<=90)return{lon:e,lat:t};const r=Math.max(Math.abs(e),Math.abs(t))>1e6?1e-6:.001;return{lon:Math.max(-180,Math.min(180,e*r)),lat:Math.max(-90,Math.min(90,t*r))}},this.projectGeometryToWGS84Alternative=e=>Ue(this,void 0,void 0,(function*(){try{const t=new se.default({wkid:4326});if(e.spatialReference&&4326===e.spatialReference.wkid)return e;try{yield Ve.load();return Ve.project(e,t)}catch(t){return console.warn("Projection module failed, using manual conversion"),this.manualProjectionFallback(e)}}catch(t){return console.error("Error projecting geometry to WGS84:",t),this.manualProjectionFallback(e)}})),this.manualProjectionFallback=e=>{const t=e.spatialReference;if(!t)return console.warn("No spatial reference found, assuming WGS84"),e;try{switch(e.type){case"point":const i=e,r=this.convertCoordinateManually(i.x,i.y,t.wkid);return new oe.default({longitude:r.lon,latitude:r.lat,spatialReference:{wkid:4326}});case"polyline":return{type:"polyline",paths:e.paths.map((e=>e.map((e=>{const i=this.convertCoordinateManually(e[0],e[1],t.wkid);return[i.lon,i.lat]})))),spatialReference:{wkid:4326}};case"polygon":return{type:"polygon",rings:e.rings.map((e=>e.map((e=>{const i=this.convertCoordinateManually(e[0],e[1],t.wkid);return[i.lon,i.lat]})))),spatialReference:{wkid:4326}};case"extent":const n=e,o=this.convertCoordinateManually(n.xmin,n.ymin,t.wkid),a=this.convertCoordinateManually(n.xmax,n.ymax,t.wkid);return{type:"extent",xmin:o.lon,ymin:o.lat,xmax:a.lon,ymax:a.lat,spatialReference:{wkid:4326}};default:return console.warn(`Cannot manually convert geometry type: ${e.type}`),null}}catch(e){return console.error("Error in manual projection fallback:",e),null}},this.convertToStandardGeoJSON=e=>Ue(this,void 0,void 0,(function*(){if(!e)return console.warn("No geometry provided"),null;try{const t=yield this.projectGeometryToWGS84Alternative(e);if(!t)return console.warn("Failed to convert geometry to WGS84"),null;switch(t.type){case"point":const e=t,i=e.longitude||e.x,r=e.latitude||e.y;return this.isValidCoordinate(i,r)?{type:"Point",coordinates:[Number(i.toFixed(8)),Number(r.toFixed(8))]}:(console.warn(`Invalid point coordinates: ${i}, ${r}`),null);case"polyline":const n=t,o=[];for(const e of n.paths){const t=[];for(const i of e){const e=i[0],r=i[1];this.isValidCoordinate(e,r)&&t.push([Number(e.toFixed(8)),Number(r.toFixed(8))])}t.length>1&&o.push(t)}return 0===o.length?null:{type:1===o.length?"LineString":"MultiLineString",coordinates:1===o.length?o[0]:o};case"polygon":const a=t,s=[];for(const e of a.rings){const t=[];for(const i of e){const e=i[0],r=i[1];this.isValidCoordinate(e,r)&&t.push([Number(e.toFixed(8)),Number(r.toFixed(8))])}if(t.length>3){const e=t[0],i=t[t.length-1];e[0]===i[0]&&e[1]===i[1]||t.push([e[0],e[1]]),s.push(t)}}return 0===s.length?null:{type:"Polygon",coordinates:s};case"extent":const l=t;return{type:"Polygon",coordinates:[[[Number(l.xmin.toFixed(8)),Number(l.ymin.toFixed(8))],[Number(l.xmax.toFixed(8)),Number(l.ymin.toFixed(8))],[Number(l.xmax.toFixed(8)),Number(l.ymax.toFixed(8))],[Number(l.xmin.toFixed(8)),Number(l.ymax.toFixed(8))],[Number(l.xmin.toFixed(8)),Number(l.ymin.toFixed(8))]]]};default:return console.warn(`Unsupported geometry type: ${t.type}`),null}}catch(e){return console.error("Error converting geometry:",e),null}})),this.manualProjectionFallbackEnhanced=e=>{const t=e.spatialReference;if(!t)return console.warn("No spatial reference found, assuming WGS84"),e;try{switch(e.type){case"point":const i=e,r=this.convertCoordinateManuallyEnhanced(i.x,i.y,t.wkid);return new oe.default({longitude:r.lon,latitude:r.lat,spatialReference:{wkid:4326}});case"polyline":return{type:"polyline",paths:e.paths.map((e=>e.map((e=>{const i=this.convertCoordinateManuallyEnhanced(e[0],e[1],t.wkid);return[i.lon,i.lat]})))),spatialReference:{wkid:4326}};case"polygon":return{type:"polygon",rings:e.rings.map((e=>e.map((e=>{const i=this.convertCoordinateManuallyEnhanced(e[0],e[1],t.wkid);return[i.lon,i.lat]})))),spatialReference:{wkid:4326}};case"extent":const n=e,o=this.convertCoordinateManuallyEnhanced(n.xmin,n.ymin,t.wkid),a=this.convertCoordinateManuallyEnhanced(n.xmax,n.ymax,t.wkid);return{type:"extent",xmin:o.lon,ymin:o.lat,xmax:a.lon,ymax:a.lat,spatialReference:{wkid:4326}};default:return console.warn(`Cannot manually convert geometry type: ${e.type}`),null}}catch(e){return console.error("Error in enhanced manual projection fallback:",e),null}},this.convertCoordinateManuallyEnhanced=(e,t,i)=>{if(3857===i||102100===i){const i=e/20037508.34*180,r=360*Math.atan(Math.exp(t/20037508.34*Math.PI))/Math.PI-90;return{lon:Math.max(-180,Math.min(180,i)),lat:Math.max(-90,Math.min(90,r))}}if(i>=32601&&i<=32660){const r=t/110540,n=6*(i-32600-1)-180+3+(e-5e5)/(111320*Math.cos(r*Math.PI/180));return{lon:Math.max(-180,Math.min(180,n)),lat:Math.max(-90,Math.min(90,r))}}if(i>=32701&&i<=32760){const r=(t-1e7)/110540,n=6*(i-32700-1)-180+3+(e-5e5)/(111320*Math.cos(Math.abs(r)*Math.PI/180));return{lon:Math.max(-180,Math.min(180,n)),lat:Math.max(-90,Math.min(90,r))}}if(i>=2001&&i<=5e3){let r=1,n=-98,o=39;(Math.abs(e)>1e6||Math.abs(t)>1e6)&&(r=.3048),i>=2001&&i<=2099&&(i>=2001&&i<=2020?(n=-77,o=40):i>=2021&&i<=2050?(n=-95,o=35):i>=2051&&i<=2099&&(n=-115,o=37));const a=e*r,s=t*r,l=o*Math.PI/180,c=n+a/(111320*Math.cos(l)),u=o+s/110540;return{lon:Math.max(-180,Math.min(180,c)),lat:Math.max(-90,Math.min(90,u))}}if(27700===i){const i=-2,r=54,n=(e-4e5)/7e4,o=(t-1e5)/11e4;return{lon:Math.max(-180,Math.min(180,i+n)),lat:Math.max(-90,Math.min(90,r+o))}}if(Math.abs(e)<=180&&Math.abs(t)<=90)return{lon:e,lat:t};let r=1;const n=Math.max(Math.abs(e),Math.abs(t));n>1e7?r=1e-7:n>1e6?r=1e-6:n>1e5?r=1e-5:n>1e4&&(r=.001);const o=e*r,a=t*r;let s=o,l=a;return(Math.abs(s)>180||Math.abs(l)>90)&&(e>0&&t>0&&n>1e5?(s=o%60-100,l=40+a%30):e<0&&t>0&&n>1e5?(s=Math.abs(o)%60-120,l=35+a%30):(s=-98,l=39)),{lon:Math.max(-180,Math.min(180,s)),lat:Math.max(-90,Math.min(90,l))}},this.projectGeometryFromWGS84=(e,t)=>Ue(this,void 0,void 0,(function*(){try{try{yield Ve.load();const i=Ve.project(e,t);if(i){const e=Array.isArray(i)?i[0]:i;if(e)return e}}catch(e){console.warn("ArcGIS projection engine failed during WGS84 conversion, using manual method:",e)}return this.manualProjectionFromWGS84(e,t)}catch(i){return console.error("Error projecting from WGS84:",i),this.manualProjectionFromWGS84(e,t)}})),this.manualProjectionFromWGS84=(e,t)=>{if(!t||4326===t.wkid)return e;try{switch(e.type){case"point":const i=e,r=i.longitude||i.x,n=i.latitude||i.y,o=this.convertFromWGS84Enhanced(r,n,t.wkid);return new oe.default({x:o.x,y:o.y,spatialReference:t});case"polyline":const a=e.paths.map((e=>e.map((e=>{const i=this.convertFromWGS84Enhanced(e[0],e[1],t.wkid);return[i.x,i.y]}))));return{type:"polyline",paths:a,spatialReference:t};case"polygon":const s=e.rings.map((e=>e.map((e=>{const i=this.convertFromWGS84Enhanced(e[0],e[1],t.wkid);return[i.x,i.y]}))));return{type:"polygon",rings:s,spatialReference:t};default:return console.warn(`Cannot project geometry type: ${e.type}`),null}}catch(e){return console.error("Error in manual projection from WGS84:",e),null}},this.convertFromWGS84Enhanced=(e,t,i)=>{if(4326===i)return{x:e,y:t};if(console.log(`Converting WGS84 coordinates ${e}, ${t} to WKID: ${i}`),3857===i||102100===i){return{x:20037508.34*e/180,y:Math.log(Math.tan((90+t)*Math.PI/360))/(Math.PI/180)*20037508.34/180}}if(i>=32601&&i<=32660){const r=6*(i-32600-1)-180+3,n=t*Math.PI/180,o=e*Math.PI/180,a=r*Math.PI/180,s=.9996,l=6378137,c=.00669438,u=l/Math.sqrt(1-c*Math.sin(n)*Math.sin(n)),d=Math.tan(n)*Math.tan(n),h=c*Math.cos(n)*Math.cos(n)/(1-c),m=Math.cos(n)*(o-a);return{x:5e5+s*u*(m+(1-d+h)*m*m*m/6),y:s*(l*(t*Math.PI/180)+u*Math.tan(n)*(m*m/2))}}if(i>=32701&&i<=32760){const r=6*(i-32700-1)-180+3,n=t*Math.PI/180,o=e*Math.PI/180,a=r*Math.PI/180,s=.9996,l=6378137,c=.00669438,u=l/Math.sqrt(1-c*Math.sin(n)*Math.sin(n)),d=Math.tan(n)*Math.tan(n),h=c*Math.cos(n)*Math.cos(n)/(1-c),m=Math.cos(n)*(o-a);return{x:5e5+s*u*(m+(1-d+h)*m*m*m/6),y:1e7+s*(l*(t*Math.PI/180)+u*Math.tan(n)*(m*m/2))}}if(i>=2001&&i<=5e3){let r=-98,n=39,o=!1;i>=2001&&i<=2020?(r=-77,n=40,o=!0):i>=2021&&i<=2050?(r=-95,n=35,o=!0):i>=2051&&i<=2099&&(r=-115,n=37,o=!1);const a=e-r,s=t-n,l=n*Math.PI/180;let c=a*(111320*Math.cos(l)),u=110540*s;return o&&(c/=.3048,u/=.3048),c+=o?2e6:5e5,u+=0,{x:c,y:u}}if(27700===i){return{x:4e5+7e4*(e- -2),y:1e5+11e4*(t-54)}}let r=111320,n=0;i>1e4&&(r/=.3048,n=2e6);const o=n+(e+180)*r/360,a=0+t*r/90;return console.log(`Applied fallback conversion with scale factor ${r}`),{x:o,y:a}},this.detectImportFormat=e=>{try{const t=JSON.parse(e);return"FeatureCollection"===t.type&&Array.isArray(t.features)?"geojson":t.drawings||Array.isArray(t)||t.version?"legacy":"unknown"}catch(e){return"unknown"}},this.processNewMeasurementLabel=e=>{var t,i,r,n,o;if(!(e&&e.attributes&&e.attributes.isMeasurementLabel&&e.symbol&&"text"===e.symbol.type))return!1;const a=this.getGraphicId(e);if(this.processedMeasurementGraphics.has(a))return!1;try{const s=e.symbol.text,l=e.symbol;if(l.color&&l.font&&void 0!==l.haloColor&&void 0!==l.haloSize)return this.processedMeasurementGraphics.add(a),e.attributes||(e.attributes={}),e.attributes._styleFixed=!0,!0;const c=l.clone();return c.color||(c.color=new O.default([0,0,0,1])),c.font&&c.font.family||(c.font=new Se.default({family:(null===(t=c.font)||void 0===t?void 0:t.family)||"Arial",size:(null===(i=c.font)||void 0===i?void 0:i.size)||12,weight:(null===(r=c.font)||void 0===r?void 0:r.weight)||"normal",style:(null===(n=c.font)||void 0===n?void 0:n.style)||"normal",decoration:(null===(o=c.font)||void 0===o?void 0:o.decoration)||"none"})),null===c.haloColor&&null===c.haloSize&&(c.haloColor=new O.default([255,255,255,1]),c.haloSize=2),c.horizontalAlignment||(c.horizontalAlignment="center"),c.verticalAlignment||(c.verticalAlignment="middle"),c.text=s,e.symbol=c,this.processedMeasurementGraphics.add(a),e.attributes||(e.attributes={}),e.attributes._styleFixed=!0,!0}catch(e){return console.error("Error processing measurement label:",e),!1}},this.verifyLayerState=()=>{if(!this.props.graphicsLayer)return;const e=this.props.graphicsLayer.graphics.toArray(),t=e.filter((e=>{var t,i;return!(null===(t=e.attributes)||void 0===t?void 0:t.isMeasurementLabel)&&!(null===(i=e.attributes)||void 0===i?void 0:i.hideFromList)}));e.filter((e=>{var t;return null===(t=e.attributes)||void 0===t?void 0:t.isMeasurementLabel}));t.length!==this.state.drawings.length&&(console.warn("\u26a0\ufe0f State mismatch detected! Forcing refresh..."),this.refreshDrawingsFromLayer())},this.removeMeasurementLabels=e=>{var t,i,r;if(e&&this.props.graphicsLayer)try{const n=null===(t=e.attributes)||void 0===t?void 0:t.uniqueId;let o=0;e.bufferGraphic&&(this.props.graphicsLayer.remove(e.bufferGraphic),e.bufferGraphic=null,o++),e.bufferSettings&&(e.bufferSettings=null);const a=this.props.graphicsLayer.graphics.toArray().filter((t=>{var i,r,o;const a=t;return!!(null===(i=a.attributes)||void 0===i?void 0:i.isMeasurementLabel)&&(a.measureParent===e||n&&(null===(r=a.attributes)||void 0===r?void 0:r.parentGraphicId)===n||(null===(o=a.measure)||void 0===o?void 0:o.graphic)===e)}));if(a.forEach((e=>{try{this.props.graphicsLayer.remove(e),o++}catch(e){console.error("\u274c Error removing measurement label:",e)}})),null===(i=e.measure)||void 0===i?void 0:i.graphic)try{this.props.graphicsLayer.remove(e.measure.graphic),o++}catch(e){console.error("\u274c Error removing direct measure graphic:",e)}(null===(r=e.attributes)||void 0===r?void 0:r.relatedSegmentLabels)&&Array.isArray(e.attributes.relatedSegmentLabels)&&e.attributes.relatedSegmentLabels.forEach((e=>{if(e)try{this.props.graphicsLayer.remove(e),o++}catch(e){console.error("\u274c Error removing segment label:",e)}}))}catch(e){console.error("\u274c Error in measurement cleanup:",e)}},this.associateMeasurementLabel=(e,t)=>{var i;e&&t&&(t.attributes||(t.attributes={}),t.attributes.isMeasurementLabel=!0,t.attributes.parentGraphicId=null===(i=e.attributes)||void 0===i?void 0:i.uniqueId,t.measureParent=e,e.attributes||(e.attributes={}),e.attributes.relatedMeasurementLabels||(e.attributes.relatedMeasurementLabels=[]),e.attributes.relatedMeasurementLabels.push(t))},this.cleanupMeasurementLabelsForGraphic=e=>{if(e&&this.props.graphicsLayer)try{this.sketchViewModel&&(this.sketchViewModel.cancel(),this.sketchViewModel.updateGraphics&&this.sketchViewModel.updateGraphics.removeAll()),this.setState({selectedGraphicIndex:null,symbolEditingIndex:null}),setTimeout((()=>{this.performAggressiveCleanup(e)}),100)}catch(e){console.error("Error in cleanup initiation:",e)}},this.performActualCleanup=e=>{var t,i;if(e&&this.props.graphicsLayer)try{(null===(t=e.measure)||void 0===t?void 0:t.graphic)&&(this.props.graphicsLayer.remove(e.measure.graphic),e.measure=null),(null===(i=e.attributes)||void 0===i?void 0:i.relatedSegmentLabels)&&Array.isArray(e.attributes.relatedSegmentLabels)&&(e.attributes.relatedSegmentLabels.forEach((e=>{e&&this.props.graphicsLayer.remove(e)})),e.attributes.relatedSegmentLabels=[]);const r=this.props.graphicsLayer.graphics.toArray().filter((t=>{var i,r,n;const o=t;return(null===(i=o.attributes)||void 0===i?void 0:i.isMeasurementLabel)&&(o.measureParent===e||(null===(r=o.attributes)||void 0===r?void 0:r.parentId)===(null===(n=e.attributes)||void 0===n?void 0:n.uniqueId))}));r.length>0&&r.forEach((e=>{this.props.graphicsLayer.remove(e)})),setTimeout((()=>{this.forceMapRefresh()}),100)}catch(e){console.error("Error in actual cleanup:",e)}},this.convertToGeographic=e=>{try{if(e.spatialReference&&(4326===e.spatialReference.wkid||4326===e.spatialReference.latestWkid))return e;const t={wkid:4326};if(void 0!==Ce.default)try{const t=k(4272);if(t&&t.webMercatorToGeographic)return t.webMercatorToGeographic(e)}catch(e){}if(void 0!==e.longitude&&void 0!==e.latitude)return e;if(e.spatialReference&&(3857===e.spatialReference.wkid||3857===e.spatialReference.latestWkid)){const i=e.x/20037508.34*180,r=360*Math.atan(Math.exp(e.y/20037508.34*Math.PI))/Math.PI-90;return{x:i,y:r,longitude:i,latitude:r,spatialReference:t}}return console.warn("Could not convert point to geographic coordinates:",e),e}catch(t){return console.error("Error converting point to geographic:",t),e}},this.convertCoordinateToGeographic=(e,t)=>{var i,r;try{const n=null===(r=null===(i=this.props.jimuMapView)||void 0===i?void 0:i.view)||void 0===r?void 0:r.spatialReference;if(n&&(4326===n.wkid||4326===n.latestWkid))return{longitude:e,latitude:t};if(n&&(3857===n.wkid||3857===n.latestWkid)){return{longitude:e/20037508.34*180,latitude:360*Math.atan(Math.exp(t/20037508.34*Math.PI))/Math.PI-90}}return{longitude:e,latitude:t}}catch(i){return console.error("Error converting coordinate to geographic:",i),{longitude:e,latitude:t}}},this.simpleCoordinateConversion=e=>{if(!e)return null;try{switch(e.type){case"point":const t=e;if(void 0!==t.longitude&&void 0!==t.latitude)return{type:"Point",coordinates:[t.longitude,t.latitude]};let i=t.x,r=t.y;return t.spatialReference&&3857===t.spatialReference.wkid&&(i=t.x/20037508.34*180,r=360*Math.atan(Math.exp(t.y/20037508.34*Math.PI))/Math.PI-90),{type:"Point",coordinates:[i,r]};case"polyline":const n=e,o=n.paths.map((e=>e.map((e=>{let t=e[0],i=e[1];return n.spatialReference&&3857===n.spatialReference.wkid&&(t=e[0]/20037508.34*180,i=360*Math.atan(Math.exp(e[1]/20037508.34*Math.PI))/Math.PI-90),[t,i]}))));return{type:o.length>1?"MultiLineString":"LineString",coordinates:o.length>1?o:o[0]};case"polygon":const a=e,s=a.rings.map((e=>e.map((e=>{let t=e[0],i=e[1];return a.spatialReference&&3857===a.spatialReference.wkid&&(t=e[0]/20037508.34*180,i=360*Math.atan(Math.exp(e[1]/20037508.34*Math.PI))/Math.PI-90),[t,i]}))));return{type:"Polygon",coordinates:s};case"extent":const l=e;let c=l.xmin,u=l.ymin,d=l.xmax,h=l.ymax;l.spatialReference&&3857===l.spatialReference.wkid&&(c=l.xmin/20037508.34*180,u=360*Math.atan(Math.exp(l.ymin/20037508.34*Math.PI))/Math.PI-90,d=l.xmax/20037508.34*180,h=360*Math.atan(Math.exp(l.ymax/20037508.34*Math.PI))/Math.PI-90);return{type:"Polygon",coordinates:[[[c,u],[d,u],[d,h],[c,h],[c,u]]]};default:return console.warn(`Unsupported geometry type: ${e.type}`),null}}catch(e){return console.error("Error converting geometry to GeoJSON:",e),null}},this.convertToGeoJSONGeometry=e=>this.simpleCoordinateConversion(e),this.convertSymbolToStandardProperties=e=>{var t,i,r,n,o,a,s,l,c,u,d,h,m,p,g,f,y,v;if(!e)return{};const w={};try{switch(e.type){case"simple-marker":const b=e;w.marker_color=(null===(t=b.color)||void 0===t?void 0:t.toHex())||"#000000",w.marker_size=b.size||12,w.marker_symbol=b.style||"circle",b.outline&&(w.stroke=(null===(i=b.outline.color)||void 0===i?void 0:i.toHex())||"#000000",w.stroke_width=b.outline.width||1);break;case"simple-line":const x=e;w.stroke=(null===(r=x.color)||void 0===r?void 0:r.toHex())||"#000000",w.stroke_width=x.width||1,w.stroke_opacity=(null===(n=x.color)||void 0===n?void 0:n.a)||1;break;case"simple-fill":const M=e;w.fill=(null===(o=M.color)||void 0===o?void 0:o.toHex())||"#000000",w.fill_opacity=(null===(a=M.color)||void 0===a?void 0:a.a)||1,M.outline&&(w.stroke=(null===(s=M.outline.color)||void 0===s?void 0:s.toHex())||"#000000",w.stroke_width=M.outline.width||1);break;case"text":const L=e;w.text=L.text||"",w.text_color=(null===(l=L.color)||void 0===l?void 0:l.toHex())||"#000000",w.text_size=(null===(c=L.font)||void 0===c?void 0:c.size)||12,w.text_font=(null===(u=L.font)||void 0===u?void 0:u.family)||"Arial",(null===(d=L.font)||void 0===d?void 0:d.weight)&&"normal"!==L.font.weight&&(w.text_weight=L.font.weight),(null===(h=L.font)||void 0===h?void 0:h.style)&&"normal"!==L.font.style&&(w.text_style=L.font.style),(null===(m=L.font)||void 0===m?void 0:m.decoration)&&"none"!==L.font.decoration&&(w.text_decoration=L.font.decoration),w.text_align=L.horizontalAlignment||"center",w.text_baseline=L.verticalAlignment||"middle",L.angle&&(w.text_rotation=L.angle),w.text_opacity=null!==(g=null===(p=L.color)||void 0===p?void 0:p.a)&&void 0!==g?g:1;const S=L.haloSize;null!=S&&(w.text_halo_size=S,S>0&&L.haloColor&&(w.text_halo_color=(null===(y=(f=L.haloColor).toHex)||void 0===y?void 0:y.call(f))||"#FFFFFF",w.text_halo_opacity=null!==(v=L.haloColor.a)&&void 0!==v?v:1))}}catch(e){console.error("Error converting symbol properties:",e)}return w},this.generateCompatibleExportData=e=>Ue(this,void 0,void 0,(function*(){var t,i,r,n,o,a,s,l,c;const u=[],d=e=>{var t,i;return(null===(t=null==e?void 0:e.attributes)||void 0===t?void 0:t.uniqueId)||(null===(i=null==e?void 0:e.attributes)||void 0===i?void 0:i.id)||`exp_${Date.now()}_${Math.random().toString(36).slice(2,10)}`},h=e=>{var t;if(!e||"text"!==e.type)return{};const i=e,r=i.font||{},n={text:null!==(t=i.text)&&void 0!==t?t:"",text_color:i.color&&"function"==typeof i.color.toHex?i.color.toHex():"#000000",text_opacity:i.color&&"number"==typeof i.color.a?i.color.a:1,text_size:"number"==typeof r.size?r.size:12,text_font:r.family||"Arial",text_weight:r.weight||"normal",text_style:r.style||"normal",text_decoration:r.decoration||"none",text_align:i.horizontalAlignment||"center",text_baseline:i.verticalAlignment||"middle",text_rotation:"number"==typeof i.angle?i.angle:0};return"number"==typeof i.haloSize&&(n.text_halo_size=i.haloSize,i.haloSize>0&&i.haloColor&&(n.text_halo_color="function"==typeof i.haloColor.toHex?i.haloColor.toHex():"#FFFFFF",n.text_halo_opacity="number"==typeof i.haloColor.a?i.haloColor.a:1)),n},m=(e,t)=>{u.push({type:"Feature",geometry:e,properties:t})},p=(e,t)=>Ue(this,void 0,void 0,(function*(){var i,r,n;const o=yield this.convertToStandardGeoJSON(e.geometry);if(!o)return void console.warn(`Failed to convert geometry for drawing ${t}`);const a={id:d(e),name:(null===(i=e.attributes)||void 0===i?void 0:i.name)||`Drawing ${t+1}`,description:`${this.getDrawingTypeLabel(e)} drawing`,type:this.getDrawingTypeLabel(e),created:(null===(r=e.attributes)||void 0===r?void 0:r.createdDate)?new Date(e.attributes.createdDate).toISOString():null},s=this.convertSymbolToStandardProperties(e.symbol)||{};Object.assign(a,s),"text"===(null===(n=e.symbol)||void 0===n?void 0:n.type)&&Object.assign(a,h(e.symbol)),e.bufferSettings&&e.bufferSettings.enabled&&(a.bufferDistance=e.bufferSettings.distance,a.bufferUnit=e.bufferSettings.unit,"number"==typeof e.bufferSettings.opacity&&(a.bufferOpacity=e.bufferSettings.opacity)),m(o,a)})),g=(e,t,i)=>Ue(this,void 0,void 0,(function*(){var i,r,n,o,a,s;if(!(null==e?void 0:e.geometry))return;const l=yield this.convertToStandardGeoJSON(e.geometry);if(!l)return;const c=d(e),u=d(t),p={id:c,name:(null===(i=e.attributes)||void 0===i?void 0:i.name)||"Measurement Label",description:"Measurement label",type:"Text",created:(null===(r=e.attributes)||void 0===r?void 0:r.createdDate)?new Date(e.attributes.createdDate).toISOString():null,isMeasurementLabel:!0,hideFromList:!0,parentGraphicId:u};(null===(n=e.attributes)||void 0===n?void 0:n.measurementType)&&(p.measurementType=e.attributes.measurementType),(null===(o=e.attributes)||void 0===o?void 0:o.lengthUnit)&&(p.lengthUnit=e.attributes.lengthUnit),(null===(a=e.attributes)||void 0===a?void 0:a.areaUnit)&&(p.areaUnit=e.attributes.areaUnit);const g=this.convertSymbolToStandardProperties(e.symbol)||{};Object.assign(p,g),"text"===(null===(s=e.symbol)||void 0===s?void 0:s.type)&&Object.assign(p,h(e.symbol)),m(l,p)}));for(let u=0;u<e.length;u++){const h=e[u];if(!h||!h.geometry){console.warn(`Skipping graphic ${u}: missing graphic or geometry`);continue}yield p(h,u);const m=[];(null===(t=h.measure)||void 0===t?void 0:t.graphic)&&(null===(i=h.measure.graphic.attributes)||void 0===i?void 0:i.isMeasurementLabel)&&m.push(h.measure.graphic);const f=null===(r=h.attributes)||void 0===r?void 0:r.relatedSegmentLabels;if(Array.isArray(f)&&f.length)for(const e of f)(null===(n=null==e?void 0:e.attributes)||void 0===n?void 0:n.isMeasurementLabel)&&m.push(e);const y=d(h);try{const e=this.props.graphicsLayer,t=null!==(s=null===(a=null===(o=null==e?void 0:e.graphics)||void 0===o?void 0:o.toArray)||void 0===a?void 0:a.call(o))&&void 0!==s?s:[];for(const e of t)(null===(l=null==e?void 0:e.attributes)||void 0===l?void 0:l.isMeasurementLabel)&&(null===(c=null==e?void 0:e.attributes)||void 0===c?void 0:c.parentGraphicId)===y&&(m.includes(e)||m.push(e))}catch(e){}const v=new Set;for(let e=0;e<m.length;e++){const t=m[e],i=d(t);if(!v.has(i)){v.add(i);try{yield g(t,h)}catch(e){console.warn("Failed exporting measurement label",e)}}}}return{geoJSONFormat:{type:"FeatureCollection",features:u}}})),this.getWGS84Coordinates=(e,t)=>{var i,r;const n=null===(r=null===(i=this.props.jimuMapView)||void 0===i?void 0:i.view)||void 0===r?void 0:r.spatialReference;if(!n||4326===n.wkid){return{lon:Number(e.toFixed(8)),lat:Number(t.toFixed(8))}}if(3857===n.wkid||102100===n.wkid){const i=e/20037508.34*180,r=360*Math.atan(Math.exp(t/20037508.34*Math.PI))/Math.PI-90;return{lon:Number(i.toFixed(8)),lat:Number(r.toFixed(8))}}return{lon:Number(e.toFixed(8)),lat:Number(t.toFixed(8))}},this.isValidCoordinate=(e,t)=>!isNaN(e)&&!isNaN(t)&&e>=-180&&e<=180&&t>=-90&&t<=90,this.determineEsriGeometryType=e=>{const t=e.reduce(((e,t)=>{var i;const r=null===(i=t.geometry)||void 0===i?void 0:i.type;return r&&(e[r]=(e[r]||0)+1),e}),{});switch(Object.keys(t).reduce(((e,i)=>t[e]>t[i]?e:i))){case"point":default:return"esriGeometryPoint";case"polyline":return"esriGeometryPolyline";case"polygon":case"extent":return"esriGeometryPolygon"}},this.getGraphicId=e=>{var t,i,r,n,o;if(null===(t=e.attributes)||void 0===t?void 0:t.uniqueId)return e.attributes.uniqueId;if(null===(i=e.attributes)||void 0===i?void 0:i.objectId)return`obj_${e.attributes.objectId}`;const a=(null===(r=e.geometry)||void 0===r?void 0:r.type)||"unknown",s=(null===(n=e.symbol)||void 0===n?void 0:n.type)||"unknown",l=(null===(o=e.symbol)||void 0===o?void 0:o.text)||"",c=Date.now(),u=Math.floor(1e4*Math.random());return`${a}_${s}_${l.substring(0,10)}_${c}_${u}`},this.performFinalMeasurementCleanup=e=>{if(this.props.graphicsLayer)try{const t=this.props.graphicsLayer.graphics.toArray(),i=t.filter((e=>{var t;return null===(t=e.attributes)||void 0===t?void 0:t.isMeasurementLabel})).filter((t=>{var i,r;const n=t,o=n.measureParent,a=null===(i=n.attributes)||void 0===i?void 0:i.parentId,s=null===(r=e.attributes)||void 0===r?void 0:r.uniqueId;return o===e||!(!a||!s||a!==s)}));i.length>0&&i.forEach((e=>{this.props.graphicsLayer.remove(e)}))}catch(e){console.error("Error in final measurement cleanup:",e)}},this.createBufferSymbolFromParent=e=>{var t,i,r;const n=null===(t=e.geometry)||void 0===t?void 0:t.type,o=e.symbol,a=null===(i=e.bufferSettings)||void 0===i?void 0:i.opacity,s=(void 0!==a?a:50)/100;let l=new O.default([0,0,0,.15*s]),c=new O.default([0,0,0,.6*s]);try{if("polygon"===n&&o){const e=o;if(null==e?void 0:e.color){const t=e.color.toRgba?e.color.toRgba():[0,0,0,1];l=new O.default([t[0],t[1],t[2],Math.min(t[3]*s,1)]),c=new O.default([t[0],t[1],t[2],Math.min(t[3]*s,1)])}if(null===(r=null==e?void 0:e.outline)||void 0===r?void 0:r.color){const t=e.outline.color.toRgba?e.outline.color.toRgba():[0,0,0,1];c=new O.default([t[0],t[1],t[2],Math.min(t[3]*s,1)])}}else if("polyline"===n&&o){const e=o;if(null==e?void 0:e.color){const t=e.color.toRgba?e.color.toRgba():[0,0,0,1];l=new O.default([t[0],t[1],t[2],Math.min(.6*t[3]*s,1)]),c=new O.default([t[0],t[1],t[2],Math.min(t[3]*s,1)])}}else if("point"===n&&o){const e=o;if(null==e?void 0:e.color){const t=e.color.toRgba?e.color.toRgba():[0,0,0,1];l=new O.default([t[0],t[1],t[2],Math.min(.6*t[3]*s,1)]),c=new O.default([t[0],t[1],t[2],Math.min(t[3]*s,1)])}}}catch(e){console.warn("Error processing parent colors:",e)}return new Le.default({color:l,outline:new Me.default({color:c,width:1.5,style:"dash"})})},this.completeDeletion=()=>{try{this.props.onMeasurementSystemControl&&this._measurementWasEnabled&&this.props.onMeasurementSystemControl(!0),this._isDeletingGraphic=!1,this.forceMapRefresh()}catch(e){console.error("\u274c Error completing deletion:",e),this._isDeletingGraphic=!1,this.props.onMeasurementSystemControl&&this._measurementWasEnabled&&this.props.onMeasurementSystemControl(!0)}},this.finishDeletion=(e,t)=>{try{this.ignoreNextGraphicsUpdate=!0,this.props.graphicsLayer.remove(e),setTimeout((()=>{this.performFinalMeasurementCleanup(e)}),50);const i=[...this.state.drawings];i.splice(t,1);const r=new Set;this.state.selectedGraphics.forEach((e=>{e<t?r.add(e):e>t&&r.add(e-1)})),this.setState({drawings:i,selectedGraphicIndex:null,selectedGraphics:r,symbolEditingIndex:null},(()=>{!1!==this.props.allowLocalStorage&&!0===this.state.consentGranted&&this.saveToLocalStorage(),this.props.onDrawingsUpdate&&this.props.onDrawingsUpdate(i),setTimeout((()=>{this.completeDeletion()}),300)}))}catch(e){console.error("Error finishing deletion:",e),this.isDeletingGraphics=!1,this.showLocalAlert("Error completing deletion","error"),this.refreshDrawingsFromLayer()}},this.performAggressiveCleanup=e=>{var t,i,r,n;if(e&&this.props.graphicsLayer)try{e.bufferGraphic&&(this.props.graphicsLayer.remove(e.bufferGraphic),e.bufferGraphic=null),e.bufferSettings&&(e.bufferSettings=null);const o=null===(t=e.attributes)||void 0===t?void 0:t.uniqueId;o&&this._positionWatchers&&Object.keys(this._positionWatchers).forEach((e=>{if(e.includes(o))try{this._positionWatchers[e].remove(),delete this._positionWatchers[e]}catch(e){console.warn("Error removing geometry watcher:",e)}}));const a=null===(i=e.attributes)||void 0===i?void 0:i.uniqueId,s=this.props.graphicsLayer.graphics.toArray();(null===(r=e.measure)||void 0===r?void 0:r.graphic)&&(this.props.graphicsLayer.remove(e.measure.graphic),e.measure=null),(null===(n=e.attributes)||void 0===n?void 0:n.relatedSegmentLabels)&&Array.isArray(e.attributes.relatedSegmentLabels)&&(e.attributes.relatedSegmentLabels.forEach((e=>{e&&this.props.graphicsLayer.remove(e)})),e.attributes.relatedSegmentLabels=[]);const l=[];s.forEach((t=>{var i,r,n,o,s,c,u;const d=t;(null===(i=d.attributes)||void 0===i?void 0:i.isMeasurementLabel)&&(d.measureParent===e||a&&(null===(r=d.attributes)||void 0===r?void 0:r.parentId)===a||(null===(n=e.measure)||void 0===n?void 0:n.graphic)===d||(null===(s=null===(o=e.attributes)||void 0===o?void 0:o.relatedSegmentLabels)||void 0===s?void 0:s.includes(d))||a&&(null===(u=null===(c=d.measureParent)||void 0===c?void 0:c.attributes)||void 0===u?void 0:u.uniqueId)===a)&&l.push(d)})),l.length>0&&l.forEach((e=>{this.props.graphicsLayer.remove(e)}));const c=s.filter((e=>{var t,i,r,n;const o=e;return((null===(t=o.attributes)||void 0===t?void 0:t.isBuffer)||(null===(i=o.attributes)||void 0===i?void 0:i.isPreviewBuffer))&&((null===(r=o.attributes)||void 0===r?void 0:r.parentId)===a||(null===(n=o.attributes)||void 0===n?void 0:n.sourceGraphicId)===a)}));c.length>0&&c.forEach((e=>{this.props.graphicsLayer.remove(e)})),this.forceMapRefresh()}catch(e){console.error("\u274c Error in selective cleanup:",e)}},this.isSuspiciousMeasurementLabel=(e,t)=>{if(!e.symbol||"text"!==e.symbol.type)return!1;try{const i=e.symbol.text||"",r=e.geometry,n=t.geometry;if(!["area:","length:","perimeter:","radius:","total:","m\xb2","ft\xb2","km\xb2","mi\xb2","km","mi","ft","m"].some((e=>i.toLowerCase().includes(e.toLowerCase()))))return!1;if(r&&n&&r.extent&&n.extent){const e=r.extent.center,t=n.extent.center;if(e&&t){const i=Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2));if(i<2*Math.max(n.extent.width,n.extent.height))return!0}}return!1}catch(e){return console.error("Error checking suspicious label:",e),!1}},this._isDeletingGraphic=!1,this.ensurePointTextOverlay=e=>{var t;if(!e||!this.props.graphicsLayer)return;if(!e.geometry||"point"!==e.geometry.type)return;const i=this.props.graphicsLayer;if(e._selectionOverlay){try{e._selectionOverlay.geometry=e.geometry}catch(e){console.warn("Error updating overlay geometry:",e)}return void this.bringOverlayToFront(e._selectionOverlay)}const r="text"===(null===(t=e.symbol)||void 0===t?void 0:t.type),n=new me.default({style:r?"square":"circle",size:r?26:22,color:[0,0,0,0],outline:{color:[255,128,0,1],width:2}}),o=new P.default({geometry:e.geometry,symbol:n,attributes:{hideFromList:!0,isMeasurementLabel:!1,isSelectionOverlay:!0}});try{i.add(o),e._selectionOverlay=o}catch(e){console.error("ensurePointTextOverlay: error creating overlay:",e)}},this.continueDeleteGraphic=(e,t)=>{var i,r;try{t.bufferGraphic&&(this.props.graphicsLayer.remove(t.bufferGraphic),t.bufferGraphic=null),t.bufferSettings&&(t.bufferSettings=null);const n=null===(i=t.attributes)||void 0===i?void 0:i.uniqueId;n&&this._positionWatchers&&Object.keys(this._positionWatchers).forEach((e=>{if(e.includes(n))try{this._positionWatchers[e].remove(),delete this._positionWatchers[e]}catch(e){console.warn("Error removing geometry watcher:",e)}})),this.removeMeasurementLabels(t);const o=null===(r=t.attributes)||void 0===r?void 0:r.uniqueId;if(o){const e=this.props.graphicsLayer.graphics.toArray().find((e=>{var t,i,r,n,a;return!((null===(t=e.attributes)||void 0===t?void 0:t.uniqueId)!==o||(null===(i=e.attributes)||void 0===i?void 0:i.isMeasurementLabel)||(null===(r=e.attributes)||void 0===r?void 0:r.hideFromList)||(null===(n=e.attributes)||void 0===n?void 0:n.isBuffer)||(null===(a=e.attributes)||void 0===a?void 0:a.isPreviewBuffer))}));e?(this.ignoreNextGraphicsUpdate=!0,this.props.graphicsLayer.remove(e)):console.warn(`\u26a0\ufe0f Could not find graphic with uniqueId ${o} in layer`)}else console.warn("\u26a0\ufe0f Graphic has no uniqueId, using fallback removal"),this.ignoreNextGraphicsUpdate=!0,this.props.graphicsLayer.remove(t);o&&setTimeout((()=>{this.performAggressiveMeasurementCleanup(o)}),200);const a=[...this.state.drawings];a.splice(e,1);const s=new Set;this.state.selectedGraphics.forEach((t=>{t<e?s.add(t):t>e&&s.add(t-1)})),this.setState({drawings:a,selectedGraphicIndex:null,selectedGraphics:s,symbolEditingIndex:null},(()=>{!1!==this.props.allowLocalStorage&&!0===this.state.consentGranted&&this.saveToLocalStorage(),this.props.onDrawingsUpdate&&this.props.onDrawingsUpdate(a),this._isDeletingGraphic=!1,setTimeout((()=>{this.verifyLayerState()}),500)}))}catch(e){console.error("\u274c Error during deletion continuation:",e),this._isDeletingGraphic=!1,this.showLocalAlert("Error deleting drawing","error"),this.refreshDrawingsFromLayer()}},this.restoreSketchViewModelSelection=e=>{if(this.sketchViewModel&&e)try{setTimeout((()=>{this.sketchViewModel&&!this._isDeletingGraphic&&this.sketchViewModel.update([e])}),100)}catch(e){console.warn("Could not restore SketchViewModel selection:",e)}},this.removePointTextOverlayByIndex=e=>{var t;if(null==e)return;const i=null===(t=this.state.drawings)||void 0===t?void 0:t[e];this.removePointTextOverlay(i)},this.removeAllSelectionOverlays=()=>{const e=this.state.selectedGraphics;(null==e?void 0:e.size)&&e.forEach((e=>this.removePointTextOverlayByIndex(e))),this.removePointTextOverlayByIndex(this.state.selectedGraphicIndex)},this.bringOverlayToFront=e=>{if(e&&this.props.graphicsLayer)try{this.props.graphicsLayer.remove(e),this.props.graphicsLayer.add(e)}catch(e){}},this.removePointTextOverlay=e=>{if(e&&this.props.graphicsLayer&&e._selectionOverlay){try{this.props.graphicsLayer.remove(e._selectionOverlay)}catch(e){}e._selectionOverlay=null}},this.performAggressiveMeasurementCleanup=e=>{if(this.props.graphicsLayer)try{const t=this.props.graphicsLayer.graphics.toArray();let i=0;t.filter((e=>{var t;return null===(t=e.attributes)||void 0===t?void 0:t.isMeasurementLabel})).forEach((r=>{var n,o;const a=r,s=null===(n=a.attributes)||void 0===n?void 0:n.parentId;let l=!1;if(s===e)l=!0;else if(s){const e=t.some((e=>{var t,i;return(null===(t=e.attributes)||void 0===t?void 0:t.uniqueId)===s&&!(null===(i=e.attributes)||void 0===i?void 0:i.isMeasurementLabel)}));e||(l=!0)}else if(a.measureParent){const i=null===(o=a.measureParent.attributes)||void 0===o?void 0:o.uniqueId;if(i===e)l=!0;else{const e=t.some((e=>{var t,r;return(null===(t=e.attributes)||void 0===t?void 0:t.uniqueId)===i&&!(null===(r=e.attributes)||void 0===r?void 0:r.isMeasurementLabel)}));e||(l=!0)}}else l=!0;if(l)try{this.props.graphicsLayer.remove(r),i++}catch(e){console.warn("\u274c Failed to remove orphaned label:",e)}})),setTimeout((()=>{this.forceMapRefresh()}),100)}catch(e){console.error("\u274c Error in aggressive measurement cleanup:",e)}},this.measureRef=null,this._measurementUpdateTimeout=null,this._saveToStorageTimeout=null,this._isUpdatingMeasurements=!1,this._measurementUpdateQueue=new Set,this._processingMeasurements=!1,this.updateAttachedBuffer=e=>Ue(this,void 0,void 0,(function*(){if(e.bufferGraphic&&e.bufferSettings&&this.props.graphicsLayer)try{const{distance:t,unit:i}=e.bufferSettings,r=yield this.createBufferGeometry(e.geometry,t,i);r&&(e.bufferGraphic.geometry=r,this.props.graphicsLayer.remove(e.bufferGraphic),this.props.graphicsLayer.add(e.bufferGraphic))}catch(e){console.error("\u274c Error updating attached buffer:",e)}})),this.ensureBufferWatchersForSelectedGraphic=e=>{var t;if(e.bufferSettings&&e.bufferSettings.enabled&&e.bufferGraphic){const i=null===(t=e.attributes)||void 0===t?void 0:t.uniqueId;if(i){const t=this._positionWatchers[i+"_buffer"];t&&t.remove(),this._positionWatchers[i+"_buffer"]=e.watch("geometry",(t=>Ue(this,void 0,void 0,(function*(){if(e.bufferGraphic&&e.bufferSettings)try{yield this.updateAttachedBuffer(e)}catch(e){console.error("\u274c Error updating buffer from MyDrawingsPanel:",e)}}))))}}},this.createBufferGeometry=(e,t,i)=>Ue(this,void 0,void 0,(function*(){var r,n,o;try{const a=null===(r=this.props.jimuMapView)||void 0===r?void 0:r.view;if(!a)return null;const s=i;let l=null;return l=(null===(n=a.spatialReference)||void 0===n?void 0:n.isGeographic)||(null===(o=a.spatialReference)||void 0===o?void 0:o.isWebMercator)?yield Ce.default.geodesicBuffer(e,t,s):yield Ce.default.buffer(e,t,s,!0),l?Array.isArray(l)?0===l.length?(console.warn("Buffer operation returned empty array"),null):l[0]:l:(console.warn("Buffer operation returned null"),null)}catch(e){return console.error("Error creating buffer geometry:",e),null}})),this._geometryWatchTimeouts={},this.performActualSave=()=>{if(!1!==this.props.allowLocalStorage&&!0===this.state.consentGranted)try{const e=this.props.graphicsLayer.graphics.toArray(),t=e.filter((e=>{var t,i,r,n,o;return!((null===(t=e.attributes)||void 0===t?void 0:t.isMeasurementLabel)||(null===(i=e.attributes)||void 0===i?void 0:i.hideFromList)||(null===(r=e.attributes)||void 0===r?void 0:r.isPreviewBuffer)||(null===(n=e.attributes)||void 0===n?void 0:n.isBuffer)||(null===(o=e.attributes)||void 0===o?void 0:o.isBufferDrawing))})),i=e.filter((e=>{var t,i;return(null===(t=e.attributes)||void 0===t?void 0:t.isMeasurementLabel)&&!(null===(i=e.attributes)||void 0===i?void 0:i.isPreviewBuffer)})),r=t.map((e=>{const t=e,i=e.toJSON();if(i.attributes||(i.attributes={}),!i.attributes.uniqueId){const e=`restored_${Date.now()}_${Math.floor(1e4*Math.random())}`;i.attributes.uniqueId=e}return i.attributes.createdDate||(i.attributes.createdDate=Date.now()),t.bufferSettings&&(i.attributes.bufferSettings={distance:t.bufferSettings.distance,unit:t.bufferSettings.unit,enabled:t.bufferSettings.enabled,opacity:t.bufferSettings.opacity}),i})),n={drawings:r,measurementLabels:i.map((e=>{var t,i,r,n,o,a,s,l;const c=e,u=e.toJSON();return u.attributes||(u.attributes={}),(null===(i=null===(t=c.measureParent)||void 0===t?void 0:t.attributes)||void 0===i?void 0:i.uniqueId)&&(u.attributes.parentGraphicId=c.measureParent.attributes.uniqueId),u.attributes.isMeasurementLabel=!0,u.attributes.hideFromList=!0,(null===(r=c.attributes)||void 0===r?void 0:r.customized)&&(u.attributes.customized=!0,u.attributes.lastModified=c.attributes.lastModified),(null===(n=c.attributes)||void 0===n?void 0:n.hasCustomPosition)&&(null===(o=c.attributes)||void 0===o?void 0:o.customPosition)&&(u.attributes.hasCustomPosition=!0,u.attributes.customPosition=c.attributes.customPosition),(null===(a=c.attributes)||void 0===a?void 0:a.measurementType)&&(u.attributes.measurementType=c.attributes.measurementType),(null===(s=c.attributes)||void 0===s?void 0:s.lengthUnit)&&(u.attributes.lengthUnit=c.attributes.lengthUnit),(null===(l=c.attributes)||void 0===l?void 0:l.areaUnit)&&(u.attributes.areaUnit=c.attributes.areaUnit),u})),version:"1.4"},o=this.localStorageKey,a=()=>{try{const e=JSON.stringify(n);localStorage.setItem(o,e)}catch(e){console.error("\u274c Failed to stringify graphics for localStorage",e),this.showLocalAlert("Error saving drawings (stringify failed)","error")}};"requestIdleCallback"in window?window.requestIdleCallback(a,{timeout:5e3}):setTimeout(a,0)}catch(e){console.error("\u274c Error preparing drawings for localStorage",e),this.showLocalAlert("Error saving drawings","error")}},this.debouncedMeasurementUpdate=(e,t=500)=>{var i;if(!e||!(null===(i=e.attributes)||void 0===i?void 0:i.uniqueId))return;if(this._isUpdatingMeasurements)return;const r=e.attributes.uniqueId;this._geometryWatchTimeouts[r]&&clearTimeout(this._geometryWatchTimeouts[r]),this._geometryWatchTimeouts[r]=setTimeout((()=>{this.performSingleMeasurementUpdate(e),delete this._geometryWatchTimeouts[r]}),t)},this.performSingleMeasurementUpdate=e=>{var t,i;if(!e||!(null===(t=this.measureRef)||void 0===t?void 0:t.current)||this._isUpdatingMeasurements)return;this._isUpdatingMeasurements=!0;const r=(null===(i=e.attributes)||void 0===i?void 0:i.uniqueId)||"unknown";try{this.measureRef.current.updateMeasurementsForGraphic(e)}catch(e){console.warn(`\u274c Could not update measurements for ${r}:`,e)}finally{setTimeout((()=>{this._isUpdatingMeasurements=!1}),100)}},this.cleanupOrphanedMeasurementLabels=()=>{if(this.props.graphicsLayer)try{const e=this.props.graphicsLayer.graphics.toArray(),t=e.filter((e=>{var t,i,r,n;const o=e;return!((null===(t=o.attributes)||void 0===t?void 0:t.isMeasurementLabel)||(null===(i=o.attributes)||void 0===i?void 0:i.hideFromList)||(null===(r=o.attributes)||void 0===r?void 0:r.isBuffer)||(null===(n=o.attributes)||void 0===n?void 0:n.isPreviewBuffer))})),i=e.filter((e=>{var t,i;const r=e;return(null===(t=r.attributes)||void 0===t?void 0:t.isMeasurementLabel)&&!(null===(i=r.attributes)||void 0===i?void 0:i.isBuffer)})),r=e.filter((e=>{var t,i;const r=e;return(null===(t=r.attributes)||void 0===t?void 0:t.isBuffer)||(null===(i=r.attributes)||void 0===i?void 0:i.isPreviewBuffer)||r.isBufferDrawing})),n=new Set(t.map((e=>{var t;return null===(t=e.attributes)||void 0===t?void 0:t.uniqueId})).filter((e=>e))),o=i.filter((e=>{var t,i,r;const o=(null===(t=e.attributes)||void 0===t?void 0:t.parentGraphicId)||(null===(r=null===(i=e.measureParent)||void 0===i?void 0:i.attributes)||void 0===r?void 0:r.uniqueId);return!o||!n.has(o)})),a=r.filter((e=>{var t,i;const r=null===(t=e.attributes)||void 0===t?void 0:t.parentId;if(r&&!n.has(r))return!0;const o=e.sourceGraphicId||(null===(i=e.attributes)||void 0===i?void 0:i.sourceGraphicId);return!(!o||n.has(o))||!r&&!o}));o.length>0&&o.forEach((e=>{this.props.graphicsLayer.remove(e)})),a.length>0&&a.forEach((e=>{this.props.graphicsLayer.remove(e)})),0===o.length&&0===a.length||this.forceMapRefresh()}catch(e){console.error("\u274c Error during automatic orphaned graphics cleanup:",e)}},this.cleanupLocalStorageMeasurements=()=>{if(!1!==this.props.allowLocalStorage&&!0===this.state.consentGranted)try{const e=this.localStorageKey,t=localStorage.getItem(e);if(!t)return;const i=JSON.parse(t);if("1.1"===i.version&&i.drawings&&i.measurementLabels){const t=i.drawings||[],r=i.measurementLabels||[],n=new Set(t.map((e=>{var t;return null===(t=e.attributes)||void 0===t?void 0:t.uniqueId})).filter((e=>e))),o=r.filter((e=>{var t;const i=null===(t=e.attributes)||void 0===t?void 0:t.parentGraphicId;return i&&n.has(i)}));if(o.length!==r.length){const t=Object.assign(Object.assign({},i),{measurementLabels:o});localStorage.setItem(e,JSON.stringify(t))}}}catch(e){console.error("\u274c Error auto-cleaning localStorage measurements:",e)}},this.safeSketchViewModelUpdate=e=>{if(!this.sketchViewModel||!e||0===e.length)return Promise.resolve();try{const t=e.filter((e=>e&&e.geometry&&e.symbol&&!e.destroyed&&e.layer===this.props.graphicsLayer));if(0===t.length)return Promise.resolve();const i=this.sketchViewModel.update(t);return i&&"function"==typeof i.catch?i.catch((e=>(console.warn("SketchViewModel update error (handled):",e),Promise.resolve()))):Promise.resolve()}catch(e){return console.warn("SketchViewModel update error (caught):",e),Promise.resolve()}},this.recreateAttachedBuffer=(e,...t)=>Ue(this,[e,...t],void 0,(function*(e,t=!0){var i,r,n,o,a;if(!e.bufferSettings||!this.props.graphicsLayer)return;const{distance:s,unit:l,enabled:c,opacity:u}=e.bufferSettings;if(!c)return;const d=void 0!==u?u:50;try{const t=yield this.createBufferGeometry(e.geometry,s,l);if(!t)return void console.warn(`\u274c Failed to recreate buffer geometry for graphic ${null===(i=e.attributes)||void 0===i?void 0:i.uniqueId}`);e.bufferSettings={distance:s,unit:l,enabled:c,opacity:d};const u=this.createBufferSymbolFromParent(e),h=new P.default({geometry:t,symbol:u,attributes:{uniqueId:`buffer_${null===(r=e.attributes)||void 0===r?void 0:r.uniqueId}_${Date.now()}`,name:`${(null===(n=e.attributes)||void 0===n?void 0:n.name)||"Drawing"} Buffer`,parentId:null===(o=e.attributes)||void 0===o?void 0:o.uniqueId,isBuffer:!0,hideFromList:!0,isMeasurementLabel:!1,bufferDistance:s,bufferUnit:l}});h.isBufferDrawing=!0,h.sourceGraphicId=null===(a=e.attributes)||void 0===a?void 0:a.uniqueId,e.bufferGraphic=h;const m=this.props.graphicsLayer.graphics.indexOf(e);m>=0?this.props.graphicsLayer.graphics.add(h,m):this.props.graphicsLayer.add(h)}catch(e){console.error("\u274c Error recreating attached buffer:",e)}})),this.setupInteractionManager=()=>{var e;if(null===(e=this.props.jimuMapView)||void 0===e?void 0:e.view)try{const e=this.props.jimuMapView.view;void 0!==e.qualityProfile&&(this._originalQuality=e.qualityProfile);const t=()=>{this._isInteracting||(this._isInteracting=!0,void 0!==e.qualityProfile&&(e.qualityProfile="low"),this.props.graphicsLayer&&this.props.graphicsLayer.graphics.forEach((e=>{var t,i;((null===(t=e.attributes)||void 0===t?void 0:t.isMeasurementLabel)||(null===(i=e.attributes)||void 0===i?void 0:i.hideDuringInteraction))&&(e.visible=!1)})))},i=this.debounce((()=>{this._isInteracting&&(this._isInteracting=!1,void 0!==e.qualityProfile&&(e.qualityProfile=this._originalQuality),this.props.graphicsLayer&&this.props.graphicsLayer.graphics.forEach((e=>{var t,i;((null===(t=e.attributes)||void 0===t?void 0:t.isMeasurementLabel)||(null===(i=e.attributes)||void 0===i?void 0:i.hideDuringInteraction))&&(e.visible=!0)})),setTimeout((()=>this.forceMapRefresh()),250))}),300);this.props.jimuMapView.view.on("drag",t),this.props.jimuMapView.view.on("drag",["end"],i),this.props.jimuMapView.view.on("mouse-wheel",t),this.props.jimuMapView.view.on("mouse-wheel",i),this.props.jimuMapView.view.on("key-down",(e=>{["+","-","_","=","ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.key)&&t()})),this.props.jimuMapView.view.on("key-up",i)}catch(e){console.warn("Could not setup interaction manager:",e)}},this.handleInteractionStart=()=>{var e;this._isInteracting=!0;try{const t=null===(e=this.props.jimuMapView)||void 0===e?void 0:e.view;void 0!==(null==t?void 0:t.qualityProfile)&&(t.qualityProfile="low"),this.props.graphicsLayer&&this.props.graphicsLayer.graphics.forEach((e=>{var t,i;((null===(t=e.attributes)||void 0===t?void 0:t.isMeasurementLabel)||(null===(i=e.attributes)||void 0===i?void 0:i.hideDuringInteraction))&&(e.visible=!1)}))}catch(e){console.warn("Error in interaction start handler:",e)}},this.ensureUniqueName=e=>{if(!e)return`Drawing_${Date.now()}`;const t=e.toLowerCase(),i=this.state.drawings.map((e=>{var t;return((null===(t=e.attributes)||void 0===t?void 0:t.name)||"").toLowerCase()}));if(!i.includes(t))return e;let r=1,n=`${e} (${r})`,o=n.toLowerCase();for(;i.includes(o);)r++,n=`${e} (${r})`,o=n.toLowerCase();return n},this.handleInteractionEnd=()=>{var e;this._isInteracting=!1;try{const t=null===(e=this.props.jimuMapView)||void 0===e?void 0:e.view;void 0!==(null==t?void 0:t.qualityProfile)&&this._originalQuality&&(t.qualityProfile=this._originalQuality),this.props.graphicsLayer&&this.props.graphicsLayer.graphics.forEach((e=>{var t,i;((null===(t=e.attributes)||void 0===t?void 0:t.isMeasurementLabel)||(null===(i=e.attributes)||void 0===i?void 0:i.hideDuringInteraction))&&(e.visible=!0)}));const i=()=>this.forceMapRefresh();"requestIdleCallback"in window?window.requestIdleCallback(i):requestAnimationFrame(i)}catch(e){console.warn("Error in interaction end handler:",e)}},this.refreshGraphicDisplay=e=>{var t;if(e)try{this.ensureGraphicVisibility(e);const i=null===(t=e.attributes)||void 0===t?void 0:t.uniqueId;if(i&&this._drawingMap.has(i)){const t=this._drawingMap.get(i);if(void 0!==t){const i=[...this.state.drawings];i[t]=e,this.setState({drawings:i})}}}catch(e){console.error("Error refreshing graphic display:",e),this._isInteracting||this.forceMapRefresh()}},this.forceMapRefresh=()=>{var e;if(null===(e=this.props.jimuMapView)||void 0===e?void 0:e.view)try{this._goToController&&(this._goToController.abort(),this._goToController=null);const e=new AbortController;this._goToController=e;const t=this.props.jimuMapView.view,i=t.center.clone(),r=t.scale;t.goTo({target:i,scale:r},{animate:!1,duration:0,signal:e.signal}).catch((e=>{"AbortError"!==e.name&&"view:goto-interrupted"!==e.name&&console.error("Map refresh error:",e)}))}catch(e){console.error("Error refreshing map:",e)}},this.ensureGraphicVisibility=e=>{if(e&&this.props.graphicsLayer)try{const t=!1!==e.visible;e.visible=!1,setTimeout((()=>{e&&!e.destroyed&&(e.visible=t)}),0)}catch(e){console.error("Error ensuring graphic visibility:",e)}},this.handleLoadExistingDrawings=()=>{We._drawingsLoadChoiceTimestamp=(new Date).getTime(),this.setState({showLoadPrompt:!1},(()=>{this.loadFromLocalStorage(),this.initializeComponents()}))},this.handleStartFresh=()=>{if(We._drawingsLoadChoiceTimestamp=(new Date).getTime(),!1!==this.props.allowLocalStorage&&!0===this.state.consentGranted)try{localStorage.removeItem(this.localStorageKey)}catch(e){console.error("Error clearing drawings from localStorage:",e)}this.setState({showLoadPrompt:!1,hasExistingDrawings:!1},this.initializeComponents)},this.setupMapQualityManager=()=>{var e;if(null===(e=this.props.jimuMapView)||void 0===e?void 0:e.view)try{const e=this.props.jimuMapView.view;void 0!==e.qualityProfile&&(this._originalQuality=e.qualityProfile),e.on("drag",["start"],(()=>this.lowerMapQuality())),e.on("drag",["end"],(()=>this.restoreMapQuality()))}catch(e){console.warn("Could not setup map quality manager:",e)}},this.lowerMapQuality=()=>{var e;if(null===(e=this.props.jimuMapView)||void 0===e?void 0:e.view)try{const e=this.props.jimuMapView.view;void 0!==e.qualityProfile&&(e.qualityProfile="low")}catch(e){console.warn("Could not lower map quality:",e)}},this.restoreMapQuality=()=>{var e;if(null===(e=this.props.jimuMapView)||void 0===e?void 0:e.view)try{const e=this.props.jimuMapView.view;void 0!==e.qualityProfile&&(e.qualityProfile=this._originalQuality)}catch(e){console.warn("Could not restore map quality:",e)}},this.debounce=(e,t)=>{let i;return(...r)=>{clearTimeout(i),i=setTimeout((()=>e(...r)),t)}},this.resetSessionChoice=()=>{sessionStorage.removeItem("drawingsLoadChoiceMade")},this.checkExistingDrawings=()=>{(new Date).getTime();if(We._drawingsLoadChoiceTimestamp>0)return!1;if(!1!==this.props.allowLocalStorage&&!0===this.state.consentGranted)try{const e=localStorage.getItem(this.localStorageKey);if(e){const t=JSON.parse(e);let i=[];if(Array.isArray(t)?i=t:t.drawings&&(i=t.drawings||[]),Array.isArray(i)&&i.length>0)return this.setState({hasExistingDrawings:!0,showLoadPrompt:!0}),!0}}catch(e){console.error("Error checking for existing drawings in localStorage:",e)}return!1},this.handleDrawingSelectAndScroll=(e,t)=>{var i;try{this._goToController&&(this._goToController.abort(),this._goToController=null);try{null===(i=this.sketchViewModel)||void 0===i||i.cancel()}catch(e){}const r=this.state.selectedGraphicIndex;this.removePointTextOverlayByIndex(r),this.setState({selectedGraphicIndex:t});const n=document.getElementById(`drawing-item-${t}`);n&&n.scrollIntoView({behavior:"smooth",block:"nearest"}),setTimeout((()=>{var i,r;this._isInteracting||(this.highlightGraphic(e,t),null===(r=(i=this.props).onDrawingSelect)||void 0===r||r.call(i,e,t))}),100)}catch(e){console.error("Error in handleDrawingSelectAndScroll:",e),this.showLocalAlert("Error selecting drawing from map","error")}},this.initializeComponents=()=>{if(!this.props.jimuMapView||!this.props.graphicsLayer)return;try{this.sketchViewModel=new E.default({view:this.props.jimuMapView.view,layer:this.props.graphicsLayer}),this.internalSketchVM=!0}catch(e){return void console.error("Error creating SketchViewModel:",e)}this.setupInteractionManager(),this.fixMeasurementLabelStyles(),this.setupGraphicsWatcher(),this.refreshDrawingsFromLayer(),!1!==this.props.allowLocalStorage&&!0===this.state.consentGranted&&this.loadFromLocalStorage();const e=()=>{this._drawingMap.clear(),this.state.drawings.forEach(((e,t)=>{var i;const r=null===(i=e.attributes)||void 0===i?void 0:i.uniqueId;r&&this._drawingMap.set(r,t)}))};e(),this._afterRefreshDrawings=()=>{e(),this.forceMapRefresh()},this.scheduleDrawingsSyncCheck(),this.sketchViewModel.on("update",(e=>{var t,i,r,n;try{if("active"===e.state&&e.graphics.length>0){const o=e.graphics.filter((e=>{var t,i,r,n,o,a,s,l,c,u;return!((null===(t=e.attributes)||void 0===t?void 0:t.isBuffer)||(null===(i=e.attributes)||void 0===i?void 0:i.isBufferDrawing)||(null===(r=e.attributes)||void 0===r?void 0:r.isPreviewBuffer)||(null===(n=e.attributes)||void 0===n?void 0:n.isMeasurementLabel)||(null===(o=e.attributes)||void 0===o?void 0:o.hideFromList)||(null===(s=null===(a=e.attributes)||void 0===a?void 0:a.uniqueId)||void 0===s?void 0:s.startsWith("buffer_"))||"point"===(null===(l=e.geometry)||void 0===l?void 0:l.type)&&"text"===(null===(c=e.symbol)||void 0===c?void 0:c.type)&&(null===(u=e.attributes)||void 0===u?void 0:u.isMeasurementLabel))}));if(!o.length)return;const a=o[0];if("point"===(null===(t=a.geometry)||void 0===t?void 0:t.type)&&(this.ensurePointTextOverlay(a),a._selectionOverlay))try{a._selectionOverlay.geometry=a.geometry}catch(e){}const s=null===(i=a.attributes)||void 0===i?void 0:i.uniqueId;if(s&&this._drawingMap.has(s)){const e=this._drawingMap.get(s);document.querySelectorAll(".drawing-item").forEach((e=>e.classList.remove("selected-drawing")));const t=document.getElementById(`drawing-item-${e}`);t&&(t.classList.add("selected-drawing"),t.scrollIntoView({behavior:"smooth",block:"nearest"})),this.setState({selectedGraphicIndex:e,selectedGraphics:new Set([e])}),null===(n=(r=this.props).onDrawingSelect)||void 0===n||n.call(r,a,e)}}"complete"===e.state&&e.graphics.length>0&&setTimeout((()=>{this.ignoreNextGraphicsUpdate=!0,this.refreshDrawingsFromLayer(),!1!==this.props.allowLocalStorage&&!0===this.state.consentGranted&&this.saveToLocalStorage()}),50),"complete"===e.state&&this._goToController&&(this._goToController.abort(),this._goToController=null)}catch(e){console.warn("SketchViewModel event handler error:",e)}}));const t=this.props.graphicsLayer.graphics.watch("length",((e,t)=>{e>t&&setTimeout((()=>this.forceMapRefresh()),100)}));this._graphicsWatchHandles.push(t),this.props.graphicsLayer.graphics.on("change",(e=>{e.added&&e.added.length>0&&setTimeout((()=>this.forceMapRefresh()),100)})),this._drawingMap.clear(),this.state.drawings.forEach(((e,t)=>{var i;const r=null===(i=e.attributes)||void 0===i?void 0:i.uniqueId;r&&this._drawingMap.set(r,t)})),this._afterRefreshDrawings=()=>{this._drawingMap.clear(),this.state.drawings.forEach(((e,t)=>{var i;const r=null===(i=e.attributes)||void 0===i?void 0:i.uniqueId;r&&this._drawingMap.set(r,t)})),this.state.drawings.length>0&&!this._isInteracting&&setTimeout((()=>this.forceMapRefresh()),100)},this.mapClickSync()},this.mapClickSync=()=>{var e,t,i;if(!this._mapClickSyncEnabled||!this.props.jimuMapView||!this.props.graphicsLayer)return;const r=(null===(t=null===(e=this.sketchViewModel)||void 0===e?void 0:e.updateGraphics)||void 0===t?void 0:t.toArray())||[];if(r.length>0){const e=r[0];if(null===(i=e.attributes)||void 0===i?void 0:i.uniqueId){const t=e.attributes.uniqueId;if(this._drawingMap.has(t)){const i=this._drawingMap.get(t);if(void 0!==i&&this.state.selectedGraphicIndex!==i){document.querySelectorAll(".drawing-item").forEach((e=>{e.classList.remove("selected-drawing")}));const t=document.getElementById(`drawing-item-${i}`);t&&(t.classList.add("selected-drawing"),t.scrollIntoView({behavior:"smooth",block:"nearest"})),this.setState({selectedGraphicIndex:i}),this.props.onDrawingSelect&&this.props.onDrawingSelect(e,i)}}}}setTimeout(this.mapClickSync,500)},this.setupGraphicsWatcher=()=>{if(!this.props.graphicsLayer)return;const e=this.props.graphicsLayer.graphics.on("change",(e=>{this.ignoreNextGraphicsUpdate?this.ignoreNextGraphicsUpdate=!1:this.refreshDrawingsFromLayer()}));this.setState({graphicsWatchHandle:e})},this.refreshDrawingsFromLayer=()=>{if(!this.props.graphicsLayer)return;const e=this.props.graphicsLayer.graphics.toArray().filter((e=>{var t,i,r,n,o,a,s;return!(null===(t=e.attributes)||void 0===t?void 0:t.isMeasurementLabel)&&(!(null===(i=e.attributes)||void 0===i?void 0:i.isPreviewBuffer)&&(!(null===(r=e.attributes)||void 0===r?void 0:r.hideFromList)&&(!(null===(n=e.attributes)||void 0===n?void 0:n.isBuffer)&&("point"!==(null===(o=e.geometry)||void 0===o?void 0:o.type)||"text"!==(null===(a=e.symbol)||void 0===a?void 0:a.type)||!(null===(s=e.attributes)||void 0===s?void 0:s.isMeasurementLabel)))))})),t=this.sortGraphicsArray(e);this.setState({drawings:t,selectedGraphics:new Set,symbolEditingIndex:null},(()=>{this.props.onDrawingsUpdate&&this.props.onDrawingsUpdate(t),!1!==this.props.allowLocalStorage&&!0===this.state.consentGranted&&this.saveToLocalStorage(),"function"==typeof this._afterRefreshDrawings&&this._afterRefreshDrawings()}))},this.verifyDrawingsSync=()=>{if(!this.props.graphicsLayer)return;const e=this.props.graphicsLayer.graphics.filter((e=>{var t,i;return!(null===(t=e.attributes)||void 0===t?void 0:t.isMeasurementLabel)&&!(null===(i=e.attributes)||void 0===i?void 0:i.hideFromList)})).length;e!==this.state.drawings.length&&(console.warn(`Drawing sync issue detected: ${e} visible graphics vs ${this.state.drawings.length} drawings in state`),this.forceMapRefresh())},this.scheduleDrawingsSyncCheck=()=>{setTimeout((()=>{this.verifyDrawingsSync(),setTimeout((()=>{this.verifyDrawingsSync()}),3e3)}),1e3)},this.sortGraphicsArray=e=>{const{sortOption:t}=this.state;return[...e].sort(((e,i)=>{var r,n,o,a,s,l,c,u;if("name"===t){const t=((null===(r=e.attributes)||void 0===r?void 0:r.name)||"").toLowerCase(),o=((null===(n=i.attributes)||void 0===n?void 0:n.name)||"").toLowerCase();return t.localeCompare(o)}if("type"===t){const t=((null===(o=e.attributes)||void 0===o?void 0:o.geometryType)||(null===(a=e.geometry)||void 0===a?void 0:a.type)||"").toLowerCase(),r=((null===(s=i.attributes)||void 0===s?void 0:s.geometryType)||(null===(l=i.geometry)||void 0===l?void 0:l.type)||"").toLowerCase();return t.localeCompare(r)}if("created"===t){const t=(null===(c=e.attributes)||void 0===c?void 0:c.createdDate)?Number(e.attributes.createdDate):0;return((null===(u=i.attributes)||void 0===u?void 0:u.createdDate)?Number(i.attributes.createdDate):0)-t}return 0}))},this.handleConsentYes=()=>{localStorage.setItem("drawingConsentGranted","true"),this.setState({consentGranted:!0,showStorageDisclaimer:!0})},this.handleDrawingSelect=e=>{var t,i,r,n,o,a;if(!e||!e.geometry||!this.sketchViewModel)return;const s=e,l=this.state.selectedGraphics,c=!!l&&l.size>1;c||this.state.drawings.forEach((e=>{const t=e;t._selectionOverlay&&t!==s&&this.removePointTextOverlay(t)}));try{this.sketchViewModel.cancel()}catch(e){}if("polyline"===s.geometry.type&&"simple-line"!==(null===(t=s.symbol)||void 0===t?void 0:t.type)){const e=(null===(i=s.symbol)||void 0===i?void 0:i.color)||[0,0,0,1],t=(null===(r=s.symbol)||void 0===r?void 0:r.width)||2,o=(null===(n=s.symbol)||void 0===n?void 0:n.style)||"solid";s.symbol=new Me.default({color:e,width:t,style:o})}const u="point"===s.geometry.type,d=null===(o=s.symbol)||void 0===o?void 0:o.type,h={enableRotation:!0,enableScaling:!0,enableZ:!1,multipleSelectionEnabled:!1},m={tool:"transform",toggleToolOnClick:!1,enableRotation:!0,enableScaling:u&&"text"===d||u&&"picture-marker"===d,enableZ:!1,multipleSelectionEnabled:!1};try{this.sketchViewModel.update([s],u?m:h)}catch(e){console.warn("Error updating SketchViewModel for selection:",e);try{this.sketchViewModel.update([s])}catch(e){console.warn("Fallback SketchViewModel update also failed:",e)}}try{u&&setTimeout((()=>{this.ensurePointTextOverlay(s),setTimeout((()=>{s._selectionOverlay||this.ensurePointTextOverlay(s)}),200)}),150),c&&l.forEach((e=>{var t,i;const r=null===(t=this.state.drawings)||void 0===t?void 0:t[e];r&&"point"===(null===(i=r.geometry)||void 0===i?void 0:i.type)&&setTimeout((()=>{this.ensurePointTextOverlay(r)}),150)}))}catch(e){console.warn("Selection overlay management failed:",e)}const p=(null===(a=s.attributes)||void 0===a?void 0:a.uniqueId)||`temp_${Date.now()}`;this._positionWatchers&&this._positionWatchers[p]&&(this._positionWatchers[p].remove(),delete this._positionWatchers[p]),this._positionWatchers||(this._positionWatchers={}),this._positionWatchers[p]=s.watch("geometry",(e=>{if(u&&s._selectionOverlay)try{s._selectionOverlay.geometry=e}catch(e){}clearTimeout(this._savePositionTimeout),this._savePositionTimeout=setTimeout((()=>{!1!==this.props.allowLocalStorage&&!0===this.state.consentGranted&&this.saveToLocalStorage()}),500)}))},this.handleListItemClick=(e,t)=>{var i,r,n;if(!0===this.state.consentGranted){try{e.attributes||(e.attributes={}),e.attributes.uniqueId||(e.attributes.uniqueId=`auto_${Date.now()}_${Math.random().toString(36).slice(2,8)}`)}catch(e){console.warn("Panel: could not ensure uniqueId on graphic:",e)}if(this.state.selectedGraphicIndex===t)return null===(r=(i=this.props).onClearSelectionOverlays)||void 0===r||r.call(i),void Promise.resolve("function"==typeof this.props.onDrawingSelect?this.props.onDrawingSelect(e,t):null===(n=this.handleDrawingSelect)||void 0===n?void 0:n.call(this,e,t)).catch((e=>{"AbortError"!==(null==e?void 0:e.name)&&console.warn("Re-selection encountered an issue (non-critical):",e)}));this._goToController&&(this._goToController.abort(),this._goToController=null),this.setState({selectedGraphicIndex:t}),this.openSymbolEditor(t),this.highlightGraphic(e,t).catch((e=>{console.warn("Highlight graphic failed (non-critical):",e)}))}else this.showLocalAlert("My Drawings feature requires local storage permission","warning")},this.highlightGraphic=(e,t)=>Ue(this,void 0,void 0,(function*(){var i,r,n,o,a;if(e&&this.props.jimuMapView&&!0===this.state.consentGranted)try{this._goToController&&(this._goToController.abort(),this._goToController=null);try{e.attributes||(e.attributes={}),e.attributes.uniqueId||(e.attributes.uniqueId=`auto_${Date.now()}_${Math.random().toString(36).slice(2,8)}`)}catch(e){console.warn("Panel: ensure uniqueId in highlightGraphic failed:",e)}if(null===(r=(i=this.props).onClearSelectionOverlays)||void 0===r||r.call(i),"function"==typeof this.props.onDrawingSelect)try{yield this.props.onDrawingSelect(e,t)}catch(e){"AbortError"!==(null==e?void 0:e.name)&&"view:goto-interrupted"!==(null==e?void 0:e.name)&&console.warn("Selection update encountered an issue (non-critical):",e)}if(null===(o=(n=this.props).onDrawingSelect)||void 0===o||o.call(n,e,t),!e.geometry)return;yield this.props.jimuMapView.view.when();const s=new AbortController;this._goToController=s;let l,c=e.geometry;if("point"!==e.geometry.type&&("centroid"in e.geometry?c=e.geometry.centroid:(null===(a=e.geometry.extent)||void 0===a?void 0:a.center)&&(c=e.geometry.extent.center)),e.geometry.extent){l=5*e.geometry.extent.width,l=Math.max(500,Math.min(5e4,l))}else l=2e3;this.props.jimuMapView.view.goTo({target:c,scale:l},{animate:!1,duration:0,signal:s.signal}).catch((e=>{"AbortError"!==(null==e?void 0:e.name)&&"view:goto-interrupted"!==(null==e?void 0:e.name)&&console.error("Navigation error:",e)}))}catch(e){console.error("Error highlighting graphic (panel):",e)}})),this.handleConsentNo=()=>{localStorage.setItem("drawingConsentGranted","false"),localStorage.removeItem(this.localStorageKey),this.setState({consentGranted:!1})},this.handleDrawingsUpdate=e=>{var t;try{if(this.props.onDrawingsUpdate&&this.props.onDrawingsUpdate(e),(null===(t=this.measureRef)||void 0===t?void 0:t.current)&&!this._processingMeasurements){this._processingMeasurements=!0;const t=2,i=r=>{const n=Math.min(r+t,e.length);e.slice(r,n).forEach(((e,t)=>{const i=r+t;e&&e.geometry&&setTimeout((()=>{this.performSingleMeasurementUpdate(e)}),300*i)})),n<e.length?setTimeout((()=>{i(n)}),300*t+200):setTimeout((()=>{this._processingMeasurements=!1}),300*t+500)};setTimeout((()=>{i(0)}),1e3)}this.saveToLocalStorage()}catch(e){console.error("\u274c Error in handleDrawingsUpdate:",e),this._processingMeasurements=!1,this.showLocalAlert("Error updating drawings","error")}},this.loadFromLocalStorage=()=>{if(!1===this.props.allowLocalStorage||!0!==this.state.consentGranted)return;this.cleanupLocalStorageMeasurements();const e=this.localStorageKey,t=localStorage.getItem(e);if(!t)return;const i=()=>{try{const i=JSON.parse(t);let r=[],n=[];if(Array.isArray(i))r=i;else if("1.1"===i.version&&i.drawings)r=i.drawings||[],n=i.measurementLabels||[];else if("1.2"===i.version&&i.drawings)r=i.drawings||[],n=i.measurementLabels||[];else if("1.3"===i.version&&i.drawings)r=i.drawings||[],n=i.measurementLabels||[];else{if("1.4"!==i.version||!i.drawings)return void console.warn(`\u26a0\ufe0f Invalid data format in localStorage for key: ${e}`);r=i.drawings||[],n=i.measurementLabels||[]}if(this.props.graphicsLayer&&0===this.props.graphicsLayer.graphics.length){this.props.graphicsLayer.removeAll(),this.ignoreNextGraphicsUpdate=!0;let t=0,i=0,o=0,a=0,s=0;const l=new Map;r.forEach(((e,r)=>{var n,o;try{const s=P.default.fromJSON(e);s.attributes||(s.attributes={}),s.attributes.uniqueId||(s.attributes.uniqueId=`restored_${Date.now()}_${r}`),(null===(n=e.attributes)||void 0===n?void 0:n.isBufferDrawing)?(s.isBufferDrawing=!0,s.sourceGraphicId=e.attributes.sourceGraphicId,s.attributes.isBufferDrawing=!0,s.attributes.sourceGraphicId=e.attributes.sourceGraphicId,s.attributes.bufferDistance=e.attributes.bufferDistance,s.attributes.bufferUnit=e.attributes.bufferUnit,i++):(null===(o=e.attributes)||void 0===o?void 0:o.bufferSettings)?(s.bufferSettings={distance:e.attributes.bufferSettings.distance,unit:e.attributes.bufferSettings.unit,enabled:e.attributes.bufferSettings.enabled,opacity:e.attributes.bufferSettings.opacity},s.bufferSettings.enabled?a++:t++):t++,this.props.graphicsLayer.add(s),l.set(s.attributes.uniqueId,s)}catch(e){console.warn(`\u26a0\ufe0f Error restoring graphic at index ${r} from localStorage:`,e)}})),n.forEach(((e,t)=>{var i,r,n,a,c,u;try{const d=P.default.fromJSON(e);d.attributes||(d.attributes={}),d.attributes.isMeasurementLabel=!0,d.attributes.hideFromList=!0,(null===(i=e.attributes)||void 0===i?void 0:i.customized)&&(d.attributes.customized=!0,d.attributes.lastModified=e.attributes.lastModified,s++),(null===(r=e.attributes)||void 0===r?void 0:r.hasCustomPosition)&&(null===(n=e.attributes)||void 0===n?void 0:n.customPosition)&&(d.attributes.hasCustomPosition=!0,d.attributes.customPosition=e.attributes.customPosition),(null===(a=e.attributes)||void 0===a?void 0:a.measurementType)&&(d.attributes.measurementType=e.attributes.measurementType),(null===(c=e.attributes)||void 0===c?void 0:c.lengthUnit)&&(d.attributes.lengthUnit=e.attributes.lengthUnit),(null===(u=e.attributes)||void 0===u?void 0:u.areaUnit)&&(d.attributes.areaUnit=e.attributes.areaUnit);const h=d.attributes.parentGraphicId;if(h&&l.has(h)){const e=l.get(h);d.measureParent=e,e.measure||(e.measure={graphic:d,lengthUnit:d.attributes.lengthUnit,areaUnit:d.attributes.areaUnit}),e.attributes.relatedMeasurementLabels||(e.attributes.relatedMeasurementLabels=[]),e.attributes.relatedMeasurementLabels.push(d),"segment"===d.attributes.measurementType&&(e.attributes.relatedSegmentLabels||(e.attributes.relatedSegmentLabels=[]),e.attributes.relatedSegmentLabels.push(d)),this.props.graphicsLayer.add(d),o++}else console.warn(`\u26a0\ufe0f Auto-skipping orphaned measurement label at index ${t} - no valid parent found`)}catch(e){console.warn(`\u26a0\ufe0f Error restoring measurement label at index ${t} from localStorage:`,e)}})),setTimeout((()=>{l.forEach(((e,t)=>{if(e.bufferSettings&&e.bufferSettings.enabled){void 0!==e.bufferSettings.opacity&&e.bufferSettings.opacity;this.recreateAttachedBuffer(e,!0)}}));if(t+i>0){this.refreshDrawingsFromLayer();let r=`\u2705 Successfully loaded ${t} drawing(s)`;i>0&&(r+=`, ${i} buffer drawing(s)`),o>0&&(r+=`, ${o} measurement label(s)`),s>0&&(r+=` (${s} customized)`),a>0&&(r+=`, and recreated ${a} attached buffer(s)`),r+=` from key: ${e}`,setTimeout((()=>{this.handleDrawingsUpdate(this.state.drawings)}),500),setTimeout((()=>{this.cleanupOrphanedMeasurementLabels()}),1e3)}}),200)}}catch(t){console.error(`\u274c Error parsing drawings from localStorage key: ${e}`,t),this.showLocalAlert("Error loading saved drawings","error")}};"requestIdleCallback"in window?window.requestIdleCallback(i):setTimeout(i,0)},this.saveToLocalStorage=()=>{!1!==this.props.allowLocalStorage&&!0===this.state.consentGranted&&(this._saveToStorageTimeout&&clearTimeout(this._saveToStorageTimeout),this._saveToStorageTimeout=setTimeout((()=>{this.performActualSave()}),2e3))},this.showLocalAlert=(e,t)=>{this.props.showAlert?this.props.showAlert(e,t):(this.setState({alertMessage:e,alertType:t,showAlert:!0}),setTimeout((()=>this.setState({showAlert:!1})),3e3))},this.updateSymbolWithoutClosing=(e,t)=>{var i,r,n,o;const a=[...this.state.drawings];if(!a[t])return void console.warn(`Drawing not found at index ${t}`);const s=a[t];try{const l=this.props.view||this.props.mapView,c=this.props.graphicsLayer;l&&c&&(this.sketchViewModel?this.sketchViewModel.layer!==c&&(this.sketchViewModel.layer=c):this.sketchViewModel=new E.default({view:l,layer:c,defaultUpdateOptions:{enableScaling:!0,enableRotation:!0}}),this.sketchViewModel.cancel());let u=null,d=!1;if("polyline"===(null===(i=s.geometry)||void 0===i?void 0:i.type)&&"simple-line"===(null===(r=s.symbol)||void 0===r?void 0:r.type)){u=s.symbol.marker||null,u&&(d=!0)}if("polyline"===(null===(n=s.geometry)||void 0===n?void 0:n.type)){if(e=e&&"simple-line"===e.type?e.clone():new Me.default({color:(null==e?void 0:e.color)||[0,0,0,1],width:(null==e?void 0:e.width)||2,style:(null==e?void 0:e.style)||"solid"}),u)try{const t=JSON.parse(JSON.stringify(u));d&&(t.color=null==e?void 0:e.color),e.marker=t}catch(t){e.marker={type:u.type,style:u.style,placement:u.placement,color:d?null==e?void 0:e.color:u.color}}}else e&&(e=e.clone());if("text"===(null==e?void 0:e.type)){const t=e;t.color||(t.color=new O.default([0,0,0,1])),t.font?t.font=new Se.default({family:t.font.family||"Arial",size:t.font.size||12,style:t.font.style||"normal",weight:t.font.weight||"normal",decoration:t.font.decoration||"none"}):t.font=new Se.default({size:12}),t.text||(t.text=(null===(o=s.attributes)||void 0===o?void 0:o.name)||"Label"),e=t}this.ignoreNextGraphicsUpdate=!0,s.symbol=e,a[t]=s,c&&(c.remove(s),c.add(s));const h=()=>{if(this.sketchViewModel)try{this.sketchViewModel.update([s],{tool:"transform",enableRotation:!0,enableScaling:!0})}catch(e){console.warn("SketchViewModel.update failed to reselect graphic:",e)}};h(),"undefined"!=typeof requestAnimationFrame?requestAnimationFrame(h):setTimeout(h,0),this.setState({drawings:a},(()=>{!1!==this.props.allowLocalStorage&&!0===this.state.consentGranted&&this.saveToLocalStorage(),this.props.onDrawingsUpdate&&this.props.onDrawingsUpdate(a)}))}catch(e){console.error("Error updating symbol:",e),this.showLocalAlert("Error updating symbol","error")}},this.isSupportedSymbol=(e,t)=>!!e&&("polyline"===t||("point"===t?e.type&&["simple-marker","picture-marker","text"].includes(e.type):"polygon"===t&&"simple-fill"===e.type)),this.ensureMapViewReady=()=>Ue(this,void 0,void 0,(function*(){var e;if(!(null===(e=this.props.jimuMapView)||void 0===e?void 0:e.view))return!1;try{return yield this.props.jimuMapView.view.when(),this.props.graphicsLayer&&(yield this.props.jimuMapView.view.whenLayerView(this.props.graphicsLayer)),!0}catch(e){return console.warn("Error ensuring map view ready:",e),!1}})),this.openConfirmDialog=(e,t,i,r=-1)=>{this.setState({confirmDialogOpen:!0,confirmDialogMessage:e,confirmDialogAction:i,confirmDialogType:t,confirmDialogItemIndex:r>=0?r:null})},this.closeConfirmDialog=()=>{this.setState({confirmDialogOpen:!1,confirmDialogAction:null,confirmDialogItemIndex:null})},this.executeConfirmAction=()=>{this.state.confirmDialogAction&&this.state.confirmDialogAction(),this.closeConfirmDialog()},this.handleCopyDrawing=(e,t)=>{var i;if(!0===this.state.consentGranted){t&&t.stopPropagation();try{const t=this.state.drawings[e];if(!t)return;const r=t.toJSON(),n=P.default.fromJSON(r);n.attributes||(n.attributes={}),n.attributes.uniqueId=`copy_${Date.now()}_${Math.floor(1e3*Math.random())}`;const o=(null===(i=t.attributes)||void 0===i?void 0:i.name)||`Drawing ${e+1}`;n.attributes.name=`Copy of ${o}`,n.attributes.createdDate=Date.now(),this.ignoreNextGraphicsUpdate=!0,this.props.graphicsLayer.add(n),this.refreshDrawingsFromLayer(),setTimeout((()=>{this.setState((e=>(this.handleDrawingsUpdate(e.drawings),e)))}),200)}catch(e){console.error("\u274c Error copying graphic:",e),this.showLocalAlert("Error copying drawing","error")}}else this.showLocalAlert("My Drawings feature requires local storage permission","warning")},this.handleDeleteGraphic=(e,t)=>{if(!0===this.state.consentGranted)if(t&&t.stopPropagation(),this.sketchViewModel&&this.sketchViewModel.cancel(),this._isDeletingGraphic=!0,!1!==this.props.confirmOnDelete){const t=()=>{this.performDeleteGraphic(e)};this.openConfirmDialog("Are you sure you want to delete this drawing?","delete",t,e)}else this.performDeleteGraphic(e);else this.showLocalAlert("My Drawings feature requires local storage permission","warning")},this.fixMeasurementLabelStyles=()=>{if(!this.props.graphicsLayer)return;if(this.measurementStylesInitialized)return;const e=this.props.graphicsLayer.graphics.toArray();e.forEach((e=>{if(e&&e.attributes&&e.attributes.isMeasurementLabel&&e.symbol&&"text"===e.symbol.type&&!e.attributes._styleFixed){const t=e.symbol;if(t.color&&t.font&&void 0!==t.haloColor&&void 0!==t.haloSize)return e.attributes||(e.attributes={}),e.attributes._styleFixed=!0,void 0;const i=e.symbol.text,r=t.clone();r.text||(r.text=i),r.color||(r.color=new O.default([0,0,0,1])),r.font||(r.font=new Se.default({family:"Arial",size:12,weight:"normal",style:"normal",decoration:"none"})),null===r.haloColor&&null===r.haloSize&&(r.haloColor=new O.default([255,255,255,1]),r.haloSize=2),r.horizontalAlignment||(r.horizontalAlignment="center"),r.verticalAlignment||(r.verticalAlignment="middle"),e.symbol=r,e.attributes||(e.attributes={}),e.attributes._styleFixed=!0}})),this.measurementStylesInitialized=!0},this.disableMeasurementLabelStyles=()=>{},this.handleClearAllClick=()=>{if(!0===this.state.consentGranted)if(!1!==this.props.confirmOnDelete){const e=()=>{this.performClearAll()};this.openConfirmDialog("Are you sure you want to delete ALL drawings?","clearAll",e)}else this.performClearAll();else this.showLocalAlert("My Drawings feature requires local storage permission","warning")},this.performClearAll=()=>{this._measurementWasEnabled=!1;try{if(this.props.graphicsLayer){const e=this.props.graphicsLayer.graphics.toArray();this._measurementWasEnabled=e.some((e=>{var t;return!0===(null===(t=null==e?void 0:e.attributes)||void 0===t?void 0:t.isMeasurementLabel)}))}}catch(e){console.warn("Could not infer measurement state from layer; defaulting to off.",e),this._measurementWasEnabled=!1}this.props.onMeasurementSystemControl&&this.props.onMeasurementSystemControl(!1),this._isDeletingGraphic=!0;try{this.sketchViewModel&&this.sketchViewModel.cancel(),this.state.drawings.forEach((e=>{this.removeMeasurementLabels(e)})),this.ignoreNextGraphicsUpdate=!0,this.props.graphicsLayer.removeAll(),setTimeout((()=>{this.cleanupOrphanedMeasurementLabels()}),200),this.setState({drawings:[],selectedGraphicIndex:null,selectedGraphics:new Set,symbolEditingIndex:null},(()=>{!1!==this.props.allowLocalStorage&&!0===this.state.consentGranted&&this.saveToLocalStorage(),this.props.onDrawingsUpdate&&this.props.onDrawingsUpdate([]),this.props.onMeasurementSystemControl&&this._measurementWasEnabled&&this.props.onMeasurementSystemControl(!0),this._isDeletingGraphic=!1,setTimeout((()=>{this.verifyLayerState(),this.cleanupOrphanedMeasurementLabels()}),500)}))}catch(e){console.error("\u274c Error clearing graphics:",e),this._isDeletingGraphic=!1,this.props.onMeasurementSystemControl&&this._measurementWasEnabled&&this.props.onMeasurementSystemControl(!0),this.showLocalAlert("Error clearing drawings","error"),this.refreshDrawingsFromLayer()}},this.handleImport=e=>{var t;if(!0!==this.state.consentGranted)return void this.showLocalAlert("My Drawings feature requires local storage permission","warning");const i=null===(t=e.target.files)||void 0===t?void 0:t[0];if(!i)return;const r=i.name.toLowerCase();if(!(r.endsWith(".json")||r.endsWith(".geojson")))return this.showLocalAlert("Please select a JSON or GeoJSON file","error"),void(e.target.value="");const n=new FileReader;n.onload=t=>{var n;try{const e=null===(n=t.target)||void 0===n?void 0:n.result;JSON.parse(e),this.setState({importFile:i,importFileContent:e,importDialogOpen:!0})}catch(t){console.error("Error parsing file:",t),r.endsWith(".geojson")?this.showLocalAlert("Invalid GeoJSON file format","error"):this.showLocalAlert("Invalid JSON file format","error"),e.target.value=""}},n.onerror=()=>{this.showLocalAlert("Error reading file","error"),e.target.value=""},n.readAsText(i),e.target.value=""},this.closeImportDialog=()=>{this.setState({importDialogOpen:!1,importFile:null,importFileContent:null})},this.handleImportReplace=()=>{this.processImport(!0)},this.handleImportAdd=()=>{this.processImport(!1)},this.processGeoJSONImport=(e,t)=>Ue(this,void 0,void 0,(function*(){var i,r,n,o,a,s,l,c,u,d,h,m,p;try{const g=JSON.parse(e);if(!g.features||!Array.isArray(g.features))return this.showLocalAlert("Invalid GeoJSON: no features array found","error"),void this.closeImportDialog();this.ignoreNextGraphicsUpdate=!0,t&&this.props.graphicsLayer.removeAll();let f=0,y=0;const v=g.features,w=v.filter((e=>{var t;return!(null===(t=null==e?void 0:e.properties)||void 0===t?void 0:t.isMeasurementLabel)})),b=v.filter((e=>{var t;return null===(t=null==e?void 0:e.properties)||void 0===t?void 0:t.isMeasurementLabel})),x=new Map;for(let e=0;e<w.length;e++)try{const t=yield this.convertGeoJSONFeatureToGraphic(w[e],e);if(t){this.props.graphicsLayer.add(t),f++;const e=null===(i=t.attributes)||void 0===i?void 0:i.uniqueId;e&&x.set(e,t)}else y++}catch(t){console.warn(`Error importing base feature ${e}:`,t),y++}const M=[];for(let e=0;e<b.length;e++)try{const t=b[e],i=yield this.convertGeoJSONFeatureToGraphic(t,e+w.length);if(!i){y++;continue}const l=null===(r=i.attributes)||void 0===r?void 0:r.parentGraphicId,c=l?x.get(l):void 0;c?(i.measureParent=c,c.measure||"segment"===(null===(n=i.attributes)||void 0===n?void 0:n.measurementType)||(c.measure={graphic:i,lengthUnit:null===(o=i.attributes)||void 0===o?void 0:o.lengthUnit,areaUnit:null===(a=i.attributes)||void 0===a?void 0:a.areaUnit}),c.attributes||(c.attributes={}),c.attributes.relatedMeasurementLabels||(c.attributes.relatedMeasurementLabels=[]),c.attributes.relatedMeasurementLabels.push(i),"segment"===(null===(s=i.attributes)||void 0===s?void 0:s.measurementType)&&(c.attributes.relatedSegmentLabels||(c.attributes.relatedSegmentLabels=[]),c.attributes.relatedSegmentLabels.push(i)),this.props.graphicsLayer.add(i),f++):M.push(i)}catch(t){console.warn(`Error importing label feature ${e}:`,t),y++}if(M.length>0)try{const e=(null!==(u=null===(c=null===(l=this.props.graphicsLayer.graphics)||void 0===l?void 0:l.toArray)||void 0===c?void 0:c.call(l))&&void 0!==u?u:[]).filter((e=>{var t;return(null==e?void 0:e.geometry)&&"text"!==(null===(t=null==e?void 0:e.symbol)||void 0===t?void 0:t.type)}));for(const t of M){let i=null,r=1/0;const n=t.geometry;if(n){for(const t of e){const e=t.geometry,o=(null===(d=null==e?void 0:e.extent)||void 0===d?void 0:d.center)||e;if(!o)continue;const a=n.x-o.x,s=n.y-o.y,l=Math.sqrt(a*a+s*s);l<r&&(r=l,i=t)}i?(t.measureParent=i,i.attributes||(i.attributes={}),i.attributes.relatedMeasurementLabels||(i.attributes.relatedMeasurementLabels=[]),i.attributes.relatedMeasurementLabels.push(t),"segment"===(null===(h=t.attributes)||void 0===h?void 0:h.measurementType)?(i.attributes.relatedSegmentLabels||(i.attributes.relatedSegmentLabels=[]),i.attributes.relatedSegmentLabels.push(t)):i.measure||(i.measure={graphic:t,lengthUnit:null===(m=t.attributes)||void 0===m?void 0:m.lengthUnit,areaUnit:null===(p=t.attributes)||void 0===p?void 0:p.areaUnit}),this.props.graphicsLayer.add(t),f++):(this.props.graphicsLayer.add(t),f++,console.warn("Imported label without a resolvable parent; added unlinked."))}}}catch(e){console.warn("Proximity fallback linking failed:",e)}setTimeout((()=>{try{this.refreshDrawingsFromLayer()}catch(e){console.warn("refreshDrawingsFromLayer failed:",e)}if(f>0){}}),300)}catch(e){console.error("Error processing GeoJSON import:",e),this.showLocalAlert("Error importing GeoJSON file","error")}this.closeImportDialog()})),this.convertGeoJSONFeatureToGraphic=(e,t)=>Ue(this,void 0,void 0,(function*(){try{if(!(null==e?void 0:e.geometry)||!(null==e?void 0:e.properties))return console.warn(`Feature ${t} missing geometry or properties`),null;const i=yield this.convertGeoJSONGeometryToArcGIS(e.geometry);if(!i)return console.warn(`Failed to convert geometry for feature ${t}`),null;let r,n=null;const o=()=>{var t,i;n=null!==(i=null!==(t=e.properties.text)&&void 0!==t?t:e.properties.textContent)&&void 0!==i?i:"Text";const r=new O.default(e.properties.text_color||"#000000");if("number"==typeof e.properties.text_opacity){const t=Math.max(0,Math.min(1,e.properties.text_opacity));r.a=t}const o=new Se.default({size:e.properties.text_size||12,family:e.properties.text_font||"Arial",weight:e.properties.text_weight||"normal",style:e.properties.text_style||"normal",decoration:e.properties.text_decoration||"none"}),a=e.properties.text_align||"center",s=e.properties.text_baseline||"middle",l="number"==typeof e.properties.text_rotation?e.properties.text_rotation:0;let c,u;if("number"==typeof e.properties.text_halo_size){const t=e.properties.text_halo_size;if(t>0){u=t;const i=new O.default(e.properties.text_halo_color||"#FFFFFF");"number"==typeof e.properties.text_halo_opacity&&(i.a=Math.max(0,Math.min(1,e.properties.text_halo_opacity))),c=i}else u=0,c=void 0}else e.properties.isMeasurementLabel&&(u=2,c=new O.default([255,255,255,1]));return new R.default({text:n,color:r,font:o,horizontalAlignment:a,verticalAlignment:s,angle:l,haloColor:c,haloSize:u})},a=!!e.properties.text||!!e.properties.textContent||"Text"===e.properties.type;r=a?o():this.createSymbolFromGeoJSONProperties(e.properties,e.geometry.type);const s=a&&n?n:e.properties.name||`Imported Drawing ${t+1}`;let l=Date.now();if(e.properties.created)if("number"==typeof e.properties.created)l=e.properties.created;else if("string"==typeof e.properties.created){const t=Date.parse(e.properties.created);isNaN(t)||(l=t)}const c={uniqueId:e.properties.id||`imported_geojson_${Date.now()}_${t}`,name:s,createdDate:l,geometryType:e.geometry.type};if(c.name=this.ensureUniqueName(c.name),e.properties.isMeasurementLabel&&(c.isMeasurementLabel=!0,c.hideFromList=!0,e.properties.parentGraphicId&&(c.parentGraphicId=e.properties.parentGraphicId),e.properties.measurementType&&(c.measurementType=e.properties.measurementType),e.properties.lengthUnit&&(c.lengthUnit=e.properties.lengthUnit),e.properties.areaUnit&&(c.areaUnit=e.properties.areaUnit),c.drawMode="text"),e.properties.bufferDistance&&e.properties.bufferUnit){const t={distance:e.properties.bufferDistance,unit:e.properties.bufferUnit,enabled:!0,opacity:"number"==typeof e.properties.bufferOpacity?e.properties.bufferOpacity:50};c.bufferSettings=t}const u=new P.default({geometry:i,symbol:r,attributes:c});return c.bufferSettings&&(u.bufferSettings=c.bufferSettings),u}catch(e){return console.error(`Error converting GeoJSON feature ${t}:`,e),null}})),this.convertGeoJSONGeometryToArcGIS=e=>Ue(this,void 0,void 0,(function*(){var t,i;try{const r=(null===(i=null===(t=this.props.jimuMapView)||void 0===t?void 0:t.view)||void 0===i?void 0:i.spatialReference)||new se.default({wkid:4326});let n;const o=new se.default({wkid:4326});switch(e.type){case"Point":const t=e.coordinates;n=new oe.default({longitude:t[0],latitude:t[1],spatialReference:o});break;case"LineString":n={type:"polyline",paths:[e.coordinates],spatialReference:o};break;case"MultiLineString":n={type:"polyline",paths:e.coordinates,spatialReference:o};break;case"Polygon":n={type:"polygon",rings:e.coordinates,spatialReference:o};break;default:return console.warn(`Unsupported GeoJSON geometry type: ${e.type}`),null}return 4326===r.wkid?n:yield this.projectGeometryFromWGS84(n,r)}catch(e){return console.error("Error converting GeoJSON geometry:",e),null}})),this.convertFromWGS84ToMapProjection=(e,t)=>{var i,r;const n=null===(r=null===(i=this.props.jimuMapView)||void 0===i?void 0:i.view)||void 0===r?void 0:r.spatialReference;if(!n||4326===n.wkid)return{x:e,y:t};if(3857===n.wkid||102100===n.wkid){return{x:20037508.34*e/180,y:Math.log(Math.tan((90+t)*Math.PI/360))/(Math.PI/180)*20037508.34/180}}if(n.wkid>=32601&&n.wkid<=32660){return{x:5e5+111320*(e-(6*(n.wkid-32600-1)-180+3)),y:110540*t}}return{x:e,y:t}},this.createSymbolFromGeoJSONProperties=(e,t)=>{try{switch(t){case"Point":const t=e.marker_symbol||"circle",i=["circle","square","cross","x","diamond","triangle","path"].includes(t)?t:"circle";return new me.default({style:i,size:e.marker_size||12,color:new O.default(e.marker_color||"#000000"),outline:e.stroke?new Me.default({color:new O.default(e.stroke||"#000000"),width:e.stroke_width||1}):void 0});case"LineString":case"MultiLineString":return new Me.default({style:"solid",color:new O.default(e.stroke||"#000000"),width:e.stroke_width||2});case"Polygon":const r=new O.default(e.fill||"#000000");return void 0!==e.fill_opacity&&(r.a=e.fill_opacity),new Le.default({style:"solid",color:r,outline:new Me.default({color:new O.default(e.stroke||"#000000"),width:e.stroke_width||1})});default:return new me.default({style:"circle",size:8,color:new O.default("#FF0000")})}}catch(e){return console.error("Error creating symbol from properties:",e),new me.default({style:"circle",size:8,color:new O.default("#FF0000")})}},this.processLegacyImport=(e,t)=>{try{const i=JSON.parse(e);let r=[],n=[];Array.isArray(i)?r=i:i.drawings&&(r=i.drawings||[],n=i.measurementLabels||[]),t&&this.props.graphicsLayer.removeAll(),this.ignoreNextGraphicsUpdate=!0;let o=0,a=0,s=0;const l=new Map;r.forEach(((e,i)=>{var r;try{const n=P.default.fromJSON(e);n.attributes||(n.attributes={}),n.attributes.uniqueId||(n.attributes.uniqueId=`imported_${Date.now()}_${i}`),t||(n.attributes.name=this.ensureUniqueName(n.attributes.name||`Drawing ${i+1}`)),(null===(r=e.attributes)||void 0===r?void 0:r.bufferSettings)?(n.bufferSettings={distance:e.attributes.bufferSettings.distance,unit:e.attributes.bufferSettings.unit,enabled:e.attributes.bufferSettings.enabled,opacity:e.attributes.bufferSettings.opacity},n.bufferSettings.enabled?s++:o++):o++,this.props.graphicsLayer.add(n),l.set(n.attributes.uniqueId,n)}catch(e){console.warn(`Error restoring graphic at index ${i}:`,e)}})),n.forEach(((e,t)=>{try{const t=P.default.fromJSON(e);t.attributes||(t.attributes={}),t.attributes.isMeasurementLabel=!0,t.attributes.hideFromList=!0;const i=t.attributes.parentGraphicId;if(i&&l.has(i)){const e=l.get(i);t.measureParent=e,e.measure||(e.measure={graphic:t,lengthUnit:t.attributes.lengthUnit,areaUnit:t.attributes.areaUnit}),this.props.graphicsLayer.add(t),a++}}catch(e){console.warn(`Error restoring measurement label at index ${t}:`,e)}})),setTimeout((()=>{l.forEach(((e,t)=>{e.bufferSettings&&e.bufferSettings.enabled&&this.recreateAttachedBuffer(e,!0)}));if(o>0){this.refreshDrawingsFromLayer();let e=`Successfully imported ${o} drawing(s)`;a>0&&(e+=` with ${a} measurement label(s)`),s>0&&(e+=` and ${s} buffer(s)`)}}),200)}catch(e){console.error("Error processing legacy import:",e),this.showLocalAlert("Error importing legacy JSON file","error")}this.closeImportDialog()},this.processImport=e=>{const{importFileContent:t}=this.state;if(t)try{const i=this.detectImportFormat(t);if("geojson"===i)this.processGeoJSONImport(t,e);else{if("legacy"!==i)return console.error("Unknown file format"),this.showLocalAlert("Unsupported file format. Please use GeoJSON or the original JSON format.","error"),void this.closeImportDialog();this.processLegacyImport(t,e)}}catch(e){console.error("Error processing import:",e),this.showLocalAlert("Error processing import file","error"),this.closeImportDialog()}else this.closeImportDialog()},this.handleExport=()=>Ue(this,void 0,void 0,(function*(){if(!0===this.state.consentGranted)if(0!==this.state.drawings.length)try{const e=yield this.generateCompatibleExportData(this.state.drawings),t=JSON.stringify(e.geoJSONFormat,null,2),i=new Blob([t],{type:"application/geo+json"}),r=URL.createObjectURL(i),n=document.createElement("a");n.href=r,n.download="myDrawings.geojson",document.body.appendChild(n),n.click(),setTimeout((()=>{document.body.removeChild(n),URL.revokeObjectURL(r)}),100)}catch(e){console.error("Error exporting drawings:",e),this.showLocalAlert("Error exporting drawings","error")}else this.showLocalAlert("No drawings to export","warning");else this.showLocalAlert("My Drawings feature requires local storage permission","warning")})),this.handleToggleSelect=(e,t)=>{t.stopPropagation(),this.sketchViewModel&&this.sketchViewModel.cancel();const{selectedGraphics:i}=this.state,r=new Set(i);r.has(e)?r.delete(e):r.add(e),this.setState({selectedGraphics:r}),1===r.size&&r.has(e)&&this.setState({selectedGraphicIndex:e})},this.handleToggleSelectAll=()=>{const{drawings:e,selectedGraphics:t}=this.state;if(t.size===e.length)this.setState({selectedGraphics:new Set,symbolEditingIndex:null});else{const t=new Set(e.map(((e,t)=>t)));this.setState({selectedGraphics:t})}},this.handleExportSingle=(e,t)=>Ue(this,void 0,void 0,(function*(){var i;if(t.stopPropagation(),!0!==this.state.consentGranted)return void this.showLocalAlert("My Drawings feature requires local storage permission","warning");const r=this.state.drawings[e];if(r)try{const t=yield this.generateCompatibleExportData([r]),n=JSON.stringify(t.geoJSONFormat,null,2),o=(null===(i=r.attributes)||void 0===i?void 0:i.name)?`${r.attributes.name.replace(/\s+/g,"_")}.geojson`:`drawing_${e+1}.geojson`,a=new Blob([n],{type:"application/geo+json"}),s=URL.createObjectURL(a),l=document.createElement("a");l.href=s,l.download=o,document.body.appendChild(l),l.click(),setTimeout((()=>{document.body.removeChild(l),URL.revokeObjectURL(s)}),100)}catch(e){console.error("Error exporting single drawing:",e),this.showLocalAlert("Error exporting single drawing","error")}})),this.handleExportSelected=()=>Ue(this,void 0,void 0,(function*(){if(!0!==this.state.consentGranted)return void this.showLocalAlert("My Drawings feature requires local storage permission","warning");const{drawings:e,selectedGraphics:t}=this.state;if(0!==t.size)try{const i=Array.from(t).map((t=>e[t])),r=yield this.generateCompatibleExportData(i),n=JSON.stringify(r.geoJSONFormat,null,2),o=new Blob([n],{type:"application/geo+json"}),a=URL.createObjectURL(o),s=document.createElement("a");s.href=a,s.download=`selected_drawings_${(new Date).toISOString().split("T")[0]}.geojson`,document.body.appendChild(s),s.click(),setTimeout((()=>{document.body.removeChild(s),URL.revokeObjectURL(a)}),100)}catch(e){console.error("Error exporting selected drawings:",e),this.showLocalAlert("Error exporting selected drawings","error")}else this.showLocalAlert("No drawings selected","warning")})),this.handleDeleteSelected=()=>{if(!0!==this.state.consentGranted)return void this.showLocalAlert("My Drawings feature requires local storage permission","warning");const{selectedGraphics:e}=this.state;if(0!==e.size)if(!1!==this.props.confirmOnDelete){const t=()=>{this.performDeleteSelected()};this.openConfirmDialog(`Are you sure you want to delete ${e.size} selected drawing(s)?`,"delete",t)}else this.performDeleteSelected();else this.showLocalAlert("No drawings selected","warning")},this.ingestDrawings=e=>{this.setState({drawings:Array.isArray(e)?[...e]:[],selectedGraphicIndex:null,selectedGraphics:new Set,symbolEditingIndex:null})},this.performDeleteGraphic=e=>{var t;this._measurementWasEnabled=!1;try{if(this.props.graphicsLayer){const e=this.props.graphicsLayer.graphics.toArray();this._measurementWasEnabled=e.some((e=>{var t;return!0===(null===(t=null==e?void 0:e.attributes)||void 0===t?void 0:t.isMeasurementLabel)}))}}catch(e){console.warn("Could not infer measurement state from layer; defaulting to off.",e),this._measurementWasEnabled=!1}this.props.onMeasurementSystemControl&&this.props.onMeasurementSystemControl(!1),this._isDeletingGraphic=!0,this.ignoreNextGraphicsUpdate=!0;const i=this.state.drawings[e];if(!i)return console.error(`\u274c No graphic found at index ${e}`),this._isDeletingGraphic=!1,this.ignoreNextGraphicsUpdate=!1,void(this.props.onMeasurementSystemControl&&this._measurementWasEnabled&&this.props.onMeasurementSystemControl(!0));try{try{this.removeMeasurementLabels(i)}catch(e){console.warn("\u26a0\ufe0f Failed pre-clean of measurement labels before delete:",e)}if(this.sketchViewModel){const r=null===(t=this.sketchViewModel.updateGraphics)||void 0===t?void 0:t.some((e=>{var t,r;return(null===(t=e.attributes)||void 0===t?void 0:t.uniqueId)===(null===(r=i.attributes)||void 0===r?void 0:r.uniqueId)}));return this.sketchViewModel.cancel(),this.setState({selectedGraphicIndex:null,symbolEditingIndex:null}),void setTimeout((()=>{this.continueDeleteGraphic(e,i)}),r?300:100)}this.continueDeleteGraphic(e,i)}catch(e){console.error("\u274c Error starting deletion:",e),this._isDeletingGraphic=!1,this.ignoreNextGraphicsUpdate=!1,this.props.onMeasurementSystemControl&&this._measurementWasEnabled&&this.props.onMeasurementSystemControl(!0),this.showLocalAlert("Error deleting drawing","error")}},this.performDeleteSelected=()=>{var e;const{drawings:t,selectedGraphics:i}=this.state;if(0!==i.size){this._isDeletingGraphic=!0;try{this.sketchViewModel&&this.sketchViewModel.cancel();const r=Array.from(i);r.forEach((e=>{const i=t[e];i&&this.removeMeasurementLabels(i)}));const n=r.sort(((e,t)=>t-e));this.ignoreNextGraphicsUpdate=!0;for(const i of n){const r=t[i];if(!r)continue;const n=null===(e=r.attributes)||void 0===e?void 0:e.uniqueId;if(n){const e=this.props.graphicsLayer.graphics.toArray().find((e=>{var t,i,r;return(null===(t=e.attributes)||void 0===t?void 0:t.uniqueId)===n&&!(null===(i=e.attributes)||void 0===i?void 0:i.isMeasurementLabel)&&!(null===(r=e.attributes)||void 0===r?void 0:r.hideFromList)}));e?this.props.graphicsLayer.remove(e):(console.warn(`\u26a0\ufe0f Could not find graphic with uniqueId ${n} in layer`),this.props.graphicsLayer.graphics.includes(r)&&this.props.graphicsLayer.remove(r))}else this.props.graphicsLayer.graphics.includes(r)&&this.props.graphicsLayer.remove(r)}setTimeout((()=>{this.cleanupOrphanedMeasurementLabels()}),300);const o=t.filter(((e,t)=>!i.has(t)));this.setState({drawings:o,selectedGraphics:new Set,symbolEditingIndex:null,selectedGraphicIndex:null},(()=>{!1!==this.props.allowLocalStorage&&!0===this.state.consentGranted&&this.saveToLocalStorage(),this.props.onDrawingsUpdate&&this.props.onDrawingsUpdate(o),this._isDeletingGraphic=!1,setTimeout((()=>{this.verifyLayerState(),this.cleanupOrphanedMeasurementLabels()}),500)}))}catch(e){console.error("\u274c Error deleting selected graphics:",e),this._isDeletingGraphic=!1,this.showLocalAlert("Error deleting selected drawings","error"),this.refreshDrawingsFromLayer()}}},this.handleSortOptionChange=e=>{if(!0!==this.state.consentGranted)return void this.showLocalAlert("My Drawings feature requires local storage permission","warning");const t=e.target.value;this.setState({sortOption:t},(()=>{const e=this.sortGraphicsArray(this.state.drawings);this.setState({drawings:e})}))},this.startEditing=(e,t)=>{!0===this.state.consentGranted?(t&&t.stopPropagation(),this.setState({editingGraphicIndex:e})):this.showLocalAlert("My Drawings feature requires local storage permission","warning")},this.handleNameChange=(e,t)=>{if(!0!==this.state.consentGranted)return;const i=[...this.state.drawings],r=i[e];r&&(r.attributes||(r.attributes={}),r.attributes.name=t,this.ignoreNextGraphicsUpdate=!0,this.props.graphicsLayer.remove(r),this.props.graphicsLayer.add(r),this.setState({drawings:i},(()=>{var t,i;null===(i=null===(t=this.state.drawings[e])||void 0===t?void 0:t.attributes)||void 0===i||i.name;!1!==this.props.allowLocalStorage&&!0===this.state.consentGranted&&this.saveToLocalStorage()})))},this.saveNameEdit=()=>{if(!0===this.state.consentGranted&&null!==this.state.editingGraphicIndex)try{const e=this.state.drawings[this.state.editingGraphicIndex];if(!e)return;this.ignoreNextGraphicsUpdate=!0,this.props.graphicsLayer.remove(e),this.props.graphicsLayer.add(e),this.setState({editingGraphicIndex:null},(()=>{!1!==this.props.allowLocalStorage&&!0===this.state.consentGranted&&this.saveToLocalStorage()}))}catch(e){console.error("Error saving name edit:",e),this.showLocalAlert("Error updating name","error"),this.setState({editingGraphicIndex:null})}else!0!==this.state.consentGranted&&this.showLocalAlert("My Drawings feature requires local storage permission","warning")},this.cancelNameEdit=()=>{this.setState({editingGraphicIndex:null})},this.getDrawingTypeLabel=e=>{var t,i,r,n,o;let a=null===(t=e.attributes)||void 0===t?void 0:t.drawMode;if(!a){const t=null===(i=e.attributes)||void 0===i?void 0:i.geometryType;a=["circle","rectangle","text"].includes(t)?t:"point"===(null===(r=e.geometry)||void 0===r?void 0:r.type)&&"text"===(null===(n=e.symbol)||void 0===n?void 0:n.type)?"text":null===(o=e.geometry)||void 0===o?void 0:o.type}switch(a){case"point":return"Point";case"polyline":return"Line";case"polygon":return"Polygon";case"rectangle":case"extent":return"Rectangle";case"circle":return"Circle";case"text":return"Text";default:return(null==a?void 0:a.charAt(0).toUpperCase())+(null==a?void 0:a.slice(1))||"Unknown"}},this.formatCreatedDate=e=>{if(!e)return"";return new Date(Number(e)).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})},this.openSymbolEditor=(e,t)=>{var i,r,n,o,a,s,l,c,u,d;if(!0!==this.state.consentGranted)return void this.showLocalAlert("My Drawings feature requires local storage permission","warning");t&&t.stopPropagation();const h=this.state.drawings[e];if(!h)return void console.warn(`No drawing found at index ${e}`);const m=(null===(i=h.attributes)||void 0===i?void 0:i.relatedSegmentLabels)&&h.attributes.relatedSegmentLabels.length>0;if(this.sketchViewModel&&this.sketchViewModel.cancel(),m&&(null===(r=this.measureRef)||void 0===r?void 0:r.current)&&setTimeout((()=>{var e,t;!(null===(e=this.measureRef)||void 0===e?void 0:e.current)||(null===(t=h.attributes)||void 0===t?void 0:t.relatedSegmentLabels)&&0!==h.attributes.relatedSegmentLabels.length||this.measureRef.current.updateMeasurementsForGraphic(h)}),100),"text"===(null===(n=h.symbol)||void 0===n?void 0:n.type)){const t=h.symbol,i=t.color?this.convertColorToRgba(t.color):"rgba(0,0,0,1)",r=null!==t.haloSize&&t.haloSize>0,n=t.haloColor?this.convertColorToRgba(t.haloColor):"rgba(255,255,255,1)",m=t.haloSize||1,p=t.horizontalAlignment||"center",g=t.verticalAlignment||"middle",f=(null===(o=t.font)||void 0===o?void 0:o.weight)||"normal",y=(null===(a=t.font)||void 0===a?void 0:a.style)||"normal",v=(null===(s=t.font)||void 0===s?void 0:s.decoration)||"none",w=(null===(l=t.font)||void 0===l?void 0:l.size)||12,b=t.angle||0,x="bold"===f,M="italic"===y,L="underline"===v;this.setState({symbolEditingIndex:e,textValue:t.text||"",fontColor:i,fontSize:w,fontFamily:(null===(c=t.font)||void 0===c?void 0:c.family)||"Arial",fontRotation:b,fontOpacity:(null===(u=t.color)||void 0===u?void 0:u.a)||1,fontHaloEnabled:r,fontHaloColor:n,fontHaloSize:m,fontHaloOpacity:(null===(d=t.haloColor)||void 0===d?void 0:d.a)||1,horizontalAlignment:p,verticalAlignment:g,fontWeight:f,fontStyle:y,fontDecoration:v,hAlignLeftActive:"left"===p,hAlignCenterActive:"center"===p,hAlignRightActive:"right"===p,vAlignBaseActive:"baseline"===g,vAlignTopActive:"top"===g,vAlignMidActive:"middle"===g,vAlignBotActive:"bottom"===g,fsBoldActive:x,fsItalicActive:M,fsUnderlineActive:L,isBold:x,isItalic:M,isUnderline:L})}else this.setState({symbolEditingIndex:e,textValue:""})},this.applyTextChangesExplicitly=e=>{var t,i;const r=this.state.drawings[e];if(r&&r.symbol&&"text"===r.symbol.type)try{const e=r.symbol.clone(),n=(null===(t=e.font)||void 0===t?void 0:t.clone())||new Se.default;n.family=this.state.fontFamily||"Arial",n.size=this.state.fontSize||12,n.weight=this.state.isBold?"bold":"normal",n.style=this.state.isItalic?"italic":"normal",n.decoration=this.state.isUnderline?"underline":"none",e.font=n,e.text=this.state.textValue,e.color=this.hexToRgba(this.rgbaToHex(this.state.fontColor),this.state.fontOpacity),e.horizontalAlignment=this.state.horizontalAlignment||"center",e.verticalAlignment=this.state.verticalAlignment||"middle",e.angle=null!==(i=this.state.fontRotation)&&void 0!==i?i:0,this.state.fontHaloEnabled?(e.haloSize=this.state.fontHaloSize,e.haloColor=this.hexToRgba(this.rgbaToHex(this.state.fontHaloColor),this.state.fontHaloOpacity)):(e.haloSize=0,e.haloColor=null);const o=r.clone();o.symbol=e,this.ignoreNextGraphicsUpdate=!0,this.props.graphicsLayer.remove(r),setTimeout((()=>{var e,t;if(this.props.graphicsLayer.add(o),null===(e=this.props.jimuMapView)||void 0===e?void 0:e.view){const e=this.props.jimuMapView.view.center.clone();this.props.jimuMapView.view.goTo(e,{duration:0})}(null===(t=this.sketchViewModel)||void 0===t?void 0:t.updateGraphics)&&(this.sketchViewModel.cancel(),setTimeout((()=>{this.sketchViewModel.update([o])}),50)),!1!==this.props.allowLocalStorage&&!0===this.state.consentGranted&&this.saveToLocalStorage(),this.setState({symbolEditingIndex:null,selectedGraphicIndex:null,selectedGraphics:new Set})}),50)}catch(e){console.error("Error applying text changes:",e),this.showLocalAlert("Error applying changes","error"),this.setState({symbolEditingIndex:null,selectedGraphicIndex:null,selectedGraphics:new Set})}},this.convertColorToRgba=e=>{if(!e)return"rgba(0,0,0,1)";if("function"==typeof e.toRgba){const t=e.toRgba();return`rgba(${t[0]},${t[1]},${t[2]},${t[3]})`}return`rgba(${e.r||0},${e.g||0},${e.b||0},${e.a||1})`},this.rgbaToHex=e=>{if(!e||"string"!=typeof e)return"#000000";const t=e.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*([\d.]+))?\)/);if(!t)return"#000000";return`#${parseInt(t[1],10).toString(16).padStart(2,"0")}${parseInt(t[2],10).toString(16).padStart(2,"0")}${parseInt(t[3],10).toString(16).padStart(2,"0")}`},this.hexToRgba=(e,t=1)=>{e=e.replace("#","");const i=parseInt(e.substring(0,2),16),r=parseInt(e.substring(2,4),16),n=parseInt(e.substring(4,6),16);return new O.default([i,r,n,t])},this.applyTextChanges=e=>{if(e&&this.props.graphicsLayer)try{const t=e.clone();if(this.ignoreNextGraphicsUpdate=!0,this.props.graphicsLayer.remove(e),this.props.graphicsLayer.add(t),this.sketchViewModel&&this.sketchViewModel.updateGraphics){this.sketchViewModel.updateGraphics.some((e=>{var i,r;return(null===(i=e.attributes)||void 0===i?void 0:i.uniqueId)===(null===(r=t.attributes)||void 0===r?void 0:r.uniqueId)}))&&(this.sketchViewModel.cancel(),this.sketchViewModel.update([t]))}return t}catch(e){return console.error("Error applying text changes:",e),this.showLocalAlert("Error updating text","error"),null}},this.updateTextValue=(e,t)=>{const i=[...this.state.drawings],r=i[t];if(r&&r.symbol&&"text"===r.symbol.type)try{const n=r.clone(),o=n.symbol.clone();o.text=e,n.attributes||(n.attributes={}),n.attributes.name=e,n.symbol=o,this.ignoreNextGraphicsUpdate=!0,this.props.graphicsLayer.remove(r),this.props.graphicsLayer.add(n),i[t]=n,this.setState({drawings:i,textValue:e},(()=>{!1!==this.props.allowLocalStorage&&!0===this.state.consentGranted&&this.saveToLocalStorage(),this.props.onDrawingsUpdate&&this.props.onDrawingsUpdate(i)}))}catch(e){console.error("Error updating text value:",e),this.showLocalAlert("Error updating text","error")}},this.updateFontSize=(e,t)=>{const i=[...this.state.drawings],r=i[t];if(r&&r.symbol&&"text"===r.symbol.type)try{const n=r.clone(),o=n.symbol.clone(),a=o.font?o.font.clone():new Se.default({});a.size=e,o.font=a,n.symbol=o,this.ignoreNextGraphicsUpdate=!0,this.props.graphicsLayer.remove(r),this.props.graphicsLayer.add(n),i[t]=n,this.setState({drawings:i,fontSize:e},(()=>{!1!==this.props.allowLocalStorage&&!0===this.state.consentGranted&&this.saveToLocalStorage(),this.props.onDrawingsUpdate&&this.props.onDrawingsUpdate(i)}))}catch(e){console.error("Error updating font size:",e),this.showLocalAlert("Error updating text size","error")}},this.updateFontFamily=(e,t)=>{const i=[...this.state.drawings],r=i[t];if(r&&r.symbol&&"text"===r.symbol.type)try{const n=r.clone(),o=n.symbol.clone(),a=o.font?o.font.clone():new Se.default({});a.family=e,o.font=a,n.symbol=o,this.ignoreNextGraphicsUpdate=!0,this.props.graphicsLayer.remove(r),this.props.graphicsLayer.add(n),i[t]=n,this.setState({drawings:i,fontFamily:e},(()=>{!1!==this.props.allowLocalStorage&&!0===this.state.consentGranted&&this.saveToLocalStorage()}))}catch(e){console.error("Error updating font family:",e),this.showLocalAlert("Error updating text font","error")}},this.updateFontColor=(e,t)=>{const i=[...this.state.drawings],r=i[t];if(r&&r.symbol&&"text"===r.symbol.type)try{const n=r.clone(),o=n.symbol.clone();o.color=e.clone?e.clone():new O.default(e.toRgba?e.toRgba():e),n.symbol=o,this.ignoreNextGraphicsUpdate=!0,this.props.graphicsLayer.remove(r),this.props.graphicsLayer.add(n),i[t]=n;const a=`rgba(${e.r},${e.g},${e.b},${e.a})`;this.setState({drawings:i,fontColor:a,fontOpacity:e.a||1},(()=>{!1!==this.props.allowLocalStorage&&!0===this.state.consentGranted&&this.saveToLocalStorage()}))}catch(e){console.error("Error updating font color:",e),this.showLocalAlert("Error updating text color","error")}},this.updateFontOpacity=(e,t)=>{const i=[...this.state.drawings],r=i[t];if(r&&r.symbol&&"text"===r.symbol.type)try{const n=r.clone(),o=n.symbol.clone();if(o.color){const t=o.color.toRgba?o.color.toRgba():[0,0,0,e];t[3]=e,o.color=new O.default(t)}n.symbol=o,this.ignoreNextGraphicsUpdate=!0,this.props.graphicsLayer.remove(r),this.props.graphicsLayer.add(n),i[t]=n;const a=o.color?`rgba(${o.color.r},${o.color.g},${o.color.b},${e})`:`rgba(0,0,0,${e})`;this.setState({drawings:i,fontOpacity:e,fontColor:a},(()=>{!1!==this.props.allowLocalStorage&&!0===this.state.consentGranted&&this.saveToLocalStorage()}))}catch(e){console.error("Error updating font opacity:",e),this.showLocalAlert("Error updating text opacity","error")}},this.updateFontRotation=(e,t)=>{const i=[...this.state.drawings],r=i[t];if(r&&r.symbol&&"text"===r.symbol.type)try{const n=r.clone(),o=n.symbol.clone();o.angle=e,n.symbol=o,this.ignoreNextGraphicsUpdate=!0,this.props.graphicsLayer.remove(r),this.props.graphicsLayer.add(n),i[t]=n,this.setState({drawings:i,fontRotation:e},(()=>{!1!==this.props.allowLocalStorage&&!0===this.state.consentGranted&&this.saveToLocalStorage()}))}catch(e){console.error("Error updating font rotation:",e),this.showLocalAlert("Error updating text rotation","error")}},this.toggleFontStyle=(e,t)=>{const i=[...this.state.drawings],r=i[t];if(r&&r.symbol&&"text"===r.symbol.type)try{const n=r.clone(),o=n.symbol.clone(),a=o.font?o.font.clone():new Se.default({});switch(e){case"bold":const e="bold"!==a.weight;a.weight=e?"bold":"normal",this.setState({fsBoldActive:e,isBold:e});break;case"italic":const t="italic"!==a.style;a.style=t?"italic":"normal",this.setState({fsItalicActive:t,isItalic:t});break;case"underline":const i="underline"!==a.decoration;a.decoration=i?"underline":"none",this.setState({fsUnderlineActive:i,isUnderline:i})}o.font=a,n.symbol=o,this.ignoreNextGraphicsUpdate=!0,this.props.graphicsLayer.remove(r),this.props.graphicsLayer.add(n),i[t]=n,this.setState({drawings:i},(()=>{!1!==this.props.allowLocalStorage&&!0===this.state.consentGranted&&this.saveToLocalStorage()}))}catch(e){console.error("Error updating font style:",e),this.showLocalAlert("Error updating text style","error")}},this.updateHorizontalAlignment=(e,t)=>{if(null==t)return void console.error("Invalid index provided to updateHorizontalAlignment");const i=[...this.state.drawings];if(!i[t])return void console.error(`No drawing found at index ${t}`);const r=i[t];if(r&&r.symbol&&"text"===r.symbol.type)try{const n=r.clone(),o=n.symbol.clone();o.horizontalAlignment=e,n.symbol=o,this.ignoreNextGraphicsUpdate=!0,this.props.graphicsLayer.remove(r),this.props.graphicsLayer.add(n),i[t]=n,this.setState({drawings:i,horizontalAlignment:e,hAlignLeftActive:"left"===e,hAlignCenterActive:"center"===e,hAlignRightActive:"right"===e},(()=>{!1!==this.props.allowLocalStorage&&!0===this.state.consentGranted&&this.saveToLocalStorage()}))}catch(e){console.error("Error updating horizontal alignment:",e),this.showLocalAlert("Error updating text alignment","error")}else console.error("Cannot update horizontal alignment: graphic has no text symbol")},this.updateVerticalAlignment=(e,t)=>{if(null==t)return void console.error("Invalid index provided to updateVerticalAlignment");const i=[...this.state.drawings];if(!i[t])return void console.error(`No drawing found at index ${t}`);const r=i[t];if(r&&r.symbol&&"text"===r.symbol.type)try{const n=r.clone(),o=n.symbol.clone();o.verticalAlignment=e,n.symbol=o,this.ignoreNextGraphicsUpdate=!0,this.props.graphicsLayer.remove(r),this.props.graphicsLayer.add(n),i[t]=n,this.setState({drawings:i,verticalAlignment:e,vAlignBaseActive:"baseline"===e,vAlignTopActive:"top"===e,vAlignMidActive:"middle"===e,vAlignBotActive:"bottom"===e},(()=>{!1!==this.props.allowLocalStorage&&!0===this.state.consentGranted&&this.saveToLocalStorage()}))}catch(e){console.error("Error updating vertical alignment:",e),this.showLocalAlert("Error updating text alignment","error")}else console.error("Cannot update vertical alignment: graphic has no text symbol")},this.toggleHaloEnabled=(e,t)=>{const i=[...this.state.drawings],r=i[t];if(r&&r.symbol&&"text"===r.symbol.type)try{const n=r.clone(),o=n.symbol.clone();if(e){o.haloSize=this.state.fontHaloSize||1;const e=(this.state.fontHaloColor||"rgba(255,255,255,1)").match(/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*([\d.]+))?\)/);if(e){const t=parseInt(e[1],10),i=parseInt(e[2],10),r=parseInt(e[3],10),n=e[4]?parseFloat(e[4]):1;o.haloColor=new O.default([t,i,r,n])}else o.haloColor=new O.default([255,255,255,1])}else o.haloSize=0,o.haloColor=null;n.symbol=o,this.ignoreNextGraphicsUpdate=!0,this.props.graphicsLayer.remove(r),this.props.graphicsLayer.add(n),i[t]=n,this.setState({drawings:i,fontHaloEnabled:e},(()=>{!1!==this.props.allowLocalStorage&&!0===this.state.consentGranted&&this.saveToLocalStorage()}))}catch(e){console.error("Error toggling halo:",e),this.showLocalAlert("Error updating text halo","error")}},this.updateHaloSize=(e,t)=>{const i=[...this.state.drawings],r=i[t];if(!r||!r.symbol||"text"!==r.symbol.type)return;const n=r.symbol;n.haloSize=e,e>0&&!n.haloColor&&(n.haloColor=new O.default([255,255,255,1])),this.applyTextChanges(r),this.setState({drawings:i,fontHaloSize:e,fontHaloEnabled:e>0},(()=>{!1!==this.props.allowLocalStorage&&!0===this.state.consentGranted&&this.saveToLocalStorage()}))},this.updateHaloColor=(e,t)=>{const i=[...this.state.drawings],r=i[t];if(!r||!r.symbol||"text"!==r.symbol.type)return;const n=r.symbol;n.haloColor=e,(!n.haloSize||n.haloSize<=0)&&(n.haloSize=1),this.applyTextChanges(r);const o=`rgba(${e.r},${e.g},${e.b},${e.a})`;this.setState({drawings:i,fontHaloColor:o,fontHaloOpacity:e.a||1,fontHaloEnabled:!0},(()=>{!1!==this.props.allowLocalStorage&&!0===this.state.consentGranted&&this.saveToLocalStorage()}))},this.updateHaloOpacity=(e,t)=>{const i=[...this.state.drawings],r=i[t];if(r&&r.symbol&&"text"===r.symbol.type)try{const n=r.clone(),o=n.symbol.clone();if(o.haloColor){const t=o.haloColor.toRgba?o.haloColor.toRgba():[255,255,255,e];t[3]=e,o.haloColor=new O.default(t)}else this.state.fontHaloEnabled&&(o.haloColor=new O.default([255,255,255,e]));n.symbol=o,this.ignoreNextGraphicsUpdate=!0,this.props.graphicsLayer.remove(r),this.props.graphicsLayer.add(n),i[t]=n;const a=o.haloColor?`rgba(${o.haloColor.r},${o.haloColor.g},${o.haloColor.b},${e})`:`rgba(255,255,255,${e})`;this.setState({drawings:i,fontHaloOpacity:e,fontHaloColor:a},(()=>{!1!==this.props.allowLocalStorage&&!0===this.state.consentGranted&&this.saveToLocalStorage()}))}catch(e){console.error("Error updating halo opacity:",e),this.showLocalAlert("Error updating text halo opacity","error")}},this.closeSymbolEditor=()=>{this.setState({symbolEditingIndex:null})},this.updateSymbol=(e,t)=>{var i,r;this.sketchViewModel&&this.sketchViewModel.cancel();const n=[...this.state.drawings];if(!n[t])return void console.warn(`No drawing found at index ${t} in updateSymbol`);const o=n[t];try{const a=o.clone();let s=e?e.clone():null;if("polyline"===(null===(i=a.geometry)||void 0===i?void 0:i.type)&&(s&&"simple-line"===s.type||(s=new Me.default({color:(null==s?void 0:s.color)||[0,0,0,1],width:(null==s?void 0:s.width)||2,style:(null==s?void 0:s.style)||"solid"}))),"text"===(null==s?void 0:s.type)){const e=s;e.color||(e.color=new O.default([0,0,0,1])),e.font?e.font=new Se.default({family:e.font.family||"Arial",size:e.font.size||12,style:e.font.style||"normal",weight:e.font.weight||"normal",decoration:e.font.decoration||"none"}):e.font=new Se.default({size:12}),e.text||(e.text=(null===(r=a.attributes)||void 0===r?void 0:r.name)||"Label"),s=e}a.symbol=s,n[t]=a,this.ignoreNextGraphicsUpdate=!0,this.props.graphicsLayer.remove(o),this.props.graphicsLayer.add(a),this.setState({drawings:n},(()=>{!1!==this.props.allowLocalStorage&&!0===this.state.consentGranted&&this.saveToLocalStorage()}))}catch(e){console.error("Failed to update symbol:",e),this.showLocalAlert("Error updating symbol","error")}};const t=`${window.location.origin}${window.location.pathname}`,i=btoa(t).replace(/[^a-zA-Z0-9]/g,"_"),r=this.props.localStorageKey?String(this.props.localStorageKey).replace(/[^a-zA-Z0-9_-]/g,"_"):null;this.localStorageKey=null!=r?r:`drawings_${i}`,this.sessionPromptKey=`drawings_prompt_shown_${i}`;let n=null;try{const e=localStorage.getItem("drawingConsentGranted");n="true"===e||"false"!==e&&null}catch(e){n=null}let o=!1;try{o=!!localStorage.getItem(this.localStorageKey)}catch(e){o=!1}let a=!1;try{a="1"===sessionStorage.getItem(this.sessionPromptKey)}catch(e){a=!1}const s=!a&&o&&!1!==n;if(s)try{sessionStorage.setItem(this.sessionPromptKey,"1")}catch(e){}this.state={drawings:[],selectedGraphicIndex:null,sortOption:"name",editingGraphicIndex:null,alertMessage:"",alertType:"info",showAlert:!1,consentGranted:n,graphicsWatchHandle:null,confirmDialogOpen:!1,confirmDialogAction:null,confirmDialogMessage:"",confirmDialogType:"delete",confirmDialogItemIndex:null,importDialogOpen:!1,importFile:null,importFileContent:null,selectedGraphics:new Set,symbolEditingIndex:null,showStorageDisclaimer:!1,textValue:"",fontColor:"rgba(0,0,0,1)",fontSize:12,fontFamily:"Arial",fontOpacity:1,fontRotation:0,horizontalAlignment:"center",verticalAlignment:"middle",hAlignLeftActive:!1,hAlignCenterActive:!0,hAlignRightActive:!1,vAlignBaseActive:!1,vAlignTopActive:!1,vAlignMidActive:!0,vAlignBotActive:!1,fsBoldActive:!1,fsItalicActive:!1,fsUnderlineActive:!1,fontWeight:"normal",fontStyle:"normal",fontDecoration:"none",isBold:!1,isItalic:!1,isUnderline:!1,fontHaloEnabled:!1,fontHaloColor:"rgba(255,255,255,1)",fontHaloSize:1,fontHaloOpacity:1,currentTextSymbol:new R.default({verticalAlignment:"middle",font:{family:"Arial",size:12,style:"normal",weight:"normal",decoration:"none"},text:"Text",color:new O.default("rgba(0,0,0,1)"),haloColor:null,haloSize:0,angle:0}),showLoadPrompt:s,hasExistingDrawings:o},this._goToController=null}componentDidMount(){!0===this.state.consentGranted&&this.props.jimuMapView&&this.props.graphicsLayer&&(We._drawingsLoadChoiceTimestamp>0||!this.checkExistingDrawings())&&this.initializeComponents()}componentDidUpdate(e,t){!0!==t.consentGranted&&!0===this.state.consentGranted&&this.props.jimuMapView&&this.props.graphicsLayer&&(We._drawingsLoadChoiceTimestamp>0||!this.checkExistingDrawings())&&this.initializeComponents(),!0!==this.state.consentGranted||this.state.showLoadPrompt||(e.graphicsLayer!==this.props.graphicsLayer&&this.props.graphicsLayer&&(this.state.graphicsWatchHandle&&this.state.graphicsWatchHandle.remove(),this.setupGraphicsWatcher(),this.refreshDrawingsFromLayer()),e.jimuMapView!==this.props.jimuMapView&&this.props.jimuMapView&&this.initializeComponents())}componentWillUnmount(){var e;this._isUpdatingMeasurements=!1,this._saveToStorageTimeout&&(clearTimeout(this._saveToStorageTimeout),this._saveToStorageTimeout=null),this._measurementUpdateTimeout&&(clearTimeout(this._measurementUpdateTimeout),this._measurementUpdateTimeout=null),this._geometryWatchTimeouts&&(Object.values(this._geometryWatchTimeouts).forEach((e=>{e&&clearTimeout(e)})),this._geometryWatchTimeouts={}),this._mapClickSyncEnabled=!1,this._measurementStyleWatcher&&(this._measurementStyleWatcher.remove(),this._measurementStyleWatcher=null),this.measurementStylesInitialized=!1,this.state.graphicsWatchHandle&&this.state.graphicsWatchHandle.remove(),this._positionWatchers&&(Object.values(this._positionWatchers).forEach((e=>{e&&e.remove()})),this._positionWatchers={}),this._graphicsWatchHandles&&(this._graphicsWatchHandles.forEach((e=>{e&&e.remove()})),this._graphicsWatchHandles=[]),this._savePositionTimeout&&(clearTimeout(this._savePositionTimeout),this._savePositionTimeout=null),this._goToController&&(this._goToController.abort(),this._goToController=null),this.sketchViewModel&&this.internalSketchVM&&this.sketchViewModel.destroy();try{null===(e=this.sketchViewModel)||void 0===e||e.cancel()}catch(e){}"function"==typeof this.removeAllSelectionOverlays&&this.removeAllSelectionOverlays()}render(){const{drawings:e,selectedGraphicIndex:t,sortOption:n,editingGraphicIndex:o,alertMessage:a,alertType:s,showAlert:l,consentGranted:c,confirmDialogOpen:u,confirmDialogMessage:d,confirmDialogType:h,importDialogOpen:m,importFile:p,selectedGraphics:g}=this.state,f=(i.default.createElement("div",{className:"p-4 text-center",role:"dialog","aria-modal":"true","aria-labelledby":"storageDisclaimerTitle","aria-describedby":"storageDisclaimerDescription",style:{backgroundColor:"#fff"}},i.default.createElement("h5",{id:"storageDisclaimerTitle",className:"mb-3",tabIndex:-1},"Important Notice"),i.default.createElement("div",{id:"storageDisclaimerDescription"},i.default.createElement("p",null,"Your drawings are saved in your web browser using local storage. This means they're only available on this device and in this browser."),i.default.createElement("p",null,"If you clear your browser data, switch to a different browser or computer, or if the application receives an update, your drawings may be lost."),i.default.createElement("p",null,"To keep your work safe, please use the ",i.default.createElement("strong",null,"Import")," and ",i.default.createElement("strong",null,"Export")," buttons to back up and restore your drawings.")),i.default.createElement(r.Button,{type:"primary",title:"Acknowledge this notice and continue","aria-label":"Acknowledge disclaimer and continue to My Drawings panel",onClick:()=>this.setState({showStorageDisclaimer:!1},(()=>{this.initializeComponents(),setTimeout((()=>{var e;null===(e=document.getElementById("drawingPanelHeader"))||void 0===e||e.focus()}),100)}))},"Continue")),u&&i.default.createElement("div",{className:"confirmation-dialog-overlay",role:"dialog","aria-modal":"true","aria-labelledby":"confirmationDialogTitle","aria-describedby":"confirmationDialogMessage",style:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"}},i.default.createElement("div",{className:"confirmation-dialog",style:{backgroundColor:"white",padding:"20px",borderRadius:"4px",width:"80%",maxWidth:"300px",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.2)"}},i.default.createElement("div",{className:"confirmation-dialog-header mb-3"},i.default.createElement("h5",{id:"confirmationDialogTitle",tabIndex:-1,className:"m-0"},"Confirm ","delete"===h?"Delete":"Clear All")),i.default.createElement("div",{className:"confirmation-dialog-body mb-3"},i.default.createElement("p",{id:"confirmationDialogMessage",className:"m-0"},d)),i.default.createElement("div",{className:"confirmation-dialog-footer d-flex justify-content-end",role:"group","aria-label":"Confirmation options"},i.default.createElement(r.Button,{size:"sm",className:"mr-2",onClick:this.closeConfirmDialog,title:"Cancel and close the dialog","aria-label":"Cancel"},"Cancel"),i.default.createElement(r.Button,{size:"sm",type:"danger",onClick:this.executeConfirmAction,title:"Confirm and proceed","aria-label":"Confirm and proceed"},"OK"))))),y=m&&i.default.createElement("div",{className:"confirmation-dialog-overlay",role:"dialog","aria-modal":"true","aria-labelledby":"importDialogTitle","aria-describedby":"importDialogDescription",style:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"}},i.default.createElement("div",{className:"confirmation-dialog",style:{backgroundColor:"white",padding:"20px",borderRadius:"4px",width:"80%",maxWidth:"300px",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.2)"}},i.default.createElement("div",{className:"confirmation-dialog-header mb-3"},i.default.createElement("h5",{id:"importDialogTitle",tabIndex:-1,className:"m-0"},"Import Drawings")),i.default.createElement("div",{id:"importDialogDescription",className:"confirmation-dialog-body mb-3"},i.default.createElement("p",{className:"m-0"},p&&`File: ${p.name}`),i.default.createElement("p",{className:"mt-2 mb-0"},"Would you like to replace existing drawings or add to them?")),i.default.createElement("div",{className:"confirmation-dialog-footer d-flex justify-content-between",role:"group","aria-label":"Import action options"},i.default.createElement(r.Button,{size:"sm",onClick:this.closeImportDialog,title:"Cancel import and close dialog","aria-label":"Cancel import"},"Cancel"),i.default.createElement("div",null,i.default.createElement(r.Button,{size:"sm",className:"mr-2",onClick:this.handleImportAdd,title:"Add imported drawings to existing ones","aria-label":"Add drawings"},"Add"),i.default.createElement(r.Button,{size:"sm",type:"danger",onClick:this.handleImportReplace,title:"Replace existing drawings with imported file","aria-label":"Replace drawings"},"Replace"))))),v=i.default.createElement("div",{className:"my-drawings-panel p-3",role:"dialog","aria-modal":"true","aria-labelledby":"permissionDeniedTitle","aria-describedby":"permissionDeniedDescription",style:{backgroundColor:"#fff",height:"100%",boxShadow:"none"}},i.default.createElement("div",{className:"text-center mb-4"},i.default.createElement("h5",{id:"permissionDeniedTitle",tabIndex:-1},"My Drawings Feature Unavailable"),i.default.createElement("div",{id:"permissionDeniedDescription"},i.default.createElement("p",null,"This feature requires local storage permission to save your drawings.")),i.default.createElement("div",{className:"mt-4"},i.default.createElement(r.Button,{type:"primary",onClick:this.handleConsentYes,title:"Enable local storage to use the My Drawings feature","aria-label":"Allow local storage permission to enable My Drawings feature"},"Allow Local Storage Permission"))),l&&i.default.createElement("div",{role:"alert","aria-live":"assertive"},i.default.createElement(r.Alert,{className:`edraw-alert edraw-alert-${s}`,withIcon:!0,open:!0,type:s,text:a}))),w=null===c,b=i.default.createElement("div",{className:"consent-banner border p-3 mb-2 text-center",role:"dialog","aria-modal":"true","aria-labelledby":"consentPromptTitle","aria-describedby":"consentPromptDescription",style:{backgroundColor:"#fff",height:"100%",boxShadow:"none"}},i.default.createElement("h5",{id:"consentPromptTitle",className:"mb-3",tabIndex:-1},"Storage Permission Required"),i.default.createElement("div",{id:"consentPromptDescription"},i.default.createElement("p",{className:"mb-3"},"To use the My Drawings panel, you must allow saving drawings in your browser's local storage."),i.default.createElement("p",{className:"mb-3"},"This allows your drawings to be remembered when you return to this page later.")),i.default.createElement("div",{className:"d-flex justify-content-center mt-3",role:"group","aria-label":"Consent choices"},i.default.createElement(r.Button,{type:"primary",size:"sm",className:"mr-3",onClick:this.handleConsentYes,title:"Allow saving drawings to your browser","aria-label":"Allow saving drawings to your browser"},"Allow Local Storage"),i.default.createElement(r.Button,{type:"danger",size:"sm",onClick:this.handleConsentNo,title:"Do not allow saving drawings to your browser","aria-label":"Do not allow saving drawings to your browser"},"Don't Allow"))),x=i.default.createElement("div",{className:"p-4 text-center",role:"dialog","aria-modal":"true","aria-labelledby":"loadPromptTitle","aria-describedby":"loadPromptDescription",style:{backgroundColor:"#fff",height:"100%"}},i.default.createElement("h5",{id:"loadPromptTitle",className:"mb-3",tabIndex:-1},"Existing Drawings Found"),i.default.createElement("div",{id:"loadPromptDescription"},i.default.createElement("p",null,"You have drawings saved from a previous session."),i.default.createElement("p",null,"Would you like to load your existing drawings or delete all and start new?")),i.default.createElement("div",{className:"d-flex justify-content-center mt-4 gap-3",role:"group","aria-label":"Load options"},i.default.createElement(r.Button,{type:"primary",onClick:this.handleLoadExistingDrawings,className:"mr-3",title:"Load your previously saved drawings","aria-label":"Load previously saved drawings"},"Load Existing Drawings"),i.default.createElement(r.Button,{type:"danger",onClick:this.handleStartFresh,title:"Delete all saved drawings and start fresh","aria-label":"Delete all saved drawings and start fresh"},"Delete All and Start New"))),M=i.default.createElement("div",{className:"my-drawings-panel p-2",style:{backgroundColor:"#fff"}},i.default.createElement("div",{className:"top-controls"},i.default.createElement("div",{className:"toolbar-first-line"},i.default.createElement("div",{className:"sort-wrapper"},i.default.createElement("label",{className:"sort-label",id:"sort-drawings-label",htmlFor:"sort-select",title:"Sort drawings by different criteria"},"Sort By:"),i.default.createElement("select",{id:"sort-select",value:n,onChange:this.handleSortOptionChange,className:"sort-select","aria-labelledby":"sort-drawings-label",title:"Sort drawings by name, type, or creation date"},i.default.createElement("option",{value:"name"},"Name (A \u2192 Z)"),i.default.createElement("option",{value:"type"},"Type (A \u2192 Z)"),i.default.createElement("option",{value:"created"},"Created (Newest First)"))),i.default.createElement(r.Button,{size:"sm",type:g.size===e.length&&e.length>0?"primary":"default",onClick:this.handleToggleSelectAll,disabled:0===e.length,className:"select-all-btn","aria-label":g.size===e.length&&e.length>0?"Deselect all drawings":"Select all drawings",title:g.size===e.length&&e.length>0?"Deselect all drawings":"Select all drawings"},i.default.createElement("span",{style:{display:"flex",alignItems:"center",justifyContent:"center",width:"100%"}},i.default.createElement("i",{className:"fas "+(g.size===e.length&&e.length>0?"fa-check-square":"fa-square"),"aria-hidden":"true",style:{marginRight:"4px"}}),g.size===e.length&&e.length>0?"Deselect All":"Select All")),i.default.createElement(r.Button,{size:"sm",type:"danger",onClick:this.handleClearAllClick,disabled:0===e.length,className:"delete-all-btn","aria-label":"Delete all drawings",title:"Delete all drawings"},i.default.createElement("span",{style:{display:"flex",alignItems:"center",justifyContent:"center",width:"100%"}},i.default.createElement("i",{className:"fas fa-trash-alt","aria-hidden":"true",style:{marginRight:"4px"}}),"Delete All"))),i.default.createElement("div",{className:"toolbar-second-line"},i.default.createElement("div",{className:"action-buttons-wrapper"},i.default.createElement(r.Button,{size:"sm",onClick:()=>document.getElementById("import-file").click(),className:"action-btn","aria-label":"Import drawings from file",title:"Import drawings from file"},i.default.createElement("i",{className:"fas fa-file-import","aria-hidden":"true"})," Import"),i.default.createElement(r.Button,{size:"sm",onClick:this.handleExport,disabled:0===e.length,className:"action-btn","aria-label":"Export all drawings",title:"Export all drawings"},i.default.createElement("i",{className:"fas fa-file-export","aria-hidden":"true"})," Export All"),i.default.createElement(r.Button,{size:"sm",onClick:this.handleExportSelected,disabled:0===g.size,className:"action-btn","aria-label":"Export selected drawings",title:"Export selected drawings"},i.default.createElement("i",{className:"fas fa-file-download","aria-hidden":"true"})," Export Selected"),i.default.createElement(r.Button,{size:"sm",type:"danger",onClick:this.handleDeleteSelected,disabled:0===g.size,className:"action-btn","aria-label":"Delete selected drawings",title:"Delete selected drawings"},i.default.createElement("i",{className:"fas fa-trash-alt","aria-hidden":"true"})," Delete Selected")))),i.default.createElement("div",{className:"px-3 drawing-list",style:{height:"500px",overflowY:"scroll",backgroundColor:"#fff"},role:"list","aria-label":"Drawings list"},0===e.length?i.default.createElement("div",{className:"text-center p-3 border rounded",style:{backgroundColor:"#fff"}},i.default.createElement("p",{className:"mb-0"},"No drawings available. Create a drawing in the Add Drawing tab.")):e.map(((e,n)=>{var a,s,l,c,u,d,h,m,p,f,y,v,w,b,x,M;return i.default.createElement("div",{id:`drawing-item-${n}`,key:`drawing-${(null===(a=e.attributes)||void 0===a?void 0:a.uniqueId)||n}`,className:"drawing-item border p-2 mb-2 rounded "+(t===n?"selected-drawing":""),onClick:()=>this.handleListItemClick(e,n),role:"listitem","aria-selected":t===n,tabIndex:0,onKeyDown:t=>{"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),this.handleListItemClick(e,n))}},i.default.createElement("div",{className:"d-flex"},i.default.createElement("div",{style:{flex:1,minWidth:0}},i.default.createElement("div",{className:"d-flex"},i.default.createElement("label",{className:"d-flex align-items-start mr-3 mt-1 cursor-pointer",onClick:e=>e.stopPropagation()},i.default.createElement("input",{type:"checkbox",className:"form-check-input mr-2 mt-1",checked:g.has(n),onClick:e=>this.handleToggleSelect(n,e),"aria-label":`Select drawing: ${(null===(s=e.attributes)||void 0===s?void 0:s.name)||`Drawing ${n+1}`}`,title:`Select ${(null===(l=e.attributes)||void 0===l?void 0:l.name)||`Drawing ${n+1}`}`,id:`checkbox-drawing-${n}`}),i.default.createElement("span",{className:"sr-only"},"Select ",(null===(c=e.attributes)||void 0===c?void 0:c.name)||`Drawing ${n+1}`)),i.default.createElement("div",null,o===n?i.default.createElement("div",{className:"form-group",onClick:e=>e.stopPropagation()},i.default.createElement("label",{htmlFor:`edit-name-input-${n}`,className:"sr-only"},"Edit drawing name"),i.default.createElement("input",{id:`edit-name-input-${n}`,type:"text",className:"form-control mb-2 drawing-name-input",value:(null===(u=e.attributes)||void 0===u?void 0:u.name)||"",onChange:e=>{const t=e.target.value;this.handleNameChange(n,t)},onBlur:this.saveNameEdit,onKeyDown:e=>{e.stopPropagation(),"Enter"===e.key&&this.saveNameEdit()},autoFocus:!0,onClick:e=>e.stopPropagation(),spellCheck:"false",autoComplete:"off",autoCorrect:"off","aria-label":"Edit drawing name",title:"Edit drawing name",style:{whiteSpace:"pre-wrap",wordBreak:"normal",wordSpacing:"normal",textTransform:"none"}}),i.default.createElement("div",{className:"d-flex mt-1"},i.default.createElement(r.Button,{size:"sm",className:"mr-2",onClick:e=>{e.stopPropagation(),this.saveNameEdit()},title:"Save name","aria-label":"Save drawing name"},"Save"),i.default.createElement(r.Button,{size:"sm",onClick:e=>{e.stopPropagation(),this.cancelNameEdit()},title:"Cancel editing","aria-label":"Cancel name editing"},"Cancel"))):i.default.createElement(i.default.Fragment,null,i.default.createElement("div",{className:"font-weight-bold text-truncate"},(null===(d=e.attributes)||void 0===d?void 0:d.name)||`Drawing ${n+1}`),i.default.createElement("div",{className:"text-muted small mb-2 text-truncate"},"Type: ",this.getDrawingTypeLabel(e),(null===(h=e.attributes)||void 0===h?void 0:h.createdDate)&&` \u2022 Created: ${this.formatCreatedDate(e.attributes.createdDate)}`)))),i.default.createElement("div",{className:"button-container drawToolbarDiv"},i.default.createElement(r.Button,{size:"sm",onClick:e=>{e.stopPropagation(),this.handleCopyDrawing(n,e)},className:"btn-light","aria-label":`Copy ${(null===(m=e.attributes)||void 0===m?void 0:m.name)||`Drawing ${n+1}`}`,title:"Create a copy of this drawing"},i.default.createElement("i",{className:"fas fa-copy","aria-hidden":"true"})," Copy"),i.default.createElement(r.Button,{size:"sm",onClick:e=>{e.stopPropagation(),this.startEditing(n,e)},className:"btn-light","aria-label":`Rename ${(null===(p=e.attributes)||void 0===p?void 0:p.name)||`Drawing ${n+1}`}`,title:"Rename this drawing"},i.default.createElement("i",{className:"fas fa-pencil-alt","aria-hidden":"true"})," Rename"),i.default.createElement(r.Button,{size:"sm",onClick:e=>{e.stopPropagation(),this.handleExportSingle(n,e)},className:"btn-light","aria-label":`Download ${(null===(f=e.attributes)||void 0===f?void 0:f.name)||`Drawing ${n+1}`}`,title:"Download this drawing as a file"},i.default.createElement("i",{className:"fas fa-download","aria-hidden":"true"})," Download"),i.default.createElement(r.Button,{size:"sm",type:"danger",onClick:e=>{e.stopPropagation(),this.handleDeleteGraphic(n,e)},"aria-label":`Delete ${(null===(y=e.attributes)||void 0===y?void 0:y.name)||`Drawing ${n+1}`}`,title:"Delete this drawing"},i.default.createElement("i",{className:"fas fa-trash-alt","aria-hidden":"true"})," Delete")),t===n&&i.default.createElement("div",{className:"mt-3 border",onClick:e=>e.stopPropagation(),role:"region","aria-label":"Style editor"},this.isSupportedSymbol(e.symbol,null===(v=e.geometry)||void 0===v?void 0:v.type)?"text"===(null===(w=e.symbol)||void 0===w?void 0:w.type)?i.default.createElement(i.default.Fragment,null,e&&"text"===(null===(b=e.symbol)||void 0===b?void 0:b.type)&&i.default.createElement(i.default.Fragment,null),i.default.createElement(_e,{currentTextSymbol:this.state.currentTextSymbol,graphic:e,updateSymbol:e=>this.updateSymbolWithoutClosing(e,n),show:!0,onClose:()=>{this.setState({selectedGraphicIndex:null,selectedGraphics:new Set})}})):i.default.createElement(j.SymbolSelector,{symbol:e.symbol,jimuSymbolType:"point"===(null===(x=e.geometry)||void 0===x?void 0:x.type)?j.JimuSymbolType.Point:"polyline"===(null===(M=e.geometry)||void 0===M?void 0:M.type)?j.JimuSymbolType.Polyline:j.JimuSymbolType.Polygon,onPointSymbolChanged:e=>this.updateSymbolWithoutClosing(e,n),onPolylineSymbolChanged:e=>this.updateSymbolWithoutClosing(e,n),onPolygonSymbolChanged:e=>this.updateSymbolWithoutClosing(e,n)}):i.default.createElement("div",{className:"text-muted"},"This symbol type is not supported for style editing.")))))}))),i.default.createElement("input",{type:"file",id:"import-file",accept:".json,.geojson,application/json,application/geo+json",onChange:this.handleImport,style:{display:"none"}}));return i.default.createElement("div",{className:"my-drawings-panel p-2",style:Object.assign({height:"100%",display:"flex",flexDirection:"column",overflow:"hidden"},{backgroundColor:"#fff",boxShadow:"none"})},l&&i.default.createElement("div",{role:"alert","aria-live":"assertive"},i.default.createElement(r.Alert,{className:`edraw-alert edraw-alert-${s}`,withIcon:!0,open:!0,type:s,text:a})),f&&i.default.createElement("div",{role:"dialog","aria-modal":"true","aria-labelledby":"confirmationDialogTitle","aria-describedby":"confirmationDialogDescription"},f),y&&i.default.createElement("div",{role:"dialog","aria-modal":"true","aria-labelledby":"importDialogTitle","aria-describedby":"importDialogDescription"},y),w?i.default.createElement("div",null,b):!1===c?i.default.createElement("div",null,v):this.state.showLoadPrompt?i.default.createElement("div",null,x):this.state.showStorageDisclaimer?i.default.createElement("div",{className:"p-4 text-center",style:{backgroundColor:"#fff"},role:"region","aria-labelledby":"storageDisclaimerTitle"},i.default.createElement("h5",{id:"storageDisclaimerTitle",className:"mb-3",tabIndex:-1},"Important Notice"),i.default.createElement("p",{id:"storageDisclaimerDescription"},"Your drawings are saved in your web browser using local storage. This means they're only available on this device and in this browser."),i.default.createElement("p",null,"If you clear your browser data, switch to a different browser or computer, or if the application receives an update, your drawings may be lost."),i.default.createElement("p",null,"To keep your work safe, please use the ",i.default.createElement("strong",null,"Import")," and ",i.default.createElement("strong",null,"Export")," buttons to back up and restore your drawings."),i.default.createElement(r.Button,{type:"primary",title:"Acknowledge this notice and continue","aria-label":"Continue to drawing panel",onClick:()=>this.setState({showStorageDisclaimer:!1},(()=>{this.initializeComponents(),setTimeout((()=>{const e=document.getElementById("drawingPanelHeader");null==e||e.focus()}),100)}))},"Continue")):i.default.createElement("div",{role:"region","aria-labelledby":"drawingPanelHeader"},i.default.createElement("h2",{id:"drawingPanelHeader",tabIndex:-1,className:"sr-only"},"Drawing Panel"),M),i.default.createElement("style",{dangerouslySetInnerHTML:{__html:'\n  /* Force white background on potentially gray elements */\n  .my-drawings-panel,\n  .my-drawings-panel h5,\n  .my-drawings-panel .border-bottom,\n  .my-drawings-panel > div,\n  .my-drawings-panel > div > div {\n      background-color: #fff !important;\n  }\n\n  .my-drawings-panel .drawing-list-container {\n      overflow-y: auto !important;\n  }\n\n  /* Target panel headers that might be getting styled by the framework */\n  .panel-title, \n  .panel-heading,\n  .widget-title,\n  .widget-heading,\n  .widget-header {\n      background-color: #fff !important;\n  }\n\n  /* Style the main panel header specifically */\n  .my-drawings {\n      background-color: #fff !important;\n  }\n\n  /* SCROLLING IMPROVEMENTS */\n  .my-drawings-panel {\n      display: flex !important;\n      flex-direction: column !important;\n      height: 100% !important;\n      overflow: hidden !important;\n  }\n\n  .accessible-tooltip-wrapper {\n    position: relative !important;\n    display: inline-block !important;\n  }\n\n  .accessible-tooltip-wrapper:hover .accessible-tooltip,\n  .accessible-tooltip-wrapper:focus-within .accessible-tooltip {\n      visibility: visible !important;\n      opacity: 1 !important;\n  }\n\n  .accessible-tooltip-wrapper .accessible-tooltip {\n      visibility: hidden !important;\n      opacity: 0 !important;\n      position: absolute !important;\n      z-index: 1000 !important;\n      background-color: rgba(0, 0, 0, 0.75) !important;\n      color: white !important;\n      text-align: center !important;\n      padding: 5px 10px !important;\n      border-radius: 4px !important;\n      font-size: 12px !important;\n      white-space: nowrap !important;\n      pointer-events: none !important;\n      transition: opacity 0.2s, visibility 0.2s !important;\n  }\n\n  /* Position the tooltip */\n  .accessible-tooltip-wrapper .accessible-tooltip[data-placement="top"] {\n      bottom: 100% !important;\n      left: 50% !important;\n      transform: translateX(-50%) translateY(-6px) !important;\n  }\n\n  .accessible-tooltip-wrapper .accessible-tooltip[data-placement="bottom"] {\n      top: 100% !important;\n      left: 50% !important;\n      transform: translateX(-50%) translateY(6px) !important;\n  }\n\n  .accessible-tooltip-wrapper .accessible-tooltip[data-placement="left"] {\n      right: 100% !important;\n      top: 50% !important;\n      transform: translateY(-50%) translateX(-6px) !important;\n  }\n\n  .accessible-tooltip-wrapper .accessible-tooltip[data-placement="right"] {\n      left: 100% !important;\n      top: 50% !important;\n      transform: translateY(-50%) translateX(6px) !important;\n  }\n\n  /* Add arrows */\n  .accessible-tooltip-wrapper .accessible-tooltip::after {\n      content: "" !important;\n      position: absolute !important;\n      border-width: 5px !important;\n      border-style: solid !important;\n      border-color: transparent !important;\n  }\n\n  .accessible-tooltip-wrapper .accessible-tooltip[data-placement="top"]::after {\n      bottom: -10px !important;\n      left: 50% !important;\n      margin-left: -5px !important;\n      border-color: rgba(0, 0, 0, 0.75) transparent transparent transparent !important;\n  }\n\n  .accessible-tooltip-wrapper .accessible-tooltip[data-placement="bottom"]::after {\n      top: -10px !important;\n      left: 50% !important;\n      margin-left: -5px !important;\n      border-color: transparent transparent rgba(0, 0, 0, 0.75) transparent !important;\n  }\n\n  .accessible-tooltip-wrapper .accessible-tooltip[data-placement="left"]::after {\n      top: 50% !important;\n      right: -10px !important;\n      margin-top: -5px !important;\n      border-color: transparent transparent transparent rgba(0, 0, 0, 0.75) !important;\n  }\n\n  .accessible-tooltip-wrapper .accessible-tooltip[data-placement="right"]::after {\n      top: 50% !important;\n      left: -10px !important;\n      margin-top: -5px !important;\n      border-color: transparent rgba(0, 0, 0, 0.75) transparent transparent !important;\n  }\n\n  /* Main scrollable container */\n  .my-drawings-panel .flex-grow-1,\n  .my-drawings-panel .drawing-list-container {\n      overflow-y: auto !important;\n      flex: 1 1 auto !important;\n      height: auto !important;\n      max-height: 100% !important;\n  }\n\n  /* Ensure the top controls don\'t shrink */\n  .my-drawings-panel .border-bottom {\n      flex-shrink: 0 !important;\n  }\n\n  /* ======= IMPROVED DRAWING ITEM STYLING ======= */\n\n  /* Drawing item container styling */\n  .drawing-item {\n      position: relative;\n      border: 1px solid #e0e0e0;\n      border-radius: 6px;\n      overflow: hidden;\n      box-sizing: border-box;\n      width: 100%;\n      margin-bottom: 8px;\n      box-shadow: 0 1px 3px rgba(0,0,0,0.05);\n      transition: all 0.2s ease;\n  }\n\n  /* Hover effect for drawing items */\n  .drawing-item:hover {\n      border-color: #c0c0c0;\n      box-shadow: 0 2px 5px rgba(0,0,0,0.08);\n  }\n\n  /* Selected item styling */\n  .drawing-item.selected-drawing {\n      background-color: #f0f7ff !important;\n      border-color: #3b82f6 !important;\n      border-width: 2px !important;\n      border-style: solid !important;\n      box-shadow: 0 2px 4px rgba(59, 130, 246, 0.15) !important;\n      position: relative;\n      z-index: 1;\n      transition: background-color 0.2s, border-color 0.25s;\n  }\n\n  /* Add a left accent bar for selected items */\n  .drawing-item.selected-drawing::before {\n      content: \'\';\n      position: absolute;\n      left: 0;\n      top: 0;\n      bottom: 0;\n      width: 4px;\n      background-color: #3b82f6;\n      border-top-left-radius: 3px;\n      border-bottom-left-radius: 3px;\n  }\n\n  /* Truncate text labels to prevent overflow */\n  .drawing-item .font-weight-bold,\n  .drawing-item .text-muted {\n      white-space: nowrap;\n      overflow: hidden;\n      text-overflow: ellipsis;\n  }\n\n  /* ======= IMPROVED BUTTON STYLING ======= */\n\n  /* Contain buttons in a proper grid layout */\n  .drawing-item .d-flex.flex-column {\n      width: 100%;\n      display: flex;\n      flex-direction: column;\n      gap: 6px;\n  }\n\n  /* OPTIMIZED COMPACT BUTTON LAYOUT FOR 4 BUTTONS */\n  .drawing-item .button-container {\n      display: flex !important;\n      flex-wrap: wrap !important;\n      gap: 2px !important;\n      width: 100% !important;\n      margin-top: 8px !important;\n  }\n\n  /* Individual button styling - optimized for 4 buttons */\n  .drawing-item .btn {\n      flex: 1 !important;\n      min-width: 65px !important;\n      padding: 4px 5px !important;\n      font-size: 11px !important;\n      white-space: nowrap !important;\n      text-align: center !important;\n      justify-content: center !important;\n      display: flex !important;\n      align-items: center !important;\n      transition: all 0.2s !important;\n      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05) !important;\n      margin: 0 !important;\n  }\n\n  /* Ensure icons have consistent spacing */\n  .drawing-item .btn i {\n      margin-right: 3px !important;\n      font-size: 10px !important;\n  }\n\n  /* Button hover effect */\n  .drawing-item .btn:hover {\n      transform: translateY(-1px);\n      box-shadow: 0 2px 4px rgba(0,0,0,0.1);\n      z-index: 1;\n  }\n\n  /* Ensure button action happens on click */\n  .drawing-item .btn:active {\n      transform: translateY(1px);\n      box-shadow: 0 1px 1px rgba(0,0,0,0.1);\n  }\n\n  /* Button colors */\n  .drawing-item .btn-danger {\n      background-color: #f8d7da;\n      border-color: #f5c6cb;\n      color: #721c24;\n  }\n\n  .drawing-item .btn-danger:hover {\n      background-color: #f1c1c7;\n      border-color: #efb0b9;\n  }\n\n  /* Extra compact styling for wider screens - allow to fit 4 buttons */\n  @media (min-width: 651px) {\n      .drawing-item .button-container {\n          gap: 3px !important;\n      }\n  \n      .drawing-item .btn {\n          min-width: 70px !important;\n          padding: 4px 6px !important;\n          font-size: 12px !important;\n      }\n  \n      .drawing-item .btn i {\n          margin-right: 3px !important;\n          font-size: 11px !important;\n      }\n  }\n\n  /* ======= TEXT STYLE EDITOR IMPROVEMENTS ======= */\n\n  /* Text editor container */\n  .text-editor {\n      padding: 12px;\n      border-radius: 6px;\n      background-color: #f9f9f9 !important;\n      border: 1px solid #e0e0e0;\n      margin-top: 8px;\n      box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);\n      width: 100%;\n      overflow: hidden;\n  }\n\n  /* Form groups within text editor */\n  .text-editor .form-group {\n      margin-bottom: 12px;\n      padding-bottom: 12px;\n      border-bottom: 1px solid rgba(0,0,0,0.05);\n  }\n\n  .text-editor .form-group:last-child {\n      margin-bottom: 0;\n      padding-bottom: 0;\n      border-bottom: none;\n  }\n\n  /* Form controls */\n  .text-editor input,\n  .text-editor select,\n  .text-editor .form-control {\n      max-width: 100%;\n      width: 100%;\n  }\n\n  .text-editor input[type="text"],\n  .text-editor input[type="number"] {\n      text-overflow: ellipsis;\n  }\n\n  /* Form labels */\n  .text-editor label {\n      white-space: nowrap;\n      overflow: hidden;\n      text-overflow: ellipsis;\n      max-width: 100%;\n      font-size: 12px;\n      margin-bottom: 4px;\n  }\n\n  /* Color picker and number inputs */\n  .text-editor input[type="color"] {\n      height: 32px;\n      width: 32px;\n      padding: 0;\n      min-width: 32px;\n  }\n\n  .text-editor input[type="number"] {\n      max-width: 80px;\n  }\n\n  /* Range sliders */\n  .text-editor input[type="range"] {\n      height: 6px;\n      background: #e0e0e0;\n      border-radius: 3px;\n      width: 100%;\n  }\n\n  /* Text style button controls */\n  .text-editor .text-style-btn {\n      min-width: 40px !important;\n      height: 40px !important;\n      display: flex !important;\n      align-items: center !important;\n      justify-content: center !important;\n      position: relative !important;\n      margin: 0 2px;\n  }\n\n  /* Active buttons style */\n  .text-editor .btn-primary.text-style-btn::after {\n      content: \'\';\n      position: absolute;\n      bottom: 3px;\n      left: 30%;\n      width: 40%;\n      height: 2px;\n      background-color: white;\n  }\n\n  /* ALIGNMENT BUTTON IMPROVEMENTS */\n  .text-alignment-btn {\n      min-width: 0 !important; \n      flex: 1 !important;\n      display: flex !important;\n      flex-direction: column !important;\n      align-items: center !important;\n      padding: 6px 4px !important;\n      margin: 0 2px !important;\n      overflow: hidden !important;\n  }\n\n  .text-alignment-btn .alignment-label {\n      font-size: 12px !important;\n      font-weight: normal !important;\n      margin-bottom: 2px !important;\n      white-space: nowrap !important;\n      overflow: hidden !important;\n      text-overflow: ellipsis !important;\n      width: 100% !important;\n      text-align: center !important;\n  }\n\n  .text-alignment-btn .alignment-icon {\n      font-size: 8px !important;\n      opacity: 0.8 !important;\n  }\n\n  .text-alignment-btn.active .alignment-label {\n      font-weight: bold !important;\n  }\n\n  /* Horizontal alignment specific styles */\n  .horizontal-alignment-controls {\n      display: flex !important;\n      justify-content: space-between !important;\n      margin-bottom: 12px !important;\n      width: 100% !important;\n  }\n\n  .horizontal-alignment-controls .btn-group {\n      width: 100% !important;\n      display: flex !important;\n      gap: 2% !important;\n  }\n\n  /* Vertical alignment specific styles */\n  .vertical-alignment-controls {\n      display: flex !important;\n      justify-content: space-between !important;\n      margin-bottom: 12px !important;\n      width: 100% !important;\n  }\n\n  .vertical-alignment-controls .btn-group {\n      width: 100% !important;\n      display: flex !important;\n      gap: 2% !important;\n  }\n\n  /* Alignment buttons */\n  .btn-sm.alignment-button {\n      flex: 1 !important;\n      min-width: 0 !important;\n      overflow: hidden !important;\n      text-overflow: ellipsis !important;\n      white-space: nowrap !important;\n      font-size: 12px !important;\n      padding: 4px 2px !important;\n  }\n\n  /* Improved visual indicators for alignment states */\n  .alignment-label-container {\n      display: flex !important;\n      flex-direction: column !important;\n      align-items: center !important;\n  }\n\n  /* Button group improvements */\n  .alignment-btn-group {\n      display: flex !important;\n      width: 100% !important;\n      justify-content: space-between !important;\n      gap: 2% !important;\n  }\n\n  /* Apply button styling */\n  .text-editor .btn-primary {\n      width: 100%;\n      margin-top: 12px;\n      font-weight: bold;\n  }\n\n/* ======= IMPROVED RESPONSIVE TOOLBAR STYLING ======= */\n\n/* Enhanced responsive toolbar styling */\n.my-drawings-panel .top-controls {\n    display: flex !important;\n    flex-direction: column !important;\n    padding: 8px 8px !important;\n    border-bottom: 1px solid #e0e0e0 !important;\n    background-color: #fff !important;\n    gap: 6px !important;\n    margin-bottom: 8px !important;\n}\n\n/* First line container with sort, select all, and delete all */\n.my-drawings-panel .toolbar-first-line {\n    display: flex !important;\n    flex-wrap: wrap !important;\n    align-items: center !important;\n    gap: 6px !important;\n    width: 100% !important;\n    margin-bottom: 6px !important;\n}\n\n/* Sort dropdown container - flexible width */\n.my-drawings-panel .sort-wrapper {\n    display: flex !important;\n    align-items: center !important;\n    gap: 6px !important;\n    flex: 1 1 auto !important;\n    min-width: 150px !important;\n}\n\n.my-drawings-panel .sort-label {\n    font-size: 12px !important;\n    margin: 0 !important;\n    white-space: nowrap !important;\n    color: #555 !important;\n    flex-shrink: 0 !important;\n}\n\n.my-drawings-panel .sort-select {\n    font-size: 12px !important;\n    height: 28px !important;\n    min-width: 80px !important;\n    padding: 2px 6px !important;\n    border-radius: 4px !important;\n    border: 1px solid #ccc !important;\n    flex: 1 1 auto !important;\n}\n\n/* Override Bootstrap\'s form-control padding */\n.my-drawings-panel .form-control-sm.sort-select {\n    padding: 2px 6px !important;\n    height: 28px !important;\n}\n\n/* Select All button styling - CENTERED TEXT */\n.my-drawings-panel .select-all-btn {\n    display: flex !important;\n    align-items: center !important;\n    justify-content: center !important;\n    text-align: center !important;\n    gap: 4px !important;\n    padding: 5px 8px !important;\n    font-size: 12px !important;\n    white-space: nowrap !important;\n    transition: all 0.15s ease !important;\n    box-shadow: 0 1px 2px rgba(0,0,0,0.05) !important;\n    flex: 0 0 auto !important;\n    min-width: fit-content !important;\n}\n\n.my-drawings-panel .select-all-btn i {\n    margin-right: 4px !important;\n    font-size: 12px !important;\n    flex-shrink: 0 !important;\n}\n\n.my-drawings-panel .select-all-btn:hover:not(:disabled) {\n    transform: translateY(-1px);\n    box-shadow: 0 2px 4px rgba(0,0,0,0.15) !important;\n}\n\n.my-drawings-panel .select-all-btn:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n}\n\n/* When all items are selected, make it primary (blue) */\n.my-drawings-panel .select-all-btn.btn-primary {\n    background-color: #007bff !important;\n    border-color: #007bff !important;\n    color: white !important;\n}\n\n.my-drawings-panel .select-all-btn.btn-primary:hover:not(:disabled) {\n    background-color: #0056b3 !important;\n    border-color: #0056b3 !important;\n}\n\n/* Delete All button styling - CENTERED TEXT */\n.my-drawings-panel .delete-all-btn {\n    display: flex !important;\n    align-items: center !important;\n    justify-content: center !important;\n    text-align: center !important;\n    gap: 4px !important;\n    padding: 5px 8px !important;\n    font-size: 12px !important;\n    white-space: nowrap !important;\n    transition: all 0.15s ease !important;\n    box-shadow: 0 1px 2px rgba(0,0,0,0.05) !important;\n    flex: 0 0 auto !important;\n    min-width: fit-content !important;\n}\n\n.my-drawings-panel .delete-all-btn i {\n    margin-right: 4px !important;\n    font-size: 12px !important;\n    flex-shrink: 0 !important;\n}\n\n.my-drawings-panel .delete-all-btn:hover:not(:disabled) {\n    transform: translateY(-1px);\n    box-shadow: 0 2px 4px rgba(220, 53, 69, 0.3) !important;\n}\n\n.my-drawings-panel .delete-all-btn:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n}\n\n/* Second line: Action buttons - EQUAL WIDTH & CENTERED */\n.my-drawings-panel .action-buttons-wrapper {\n    display: flex !important;\n    flex-wrap: wrap !important;\n    gap: 6px !important;\n    width: 100% !important;\n}\n\n/* Action button styling - EQUAL WIDTH and CENTERED TEXT */\n.my-drawings-panel .action-btn {\n    flex: 1 1 calc(25% - 5px) !important;\n    min-width: 90px !important;\n    padding: 5px 8px !important;\n    font-size: 12px !important;\n    white-space: nowrap !important;\n    overflow: hidden !important;\n    text-overflow: ellipsis !important;\n    display: flex !important;\n    align-items: center !important;\n    justify-content: center !important;\n    text-align: center !important;\n    transition: all 0.15s ease !important;\n    box-shadow: 0 1px 2px rgba(0,0,0,0.05) !important;\n}\n\n.my-drawings-panel .action-btn i {\n    margin-right: 4px !important;\n    font-size: 12px !important;\n    flex-shrink: 0 !important;\n}\n\n/* Responsive behavior for extremely narrow screens */\n@media (max-width: 350px) {\n    .drawing-item .button-container {\n        flex-direction: column !important;\n    }\n\n    .drawing-item .btn {\n        width: 100% !important;\n        margin-bottom: 4px !important;\n    }\n\n    .text-editor .d-flex {\n        flex-wrap: wrap;\n    }\n\n    .my-drawings-panel .toolbar-first-line {\n        flex-direction: column !important;\n        align-items: stretch !important;\n        gap: 8px !important;\n    }\n\n    .my-drawings-panel .sort-wrapper,\n    .my-drawings-panel .select-all-btn,\n    .my-drawings-panel .delete-all-btn {\n        width: 100% !important;\n        flex: 1 1 100% !important;\n    }\n\n    .my-drawings-panel .select-all-btn,\n    .my-drawings-panel .delete-all-btn {\n        justify-content: center !important;\n    }\n\n    .my-drawings-panel .sort-select {\n        flex-grow: 1 !important;\n        width: 100% !important;\n    }\n\n    /* Stack action buttons vertically - FULL WIDTH */\n    .my-drawings-panel .action-buttons-wrapper {\n        display: flex !important;\n        flex-direction: column !important;\n        gap: 6px !important;\n    }\n\n    .my-drawings-panel .action-btn {\n        width: 100% !important;\n        flex: 1 1 100% !important;\n        min-width: 100% !important;\n        justify-content: center !important;\n    }\n}\n\n/* Responsive behavior for narrow screens - 2 BUTTONS PER ROW */\n@media (min-width: 351px) and (max-width: 500px) {\n    .drawing-item .button-container {\n        gap: 2px !important;\n    }\n\n    .drawing-item .btn {\n        padding: 3px 2px !important;\n        font-size: 10px !important;\n        min-width: 50px !important;\n    }\n\n    .drawing-item .btn i {\n        margin-right: 2px !important;\n        font-size: 9px !important;\n    }\n\n    .my-drawings-panel .sort-wrapper {\n        flex: 1 1 100% !important;\n        min-width: 100% !important;\n    }\n\n    .my-drawings-panel .select-all-btn,\n    .my-drawings-panel .delete-all-btn {\n        flex: 1 1 calc(50% - 3px) !important;\n    }\n\n    /* 2 EQUAL-WIDTH action buttons per row */\n    .my-drawings-panel .action-btn {\n        flex: 1 1 calc(50% - 3px) !important;\n        min-width: calc(50% - 3px) !important;\n        padding: 5px 6px !important;\n        font-size: 11px !important;\n        justify-content: center !important;\n    }\n\n    .my-drawings-panel .action-btn i {\n        margin-right: 3px !important;\n        font-size: 10px !important;\n    }\n}\n\n/* Medium screens - 2 BUTTONS PER ROW expanding to 4 */\n@media (min-width: 501px) and (max-width: 650px) {\n    .drawing-item .button-container {\n        gap: 2px !important;\n    }\n\n    .drawing-item .btn {\n        padding: 4px 3px !important;\n        font-size: 11px !important;\n        min-width: 60px !important;\n    }\n\n    .drawing-item .btn i {\n        margin-right: 2px !important;\n    }\n\n    .my-drawings-panel .sort-wrapper {\n        min-width: 140px !important;\n    }\n\n    /* 2-4 EQUAL-WIDTH buttons per row */\n    .my-drawings-panel .action-btn {\n        flex: 1 1 calc(50% - 3px) !important;\n        min-width: 110px !important;\n        padding: 5px 7px !important;\n        font-size: 11px !important;\n        justify-content: center !important;\n    }\n}\n\n/* Large screens - 4 EQUAL-WIDTH BUTTONS IN ONE ROW */\n@media (min-width: 651px) {\n    .drawing-item .button-container {\n        gap: 3px !important;\n    }\n\n    .drawing-item .btn {\n        min-width: 70px !important;\n        padding: 4px 6px !important;\n        font-size: 12px !important;\n    }\n\n    .drawing-item .btn i {\n        margin-right: 3px !important;\n        font-size: 11px !important;\n    }\n\n    .my-drawings-panel .sort-wrapper {\n        min-width: 150px !important;\n        flex: 1 1 auto !important;\n        max-width: 300px !important;\n    }\n\n    /* 4 EQUAL-WIDTH buttons in one row */\n    .my-drawings-panel .action-btn {\n        flex: 1 1 calc(25% - 5px) !important;\n        min-width: 0 !important;\n        padding: 5px 8px !important;\n        font-size: 12px !important;\n        justify-content: center !important;\n    }\n\n    .my-drawings-panel .action-btn i {\n        margin-right: 4px !important;\n        font-size: 11px !important;\n    }\n}\n\n  /* ======= SCROLLBAR STYLING ======= */\n\n  /* Firefox scrollbar */\n  .px-3 {\n      scrollbar-width: thin;\n      scrollbar-color: rgba(0,0,0,0.2) transparent;\n  }\n\n  /* Chrome/Safari scrollbar */\n  .px-3::-webkit-scrollbar {\n      width: 6px;\n  }\n\n  .px-3::-webkit-scrollbar-track {\n      background: transparent;\n  }\n\n  .px-3::-webkit-scrollbar-thumb {\n      background-color: rgba(0,0,0,0.2);\n      border-radius: 3px;\n  }\n\n  /* Prevent text overflow in all text elements */\n  .text-truncate {\n      white-space: nowrap;\n      overflow: hidden;\n      text-overflow: ellipsis;\n      max-width: 100%;\n  }\n'}}))}}We._drawingsLoadChoiceTimestamp=0;var Fe=k(1252),He=k(5633),Qe=k(3321),Ye=function(e,t,i,r){return new(i||(i=Promise))((function(n,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,s)}l((r=r.apply(e,t||[])).next())}))};const Ze=e=>{const[i,n]=t.React.useState(!1),[o,a]=t.React.useState(0),[s,l]=t.React.useState(null),[c,u]=t.React.useState(!1),d=t.React.useRef(new Set),h=(e,t,i)=>{if(!d.current.has(i))try{const r=new Fe.default({layer:e,enabled:!0});t.push(r),d.current.add(i)}catch(e){console.warn(`Failed to add snapping source for ${i}: ${e.message}`)}},m=(e,t,...i)=>Ye(void 0,[e,t,...i],void 0,(function*(e,t,i=0){if(!e||i>10||!e.visible)return;const r=e.id||e.url||`${e.title}-${i}`;if((e=>{var t;return!!(null==e?void 0:e.visible)&&["feature","graphics","csv","geojson","wfs"].includes((null===(t=null==e?void 0:e.type)||void 0===t?void 0:t.toLowerCase())||"")})(e)&&h(e,t,r),(null==e?void 0:e.url)&&"sublayer"===(null==e?void 0:e.type)&&"Feature Layer"===(null==e?void 0:e.layerType)){const i=`url:${e.url}`;if(!d.current.has(i))try{const r=new He.default({url:e.url,visible:!0,outFields:["*"]});yield r.load(),h(r,t,i)}catch(t){console.warn(`\u274c Could not load feature layer from URL ${e.url}: ${t.message}`)}}const n=[e.sublayers,e.allSublayers,e.layers,e.subLayers,e.layerInfos];for(const e of n)if(null==e?void 0:e.items)for(const r of e.items)yield m(r,t,i+1);else if(Array.isArray(e))for(const r of e)yield m(r,t,i+1)}));return t.React.useEffect((()=>{var t,r;i&&(null===(t=e.jimuMapView)||void 0===t?void 0:t.view)&&e.sketchViewModel&&Ye(void 0,void 0,void 0,(function*(){var t;u(!0),l(null),d.current.clear();const i=null===(t=e.jimuMapView)||void 0===t?void 0:t.view,r=e.sketchViewModel;if(!i)return l("Map view is not available."),void u(!1);if(!r)return l("SketchViewModel is not available."),void u(!1);try{const e=[],t=i.map.allLayers.toArray();yield Promise.all(t.filter((e=>e.load&&!e.loaded)).map((e=>e.load().catch((()=>{})))));for(const i of t)yield m(i,e);const n={enabled:!0,featureEnabled:!0,selfEnabled:!0,distance:15,featureSources:new Qe.default(e)};r.snappingOptions=n,i.snappingOptions=n,a(e.length),0===e.length&&l("No visible snappable layers found.")}catch(e){console.error("Error configuring snapping:",e),l(`Snapping failed: ${e.message}`)}finally{u(!1)}})),!i&&(null===(r=e.jimuMapView)||void 0===r?void 0:r.view)&&e.sketchViewModel&&(e.sketchViewModel.snappingOptions.enabled=!1)}),[i,e.jimuMapView,e.sketchViewModel]),t.React.createElement("div",{className:"drawToolbarDiv"},t.React.createElement(r.CollapsableCheckbox,{label:i?"Disable Snapping":"Enable Snapping",checked:i,onCheckedChange:()=>{n(!i)},disableActionForUnchecked:!0,openForCheck:!0,closeForUncheck:!0,className:"w-100"},t.React.createElement("div",{className:"ml-3 my-1"},t.React.createElement("ul",{className:"text-dark m-0 pl-3 small"},t.React.createElement("li",null,"Hold ",t.React.createElement("strong",null,"Ctrl")," (Windows) or ",t.React.createElement("strong",null,"Cmd")," (Mac) to temporarily disable snapping."),t.React.createElement("li",null,"Snap to feature vertices, edges, and intersections while drawing.")),c&&t.React.createElement("p",{className:"text-info my-1"},"Configuring snapping..."),s&&t.React.createElement(r.Alert,{type:"warning",className:"mt-2",withIcon:!0,text:s,closable:!0}))))};var Je=k(9298),$e=function(e,t,i,r){return new(i||(i=Promise))((function(n,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,s)}l((r=r.apply(e,t||[])).next())}))};const qe=({jimuMapView:e,sketchViewModel:t})=>{const[n,o]=(0,i.useState)(!1),[a,s]=(0,i.useState)(100),[l,c]=(0,i.useState)("feet"),[u,d]=(0,i.useState)(75),h=(0,i.useRef)(new Map),m=(0,i.useCallback)((e=>{try{const t=Object.assign({enabled:n,distance:a,unit:l,opacity:u},e);localStorage.setItem("bufferControlSettings",JSON.stringify(t))}catch(e){}}),[n,a,l,u]),p=(0,i.useCallback)((()=>{try{const e=localStorage.getItem("bufferControlSettings");if(!e)return;const t=JSON.parse(e);"number"==typeof t.distance&&s(t.distance),"string"==typeof t.unit&&c(t.unit),"number"==typeof t.opacity&&d(t.opacity)}catch(e){}}),[]);(0,i.useEffect)((()=>{p()}),[p]),(0,i.useEffect)((()=>{m()}),[n,m]),(0,i.useEffect)((()=>()=>{h.current.forEach((e=>{try{e.remove()}catch(e){}})),h.current.clear()}),[]);const g=(0,i.useCallback)((()=>{const t=null==e?void 0:e.view;return t?t.map.findLayerById("DrawGL"):null}),[e]),f=e=>{var t,i,r,n;if(!e)return[0,0,0,1];if(Array.isArray(e))return e.length>=3?e:[0,0,0,1];if("object"==typeof e){if("r"in e&&"g"in e&&"b"in e)return[null!==(t=e.r)&&void 0!==t?t:0,null!==(i=e.g)&&void 0!==i?i:0,null!==(r=e.b)&&void 0!==r?r:0,null!==(n=e.a)&&void 0!==n?n:1];if("function"==typeof e.toRgba)try{return e.toRgba()}catch(e){return[0,0,0,1]}}return[0,0,0,1]},y=(0,i.useCallback)((()=>{var e,i,r;return(null!==(r=null===(i=null===(e=null==t?void 0:t.updateGraphics)||void 0===e?void 0:e.toArray)||void 0===i?void 0:i.call(e))&&void 0!==r?r:[]).filter((e=>{var t,i;const r=e.attributes||{};return!(r.isBuffer||r.isMeasurementLabel||r.hideFromList)&&("point"!==(null===(t=e.geometry)||void 0===t?void 0:t.type)||"text"!==(null===(i=e.symbol)||void 0===i?void 0:i.type)||!r.isMeasurementLabel)}))}),[t]),v=(t,i,r)=>$e(void 0,void 0,void 0,(function*(){var n,o,a;try{const s=null==e?void 0:e.view;if(!s)return null;const l=yield Ce.default,c=r,u=(null===(n=s.spatialReference)||void 0===n?void 0:n.isGeographic)||(null===(o=s.spatialReference)||void 0===o?void 0:o.isWebMercator)?yield l.geodesicBuffer(t,i,c):yield l.buffer(t,i,c,!0);return u?Array.isArray(u)?null!==(a=u[0])&&void 0!==a?a:null:u:null}catch(e){return console.error("Buffer geometry error",e),null}})),w=e=>{var t,i,r,n,o,a,s,l,c,d,h,m,p,g,y;const v=(null!==(i=null===(t=e.bufferSettings)||void 0===t?void 0:t.opacity)&&void 0!==i?i:u)/100,w=null===(r=e.geometry)||void 0===r?void 0:r.type;let b=new O.default([0,122,194,.3*v]),x=new O.default([0,122,194,1*v]),M=2.5;try{if("polygon"===w&&"simple-fill"===(null===(n=e.symbol)||void 0===n?void 0:n.type)){const t=e.symbol,i=f(t.color);if(b=new O.default([i[0],i[1],i[2],(null!==(o=i[3])&&void 0!==o?o:1)*v]),null===(a=t.outline)||void 0===a?void 0:a.color){const e=f(t.outline.color);x=new O.default([e[0],e[1],e[2],(null!==(s=e[3])&&void 0!==s?s:1)*v])}(null===(l=t.outline)||void 0===l?void 0:l.width)&&(M=Math.max(1.2*t.outline.width,2))}else if("polyline"===w&&"simple-line"===(null===(c=e.symbol)||void 0===c?void 0:c.type)){const t=e.symbol,i=f(t.color);b=new O.default([i[0],i[1],i[2],.6*(null!==(d=i[3])&&void 0!==d?d:1)*v]),x=new O.default([i[0],i[1],i[2],(null!==(h=i[3])&&void 0!==h?h:1)*v]),t.width&&(M=Math.max(1.2*t.width,2))}else if("point"===w&&"simple-marker"===(null===(m=e.symbol)||void 0===m?void 0:m.type)){const t=e.symbol,i=f(t.color);b=new O.default([i[0],i[1],i[2],.6*(null!==(p=i[3])&&void 0!==p?p:1)*v]),x=new O.default([i[0],i[1],i[2],(null!==(g=i[3])&&void 0!==g?g:1)*v]),(null===(y=t.outline)||void 0===y?void 0:y.width)&&(M=Math.max(1.2*t.outline.width,2.5))}}catch(e){}return new Le.default({color:b,outline:new Me.default({color:x,width:M,style:"dash"})})},b=e=>$e(void 0,void 0,void 0,(function*(){const t=g();if(t&&e.bufferGraphic&&e.bufferSettings)try{const i=yield v(e.geometry,e.bufferSettings.distance,e.bufferSettings.unit);if(!i)return;const r=e.bufferGraphic;t.remove(r),r.geometry=i,r.symbol=w(e);const n=t.graphics.indexOf(e);n>=0?t.graphics.add(r,n):t.add(r)}catch(e){console.error("Update buffer error",e)}})),x=(e,t,i)=>$e(void 0,void 0,void 0,(function*(){var r,n,o,a;const s=g();if(!s)return;const l=null===(r=e.attributes)||void 0===r?void 0:r.uniqueId;if(!l)return;const c=e.attributes||{};if(c.isBuffer||c.isMeasurementLabel||c.hideFromList)return;if("point"===(null===(n=e.geometry)||void 0===n?void 0:n.type)&&"text"===(null===(o=e.symbol)||void 0===o?void 0:o.type))return;if(e.bufferGraphic){try{s.remove(e.bufferGraphic)}catch(e){}e.bufferGraphic=null}const d=yield v(e.geometry,t,i);if(!d)return;e.bufferSettings={distance:t,unit:i,enabled:!0,opacity:u};const m=new P.default({geometry:d,symbol:w(e),attributes:{uniqueId:`buffer_${l}_${Date.now()}`,name:`${null!==(a=c.name)&&void 0!==a?a:"Drawing"} Buffer`,parentId:l,isBuffer:!0,hideFromList:!0,isMeasurementLabel:!1,bufferDistance:t,bufferUnit:i}});m.isBufferDrawing=!0,m.sourceGraphicId=l,e.bufferGraphic=m;const p=s.graphics.indexOf(e);p>=0?s.graphics.add(m,p):s.add(m),(e=>{var t;const i=null===(t=e.attributes)||void 0===t?void 0:t.uniqueId;if(!i)return;const r=h.current.get(i);if(r)try{r.remove()}catch(e){}const n=e.watch("geometry",(()=>b(e)));h.current.set(i,n)})(e),window.dispatchEvent(new CustomEvent("saveDrawingsToStorage",{detail:{ts:Date.now()}}))})),M=()=>{window.dispatchEvent(new CustomEvent("saveDrawingsToStorage",{detail:{ts:Date.now()}}))};(0,i.useEffect)((()=>{if(!t)return;const e=t.on("create",(e=>{if("complete"===(null==e?void 0:e.state)&&n){const t=e.graphic;(null==t?void 0:t.geometry)&&setTimeout((()=>$e(void 0,void 0,void 0,(function*(){try{yield x(t,a,l),M()}catch(e){console.error("Auto buffer on create failed",e)}}))),100)}}));return()=>{try{e.remove()}catch(e){}}}),[t,n,a,l]);return i.default.createElement("div",{className:"drawToolbarDiv"},i.default.createElement(Je.CollapsableCheckbox,{className:"w-100",label:"Enable Buffer",checked:n,onCheckedChange:e=>o(e),disableActionForUnchecked:!0,openForCheck:!0,closeForUncheck:!0},i.default.createElement("div",{className:"ml-3 my-1"},i.default.createElement("div",{className:"d-flex align-items-center mb-2"},i.default.createElement(r.Label,{className:"mr-2 mb-0 d-flex align-items-center"},"Distance:"),i.default.createElement(r.NumericInput,{size:"sm",value:a,onChange:e=>{s(e),m({distance:e})},className:"mr-2",style:{width:"80px"},min:.1,step:.1}),i.default.createElement(r.Select,{size:"sm",value:l,onChange:e=>{const t=e.target.value;c(t),m({unit:t})},style:{width:"110px"}},i.default.createElement(r.Option,{value:"feet"},"Feet"),i.default.createElement(r.Option,{value:"meters"},"Meters"),i.default.createElement(r.Option,{value:"miles"},"Miles"),i.default.createElement(r.Option,{value:"kilometers"},"Kilometers"))),i.default.createElement("div",{className:"d-flex align-items-center mb-2"},i.default.createElement(r.Label,{className:"mr-2 mb-0 d-flex align-items-center"},"Opacity:"),i.default.createElement(r.NumericInput,{size:"sm",value:u,onChange:e=>{d(e),m({opacity:e})},className:"mr-2",style:{width:"80px"},min:1,max:100,step:1}),i.default.createElement("span",{className:"text-muted"},"%")),i.default.createElement("div",{className:"d-flex gap-2 mt-1"},i.default.createElement(r.Button,{size:"sm",onClick:()=>$e(void 0,void 0,void 0,(function*(){if(!n)return;const e=y();for(const t of e)t.bufferGraphic?(t.bufferSettings&&(t.bufferSettings.distance=a,t.bufferSettings.unit=l),yield b(t)):yield x(t,a,l);m({distance:a,unit:l})})),className:"flex-fill",style:{minWidth:0},title:"Update buffer geometry for selected graphics"},"Update Buffer"),i.default.createElement(r.Button,{size:"sm",onClick:()=>{if(!n)return;y().forEach((e=>{e.bufferSettings&&e.bufferGraphic&&(e.bufferSettings.opacity=u,e.bufferGraphic.symbol=w(e))})),m({opacity:u}),M()},className:"flex-fill",style:{minWidth:0},title:"Update buffer opacity for selected graphics"},"Update Graphic"),i.default.createElement(r.Button,{size:"sm",onClick:()=>{y().forEach((e=>(e=>{var t;const i=g();if(!i)return;const r=null===(t=e.attributes)||void 0===t?void 0:t.uniqueId;if(!r)return;if(e.bufferGraphic){try{i.remove(e.bufferGraphic)}catch(e){}e.bufferGraphic=null}e.bufferSettings=null;const n=h.current.get(r);if(n){try{n.remove()}catch(e){}h.current.delete(r)}})(e))),M()},className:"flex-fill",style:{minWidth:0},title:"Remove buffers from selected graphics"},"Remove Buffer")))))};var Xe=function(e,t,i,r){return new(i||(i=Promise))((function(n,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,s)}l((r=r.apply(e,t||[])).next())}))};const Ke=k(6869),et=k(1265),tt=k(1281),it=k(5799),rt=k(6698),nt=k(5407),ot=k(3180),at=k(4365),st=k(2715),lt=k(7701),ct=k(9234),ut=k(2558),dt=k(4809),ht=k(9768),mt=k(8148),pt=({children:e,className:r=""})=>{const n=(0,i.useRef)(null),[o,a]=(0,i.useState)(!1),[s,l]=(0,i.useState)(!1),c=()=>{if(!n.current)return;const{scrollTop:e,scrollHeight:t,clientHeight:i}=n.current;a(e>10),l(e+i<t-10)};return(0,i.useEffect)((()=>{const e=n.current;if(!e)return;c(),e.addEventListener("scroll",c);const t=new ResizeObserver((()=>{setTimeout(c,100)}));return t.observe(e),()=>{e.removeEventListener("scroll",c),t.disconnect()}}),[]),(0,t.jsx)("div",{className:"scrollable-container-wrapper"},(0,t.jsx)("div",{className:"scroll-shadow scroll-shadow-top "+(o?"visible":""),style:{position:"absolute",top:0,left:0,right:0,height:"8px",background:"linear-gradient(to bottom, rgba(0,0,0,0.1), transparent)",pointerEvents:"none",zIndex:5,opacity:o?1:0,transition:"opacity 0.3s ease"}}),(0,t.jsx)("div",{ref:n,className:`tab-content ${r}`,style:{flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0,position:"relative"}},e),(0,t.jsx)("div",{className:"scroll-shadow scroll-shadow-bottom "+(s?"visible":""),style:{position:"absolute",bottom:0,left:0,right:0,height:"8px",background:"linear-gradient(to top, rgba(0,0,0,0.1), transparent)",pointerEvents:"none",zIndex:5,opacity:s?1:0,transition:"opacity 0.3s ease"}}))};class gt extends t.React.PureComponent{renderSymbolSelectorSection(){const{currentSymbol:e,currentSymbolType:i,rotationMode:n}=this.state;return(0,t.jsx)("div",{className:"mb-2"},(0,t.jsx)("h6",{className:"drawToolbarDiv"},"Change symbol style:"),(0,t.jsx)("div",{className:"myss border",style:{width:"90%",margin:"0 auto"}},(0,t.jsx)(j.SymbolSelector,{symbol:e,jimuSymbolType:i,btnSize:"sm",onPopperToggle:this.onSymbolPopper,onPointSymbolChanged:this.onPointSymChanged,onPolygonSymbolChanged:this.onPolygonSymbolChanged,onPolylineSymbolChanged:this.onPolylineSymbolChanged,theme:this.props.theme})),n&&(0,t.jsx)("div",{className:"drawToolbarDiv"},(0,t.jsx)("h6",{className:"mt-2"},"Rotate Point Symbol:"),(0,t.jsx)("div",{className:"w-100 d-flex align-items-center"},(0,t.jsx)(r.NumericInput,{size:"sm",value:this.state.currentSymbol.angle,min:0,max:360,step:.1,onChange:e=>this.handlePointRotation(e),className:"mr-2 decimalInput"}),(0,t.jsx)("span",null,"0\xb0"),(0,t.jsx)(r.Slider,{value:this.state.currentSymbol.angle,min:0,max:360,step:.1,onChange:e=>this.handlePointRotation(e),className:"mx-2 flex-grow-1"}),(0,t.jsx)("span",null,"360\xb0"))),i===j.JimuSymbolType.Polyline&&this.renderArrowControls())}renderTextSymbolPreviewButton(){const{fontColor:e,fontSize:i,fontWeight:n,fontStyle:o,fontDecoration:a,fontRotation:s,fontHalo:l,currentTextSymbol:c}=this.state,u=c.backgroundColor?"string"==typeof c.backgroundColor?c.backgroundColor:`rgba(${c.backgroundColor.r}, ${c.backgroundColor.g}, ${c.backgroundColor.b}, ${c.backgroundColor.a})`:"transparent";return(0,t.jsx)("div",{className:"mb-2"},(0,t.jsx)("h6",{className:"drawToolbarDiv"},"Change text options:"),(0,t.jsx)("div",{className:"myss"},(0,t.jsx)("div",{className:"jimu-symbol-selector",style:{width:"90%",margin:"0 auto"}},(0,t.jsx)(r.Button,{size:"sm",type:"default",onClick:this.showTextSymbolPopper,id:this.props.widgetId+"_btnTextSymbol",style:{width:"100%",height:"36px",padding:"0",backgroundColor:u}},(0,t.jsx)("span",{className:"icon-btn-sizer"},(0,t.jsx)("div",{className:"justify-content-center align-items-center symbol-wapper outer-preview-btn d-flex"},(0,t.jsx)("div",{className:"w-100 h-100 justify-content-center d-flex align-items-center symbol-item text-symbol-item"},(0,t.jsx)("span",{className:"text-symbol-span",style:{color:e,fontSize:`${i}px`,fontWeight:n,fontStyle:o,fontFamily:c.font.family,textDecoration:a,zIndex:100,WebkitTransform:`rotate(${s}deg)`}},c.text),(0,t.jsx)("span",{style:{color:e,fontSize:`${i}px`,WebkitTextStroke:l,fontWeight:n,fontStyle:o,fontFamily:c.font.family,textDecoration:a,position:"absolute",WebkitTransform:`rotate(${s}deg)`}},c.text))))))))}renderArrowControls(){const{arrowEnabled:e,arrowPosition:i}=this.state;return(0,t.jsx)("div",{className:"arrow-controls mt-3"},(0,t.jsx)("div",{className:"d-flex align-items-center drawToolbarDiv"},(0,t.jsx)(r.Label,{centric:!0},"Enable Arrows",(0,t.jsx)(r.Switch,{className:"ml-2",checked:e,onChange:this.handleArrowToggle}))),e&&(0,t.jsx)("div",{className:"d-flex align-items-center mb-2 drawToolbarDiv"},(0,t.jsx)(r.Label,{centric:!0,className:"mb-0"},"Arrow Position:",(0,t.jsx)(r.AdvancedButtonGroup,{className:"ml-2"},(0,t.jsx)(r.Button,{className:"m-0",size:"sm",type:"start"===i?"primary":"secondary",active:"start"===i,onClick:()=>{this.setState({arrowPosition:"start"},(()=>{this.updateLineArrows()}))}},"Start"),(0,t.jsx)(r.Button,{className:"m-0",size:"sm",type:"end"===i?"primary":"secondary",active:"end"===i,onClick:()=>{this.setState({arrowPosition:"end"},(()=>{this.updateLineArrows()}))}},"End"),(0,t.jsx)(r.Button,{className:"m-0",size:"sm",type:"both"===i?"primary":"secondary",active:"both"===i,onClick:()=>{this.setState({arrowPosition:"both"},(()=>{this.updateLineArrows()}))}},"Both")))))}constructor(i){var n;super(i),this.textPreviewSpan=t.React.createRef(),this.drawLayer=null,this.Graphic=null,this.measureRef=t.React.createRef(),this._selectionEpoch=0,this._measurementWasEnabled=!1,this._measurementUpdateTimeout=null,this._activeMeasurementUpdateTimeout=null,this._positionWatchers={},this.handleTabChange=e=>{var t,i,r,n,o,a,s,l,c;if("mydrawings"===e){const e=this.snapshotDrawingsFromLayer();return null===(r=null===(i=null===(t=this.myDrawingsRef)||void 0===t?void 0:t.current)||void 0===i?void 0:i.ingestDrawings)||void 0===r||r.call(i,e),null===(a=null===(o=null===(n=this.measureRef)||void 0===n?void 0:n.current)||void 0===o?void 0:o.disableMeasurementEditing)||void 0===a||a.call(o),void this.setState({graphics:e,activeTab:"mydrawings"})}(null===(s=this.measureRef)||void 0===s?void 0:s.current)&&(null===(c=(l=this.measureRef.current).setMeasurementEnabled)||void 0===c||c.call(l,!1)),this.setDrawToolBtnState(""),this.setState({activeTab:e,measurementCheckboxOn:!1,pointBtnActive:!1,lineBtnActive:!1,flineBtnActive:!1,rectBtnActive:!1,polygonBtnActive:!1,fpolygonBtnActive:!1,circleBtnActive:!1,textBtnActive:!1,currentTool:""})},this.onMeasurementCheckboxChange=e=>{var t,i,r;this.setState({measurementCheckboxOn:e}),null===(r=null===(i=null===(t=this.measureRef)||void 0===t?void 0:t.current)||void 0===i?void 0:i.setMeasurementEnabled)||void 0===r||r.call(i,e)},this._savePositionTimeout=null,this.snapshotDrawingsFromLayer=()=>{if(!this.drawLayer||!this.drawLayer.graphics)return[];return this.drawLayer.graphics.toArray().filter((e=>{var t,i,r,n,o;return!(null===(t=null==e?void 0:e.attributes)||void 0===t?void 0:t.isMeasurementLabel)&&(!(null===(i=null==e?void 0:e.attributes)||void 0===i?void 0:i.isSelectionOverlay)&&(!((null===(r=null==e?void 0:e.attributes)||void 0===r?void 0:r.isPreviewBuffer)||(null===(n=null==e?void 0:e.attributes)||void 0===n?void 0:n.isBuffer)||(null===(o=null==e?void 0:e.attributes)||void 0===o?void 0:o.isBufferDrawing))&&!!(null==e?void 0:e.geometry)))}))},this.myDrawingsRef=t.React.createRef(),this._drawingMap=new Map,this.ensureBufferWatchersForSelectedGraphic=e=>{var t;if(e.bufferSettings&&e.bufferSettings.enabled&&e.bufferGraphic){const i=null===(t=e.attributes)||void 0===t?void 0:t.uniqueId;if(i){const t=i+"_widget_buffer",r=this._positionWatchers[t];r&&r.remove(),this._positionWatchers[t]=e.watch("geometry",(t=>Xe(this,void 0,void 0,(function*(){if(e.bufferGraphic&&e.bufferSettings)try{yield this.updateAttachedBuffer(e)}catch(e){console.error("\u274c Widget: Error updating buffer:",e)}}))))}}},this.ensurePointTextOverlayFromMap=e=>{var t,i,r,n;if(!e||!this.drawLayer)return;if(!e.geometry||"point"!==e.geometry.type)return;try{e.attributes||(e.attributes={}),e.attributes.uniqueId||(e.attributes.uniqueId=`auto_${Date.now()}_${Math.random().toString(36).slice(2,8)}`)}catch(e){console.warn("ensurePointTextOverlayFromMap: could not ensure uniqueId:",e)}try{const i=this.drawLayer.graphics.toArray();for(const r of i){if(r&&(null===(t=r.attributes)||void 0===t?void 0:t.isSelectionOverlay))try{this.drawLayer.remove(r)}catch(e){}if(r&&r._selectionOverlay&&r!==e){try{r._selectionOverlay.layer===this.drawLayer&&this.drawLayer.remove(r._selectionOverlay)}catch(e){}r._selectionOverlay=null}}}catch(e){console.warn("ensurePointTextOverlayFromMap: failed clearing prior overlays:",e)}if(e._selectionOverlay){try{e._selectionOverlay.layer===this.drawLayer&&this.drawLayer.remove(e._selectionOverlay)}catch(e){}e._selectionOverlay=null}const o="text"===(null===(i=e.symbol)||void 0===i?void 0:i.type),a=new me.default({style:o?"square":"circle",size:o?28:24,color:[255,128,0,.1],outline:{color:[255,128,0,1],width:2}}),s=new P.default({geometry:e.geometry,symbol:a,attributes:{hideFromList:!0,isMeasurementLabel:!1,isSelectionOverlay:!0,parentGraphicId:null!==(n=null===(r=e.attributes)||void 0===r?void 0:r.uniqueId)&&void 0!==n?n:null}});try{this.drawLayer.add(s),e._selectionOverlay=s;const t=()=>{try{this.drawLayer.remove(s)}catch(e){}this.drawLayer.add(s)};t(),setTimeout((()=>{try{e._selectionOverlay&&e._selectionOverlay.layer===this.drawLayer&&t()}catch(e){console.warn("Overlay bring-to-front next-tick failed:",e)}}),0);try{s.zIndex=99999}catch(e){}const i=this.drawLayer.graphics.toArray().filter((e=>{var t;return null===(t=e.attributes)||void 0===t?void 0:t.isSelectionOverlay}));i.length>1&&i.forEach((e=>{if(e!==s)try{this.drawLayer.remove(e)}catch(e){}}));const r=this.drawLayer.graphics.toArray().some((e=>{var t;return e===s||(null===(t=e.attributes)||void 0===t?void 0:t.isSelectionOverlay)}));console.log("\u{1f50d} Overlay present in layer:",r)}catch(e){console.error("\u274c Error creating overlay:",e)}},this.updateAttachedBuffer=e=>Xe(this,void 0,void 0,(function*(){if(this.drawLayer&&e.bufferGraphic&&e.bufferSettings)try{const{distance:t,unit:i,opacity:r}=e.bufferSettings,n=yield this.createBufferGeometry(e.geometry,t,i);if(n){const t=e.bufferGraphic,i=this.createBufferSymbolWithOpacity(e,r||50);t.symbol=i,this.drawLayer.remove(t),t.geometry=n;const o=this.drawLayer.graphics.indexOf(e);o>=0?this.drawLayer.graphics.add(t,o):this.drawLayer.add(t)}}catch(e){console.error("\u274c Widget: Error updating attached buffer:",e)}})),this.createBufferSymbolWithOpacity=(e,t)=>{var i,r,n,o;const a=null===(i=e.geometry)||void 0===i?void 0:i.type,s=e.symbol,l=t/100;let c=new O.default([0,0,0,.15*l]),u=new O.default([0,0,0,.6*l]),d=1.5;try{if("polygon"===a&&s){const e=s;if(null==e?void 0:e.color){const t=e.color.toRgba?e.color.toRgba():[0,0,0,1];c=new O.default([t[0],t[1],t[2],Math.min(t[3]*l,1)]),u=new O.default([t[0],t[1],t[2],Math.min(t[3]*l,1)])}if(null===(r=null==e?void 0:e.outline)||void 0===r?void 0:r.color){const t=e.outline.color.toRgba?e.outline.color.toRgba():[0,0,0,1];u=new O.default([t[0],t[1],t[2],Math.min(t[3]*l,1)]),(null===(n=e.outline)||void 0===n?void 0:n.width)&&(d=.8*e.outline.width)}}else if("polyline"===a&&s){const e=s;if(null==e?void 0:e.color){const t=e.color.toRgba?e.color.toRgba():[0,0,0,1];c=new O.default([t[0],t[1],t[2],Math.min(.6*t[3]*l,1)]),u=new O.default([t[0],t[1],t[2],Math.min(t[3]*l,1)]),e.width&&(d=.8*e.width)}}else if("point"===a&&s){const e=s;if(null==e?void 0:e.color){const t=e.color.toRgba?e.color.toRgba():[0,0,0,1];c=new O.default([t[0],t[1],t[2],Math.min(.6*t[3]*l,1)]),u=new O.default([t[0],t[1],t[2],Math.min(t[3]*l,1)]),(null===(o=e.outline)||void 0===o?void 0:o.width)&&(d=.8*e.outline.width)}}}catch(e){console.warn("Error processing colors:",e)}return new Le.default({color:c,outline:new Me.default({color:u,width:d,style:"dash"})})},this.createBufferGeometry=(e,t,i)=>Xe(this,void 0,void 0,(function*(){var r,n,o;try{const a=null===(r=this.state.currentJimuMapView)||void 0===r?void 0:r.view;if(!a)return null;const s=i;let l=null;const c=yield Promise.resolve().then(k.bind(k,7050));return l=(null===(n=a.spatialReference)||void 0===n?void 0:n.isGeographic)||(null===(o=a.spatialReference)||void 0===o?void 0:o.isWebMercator)?yield c.geodesicBuffer(e,t,s):yield c.buffer(e,t,s,!0),l?Array.isArray(l)?0===l.length?(console.warn("Widget: Buffer operation returned empty array"),null):l[0]:l:(console.warn("Widget: Buffer operation returned null"),null)}catch(e){return console.error("Widget: Error creating buffer geometry:",e),null}})),this.createLineSymbolWithBuiltInArrows=(e,t,i)=>{let r;switch(t){case"start":r="begin";break;case"end":r="end";break;case"both":r="begin-end";break;default:console.warn("Unknown arrow position:",t,"defaulting to end"),r="end"}return new Me.default({color:e.color,style:e.style,width:e.width,marker:{type:"line-marker",style:"arrow",placement:r,color:e.color}})},this.updateLineArrows=()=>{var e;if(!this.sketchViewModel||!this.sketchViewModel.view)return void console.warn("SketchViewModel not available for updateLineArrows");(null===(e=this.state.graphics)||void 0===e?void 0:e.length)>0&&this.state.graphics.forEach((e=>{var t,i;if("polyline"!==(null===(t=e.geometry)||void 0===t?void 0:t.type))return;let r;if("simple-line"===(null===(i=e.symbol)||void 0===i?void 0:i.type))r=e.symbol.clone(),delete r.marker;else{if(!this.sketchViewModel.polylineSymbol)return void console.warn("SketchViewModel polylineSymbol not available");r=this.sketchViewModel.polylineSymbol.clone(),delete r.marker}if(r&&"simple-line"===r.type)if(this.state.arrowEnabled)try{const t=this.createLineSymbolWithBuiltInArrows(r,this.state.arrowPosition,this.state.arrowSize);e.symbol=t}catch(e){console.warn("Error applying arrows to graphic:",e)}else e.symbol=r;else console.warn("Could not find valid base line symbol")}));const t=this.sketchViewModel.polylineSymbol;if(t&&"simple-line"===t.type)try{const e=new Me.default({color:t.color,width:t.width,style:t.style}),i=this.state.arrowEnabled?this.createLineSymbolWithBuiltInArrows(e,this.state.arrowPosition,this.state.arrowSize):e;this.sketchViewModel.polylineSymbol=i,this.setState({currentSymbol:i})}catch(e){console.warn("Error updating SketchViewModel polyline symbol:",e)}},this.handleArrowToggle=e=>{const t=e.target.checked;this.setState({arrowEnabled:t},(()=>{this.updateLineArrows()}))},this.invalidatePendingOverlays=()=>{this._selectionEpoch++},this.clearAllSelectionOverlays=()=>{if(this.drawLayer)try{this.drawLayer.graphics.toArray().forEach((e=>{if(e&&e._selectionOverlay){try{e._selectionOverlay.layer===this.drawLayer&&this.drawLayer.remove(e._selectionOverlay)}catch(e){}e._selectionOverlay=null}}))}catch(e){}},this.removeAttachedBuffer=e=>{var t;if(!this.drawLayer||!e)return;const i=null===(t=e.attributes)||void 0===t?void 0:t.uniqueId;if(!i)return;e.bufferGraphic&&(this.drawLayer.remove(e.bufferGraphic),e.bufferGraphic=null),e.bufferSettings&&(e.bufferSettings=null);const r=i+"_widget_buffer";if(this._positionWatchers&&this._positionWatchers[r])try{this._positionWatchers[r].remove(),delete this._positionWatchers[r]}catch(e){console.warn("Widget: Error removing buffer geometry watcher:",e)}},this.cleanupOrphanedBuffers=()=>{if(this.drawLayer)try{const e=this.drawLayer.graphics.toArray(),t=e.filter((e=>{var t,i,r;return(null===(t=e.attributes)||void 0===t?void 0:t.isPreviewBuffer)||(null===(i=e.attributes)||void 0===i?void 0:i.isBuffer)||(null===(r=e.attributes)||void 0===r?void 0:r.isBufferDrawing)})),i=e.filter((e=>{var t;return null===(t=e.attributes)||void 0===t?void 0:t.isMeasurementLabel})),r=e.filter((e=>{var t,i,r,n,o;return!((null===(t=e.attributes)||void 0===t?void 0:t.isPreviewBuffer)||(null===(i=e.attributes)||void 0===i?void 0:i.isBuffer)||(null===(r=e.attributes)||void 0===r?void 0:r.isMeasurementLabel)||(null===(n=e.attributes)||void 0===n?void 0:n.hideFromList)||(null===(o=e.attributes)||void 0===o?void 0:o.isBufferDrawing))})),n=new Set(r.map((e=>{var t;return null===(t=e.attributes)||void 0===t?void 0:t.uniqueId})).filter((e=>e))),o=t.filter((e=>{var t,i;const r=(null===(t=e.attributes)||void 0===t?void 0:t.parentId)||(null===(i=e.attributes)||void 0===i?void 0:i.sourceGraphicId);return!r||!n.has(r)})),a=i.filter((e=>{var t;const i=null===(t=e.attributes)||void 0===t?void 0:t.parentGraphicId;return!i||!n.has(i)}));o.length>0&&o.forEach((e=>{this.drawLayer.remove(e)})),a.length>0&&a.forEach((e=>{this.drawLayer.remove(e)})),o.length>0||a.length}catch(e){console.error("\u274c Widget: Error cleaning up orphaned graphics:",e)}},this.nls=e=>this.props.intl?this.props.intl.formatMessage({id:e,defaultMessage:T[e]}):e,this.handleSaveEvent=e=>{if(this.drawLayer){const e=this.drawLayer.graphics.toArray();this.handleDrawingsUpdate(e)}},this.activeViewChangeHandler=i=>{if(i)this.setState({currentJimuMapView:i}),i.whenJimuMapViewLoaded().then((()=>Xe(this,void 0,void 0,(function*(){const{map:r}=i.view,n=i.view;if(!n||n.destroyed)return void console.warn("View is not valid for SketchViewModel initialization");this.originalPopupEnabled=n.popupEnabled;const o=this.props.state,a=null!=o,s=this.state.pointBtnActive||this.state.lineBtnActive||this.state.flineBtnActive||this.state.rectBtnActive||this.state.polygonBtnActive||this.state.fpolygonBtnActive||this.state.circleBtnActive||this.state.textBtnActive;if((a&&o===t.WidgetState.Opened||s)&&(n.popupEnabled=!1,n.popup&&"autoCloseEnabled"in n.popup&&(n.popup.autoCloseEnabled=!1),n.popup.visible=!1,n.highlightOptions={color:[0,0,0,0],fillOpacity:0,haloOpacity:0}),n.map.layers.forEach((e=>{n.whenLayerView(e).then((i=>{try{if("feature"===e.type){const e=i;if("function"==typeof e.highlight){e.highlight([]).remove(),"highlightOptions"in e&&(a&&o===t.WidgetState.Opened||s)&&(e.highlightOptions={color:[0,0,0,0],fillOpacity:0,haloOpacity:0}),e.hasOwnProperty("_highlightIds")&&(e._highlightIds={})}}"featureEffect"in i&&(i.featureEffect=null),"filter"in i&&(i.filter=null),"function"==typeof i.refresh&&i.refresh()}catch(t){console.warn(`Error clearing highlight for layer ${e.title}:`,t)}})).catch((t=>console.warn(`Could not get layerView for ${e.title}:`,t)))})),this.state.widgetInit){this.creationMode=this.props.config.creationMode||e.SINGLE;const t=r.findLayerById("DrawGL");t?(this.drawLayer=t,this.drawLayer.graphics.length>0&&this.setState({drawGLLengthcheck:!0})):r.add(this.drawLayer)}if(this.drawLayer.graphics.watch("length",(e=>{this.setState({drawGLLengthcheck:e>0})})),this.sketchViewModel)try{this.sketchViewModel.cancel(),this.sketchViewModel.destroy()}catch(e){console.warn("Error cleaning up existing SketchViewModel:",e)}try{if(this.sketchViewModel=new E.default({view:n,updateOnGraphicClick:!1,layer:this.drawLayer,defaultUpdateOptions:{toggleToolOnClick:!1}}),this.sketchViewModel.updateOnGraphicClick=!1,!this.sketchViewModel.view)return void console.error("SketchViewModel created without valid view");yield new Promise((e=>{if("ready"===this.sketchViewModel.state)e();else{const t=this.sketchViewModel.watch("state",(i=>{"ready"===i&&(t.remove(),e())}))}})),this.sketchViewModel.on("create",this.svmGraCreate),this.sketchViewModel.on("update",this.svmGraUpdate)}catch(e){return void console.error("Error creating SketchViewModel:",e)}const l=()=>{if(this.drawLayer)try{this.drawLayer.graphics.toArray().forEach((e=>{if(e&&e._selectionOverlay){try{e._selectionOverlay.layer===this.drawLayer&&this.drawLayer.remove(e._selectionOverlay)}catch(e){}e._selectionOverlay=null}}))}catch(e){console.warn("clearAllSelectionOverlaysLocal failed:",e)}},c=e=>{var t,i,r;if(!e||!e.symbol)return!1;if(!0===(null===(t=e.attributes)||void 0===t?void 0:t.isMeasurementLabel))return!0;if(null===(i=e.attributes)||void 0===i?void 0:i.measurementType)return!0;if((null===(r=e.attributes)||void 0===r?void 0:r.hideFromList)&&"text"===e.symbol.type)return!0;if("text"===e.symbol.type){const t=e.symbol.text||"";return[/\d+(\.\d+)?\s*(km|mi|m|ft|yd|km\xb2|mi\xb2|ac|ha|m\xb2|ft\xb2|yd\xb2)/,/Area:|Perimeter:|Radius:|Total:|Lat:|Lon:|X:|Y:/].some((e=>e.test(t)))}return!1};n.on("immediate-click",(e=>Xe(this,void 0,void 0,(function*(){var t,i,r,o,a;try{if(!(null===(r=null===(i=null===(t=this.measureRef)||void 0===t?void 0:t.current)||void 0===i?void 0:i.isEditingMeasurements)||void 0===r?void 0:r.call(i)))return;if(this.state.pointBtnActive||this.state.lineBtnActive||this.state.flineBtnActive||this.state.rectBtnActive||this.state.polygonBtnActive||this.state.fpolygonBtnActive||this.state.circleBtnActive||this.state.textBtnActive)return;const s=(yield n.hitTest(e,{include:[this.drawLayer]})).results.find((e=>!!(e&&"graphic"in e&&e.graphic)&&c(e.graphic)));if(s)return void(null===(a=null===(o=this.measureRef.current)||void 0===o?void 0:o.handleMeasurementLabelSelection)||void 0===a||a.call(o,s.graphic))}catch(e){console.error("\u274c Error in immediate-click measurement handler:",e)}})))),n.on("click",(e=>Xe(this,void 0,void 0,(function*(){var t,i,r,o,a,s,u,d,h,m,p,g,f,y,v,w,b,x;try{if(!this.sketchViewModel||!this.sketchViewModel.view)return void console.warn("SketchViewModel not available for click handling");if(this.state.pointBtnActive||this.state.lineBtnActive||this.state.flineBtnActive||this.state.rectBtnActive||this.state.polygonBtnActive||this.state.fpolygonBtnActive||this.state.circleBtnActive||this.state.textBtnActive)return;if(null===(r=null===(i=null===(t=this.measureRef)||void 0===t?void 0:t.current)||void 0===i?void 0:i.isEditingMeasurements)||void 0===r?void 0:r.call(i)){const t=yield n.hitTest(e,{include:[this.drawLayer]});if(t.results.some((e=>!(!e||!("graphic"in e))&&c(e.graphic)))){const e=t.results.find((e=>!(!e||!("graphic"in e))&&c(e.graphic)));if(e)return void(null===(u=null===(s=this.measureRef.current)||void 0===s?void 0:s.handleMeasurementLabelSelection)||void 0===u||u.call(s,e.graphic))}else null===(a=null===(o=this.measureRef.current)||void 0===o?void 0:o.cleanupMeasurementLabelSelection)||void 0===a||a.call(o)}let M=yield n.hitTest(e,{include:[this.drawLayer]});if(0===M.results.length){const t=yield n.hitTest(e),i=null!==(p=null===(m=null===(h=null===(d=this.drawLayer)||void 0===d?void 0:d.graphics)||void 0===h?void 0:h.toArray)||void 0===m?void 0:m.call(h))&&void 0!==p?p:[],r=new Set(i.map((e=>{var t;return null===(t=e.attributes)||void 0===t?void 0:t.uniqueId})).filter(Boolean)),o=t.results.filter((e=>{var t,i,n,o,a;if(!e||!("graphic"in e)||!e.graphic)return!1;const s=e.graphic,l=s.layer===this.drawLayer||"DrawGL"===(null===(t=s.layer)||void 0===t?void 0:t.id)||(null===(i=s.layer)||void 0===i?void 0:i.id)===(null===(n=this.drawLayer)||void 0===n?void 0:n.id),c=!!(null===(o=s.attributes)||void 0===o?void 0:o.isSelectionOverlay),u=!!(null===(a=s.attributes)||void 0===a?void 0:a.uniqueId)&&r.has(s.attributes.uniqueId);return l||c||u}));o.length>0&&(M={results:o})}const L=M.results||[],S=[];for(const e of L){if(!e||!e.graphic)continue;const t=e.graphic;if((null===(g=t.attributes)||void 0===g?void 0:g.isSelectionOverlay)&&(null===(f=t.attributes)||void 0===f?void 0:f.parentGraphicId)){const i=t.attributes.parentGraphicId,r=null===(v=null===(y=this.drawLayer)||void 0===y?void 0:y.graphics)||void 0===v?void 0:v.find((e=>{var t;return(null===(t=e.attributes)||void 0===t?void 0:t.uniqueId)===i}));if(r){S.push(Object.assign(Object.assign({},e),{graphic:r}));continue}}S.push(e)}const C=S.filter((e=>{var t,i,r,n,o,a;if(!e||!e.graphic||e.graphic.layer!==this.drawLayer)return!1;const s=e.graphic;return!c(s)&&(!((null===(t=s.attributes)||void 0===t?void 0:t.isPreviewBuffer)||(null===(i=s.attributes)||void 0===i?void 0:i.isBuffer)||(null===(r=s.attributes)||void 0===r?void 0:r.isBufferDrawing)||(null===(o=null===(n=s.attributes)||void 0===n?void 0:n.uniqueId)||void 0===o?void 0:o.startsWith("buffer_")))&&!(null===(a=s.attributes)||void 0===a?void 0:a.isSelectionOverlay))}));if(C.length>0){const e=C[0].graphic;this._selectionEpoch++,l();const t=null===(w=e.attributes)||void 0===w?void 0:w.uniqueId,i=t&&(null===(b=this._drawingMap)||void 0===b?void 0:b.has(t))?this._drawingMap.get(t):-1;if(this.handleDrawingSelect(e,i),t&&(null===(x=this._drawingMap)||void 0===x?void 0:x.has(t))){const e=this._drawingMap.get(t);document.querySelectorAll(".drawing-item").forEach((e=>e.classList.remove("selected-drawing")));const i=document.getElementById(`drawing-item-${e}`);i&&(i.classList.add("selected-drawing"),i.scrollIntoView({behavior:"smooth",block:"nearest"})),this.setState({selectedGraphicIndex:e,selectedGraphics:new Set([e])})}}else{try{this.sketchViewModel&&this.sketchViewModel.view&&this.sketchViewModel.cancel()}catch(e){console.warn("Error canceling SketchViewModel:",e)}this._selectionEpoch++,l(),null!==this.state.selectedGraphicIndex&&(this.setState({selectedGraphicIndex:null,selectedGraphics:new Set}),document.querySelectorAll(".drawing-item").forEach((e=>e.classList.remove("selected-drawing"))))}}catch(e){console.error("\u274c Hit test error:",e)}})))),this.drawLayer.graphics.on("change",(e=>{e.removed&&e.removed.length>0&&setTimeout((()=>{this.cleanupOrphanedBuffers()}),100)}))})))).catch((e=>{console.error("\u274c Error in activeViewChangeHandler:",e)}));else{if(this.sketchViewModel){try{this.sketchViewModel.cancel(),this.sketchViewModel.destroy()}catch(e){console.warn("Error cleaning up SketchViewModel:",e)}this.sketchViewModel=null}this.setState({currentJimuMapView:null})}},this.handleMeasurementSystemControl=e=>{var t;if(null===(t=this.measureRef)||void 0===t?void 0:t.current)if(e)if(this.sketchViewModel&&this.sketchViewModel.view){this.state.pointBtnActive||this.state.lineBtnActive||this.state.flineBtnActive||this.state.rectBtnActive||this.state.polygonBtnActive||this.state.fpolygonBtnActive||this.state.circleBtnActive||this.state.textBtnActive||this.measureRef.current.enableMeasurements()}else console.warn("SketchViewModel not ready for measurements");else this.measureRef.current.disableMeasurements()},this.toggleDrawingsPanel=()=>{this.setState({showDrawingsPanel:!this.state.showDrawingsPanel})},this.clearSelectionOverlaysInDrawLayer=()=>{if(this.drawLayer)try{this.drawLayer.graphics.toArray().forEach((e=>{const t=e;if(t._selectionOverlay){try{this.drawLayer.remove(t._selectionOverlay)}catch(e){}t._selectionOverlay=null}}))}catch(e){console.warn("Error clearing selection overlays:",e)}},this.handleDrawingSelect=(e,t)=>{var i,r,n,o,a,s,l,c,u,d,h,m,p,g,f,y,v;if(!e)return;if(null===(i=e.attributes)||void 0===i?void 0:i.isBuffer)return;if(!this.sketchViewModel||!this.sketchViewModel.view)return void console.warn("SketchViewModel or view not ready for selection");try{e.attributes||(e.attributes={}),e.attributes.uniqueId||(e.attributes.uniqueId=`auto_${Date.now()}_${Math.random().toString(36).slice(2,8)}`)}catch(e){console.warn("Could not ensure uniqueId on graphic:",e)}try{this.sketchViewModel.cancel()}catch(e){return void console.warn("Error canceling sketch operation:",e)}const w=++this._selectionEpoch;try{this.drawLayer&&this.drawLayer.graphics.toArray().forEach((e=>{if(e&&e._selectionOverlay){try{e._selectionOverlay.layer===this.drawLayer&&this.drawLayer.remove(e._selectionOverlay)}catch(e){}e._selectionOverlay=null}}))}catch(e){console.warn("Failed clearing existing selection overlays:",e)}if("polyline"===(null===(r=e.geometry)||void 0===r?void 0:r.type)&&"simple-line"!==(null===(n=e.symbol)||void 0===n?void 0:n.type)){const t=(null===(o=e.symbol)||void 0===o?void 0:o.color)||[0,0,0,1],i=(null===(a=e.symbol)||void 0===a?void 0:a.width)||2,r=(null===(s=e.symbol)||void 0===s?void 0:s.style)||"solid";e.symbol=new Me.default({color:t,width:i,style:r})}try{if(!this.sketchViewModel.view)return void console.warn("SketchViewModel view became invalid during selection");this.sketchViewModel.update([e]),(null===(l=this.measureRef)||void 0===l?void 0:l.current)&&(this.sketchViewModel&&this.sketchViewModel.view?this.measureRef.current.isBusy&&this.measureRef.current.isBusy()?setTimeout((()=>{var t,i;(null===(t=this.measureRef)||void 0===t?void 0:t.current)&&(null===(i=this.sketchViewModel)||void 0===i?void 0:i.view)&&this.measureRef.current.updateMeasurementsForGraphic(e)}),500):this.measureRef.current.updateMeasurementsForGraphic(e):console.warn("SketchViewModel not ready for measurement update during selection")),(null===(d=null===(u=null===(c=this.measureRef)||void 0===c?void 0:c.current)||void 0===u?void 0:u.isEditingMeasurements)||void 0===d?void 0:d.call(u))&&setTimeout((()=>{var t,i;(null===(i=null===(t=this.measureRef)||void 0===t?void 0:t.current)||void 0===i?void 0:i.selectGraphicMeasurementLabel)&&this.measureRef.current.selectGraphicMeasurementLabel(e)}),100),this.ensureBufferWatchersForSelectedGraphic(e);const t="point"===(null===(h=e.geometry)||void 0===h?void 0:h.type),i=e;if(!t&&i._selectionOverlay){try{i._selectionOverlay.layer===this.drawLayer&&this.drawLayer.remove(i._selectionOverlay)}catch(e){}i._selectionOverlay=null}if(t){try{i._selectionOverlay&&(i._selectionOverlay.layer===this.drawLayer&&this.drawLayer.remove(i._selectionOverlay),i._selectionOverlay=null)}catch(e){console.warn("Overlay pre-clear on target failed:",e),i._selectionOverlay=null}setTimeout((()=>{w===this._selectionEpoch&&(this.ensurePointTextOverlayFromMap(i),setTimeout((()=>{if(w===this._selectionEpoch)if(i._selectionOverlay&&i._selectionOverlay.layer===this.drawLayer)try{i._selectionOverlay.geometry=i.geometry,this.drawLayer.remove(i._selectionOverlay),this.drawLayer.add(i._selectionOverlay)}catch(e){}else this.ensurePointTextOverlayFromMap(i)}),250))}),150)}const r=e.attributes&&e.attributes.uniqueId||`temp_${Date.now()}`;if(this._positionWatchers)try{this._positionWatchers[r]&&(null===(p=(m=this._positionWatchers[r]).remove)||void 0===p||p.call(m),delete this._positionWatchers[r]),this._positionWatchers[r+"_symbol"]&&(null===(f=(g=this._positionWatchers[r+"_symbol"]).remove)||void 0===f||f.call(g),delete this._positionWatchers[r+"_symbol"]),this._positionWatchers[r+"_attributes"]&&(null===(v=(y=this._positionWatchers[r+"_attributes"]).remove)||void 0===v||v.call(y),delete this._positionWatchers[r+"_attributes"])}catch(e){console.warn("Error clearing prior watchers:",e)}else this._positionWatchers={};this._positionWatchers[r]=e.watch("geometry",(()=>Xe(this,void 0,void 0,(function*(){var i,r;(null===(i=this.measureRef)||void 0===i?void 0:i.current)&&(null===(r=this.sketchViewModel)||void 0===r?void 0:r.view)&&(clearTimeout(this._measurementUpdateTimeout),this._measurementUpdateTimeout=setTimeout((()=>{var t,i;(null===(t=this.measureRef)||void 0===t?void 0:t.current)&&(null===(i=this.sketchViewModel)||void 0===i?void 0:i.view)&&this.measureRef.current.updateMeasurementsForGraphic(e)}),300));const n=e;if(n.bufferGraphic&&n.bufferSettings)try{yield this.updateAttachedBuffer(n)}catch(e){console.error("\u274c Widget: Error updating buffer:",e)}if(t&&e._selectionOverlay)try{e._selectionOverlay.geometry=e.geometry}catch(e){}})))),this._positionWatchers[r+"_symbol"]=e.watch("symbol",(()=>{var t,i,r;"point"===(null===(t=e.geometry)||void 0===t?void 0:t.type)&&(null===(i=this.measureRef)||void 0===i?void 0:i.current)&&(null===(r=this.sketchViewModel)||void 0===r?void 0:r.view)&&setTimeout((()=>{var t,i;(null===(t=this.measureRef)||void 0===t?void 0:t.current)&&(null===(i=this.sketchViewModel)||void 0===i?void 0:i.view)&&this.measureRef.current.updateMeasurementsForGraphic(e)}),100)})),this._positionWatchers[r+"_attributes"]=e.watch("attributes",(()=>{var t,i,r;"text"===(null===(t=e.symbol)||void 0===t?void 0:t.type)&&(null===(i=this.measureRef)||void 0===i?void 0:i.current)&&(null===(r=this.sketchViewModel)||void 0===r?void 0:r.view)&&setTimeout((()=>{var t,i;(null===(t=this.measureRef)||void 0===t?void 0:t.current)&&(null===(i=this.sketchViewModel)||void 0===i?void 0:i.view)&&this.measureRef.current.updateMeasurementsForGraphic(e)}),100)}))}catch(e){console.error("Error in handleDrawingSelect:",e)}},this.handleDrawingsUpdate=e=>{const t=e.filter((e=>{var t,i,r;return!(null===(t=e.attributes)||void 0===t?void 0:t.isBuffer)&&!(null===(i=e.attributes)||void 0===i?void 0:i.isMeasurementLabel)&&!(null===(r=e.attributes)||void 0===r?void 0:r.hideFromList)}));this.saveDrawingsToLocalStorage(t)},this.originalPopupEnabled=null,this.saveDrawingsToLocalStorage=e=>{try{const e=`${window.location.origin}${window.location.pathname}`,t=`drawings_${btoa(e).replace(/[^a-zA-Z0-9]/g,"_")}`,i=this.drawLayer.graphics.toArray(),r=i.filter((e=>{var t,i,r,n,o;return!((null===(t=e.attributes)||void 0===t?void 0:t.isMeasurementLabel)||(null===(i=e.attributes)||void 0===i?void 0:i.hideFromList)||(null===(r=e.attributes)||void 0===r?void 0:r.isPreviewBuffer)||(null===(n=e.attributes)||void 0===n?void 0:n.isBuffer)||(null===(o=e.attributes)||void 0===o?void 0:o.isBufferDrawing))})),n=i.filter((e=>{var t,i;return(null===(t=e.attributes)||void 0===t?void 0:t.isMeasurementLabel)&&!(null===(i=e.attributes)||void 0===i?void 0:i.isPreviewBuffer)})),o=r.map((e=>{const t=e,i=e.toJSON();if(i.attributes||(i.attributes={}),!i.attributes.uniqueId){const e=`saved_${Date.now()}_${Math.floor(1e4*Math.random())}`;i.attributes.uniqueId=e}return i.attributes.createdDate||(i.attributes.createdDate=Date.now()),t.bufferSettings&&(i.attributes.bufferSettings={distance:t.bufferSettings.distance,unit:t.bufferSettings.unit,enabled:t.bufferSettings.enabled}),i})),a=n.map((e=>{var t,i;const r=e,n=e.toJSON();return n.attributes||(n.attributes={}),(null===(i=null===(t=r.measureParent)||void 0===t?void 0:t.attributes)||void 0===i?void 0:i.uniqueId)&&(n.attributes.parentGraphicId=r.measureParent.attributes.uniqueId),n.attributes.isMeasurementLabel=!0,n.attributes.hideFromList=!0,n})),s={drawings:o,measurementLabels:a,version:"1.3"},l=JSON.stringify(s);localStorage.setItem(t,l)}catch(e){console.error("\u274c Error saving drawings to localStorage:",e)}},this.showAlert=(e,t)=>{alert(e)},this.svmGraCreate=e=>Xe(this,void 0,void 0,(function*(){var t,i,r,n,o,a;try{if(!e||!e.graphic)return;const s=e.graphic;if("active"===e.state){if(null===(t=this.measureRef)||void 0===t?void 0:t.current)try{yield this.measureRef.current.updateMeasurementsForGraphic(s)}catch(e){console.warn("Error updating live measurements:",e)}return}if("complete"!==e.state)return;if(s.attributes=s.attributes||{},s.attributes.uniqueId||(s.attributes.uniqueId=`g_${Date.now()}_${Math.random().toString(36).slice(2,8)}`),s.attributes.isDrawing=!0,s.attributes.hideFromList=!1,s.attributes.drawMode=this.state.currentTool,s.attributes.createdDate=Date.now(),s.attributes.name=`${this.state.currentTool} ${this.drawLayer.graphics.length+1}`,!1===s.visible&&(s.visible=!0),!(null===(r=null===(i=this.drawLayer.graphics)||void 0===i?void 0:i.includes)||void 0===r?void 0:r.call(i,s)))try{this.drawLayer.add(s)}catch(e){}const l=null===(n=this.sketchViewModel)||void 0===n?void 0:n.view;if(l&&"function"==typeof l.whenLayerView)try{yield l.whenLayerView(this.drawLayer)}catch(e){}if(yield new Promise((e=>requestAnimationFrame((()=>e(null))))),this.state.arrowEnabled&&"polyline"===(null===(o=s.geometry)||void 0===o?void 0:o.type)&&"simple-line"===(null===(a=s.symbol)||void 0===a?void 0:a.type))try{const e=s.symbol,t=this.createLineSymbolWithBuiltInArrows(e,this.state.arrowPosition,this.state.arrowSize);s.symbol=t}catch(e){console.warn("Error applying arrows on create:",e)}if("text"===this.state.currentTool)try{s.symbol=this.state.currentTextSymbol.clone()}catch(e){console.warn("Failed to apply currentTextSymbol:",e)}try{const e=this.drawLayer.graphics.toArray().filter((e=>{var t,i,r,n;return!(null===(t=e.attributes)||void 0===t?void 0:t.isBuffer)&&!(null===(i=e.attributes)||void 0===i?void 0:i.isMeasurementLabel)&&!0===(null===(r=e.attributes)||void 0===r?void 0:r.isDrawing)&&!0!==(null===(n=e.attributes)||void 0===n?void 0:n.hideFromList)})),t=Math.max(1,e.indexOf(s)+1);s.attributes.name=`${this.state.currentTool} ${t}`}catch(e){}if(setTimeout((()=>{var e;try{if(this._drawingMap&&(null===(e=s.attributes)||void 0===e?void 0:e.uniqueId)){const e=this.drawLayer.graphics.toArray().filter((e=>{var t,i,r,n;return!(null===(t=e.attributes)||void 0===t?void 0:t.isBuffer)&&!(null===(i=e.attributes)||void 0===i?void 0:i.isMeasurementLabel)&&!0===(null===(r=e.attributes)||void 0===r?void 0:r.isDrawing)&&!0!==(null===(n=e.attributes)||void 0===n?void 0:n.hideFromList)}));this._drawingMap.set(s.attributes.uniqueId,Math.max(0,e.indexOf(s)))}this.handleDrawingsUpdate(this.drawLayer.graphics.toArray())}catch(e){console.warn("Error saving drawings after create:",e)}}),100),"continuous"===this.creationMode)switch(this.state.currentTool){case"extent":this.sketchViewModel.create("rectangle");break;case"freepolyline":this.sketchViewModel.create("polyline",{mode:"freehand"});break;case"polyline":this.sketchViewModel.create("polyline");break;case"point":case"text":this.sketchViewModel.create("point");break;case"polygon":this.sketchViewModel.create("polygon");break;case"freepolygon":this.sketchViewModel.create("polygon",{mode:"freehand"});break;case"circle":this.sketchViewModel.create("circle")}else"single"===this.creationMode&&this.setDrawToolBtnState(null);requestAnimationFrame((()=>{try{"function"==typeof this.drawLayer.refresh&&this.drawLayer.refresh()}catch(e){}}))}catch(e){console.error("Error in svmGraCreate:",e)}})),this.svmGraUpdate=e=>{var t,i,r,n;try{if(!this.sketchViewModel||!this.sketchViewModel.view)return void console.warn("SketchViewModel view not available in update");if(this.setState({canUndo:this.sketchViewModel.canUndo(),canRedo:this.sketchViewModel.canRedo()}),"start"===e.state){if(e.graphics){const t=e.graphics.filter((e=>{var t,i,r,n,o,a,s,l,c,u;return!((null===(t=e.attributes)||void 0===t?void 0:t.isBuffer)||(null===(i=e.attributes)||void 0===i?void 0:i.isBufferDrawing)||(null===(r=e.attributes)||void 0===r?void 0:r.isPreviewBuffer)||(null===(o=null===(n=e.attributes)||void 0===n?void 0:n.uniqueId)||void 0===o?void 0:o.startsWith("buffer_")))&&(!(null===(a=e.attributes)||void 0===a?void 0:a.isMeasurementLabel)&&(!(null===(s=e.attributes)||void 0===s?void 0:s.hideFromList)&&("point"!==(null===(l=e.geometry)||void 0===l?void 0:l.type)||"text"!==(null===(c=e.symbol)||void 0===c?void 0:c.type)||!(null===(u=e.attributes)||void 0===u?void 0:u.isMeasurementLabel))))}));if(0===t.length){try{this.sketchViewModel&&this.sketchViewModel.view&&this.sketchViewModel.cancel()}catch(e){console.warn("Error canceling SketchViewModel in svmGraUpdate:",e)}return}t.forEach((e=>{try{this.ensureBufferWatchersForSelectedGraphic(e)}catch(e){console.warn("Error setting up buffer watcher:",e)}})),t.forEach((e=>{var i;try{if("point"===e.geometry.type&&"text"===e.symbol.type){const i=e.symbol.clone();let r={};r.vTextAlign=i.verticalAlignment,r.vAlignBaseBtnActive="baseline"===i.verticalAlignment,r.vAlignTopBtnActive="top"===i.verticalAlignment,r.vAlignMidBtnActive="middle"===i.verticalAlignment,r.vAlignBotBtnActive="bottom"===i.verticalAlignment,r.hTextAlign=i.horizontalAlignment,r.hAlignLeftBtnActive="left"===i.horizontalAlignment,r.hAlignCenterBtnActive="center"===i.horizontalAlignment,r.hAlignRightBtnActive="right"===i.horizontalAlignment,r.fontRotation=i.angle,r.showSymPreview=!1,r.showTextPreview=!0,r.currentSymbol=null,r.currentSymbolType=null,r.currentTextSymbol=i,r.graphics=t,r.clearBtnTitle=this.nls("drawClearSelected"),r.fontColor=this.convertSymbolColorToColorPickerValue(i.color),r.fontOpacity=i.color.a,r.fontSize=i.font.size,r.textSymPreviewText=i.text,r.fontHaloEnabled=null!==i.haloSize,i.haloColor?(r.fontHaloOpacity=i.haloColor.a,r.fontHaloColor=this.convertSymbolColorToColorPickerValue(i.haloColor),r.fontHaloSize=i.haloSize,r.fontHalo=r.fontHaloSize+"px "+r.fontHaloColor):(r.fontHaloOpacity=1,r.fontHalo="unset",r.fontHaloColor="rgba(255,255,255,1)",r.fontHaloSize=1),r.fontWeight=i.font.weight,r.fontDecoration=i.font.decoration,r.fontStyle=i.font.style,r.fsBoldBtnActive="normal"!==i.font.weight,r.fsItalicBtnActive="normal"!==i.font.style,r.fsUnderlineBtnActive="none"!==i.font.decoration,r.fontBackgroundColor=this.convertSymbolColorToColorPickerValue(i.backgroundColor),this.setState(r)}else{if("polyline"===e.geometry.type&&"simple-line"===(null===(i=e.symbol)||void 0===i?void 0:i.type)){const t=e.symbol;if(!!t.marker);else if(this.state.arrowEnabled)try{const i=this.createLineSymbolWithBuiltInArrows(t,this.state.arrowPosition,this.state.arrowSize);e.symbol=i}catch(e){console.warn("Error applying arrow settings:",e)}}"point"===e.geometry.type&&this.setState({rotationMode:!0}),this.setState({showSymPreview:!0,showTextPreview:!1,currentSymbol:t[0].symbol,graphics:t,clearBtnTitle:this.nls("drawClearSelected")})}}catch(e){console.warn("Error processing selectable graphic:",e)}}))}}else if("active"===e.state){if(e.graphics&&e.graphics.length>0){const r=e.graphics[0];if("polyline"===(null===(t=r.geometry)||void 0===t?void 0:t.type)&&this.state.arrowEnabled&&"simple-line"===(null===(i=r.symbol)||void 0===i?void 0:i.type)){const e=r.symbol;if(!!!e.marker)try{const t=this.createLineSymbolWithBuiltInArrows(e,this.state.arrowPosition,this.state.arrowSize);r.symbol=t}catch(e){console.warn("Error reapplying arrows during active editing:",e)}}}}else if("complete"===e.state&&(this.setState({graphics:null,clearBtnTitle:this.nls("drawClear"),rotationMode:!1}),e.graphics&&e.graphics.length>0)){const t=e.graphics[0];if("polyline"===(null===(r=t.geometry)||void 0===r?void 0:r.type)&&this.state.arrowEnabled&&"simple-line"===(null===(n=t.symbol)||void 0===n?void 0:n.type)){const e=t.symbol;if(!!!e.marker)try{const i=this.createLineSymbolWithBuiltInArrows(e,this.state.arrowPosition,this.state.arrowSize);t.symbol=i}catch(e){console.warn("Error reapplying arrows after editing completion:",e)}}}}catch(e){console.error("Error in svmGraUpdate:",e)}},this.onSymbolPopper=e=>{if(e){if(this.state.currentSymbolType===j.JimuSymbolType.Polyline){document.getElementsByClassName("dropdown-button-content")[0].style.filter="invert(1)"}let e=document.getElementsByClassName("jimu-btn jimu-dropdown-button dropdown-button")[0];e&&e.addEventListener("click",(e=>{setTimeout((()=>{let e=document.getElementsByClassName("dropdown-menu--inner")[0];if(e)for(let t=0;t<e.children.length;t++){const i=e.children[t].getElementsByTagName("img");for(let e=0;e<i.length;e++)i[e].style.filter="invert(1)"}}),20)}));let t=document.getElementsByClassName("style-setting--unit-selector");Array.from(t).forEach((e=>{e.firstChild&&e.firstChild instanceof HTMLElement&&(e.firstChild.style.padding="0")}));let i=document.getElementsByClassName("content-container")[0].parentNode.parentElement;setTimeout((()=>{i.style.zIndex="1004"}),5);let r=document.getElementsByClassName("color-picker-block");Array.from(r).forEach((e=>{e.addEventListener("click",(e=>{this.onColorPickerToggle(e)}))}))}},this.onPointSymChanged=e=>{this.setState({currentSymbol:e,currentSymbolType:j.JimuSymbolType.Point},(()=>{this.sketchViewModel.pointSymbol=e,this.state.graphics&&this.state.graphics.length>0&&this.state.graphics.map((t=>{"point"===t.geometry.type&&(t.symbol=e)}))}))},this.onPolygonSymbolChanged=e=>{this.setState({currentSymbol:e,currentSymbolType:j.JimuSymbolType.Polygon},(()=>{this.sketchViewModel.polygonSymbol=e,this.state.graphics&&this.state.graphics.length>0&&this.state.graphics.map((t=>{"polygon"!==t.geometry.type&&"extent"!==t.geometry.type||(t.symbol=e)}))}))},this.onPolylineSymbolChanged=e=>{if(!e||"simple-line"!==e.type)return void console.warn("Invalid symbol passed to onPolylineSymbolChanged");const t=e.clone();delete t.marker;let i=t;this.state.arrowEnabled&&(i=this.createLineSymbolWithBuiltInArrows(t,this.state.arrowPosition,this.state.arrowSize)),this.setState({currentSymbol:i,currentSymbolType:j.JimuSymbolType.Polyline},(()=>{this.sketchViewModel.polylineSymbol=i,this.state.graphics&&this.state.graphics.length>0&&this.state.graphics.map((e=>{"polyline"===e.geometry.type&&(e.symbol=i)}))}))},this.drawClearBtnClick=()=>{if(this.sketchViewModel&&this.sketchViewModel.view)try{if(this.state.graphics&&this.state.graphics.length){this.state.graphics.forEach((e=>{var t,i,r;try{const n=e;(null===(t=n.measure)||void 0===t?void 0:t.graphic)&&this.drawLayer.remove(n.measure.graphic),(null===(i=e.attributes)||void 0===i?void 0:i.relatedSegmentLabels)&&this.drawLayer.removeMany(e.attributes.relatedSegmentLabels),n.bufferGraphic&&(this.drawLayer.remove(n.bufferGraphic),n.bufferGraphic=null),n.bufferSettings&&(n.bufferSettings=null);const o=null===(r=e.attributes)||void 0===r?void 0:r.uniqueId;if(o&&this._positionWatchers){const e=o+"_widget_buffer";if(this._positionWatchers[e])try{this._positionWatchers[e].remove(),delete this._positionWatchers[e]}catch(e){console.warn("Error removing geometry watcher during clear:",e)}}}catch(e){console.warn("Error processing graphic during clear:",e)}}));try{this.sketchViewModel.delete()}catch(e){console.error("Error deleting selected graphics:",e)}return}const e=this.drawLayer.graphics.toArray().filter((e=>{var t,i,r;return(null===(t=e.attributes)||void 0===t?void 0:t.isBuffer)||(null===(i=e.attributes)||void 0===i?void 0:i.isPreviewBuffer)||(null===(r=e.attributes)||void 0===r?void 0:r.isBufferDrawing)}));e.length>0&&e.forEach((e=>{try{this.drawLayer.remove(e)}catch(e){console.warn("Error removing buffer graphic:",e)}})),this._positionWatchers&&(Object.values(this._positionWatchers).forEach((e=>{if(e&&"function"==typeof e.remove)try{e.remove()}catch(e){console.warn("Error removing watcher during clear all:",e)}})),this._positionWatchers={});try{this.drawLayer.removeAll()}catch(e){console.warn("Error clearing draw layer:",e)}this.setState({confirmDelete:!1})}catch(e){console.error("Error in drawClearBtnClick:",e),this.setState({confirmDelete:!1})}else console.warn("SketchViewModel not available for clear operation")},this.drawUndoBtnClick=()=>{if(this.sketchViewModel&&this.sketchViewModel.view)try{this.sketchViewModel.canUndo()&&this.sketchViewModel.undo(),this.setState({canUndo:this.sketchViewModel.canUndo(),canRedo:this.sketchViewModel.canRedo()})}catch(e){console.error("Error in drawUndoBtnClick:",e)}else console.warn("SketchViewModel not available for undo")},this.drawRedoBtnClick=()=>{if(this.sketchViewModel&&this.sketchViewModel.view)try{this.sketchViewModel.canRedo()&&this.sketchViewModel.redo(),this.setState({canUndo:this.sketchViewModel.canUndo(),canRedo:this.sketchViewModel.canRedo()})}catch(e){console.error("Error in drawRedoBtnClick:",e)}else console.warn("SketchViewModel not available for redo")},this.TextOnChange=e=>{let t=e.currentTarget.value,i=this.state.currentTextSymbol;i.text=t,this.setState({textSymPreviewText:t,currentTextSymbol:i,textHasChanged:!0},(()=>{this.updateSelectedTextGras()}))},this.fontSizeOnChange=e=>{let t=this.state.currentTextSymbol;t.font.size=e,this.setState({fontSize:e,currentTextSymbol:t,textPreviewHeight:this.getRotatedTextHeight()},(()=>{this.updateSelectedTextGras()}))},this.fontHaloSizeChange=e=>{let t=this.state.currentTextSymbol;t.haloSize=parseInt(e),this.setState({fontHaloSize:parseInt(e),currentTextSymbol:t,fontHalo:this.state.fontHaloEnabled?e+"px "+this.state.fontHaloColor:"unset"},(()=>{this.updateSelectedTextGras()}))},this.updateTextColor=e=>{let t=this.state.currentTextSymbol;t.color=e,this.setState({fontColor:this.convertSymbolColorToColorPickerValue(t.color),fontOpacity:t.color.a,currentTextSymbol:t},(()=>{this.updateSelectedTextGras()}))},this.updateFontHaloColor=e=>{let t=this.state.currentTextSymbol;t.haloColor=e,this.setState({fontHaloColor:e,currentTextSymbol:t,fontHalo:this.state.fontHaloEnabled?this.state.fontHaloSize+"px "+e:"unset"},(()=>{this.updateSelectedTextGras()}))},this.updateBackgroundColor=e=>{const t=new O.default(e);let i=this.state.currentTextSymbol;i.backgroundColor=t,this.setState({fontBackgroundColor:t,currentTextSymbol:i},(()=>{this.updateSelectedTextGras()}))},this.fontHaloChkChange=e=>{const t=e.currentTarget;if(!t)return;let i=this.state.currentTextSymbol;t.checked?(i.haloColor=this.state.fontHaloColor,i.haloSize=this.state.fontHaloSize):(i.haloColor=null,i.haloSize=null),this.setState({currentTextSymbol:i,fontHaloEnabled:t.checked,fontHalo:t.checked?this.state.fontHaloSize+"px "+this.state.fontHaloColor:"unset"},(()=>{this.updateSelectedTextGras()}))},this.onHTextAlignChange=e=>{let t=this.state.currentTextSymbol;t.horizontalAlignment=e,this.setState({hTextAlign:e,currentTextSymbol:t},(()=>{this.updateSelectedTextGras()}))},this.fontRotationChange=e=>{let t=this.state.currentTextSymbol;t.angle=e,this.setState({fontRotation:e,currentTextSymbol:t,textPreviewHeight:this.getRotatedTextHeight()},(()=>{this.updateSelectedTextGras()}))},this.onVertFontAlignChange=(e,t)=>{let i=this.state.currentTextSymbol;i.verticalAlignment=t,this.setState({vTextAlign:t,vAlignBaseBtnActive:"baseline"===t,vAlignTopBtnActive:"top"===t,vAlignMidBtnActive:"middle"===t,vAlignBotBtnActive:"bottom"===t,currentTextSymbol:i},(()=>{this.updateSelectedTextGras()})),this.updateActiveBtnIcons()},this.updateActiveBtnIcons=()=>{setTimeout((()=>{let e=document.querySelectorAll(".btn-group>.icon-btn");Array.from(e).forEach((e=>{this.setImgElemFilter(e,e.classList.contains("active"))}))}),20)},this.setImgElemFilter=(e,t)=>{let i=e.getElementsByTagName("img")[0];i&&(i.getAttribute("style")&&i.getAttribute("style").indexOf("filter:")>-1&&!t&&(i.style.filter=""),i.getAttribute("style")&&""!=i.style.filter||!t||(i.style.filter="invert(1)"))},this.onHorizFontAlignChange=(e,t)=>{let i=this.state.currentTextSymbol;i.horizontalAlignment=t,this.setState({hTextAlign:t,hAlignLeftBtnActive:"left"===t,hAlignCenterBtnActive:"center"===t,hAlignRightBtnActive:"right"===t,currentTextSymbol:i},(()=>{this.updateSelectedTextGras()}))},this.updateSelectedTextGras=()=>{this.state.graphics&&this.state.graphics.length>0&&this.state.graphics.forEach((e=>{var t;if("point"===e.geometry.type&&"text"===e.symbol.type){if(null===(t=e.attributes)||void 0===t?void 0:t.isMeasurementLabel)return;e.symbol=this.state.currentTextSymbol;const i=e.clone();this.drawLayer.remove(e),this.drawLayer.add(i),this.sketchViewModel.update(i)}}))},this.getRotatedTextHeight=()=>{let e,t,i=this.state.fontRotation*(Math.PI/180);return document.getElementsByClassName("text-symbol-span")[0]&&(e=document.getElementsByClassName("text-symbol-span")[0]),document.getElementsByClassName("text-symbol-item")[0]&&(t=document.getElementsByClassName("text-symbol-item")[0]),null==e?13:Math.abs(e.clientWidth*Math.sin(i)+e.clientHeight*Math.cos(i))+12},this.onFontStyleChange=(e,t)=>{let i={},r=this.state.currentTextSymbol;"bold"===t&&(this.state.fsBoldBtnActive?r.font.weight="normal":r.font.weight="bold",i.fontWeight=r.font.weight,i.fsBoldBtnActive=!this.state.fsBoldBtnActive),"italic"===t&&(this.state.fsItalicBtnActive?r.font.style="normal":r.font.style="italic",i.fontStyle=r.font.style,i.fsItalicBtnActive=!this.state.fsItalicBtnActive),"underline"===t&&(this.state.fsUnderlineBtnActive?r.font.decoration="none":r.font.decoration="underline",i.fontDecoration=r.font.decoration,i.fsUnderlineBtnActive=!this.state.fsUnderlineBtnActive),i.currentTextSymbol=r,this.setState(i,(()=>{this.updateSelectedTextGras()})),this.updateActiveBtnIcons()},this.setDrawToolBtnState=e=>{var t,i,r,n,o;if(""!==e&&(null===(r=null===(i=null===(t=this.measureRef)||void 0===t?void 0:t.current)||void 0===i?void 0:i.isEditingMeasurements)||void 0===r?void 0:r.call(i))&&(null===(o=(n=this.measureRef.current).cleanupMeasurementLabelSelection)||void 0===o||o.call(n)),!(""===e||this.sketchViewModel&&this.sketchViewModel.view))return void console.warn("SketchViewModel not available for drawing tool activation");const a=this.state.pointBtnActive||this.state.lineBtnActive||this.state.flineBtnActive||this.state.rectBtnActive||this.state.polygonBtnActive||this.state.fpolygonBtnActive||this.state.circleBtnActive||this.state.textBtnActive,s=""!==e;("point"===e&&this.state.pointBtnActive||"polyline"===e&&this.state.lineBtnActive||"freepolyline"===e&&this.state.flineBtnActive||"extent"===e&&this.state.rectBtnActive||"polygon"===e&&this.state.polygonBtnActive||"freepolygon"===e&&this.state.fpolygonBtnActive||"circle"===e&&this.state.circleBtnActive||"text"===e&&this.state.textBtnActive)&&(e="");let l={pointBtnActive:!1,lineBtnActive:!1,flineBtnActive:!1,rectBtnActive:!1,polygonBtnActive:!1,fpolygonBtnActive:!1,circleBtnActive:!1,textBtnActive:!1,currentTool:e};try{switch(this.sketchViewModel&&this.sketchViewModel.cancel(),e){case"point":l.currentSymbol=this.sketchViewModel.pointSymbol,l.currentSymbolType=j.JimuSymbolType.Point,this.sketchViewModel.create("point"),l.pointBtnActive=!0;break;case"polyline":{let e=this.sketchViewModel.polylineSymbol,t=e;if(this.state.arrowEnabled&&"simple-line"===(null==e?void 0:e.type))try{t=this.createLineSymbolWithBuiltInArrows(e,this.state.arrowPosition,this.state.arrowSize)}catch(i){console.warn("Error creating arrow symbol, using base symbol:",i),t=e}l.currentSymbol=t,l.currentSymbolType=j.JimuSymbolType.Polyline,this.sketchViewModel.polylineSymbol=t,this.sketchViewModel.create("polyline"),l.lineBtnActive=!0;break}case"freepolyline":{let e=this.sketchViewModel.polylineSymbol,t=e;if(this.state.arrowEnabled&&"simple-line"===(null==e?void 0:e.type))try{t=this.createLineSymbolWithBuiltInArrows(e,this.state.arrowPosition,this.state.arrowSize)}catch(i){console.warn("Error creating arrow symbol, using base symbol:",i),t=e}l.currentSymbol=t,l.currentSymbolType=j.JimuSymbolType.Polyline,this.sketchViewModel.polylineSymbol=t,this.sketchViewModel.create("polyline",{mode:"freehand"}),l.flineBtnActive=!0;break}case"extent":l.currentSymbol=this.sketchViewModel.polygonSymbol,l.currentSymbolType=j.JimuSymbolType.Polygon,this.sketchViewModel.create("rectangle"),l.rectBtnActive=!0;break;case"polygon":l.currentSymbol=this.sketchViewModel.polygonSymbol,l.currentSymbolType=j.JimuSymbolType.Polygon,this.sketchViewModel.create("polygon"),l.polygonBtnActive=!0;break;case"freepolygon":l.currentSymbol=this.sketchViewModel.polygonSymbol,l.currentSymbolType=j.JimuSymbolType.Polygon,this.sketchViewModel.create("polygon",{mode:"freehand"}),l.fpolygonBtnActive=!0;break;case"circle":l.currentSymbol=this.sketchViewModel.polygonSymbol,l.currentSymbolType=j.JimuSymbolType.Polygon,this.sketchViewModel.create("circle"),l.circleBtnActive=!0;break;case"text":l.currentSymbol=this.sketchViewModel.pointSymbol,l.currentSymbolType=j.JimuSymbolType.Point,this.sketchViewModel.create("point"),l.textBtnActive=!0}}catch(e){console.error("Error in setDrawToolBtnState:",e),l={pointBtnActive:!1,lineBtnActive:!1,flineBtnActive:!1,rectBtnActive:!1,polygonBtnActive:!1,fpolygonBtnActive:!1,circleBtnActive:!1,textBtnActive:!1,currentTool:""}}if(this.state.currentJimuMapView){const e=this.state.currentJimuMapView.view,t=this.props.state;!(null!=t)&&e&&null!==this.originalPopupEnabled&&(a&&!s&&!e.popupEnabled&&this.originalPopupEnabled?(e.popupEnabled=this.originalPopupEnabled,e.popup&&"autoCloseEnabled"in e.popup&&(e.popup.autoCloseEnabled=!0),e.highlightOptions={color:[0,255,255,1],fillOpacity:0,haloOpacity:.8},e.map.layers.forEach((t=>{e.whenLayerView(t).then((e=>{if("feature"===t.type){"highlightOptions"in e&&(e.highlightOptions={color:[0,255,255,1],fillOpacity:0,haloOpacity:.8})}}))}))):!a&&s&&e.popupEnabled&&(null===this.originalPopupEnabled&&(this.originalPopupEnabled=e.popupEnabled),e.popupEnabled=!1,e.popup&&"autoCloseEnabled"in e.popup&&(e.popup.autoCloseEnabled=!1),e.popup.visible=!1,e.highlightOptions={color:[0,0,0,0],fillOpacity:0,haloOpacity:0}))}l.showSymPreview="text"!==e&&""!==e,l.showTextPreview="text"===e,this.setState(l)},this.handleSwitchToDrawings=()=>{var e,t,i;const r=(null===(i=null===(t=null===(e=this.measureRef)||void 0===e?void 0:e.current)||void 0===t?void 0:t.isEditingMeasurements)||void 0===i?void 0:i.call(t))||!1;this.setDrawToolBtnState(""),this.setState({activeTab:"mydrawings"},(()=>{r&&setTimeout((()=>{var e;(null===(e=this.measureRef)||void 0===e?void 0:e.current)&&this.measureRef.current.enableMeasurements()}),250)}))},this.handleSwitchFromDrawings=()=>{var e,t,i;const r=(null===(i=null===(t=null===(e=this.measureRef)||void 0===e?void 0:e.current)||void 0===t?void 0:t.isEditingMeasurements)||void 0===i?void 0:i.call(t))||!1;this.setDrawToolBtnState(""),this.setState({activeTab:"draw"},(()=>{r&&setTimeout((()=>{var e;(null===(e=this.measureRef)||void 0===e?void 0:e.current)&&this.measureRef.current.enableMeasurements()}),250)}))},this.showTextSymbolPopper=e=>{e&&(e.preventDefault(),e.stopPropagation()),this.updateActiveBtnIcons(),setTimeout((()=>{let e=document.getElementsByClassName("style-setting--unit-selector");Array.from(e).forEach((e=>{e.firstChild.style.padding="0"}))}),200),this.setState({textPreviewisOpen:!this.state.textPreviewisOpen})},this.updateSymbolOpacity=e=>{let t=this.state.currentTextSymbol;t.color.a=e,this.setState({fontOpacity:e,currentTextSymbol:t,fontColor:this.convertSymbolColorToColorPickerValue(t.color)},(()=>{this.updateSelectedTextGras()}))},this.onOpacityInputChanged=e=>{let t=this.state.currentTextSymbol;t.color.a=e.distance/100,this.setState({fontOpacity:e.distance/100,currentTextSymbol:t,fontColor:this.convertSymbolColorToColorPickerValue(t.color)},(()=>{this.updateSelectedTextGras()}))},this.updateSymbolHaloOpacity=e=>{let t=this.state.currentTextSymbol;t.haloColor.a=e,this.setState({fontHaloOpacity:e,currentTextSymbol:t,fontHaloColor:this.convertSymbolColorToColorPickerValue(t.haloColor),fontHalo:this.state.fontHaloEnabled?this.state.fontHaloSize+"px "+this.convertSymbolColorToColorPickerValue(t.haloColor):"unset"},(()=>{this.updateSelectedTextGras()}))},this.onHaloOpacityInputChanged=e=>{let t=this.state.currentTextSymbol;t.haloColor.a=e.distance/100,this.setState({fontHaloOpacity:e.distance/100,currentTextSymbol:t,fontHaloColor:this.convertSymbolColorToColorPickerValue(t.haloColor),fontHalo:this.state.fontHaloEnabled?this.state.fontHaloSize+"px "+this.convertSymbolColorToColorPickerValue(t.haloColor):"unset"},(()=>{this.updateSelectedTextGras()}))},this.convertSymbolColorToColorPickerValue=e=>{if(e){const t=e.toRgba();return`rgba(${t[0]},${t[1]},${t[2]},${t[3]})`}return null},this.onColorPickerToggle=e=>{setTimeout((()=>{document.querySelectorAll(".color-picker-popper>.popper-box>.sketch-standard")[0].style.backgroundColor="unset"}),200)},this.handlePointRotation=e=>{const t=this.state.currentSymbol.clone();t.angle=e.target?e.target.value:e,this.onPointSymChanged(t)},this.handleFontFamily=e=>{const t=e.target.value,i=this.state.currentTextSymbol.clone();i.font.family=t,this.setState({currentTextSymbol:i},(()=>{this.updateSelectedTextGras()}))},this.handleListMode=e=>{const t=e.target.checked;this.drawLayer.listMode=t?"show":"hide",this.setState({listMode:this.drawLayer.listMode})},this.handleTitleChange=e=>{const t=e.target.value;this.drawLayer.title=t,this.setState({drawLayerTitle:t})},this.state={currentJimuMapView:null,graphics:[],pointBtnActive:!1,lineBtnActive:!1,flineBtnActive:!1,rectBtnActive:!1,polygonBtnActive:!1,fpolygonBtnActive:!1,circleBtnActive:!1,textBtnActive:!1,showSymPreview:!1,currentSymbol:null,currentSymbolType:null,currentTextSymbol:new R.default({verticalAlignment:"middle",font:{family:"Avenir Next LT Pro"},text:"Text"}),undoBtnActive:!1,redoBtnActive:!1,clearBtnActive:!1,drawGLLengthcheck:!1,currentTool:"",clearBtnTitle:this.nls("drawClear"),canUndo:!1,canRedo:!1,showTextPreview:!1,textSymPreviewText:"Text",fontColor:"rgba(0,0,0,1)",fontSize:`${null!==(n=(new R.default).font.size)&&void 0!==n?n:14}`,fontHaloSize:1,fontHaloColor:"rgba(255,255,255,1)",fontHaloEnabled:!1,fontHalo:"unset",fontWeight:"normal",fontDecoration:"none",fontStyle:"normal",hTextAlign:r.TextAlignValue.CENTER,vTextAlign:"middle",fontRotation:0,vAlignBaseBtnActive:!1,vAlignTopBtnActive:!1,vAlignMidBtnActive:!0,vAlignBotBtnActive:!1,textPreviewHeight:25,hAlignLeftBtnActive:!1,hAlignCenterBtnActive:!0,hAlignRightBtnActive:!1,fsBoldBtnActive:!1,fsItalicBtnActive:!1,fsUnderlineBtnActive:!1,widgetInit:!1,textPreviewisOpen:!1,fontOpacity:1,fontHaloOpacity:1,textHasChanged:!1,rotationMode:!1,drawLayerTitle:this.props.config.title,listMode:this.props.config.listMode?"show":"hide",confirmDelete:!1,fontBackgroundColor:"rgba(0,0,0,0)",showDrawingsPanel:!1,selectedDrawingIndex:null,activeTab:"draw",selectedGraphicIndex:null,selectedGraphics:new Set,arrowEnabled:!1,arrowPosition:"end",arrowSize:24,measurementCheckboxOn:!1},this.creationMode=this.props.config.creationMode||e.SINGLE}componentDidMount(){this.setState({widgetInit:!0}),this.drawLayer=new B.default({id:"DrawGL",listMode:this.props.config.listMode?"show":"hide",title:this.props.config.title}),this._drawingMap=new Map,window.addEventListener("saveDrawingsToStorage",this.handleSaveEvent)}componentDidUpdate(e,i){if(this.state.currentJimuMapView){const e=this.props.state,r=this.state.currentJimuMapView.view;if(e===t.WidgetState.Closed&&this.sketchViewModel){if(this.sketchViewModel.cancel(),this.sketchViewModel.updateOnGraphicClick=!1,this.setDrawToolBtnState(null),r){null!==this.originalPopupEnabled&&(r.popupEnabled=this.originalPopupEnabled),r.popup&&"autoCloseEnabled"in r.popup&&(r.popup.autoCloseEnabled=!0),r.highlightOptions={color:[0,255,255,1],fillOpacity:0,haloOpacity:.8},r.map.layers.forEach((e=>{r.whenLayerView(e).then((t=>{if("feature"===e.type){"highlightOptions"in t&&(t.highlightOptions={color:[0,255,255,1],fillOpacity:0,haloOpacity:.8})}}))}));const e=r.graphics.toArray().filter((e=>e.layer!==this.drawLayer));r.graphics.removeMany(e)}this.props.config.turnOffOnClose&&this.setDrawToolBtnState(null)}else e===t.WidgetState.Opened&&this.sketchViewModel&&(this.sketchViewModel.updateOnGraphicClick=!0,r&&(null===this.originalPopupEnabled&&(this.originalPopupEnabled=r.popupEnabled),r.popupEnabled=!1,r.popup&&"autoCloseEnabled"in r.popup&&(r.popup.autoCloseEnabled=!1),r.popup.visible=!1,r.highlightOptions={color:[0,0,0,0],fillOpacity:0,haloOpacity:0}));if(r&&null!==this.originalPopupEnabled){if(!(null!=e)){const e=this.state.pointBtnActive||this.state.lineBtnActive||this.state.flineBtnActive||this.state.rectBtnActive||this.state.polygonBtnActive||this.state.fpolygonBtnActive||this.state.circleBtnActive||this.state.textBtnActive,t=i.pointBtnActive||i.lineBtnActive||i.flineBtnActive||i.rectBtnActive||i.polygonBtnActive||i.fpolygonBtnActive||i.circleBtnActive||i.textBtnActive;t&&!e&&!r.popupEnabled&&this.originalPopupEnabled?(r.popupEnabled=this.originalPopupEnabled,r.popup&&"autoCloseEnabled"in r.popup&&(r.popup.autoCloseEnabled=!0),r.highlightOptions={color:[0,255,255,1],fillOpacity:0,haloOpacity:.8}):!t&&e&&r.popupEnabled&&(r.popupEnabled=!1,r.popup&&"autoCloseEnabled"in r.popup&&(r.popup.autoCloseEnabled=!1),r.popup.visible=!1,r.highlightOptions={color:[0,0,0,0],fillOpacity:0,haloOpacity:0})}}}document.getElementsByClassName("fontcolorpicker")[0]&&(document.getElementsByClassName("fontcolorpicker")[0].title=this.nls("fontColor")),document.getElementsByClassName("fontrotationinput")[0]&&(document.getElementsByClassName("fontrotationinput")[0].title=this.nls("fontRotation")),document.getElementsByClassName("fontsizeinput")[0]&&(document.getElementsByClassName("fontsizeinput")[0].title=this.nls("fontSize")),document.getElementsByClassName("fonthalocolorpicker")[0]&&(document.getElementsByClassName("fonthalocolorpicker")[0].title=this.nls("fontHaloColor")),document.getElementsByClassName("fonthalosizeinput")[0]&&(document.getElementsByClassName("fonthalosizeinput")[0].title=this.nls("fontHaloSize"))}componentWillUnmount(){var e,t;if(this._measurementUpdateTimeout&&(clearTimeout(this._measurementUpdateTimeout),this._measurementUpdateTimeout=null),this._activeMeasurementUpdateTimeout&&(clearTimeout(this._activeMeasurementUpdateTimeout),this._activeMeasurementUpdateTimeout=null),this._savePositionTimeout&&(clearTimeout(this._savePositionTimeout),this._savePositionTimeout=null),this._positionWatchers&&(Object.values(this._positionWatchers).forEach((e=>{if(e&&"function"==typeof e.remove)try{e.remove()}catch(e){console.warn("Error removing position watcher:",e)}})),this._positionWatchers={}),window.removeEventListener("saveDrawingsToStorage",this.handleSaveEvent),(null===(t=null===(e=this.state)||void 0===e?void 0:e.currentJimuMapView)||void 0===t?void 0:t.view)&&null!==this.originalPopupEnabled){const e=this.state.currentJimuMapView.view;try{e.popupEnabled=this.originalPopupEnabled,e.popup&&"autoCloseEnabled"in e.popup&&(e.popup.autoCloseEnabled=!0),e.highlightOptions={color:[0,255,255,1],fillOpacity:0,haloOpacity:.8},e.map.layers.forEach((t=>{e.whenLayerView(t).then((e=>{if("feature"===t.type){"highlightOptions"in e&&(e.highlightOptions={color:[0,255,255,1],fillOpacity:0,haloOpacity:.8})}})).catch((e=>{console.warn(`Could not restore highlight options for layer ${t.title}:`,e)}))}));const t=e.graphics.toArray().filter((e=>e.layer!==this.drawLayer));t.length>0&&e.graphics.removeMany(t)}catch(e){console.warn("Error restoring view state during unmount:",e)}this.originalPopupEnabled=null}if(this.sketchViewModel){try{this.sketchViewModel.cancel(),this.sketchViewModel.destroy()}catch(e){console.warn("Error cleaning up SketchViewModel:",e)}this.sketchViewModel=null}if(this.drawLayer){try{this.drawLayer.removeAll()}catch(e){console.warn("Error clearing draw layer:",e)}this.drawLayer=null}}renderMyDrawingsTab(){return(0,t.jsx)("div",{className:"my-drawings-tab-container p-3"},this.drawLayer&&(0,t.jsx)(We,{ref:this.myDrawingsRef,graphicsLayer:this.drawLayer,jimuMapView:this.state.currentJimuMapView,drawings:this.drawLayer.graphics.toArray(),allowLocalStorage:!0,confirmOnDelete:!0,onDrawingSelect:this.handleDrawingSelect,onDrawingsUpdate:this.handleDrawingsUpdate,showAlert:this.showAlert,isActiveTab:"mydrawings"===this.state.activeTab,onClearSelectionOverlays:this.clearSelectionOverlaysInDrawLayer}))}renderDrawPanel(){var e;const{config:i}=this.props,{showSymPreview:n,showTextPreview:o,drawGLLengthcheck:a,canRedo:l,canUndo:c,fontColor:u,fontSize:h,fontHaloEnabled:m,fontHaloColor:p,fontHaloSize:f,textSymPreviewText:y,currentSymbol:v,undoBtnActive:b,redoBtnActive:x,clearBtnActive:M,clearBtnTitle:L,pointBtnActive:S,lineBtnActive:N,flineBtnActive:A,rectBtnActive:T,polygonBtnActive:E,fpolygonBtnActive:j,circleBtnActive:I,textBtnActive:D,fontHalo:k,fontWeight:z,fontDecoration:O,fontStyle:B,fontRotation:P,vAlignBaseBtnActive:R,vAlignBotBtnActive:G,vAlignMidBtnActive:_,vAlignTopBtnActive:V,textPreviewHeight:U,hAlignLeftBtnActive:W,hAlignCenterBtnActive:F,hAlignRightBtnActive:H,fsBoldBtnActive:Q,fsItalicBtnActive:Y,fsUnderlineBtnActive:Z,currentSymbolType:J,textPreviewisOpen:$,fontOpacity:q,fontHaloOpacity:X,textHasChanged:K}=this.state,ee=S||N||A||T||E||j||I||D;return(0,t.jsx)("div",{className:"draw-panel-content"},(0,t.jsx)("div",{className:"mode-message text-center mb-3"},ee?(0,t.jsx)("div",null,(0,t.jsx)("h5",null,"Drawing Mode"),(0,t.jsx)("h6",null,"Click the Active Drawing Style Button to Exit Drawing Mode and Activate Editing Mode.")):(0,t.jsx)("div",null,(null===(e=this.drawLayer)||void 0===e?void 0:e.graphics.length)>0?(0,t.jsx)("div",null,(0,t.jsx)("h5",null,"Edit Mode"),(0,t.jsx)("h6",null,"Select a Drawing Style to enter Drawing Mode.")):(0,t.jsx)("div",null,(0,t.jsx)("h5",null,"No Drawings Yet"),(0,t.jsx)("h6",null,"Select a Drawing Style to get started.")))),(0,t.jsx)("div",{className:"drawing-tools-section mb-3"},(0,t.jsx)("div",{className:"d-flex justify-content-center"},(0,t.jsx)("div",{className:"drawToolbarDiv d-flex flex-column"},(0,t.jsx)("div",{className:"buttonRow"},(0,t.jsx)(r.Button,{size:"sm",type:"default",color:S?"primary":"default",active:S,onClick:()=>this.setDrawToolBtnState("point"),title:this.nls("drawPoint")},(0,t.jsx)(r.Icon,{icon:Ke})),(0,t.jsx)(r.Button,{size:"sm",type:"default",color:N?"primary":"default",active:N,onClick:()=>this.setDrawToolBtnState("polyline"),title:this.nls("drawLine")},(0,t.jsx)(r.Icon,{icon:tt})),(0,t.jsx)(r.Button,{size:"sm",type:"default",color:A?"primary":"default",active:A,onClick:()=>this.setDrawToolBtnState("freepolyline"),title:this.nls("drawFreeLine")},(0,t.jsx)(r.Icon,{icon:et})),(0,t.jsx)(r.Button,{size:"sm",type:"default",color:D?"primary":"default",active:D,onClick:()=>this.setDrawToolBtnState("text"),title:this.nls("drawText")},(0,t.jsx)(r.Icon,{icon:at}))),(0,t.jsx)("div",{className:"buttonRow"},(0,t.jsx)(r.Button,{size:"sm",type:"default",color:T?"primary":"default",active:T,onClick:()=>this.setDrawToolBtnState("extent"),title:this.nls("drawRectangle")},(0,t.jsx)(r.Icon,{icon:it})),(0,t.jsx)(r.Button,{size:"sm",type:"default",color:E?"primary":"default",active:E,onClick:()=>this.setDrawToolBtnState("polygon"),title:this.nls("drawPolygon")},(0,t.jsx)(r.Icon,{icon:rt})),(0,t.jsx)(r.Button,{size:"sm",type:"default",color:j?"primary":"default",active:j,onClick:()=>this.setDrawToolBtnState("freepolygon"),title:this.nls("drawFreePolygon")},(0,t.jsx)(r.Icon,{icon:nt})),(0,t.jsx)(r.Button,{size:"sm",type:"default",color:I?"primary":"default",active:I,onClick:()=>this.setDrawToolBtnState("circle"),title:this.nls("drawCircle")},(0,t.jsx)(r.Icon,{icon:ot})))))),n&&this.sketchViewModel&&this.renderSymbolSelectorSection(),o&&this.renderTextSymbolPreviewButton(),$&&this.renderTextPopper(),(0,t.jsx)("div",{className:"main-checkbox-stack"},(0,t.jsx)(xe,{key:`measure-${this.state.activeTab}`,ref:this.measureRef,nls:this.nls,config:i,drawLayer:this.drawLayer,currentTextSymbol:this.state.currentTextSymbol,sketchViewModel:this.sketchViewModel,currentTool:this.state.currentTool,showTextPreview:this.state.showTextPreview,currentSymbol:this.state.currentSymbol,isDrawingActive:ee}),(0,t.jsx)(Ze,{jimuMapView:this.state.currentJimuMapView,sketchViewModel:this.sketchViewModel}),!D&&(0,t.jsx)(qe,{sketchViewModel:this.sketchViewModel,jimuMapView:this.state.currentJimuMapView})),(0,t.jsx)("div",{className:"d-flex flex-column justify-content-between",style:{height:"150px"}},(0,t.jsx)("div",{className:"drawToolbarBottomDiv"},(c||l)&&(0,t.jsx)("div",{className:"d-flex gap-2"},(0,t.jsx)(r.Button,{size:"sm",type:"secondary",active:b,onClick:this.drawUndoBtnClick,title:this.nls("drawUndo"),disabled:!c},(0,t.jsx)(g,null)," Undo"),(0,t.jsx)(r.Button,{size:"sm",type:"secondary",active:x,onClick:this.drawRedoBtnClick,title:this.nls("drawRedo"),disabled:!l},(0,t.jsx)(d,null)," Redo")),this.state.clearBtnTitle===this.nls("drawClear")?this.state.confirmDelete?(0,t.jsx)("div",{className:"d-flex gap-2"},(0,t.jsx)(r.Button,{size:"sm",type:"danger",active:M,onClick:this.drawClearBtnClick,title:L},(0,t.jsx)(s,null)," ",L),(0,t.jsx)(r.Button,{size:"sm",type:"secondary",active:M,onClick:()=>this.setState({confirmDelete:!1}),title:"Cancel"},(0,t.jsx)(w,null)," Cancel")):(0,t.jsx)(r.Button,{size:"sm",type:"secondary",active:M,onClick:()=>this.setState({confirmDelete:!0}),title:L,disabled:!a},(0,t.jsx)(s,null)," ",L):(0,t.jsx)(r.Button,{size:"sm",type:"danger",active:M,onClick:this.drawClearBtnClick,title:L},(0,t.jsx)(s,null)," ",L)),(this.props.config.changeListMode||this.props.config.changeTitle)&&(0,t.jsx)("div",{className:"drawToolbarDiv"},(0,t.jsx)(r.CollapsablePanel,{label:"Draw Layer Settings",leftIcon:C()},(0,t.jsx)("div",null,(0,t.jsx)(r.Label,{className:"w-100"},"Draw Layer Title:",(0,t.jsx)(r.TextInput,{defaultValue:this.props.config.title,onChange:e=>this.handleTitleChange(e),type:"text",allowClear:!0,required:!0})),(0,t.jsx)(r.Label,{centric:!0},(0,t.jsx)(r.Checkbox,{checked:"show"===this.state.listMode,onClick:e=>this.handleListMode(e),className:"mr-2 mt-2 mb-2 ml-4"}),"Show In Map Layer List"))))))}renderTextPopper(){const e=this.state.fontBackgroundColor?"string"==typeof this.state.fontBackgroundColor?this.state.fontBackgroundColor:`rgba(${this.state.fontBackgroundColor.r}, ${this.state.fontBackgroundColor.g}, ${this.state.fontBackgroundColor.b}, ${this.state.fontBackgroundColor.a})`:"transparent";return(0,t.jsx)(r.Popper,{open:this.state.textPreviewisOpen,reference:this.props.widgetId+"_btnTextSymbol",placement:"bottom",showArrow:!0,zIndex:1002,toggle:this.showTextSymbolPopper},(0,t.jsx)("div",{className:"p-3 d-flex"},(0,t.jsx)("div",null,(0,t.jsx)("div",{className:"w-100 d-flex mt-2 mb-3"},(0,t.jsx)("div",{className:"justify-content-start d-flex align-items-center mr-4 pl-2"},this.nls("preview")),(0,t.jsx)("div",{className:"justify-content-center d-flex mt-1 mb-1 ml-3",style:{height:`${this.state.textPreviewHeight}px`,maxHeight:"220px",backgroundColor:e}},(0,t.jsx)("div",null,(0,t.jsx)("div",{className:"w-100 h-100 justify-content-center d-flex align-items-center symbol-item text-symbol-item"},(0,t.jsx)("span",{className:"text-symbol-span",style:{color:`${this.state.fontColor}`,fontSize:`${this.state.fontSize}px`,fontWeight:"normal"===this.state.fontWeight?"normal":"bold",fontStyle:this.state.fontStyle,fontFamily:this.state.currentTextSymbol.font.family,textDecoration:this.state.fontDecoration,zIndex:100,WebkitTransform:`rotate(${this.state.fontRotation}deg)`,MozTransition:`rotate(${this.state.fontRotation}deg)`,filter:`progid:DXImageTransform.Microsoft.BasicImage(rotation=${this.state.fontRotation})`}},this.state.textSymPreviewText),(0,t.jsx)("span",{style:{color:`${this.state.fontColor}`,fontSize:`${this.state.fontSize}px`,WebkitTextStroke:`${this.state.fontHalo}`,fontWeight:"normal"===this.state.fontWeight?"normal":"bold",fontStyle:this.state.fontStyle,fontFamily:this.state.currentTextSymbol.font.family,textDecoration:this.state.fontDecoration,position:"absolute",WebkitTransform:`rotate(${this.state.fontRotation}deg)`,MozTransition:`rotate(${this.state.fontRotation}deg)`,filter:`progid:DXImageTransform.Microsoft.BasicImage(rotation=${this.state.fontRotation})`}},this.state.textSymPreviewText))))),(0,t.jsx)("div",{className:"w-100"},(0,t.jsx)("div",{className:"w-100 d-flex justify-content-between align-items-center pb-2"},(0,t.jsx)(r.TextInput,{className:"w-100",size:"sm",title:this.nls("drawText"),onChange:e=>this.TextOnChange(e),placeholder:"Your Text Here",value:this.state.textHasChanged?this.state.textSymPreviewText:"",style:{fontFamily:this.state.currentTextSymbol.font.family}}))),(0,t.jsx)("div",{className:"w-100 d-flex"},"Font:",(0,t.jsx)(r.Select,{size:"sm",onChange:e=>this.handleFontFamily(e),className:"ml-2",value:this.state.currentTextSymbol.font.family},(0,t.jsx)(r.Option,{value:"Alegreya",style:{fontFamily:"Alegreya"}},"Alegreya"),(0,t.jsx)(r.Option,{value:"Arial",style:{fontFamily:"Arial"}},"Arial"),(0,t.jsx)(r.Option,{value:"Avenir Next LT Pro",style:{fontFamily:"Avenir Next LT Pro"}},"Avenir Next"),(0,t.jsx)(r.Option,{value:"Josefin Slab",style:{fontFamily:"Josefin Slab"}},"Josefin Slab"),(0,t.jsx)(r.Option,{value:"Merriweather",style:{fontFamily:"Merriweather"}},"Merriweather"),(0,t.jsx)(r.Option,{value:"Montserrat",style:{fontFamily:"Montserrat"}},"Montserrat"),(0,t.jsx)(r.Option,{value:"Noto Sans",style:{fontFamily:"Noto Sans"}},"Noto Sans"),(0,t.jsx)(r.Option,{value:"Noto Serif",style:{fontFamily:"Noto Serif"}},"Noto Serif"),(0,t.jsx)(r.Option,{value:"Playfair Display",style:{fontFamily:"Playfair Display"}},"Playfair Display"),(0,t.jsx)(r.Option,{value:"Roboto",style:{fontFamily:"Roboto"}},"Roboto"),(0,t.jsx)(r.Option,{value:"Ubuntu",style:{fontFamily:"Ubuntu"}},"Ubuntu"))),(0,t.jsx)("div",{className:"w-100"},(0,t.jsx)("div",{className:"w-100 d-flex justify-content-between align-items-center mb-2"},(0,t.jsx)(D.ColorPicker,{className:"fontcolorpicker",title:this.nls("fontColor"),style:{padding:"0"},width:26,height:26,color:this.state.fontColor?this.state.fontColor:"rgba(0,0,0,1)",onChange:this.updateTextColor,onClick:e=>{this.onColorPickerToggle(e)}}),(0,t.jsx)(r.NumericInput,{size:"sm",onChange:this.fontSizeOnChange,value:this.state.fontSize,className:"fontsizeinput",style:{width:"5rem"},showHandlers:!0,min:1,max:120}),(0,t.jsx)("div",{style:{borderRight:"1px solid rgb(182, 182, 182)",height:"26px"}}),(0,t.jsx)(r.AdvancedButtonGroup,null,(0,t.jsx)(r.Button,{icon:!0,size:"sm",active:this.state.fsBoldBtnActive,onClick:e=>{this.onFontStyleChange(e,"bold")},title:this.nls("fontBold")},(0,t.jsx)(r.Icon,{icon:dt,size:"m"})),(0,t.jsx)(r.Button,{icon:!0,size:"sm",active:this.state.fsItalicBtnActive,onClick:e=>{this.onFontStyleChange(e,"italic")},title:this.nls("fontItalic")},(0,t.jsx)(r.Icon,{icon:ht,size:"m"})),(0,t.jsx)(r.Button,{icon:!0,size:"sm",active:this.state.fsUnderlineBtnActive,onClick:e=>{this.onFontStyleChange(e,"underline")},title:this.nls("fontUnderline")},(0,t.jsx)(r.Icon,{icon:mt,width:12}))))),(0,t.jsx)(r.Label,null,"Opacity:",(0,t.jsx)("div",{className:"w-100 d-flex justify-content-between align-items-center mb-2 border"},(0,t.jsx)(r.Slider,{size:"default",value:this.state.fontOpacity,min:0,max:1,step:.1,hideThumb:!1,className:"mr-2",style:{width:"calc(100% - 80px)"},title:`${this.props.intl.formatMessage({id:"drawToolOpacity",defaultMessage:r.defaultMessages.drawToolOpacity})}: ${100*this.state.fontOpacity}%`,onChange:e=>this.updateSymbolOpacity(e.currentTarget.value)}),(0,t.jsx)(I.InputUnit,{value:100*this.state.fontOpacity+"%",className:"input-unit",onChange:e=>this.onOpacityInputChanged(e),style:{width:"70px"}}))),(0,t.jsx)("div",{className:"w-100"},(0,t.jsx)("div",{className:"w-100 d-flex justify-content-around align-items-center mb-2"},(0,t.jsx)("span",null,"Text Rotation:"),(0,t.jsx)(r.NumericInput,{size:"sm",onChange:this.fontRotationChange,value:this.state.fontRotation,className:"fontrotationinput",style:{width:"80px"},showHandlers:!0,min:-360,max:360}))),(0,t.jsx)("div",{className:"w-100"},(0,t.jsx)("div",{className:"w-100 d-flex justify-content-between align-items-center mb-2"},(0,t.jsx)(r.AdvancedButtonGroup,null,(0,t.jsx)(r.Button,{icon:!0,size:"sm",active:this.state.hAlignLeftBtnActive,onClick:e=>{this.onHorizFontAlignChange(e,"left")},title:this.nls("fontHAleft")},(0,t.jsx)(r.Icon,{icon:_(),size:"m"})),(0,t.jsx)(r.Button,{icon:!0,size:"sm",active:this.state.hAlignCenterBtnActive,onClick:e=>{this.onHorizFontAlignChange(e,"center")},title:this.nls("fontHAcenter")},(0,t.jsx)(r.Icon,{icon:U(),size:"m"})),(0,t.jsx)(r.Button,{icon:!0,size:"sm",active:this.state.hAlignRightBtnActive,onClick:e=>{this.onHorizFontAlignChange(e,"right")},title:this.nls("fontHAright")},(0,t.jsx)(r.Icon,{icon:F(),size:"m"}))),(0,t.jsx)("div",{style:{borderRight:"1px solid rgb(182, 182, 182)",height:"26px"}}),(0,t.jsx)(r.AdvancedButtonGroup,null,(0,t.jsx)(r.Button,{icon:!0,size:"sm",active:this.state.vAlignBaseBtnActive,onClick:e=>{this.onVertFontAlignChange(e,"baseline")},title:this.nls("fontVAbase")},(0,t.jsx)(r.Icon,{icon:ut,currentColor:!0})),(0,t.jsx)(r.Button,{icon:!0,size:"sm",active:this.state.vAlignTopBtnActive,onClick:e=>{this.onVertFontAlignChange(e,"top")},title:this.nls("fontVAtop")},(0,t.jsx)(r.Icon,{icon:st})),(0,t.jsx)(r.Button,{icon:!0,size:"sm",active:this.state.vAlignMidBtnActive,onClick:e=>{this.onVertFontAlignChange(e,"middle")},title:this.nls("fontVAmid")},(0,t.jsx)(r.Icon,{icon:ct})),(0,t.jsx)(r.Button,{icon:!0,size:"sm",active:this.state.vAlignBotBtnActive,onClick:e=>{this.onVertFontAlignChange(e,"bottom")},title:this.nls("fontVAbottom")},(0,t.jsx)(r.Icon,{icon:lt}))))),(0,t.jsx)(r.Label,{centric:!0},"Background Color:",(0,t.jsx)(D.ColorPicker,{className:"mr-4 ml-2",style:{padding:"0"},width:26,height:26,type:"icon-only",icon:"rgba(0,0,0,0)"===this.state.fontBackgroundColor?(0,t.jsx)(L,{title:"No Background Color"}):(0,t.jsx)("div",{title:"Background Color",style:{backgroundColor:e,height:"100%",width:"100%"}}),color:this.state.fontBackgroundColor?e:"#000000",onClick:e=>{this.onColorPickerToggle(e)},onChange:this.updateBackgroundColor}))),(0,t.jsx)("div",{className:"ml-2"},(0,t.jsx)("div",{className:"border p-2 mb-2"},(0,t.jsx)("h6",null,"Text Halo Options"),(0,t.jsx)("div",{className:"w-100"},(0,t.jsx)("div",{className:"w-100 d-flex justify-content-between align-items-center mb-2"},(0,t.jsx)(r.Label,{centric:!0},this.state.fontHaloEnabled?"Disable":"Enable",(0,t.jsx)(r.Switch,{title:this.nls("enableFontHalo"),className:"mr-4 ml-2",onChange:this.fontHaloChkChange,checked:this.state.fontHaloEnabled})),(0,t.jsx)(D.ColorPicker,{className:"mr-4 fonthalocolorpicker",style:{padding:"0"},width:26,height:26,color:this.state.fontHaloColor?this.state.fontHaloColor:"#000000",onClick:e=>{this.onColorPickerToggle(e)},onChange:this.updateFontHaloColor,disabled:!this.state.fontHaloEnabled}),(0,t.jsx)(r.NumericInput,{size:"sm",onChange:e=>this.fontHaloSizeChange(e),value:this.state.fontHaloSize,disabled:!this.state.fontHaloEnabled,className:"fonthalosizeinput",style:{width:"80px"},showHandlers:!0,min:1,max:20}))),(0,t.jsx)(r.Label,null,"Opacity:",(0,t.jsx)("div",{className:"w-100 d-flex justify-content-between align-items-center mb-2 border"},(0,t.jsx)(r.Slider,{size:"default",value:this.state.fontHaloOpacity,min:0,max:1,step:.1,hideThumb:!1,className:"mr-2",style:{width:"calc(100% - 80px)"},title:`${this.nls("fontHalo")} ${this.props.intl.formatMessage({id:"drawToolOpacity",defaultMessage:r.defaultMessages.drawToolOpacity})}: ${100*this.state.fontHaloOpacity}%`,onChange:e=>{this.state.fontHaloEnabled&&this.updateSymbolHaloOpacity(e.currentTarget.value)}}),(0,t.jsx)(I.InputUnit,{value:100*this.state.fontHaloOpacity+"%",className:"input-unit",onChange:e=>this.onHaloOpacityInputChanged(e),style:{width:"70px"},disabled:!this.state.fontHaloEnabled})))))))}render(){const{config:e}=this.props,{fontColor:i,fontSize:r,fontHalo:n,fontRotation:o,fontWeight:a,fontStyle:s,fontDecoration:l,fontHaloColor:c,fontHaloEnabled:u,fontHaloSize:d,textSymPreviewText:h,textPreviewHeight:m,currentSymbol:p,currentSymbolType:g,fontOpacity:f,fontHaloOpacity:y,textHasChanged:v,undoBtnActive:w,redoBtnActive:b,clearBtnActive:x,clearBtnTitle:M,canUndo:L,canRedo:S,showSymPreview:C,showTextPreview:T,textPreviewisOpen:E,drawGLLengthcheck:j,rotationMode:I,pointBtnActive:D,lineBtnActive:k,flineBtnActive:z,rectBtnActive:O,polygonBtnActive:B,fpolygonBtnActive:P,circleBtnActive:R,textBtnActive:G,vAlignBaseBtnActive:_,vAlignTopBtnActive:V,vAlignMidBtnActive:U,vAlignBotBtnActive:W,hAlignLeftBtnActive:F,hAlignCenterBtnActive:H,hAlignRightBtnActive:Q,fsBoldBtnActive:Y,fsItalicBtnActive:Z,fsUnderlineBtnActive:J,activeTab:$,measurementCheckboxOn:q}=this.state;return(0,t.jsx)("div",{className:"widget-draw jimu-widget",css:A(this.props.theme)},this.props.useMapWidgetIds&&1===this.props.useMapWidgetIds.length&&(0,t.jsx)(N.JimuMapViewComponent,{useMapWidgetId:this.props.useMapWidgetIds[0],onActiveViewChange:this.activeViewChangeHandler}),(0,t.jsx)("div",{className:"tab-header"},(0,t.jsx)("div",{className:"tab-button "+("draw"===$?"active":""),onClick:()=>this.handleTabChange("draw")},"Draw"),(0,t.jsx)("div",{className:"tab-button "+("mydrawings"===$?"active":""),onClick:()=>this.handleTabChange("mydrawings")},"My Drawings")),(0,t.jsx)("div",{className:"tab-content"},"draw"===$&&(0,t.jsx)("div",{className:"draw-tab-content",key:"draw-tab"},this.renderDrawPanel()),"mydrawings"===$&&this.renderMyDrawingsTab()))}}function ft(e){k.p=e}})(),z})())}}}));