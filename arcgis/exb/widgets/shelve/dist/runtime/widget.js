System.register(["jimu-core","jimu-core/data-source","jimu-ui","jimu-arcgis","esri/Basemap","esri/WebMap","esri/Viewpoint","esri/layers/GroupLayer","esri/Graphic","esri/core/Collection","esri/layers/GraphicsLayer","esri/layers/FeatureLayer"],(function(e,t){var a={},r={},s={},i={},o={},n={},l={},c={},u={},d={},p={},y={};return{setters:[function(e){a.DataSourceManager=e.DataSourceManager,a.DataSourcesChangeType=e.DataSourcesChangeType,a.Immutable=e.Immutable,a.MessageManager=e.MessageManager,a.MessageType=e.MessageType,a.MutableStoreManager=e.MutableStoreManager,a.React=e.React,a.WidgetManager=e.WidgetManager,a.classNames=e.classNames,a.css=e.css,a.getAppStore=e.getAppStore,a.jsx=e.jsx},function(e){r.dataSourceJsonCreator=e.dataSourceJsonCreator},function(e){s.Button=e.Button,s.Input=e.Input},function(e){i.JimuMapViewComponent=e.JimuMapViewComponent},function(e){o.default=e.default},function(e){n.default=e.default},function(e){l.default=e.default},function(e){c.default=e.default},function(e){u.default=e.default},function(e){d.default=e.default},function(e){p.default=e.default},function(e){y.default=e.default}],execute:function(){e((()=>{var e={420:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M6.973 11.484c0 .285.236.516.527.516a.52.52 0 0 0 .527-.516V1.976L10.6 4.473c.206.202.54.202.746 0a.51.51 0 0 0 0-.73L7.5 0 3.654 3.743a.51.51 0 0 0 0 .73c.206.202.54.202.746 0l2.573-2.497zM1 8v7h13V8h1v8H0V8z" clip-rule="evenodd"></path></svg>'},921:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8.027.516A.52.52 0 0 0 7.5 0a.52.52 0 0 0-.527.516v9.508L4.4 7.527a.535.535 0 0 0-.746 0 .51.51 0 0 0 0 .73L7.5 12l3.846-3.743a.51.51 0 0 0 0-.73.535.535 0 0 0-.746 0l-2.573 2.497zM1 8v7h13V8h1v8H0V8z" clip-rule="evenodd"></path></svg>'},692:e=>{"use strict";e.exports=o},89:e=>{"use strict";e.exports=u},948:e=>{"use strict";e.exports=l},359:e=>{"use strict";e.exports=n},702:e=>{"use strict";e.exports=d},633:e=>{"use strict";e.exports=y},620:e=>{"use strict";e.exports=p},750:e=>{"use strict";e.exports=c},686:e=>{"use strict";e.exports=i},244:e=>{"use strict";e.exports=a},349:e=>{"use strict";e.exports=r},321:e=>{"use strict";e.exports=s}},t={};function m(a){var r=t[a];if(void 0!==r)return r.exports;var s=t[a]={exports:{}};return e[a](s,s.exports,m),s.exports}m.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return m.d(t,{a:t}),t},m.d=(e,t)=>{for(var a in t)m.o(t,a)&&!m.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},m.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),m.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},m.p="";var f={};return m.p=window.jimuConfig.baseUrl,(()=>{"use strict";m.r(f),m.d(f,{__set_webpack_public_path__:()=>E,default:()=>C});var e=m(244),t=m(349),a=m(321),r=m(420),s=m.n(r),i=function(e,t){var a={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(a[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(r=Object.getOwnPropertySymbols(e);s<r.length;s++)t.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(e,r[s])&&(a[r[s]]=e[r[s]])}return a};const o=t=>{const a=window.SVG,{className:r}=t,o=i(t,["className"]),n=(0,e.classNames)("jimu-icon jimu-icon-component",r);return a?e.React.createElement(a,Object.assign({className:n,src:s()},o)):e.React.createElement("svg",Object.assign({className:n},o))};var n=m(921),l=m.n(n),c=function(e,t){var a={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(a[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(r=Object.getOwnPropertySymbols(e);s<r.length;s++)t.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(e,r[s])&&(a[r[s]]=e[r[s]])}return a};const u=t=>{const a=window.SVG,{className:r}=t,s=c(t,["className"]),i=(0,e.classNames)("jimu-icon jimu-icon-component",r);return a?e.React.createElement(a,Object.assign({className:i,src:l()},s)):e.React.createElement("svg",Object.assign({className:i},s))};var d=m(686),p=m(692),y=m(359),g=m(948),b=m(750),v=m(89),w=m(702),h=m(620),S=m(633);const x=e=>{switch(typeof e){case"number":case"string":case"boolean":return e;case"object":break;default:return}if(null===e)return null;if(e instanceof Set)return Array.from(e).map(x);if(e instanceof Array||e instanceof w.default)return e.map(x);const t=O[e.declaredClass];return!t&&e.declaredClass&&console.log("No replacer found for ",e),t?t(e):e},j=e=>{let t;switch(e.type){case"graphics":t=h.default;break;case"group":t=b.default;break;case"feature":t=S.default;break;case"webmap":t=y.default;break;default:return e}return(e=window.structuredClone(e)).layers&&(e.layers=e.layers.map(j)),delete e.type,new t(e)},M=e=>e.filter((([e,t])=>null!=t)),I=(e,t,a)=>{const r=t.map((t=>[t,x(e[t])]));return Object.fromEntries(r&&a?a(r):r)},O={"esri.Basemap":e=>e.portalItem?I(e,["portalItem","title"]):I(e,["baseLayers","id","referenceLayers","spatialReference","style","title"],M),"esri.Camera":e=>I(e,["fov","heading","layout","position","tilt"]),"esri.CameraLayout":e=>I(e,["column","columns","row","rows","tilt"]),"esri.Color":e=>I(e,["r","g","b","a"]),"esri.Graphic":e=>I(e,["aggregateGeometries","attributes","geometry","popupTemplate","symbol","visible"]),"esri.Ground":e=>I(e,["type","layers","navigationConstraint","opacity","surfaceColor"],M),"esri.Viewpoint":e=>I(e,["camera","rotation","scale","targetGeometry"]),"esri.WebMap":e=>Object.assign({type:"webmap"},I(e,["applicationProperties","authoringApp","authoringAppVersion","basemap","bookmarks","floorInfo","geotriggersInfo","ground","initialViewProperties","ipsInfo","layers","presentation","sourceVersion","tables","utilityNetworks","widgets"],M)),"esri.geometry.Extent":e=>I(e,["type","mmax","mmin","spatialReference","xmax","xmin","ymax","ymin","zmax","zmin"]),"esri.geometry.Geometry":e=>I(e,["type","hasM","hasZ","spatialReference"]),"esri.geometry.Multipoint":e=>Object.assign(Object.assign({},O["esri.geometry.Geometry"](e)),I(e,["points"])),"esri.geometry.Point":e=>I(e,["type","latitude","longitude","m","spatialReference","x","y","z"]),"esri.geometry.Polygon":e=>Object.assign(Object.assign({},O["esri.geometry.Geometry"](e)),I(e,["curveRings","rings"])),"esri.geometry.Polyline":e=>Object.assign(Object.assign({},O["esri.geometry.Geometry"](e)),I(e,["curvePaths","paths"])),"esri.geometry.SpatialReference":e=>I(e,["imageCoordinateSystem","wkid","wkt","wkt2"],M),"esri.layers.FeatureLayer":e=>e.url||e.portalItem?Object.assign(Object.assign({},O["esri.layers.Layer"](e)),I(e,["layerId","legendEnabled","popupEnabled",e.portalItem?"portalItem":"url"],M)):Object.assign(Object.assign({},O["esri.layers.Layer"](e)),I(e,["attributeTableTemplate","charts","customParameters","elevationInfo","dateFieldsTimeZone","displayField","displayFilterEnabled","displayFilterInfo","dynamicDataSource","editingEnabled","effect","featureEffect","featureReduction","fields","floorInfo","formTemplate","fullExtent","gdbVersion","geometryType","hasM","hasZ","historicMoment","labelingInfo","labelsVisible","layerId","legendEnabled","maxScale","minScale","objectIdField","orderBy","outFields","popupEnabled","popupTemplate","refreshInterval","renderer","returnM","returnZ","screenSizePerspectiveEnabled","source","spatialReference","templates","timeExtent","timeInfo","timeOffset","trackInfo","typeIdField","types","useViewTime"],M)),"esri.layers.GraphicsLayer":e=>Object.assign(Object.assign({},O["esri.layers.Layer"](e)),I(e,["effect","elevationInfo","graphics","maxScale","minScale","screenSizePerspectiveEnabled"],M)),"esri.layers.GroupLayer":e=>Object.assign(Object.assign({},O["esri.layers.Layer"](e)),I(e,["blendMode","effect","layers","maxScale","minScale","portalItem","tables","visibilityMode"],M)),"esri.layers.Layer":e=>I(e,["type","blendMode","fullExtent","id","listMode","opacity","title","visibilityTimeExtent","visible"],M),"esri.layers.TileLayer":e=>Object.assign(Object.assign({},O["esri.layers.Layer"](e)),I(e,[e.portalItem?"portalItem":"url"])),"esri.layers.VectorTileLayer":e=>e.portalItem||e.url?Object.assign(Object.assign({},O["esri.layers.Layer"](e)),I(e,[e.portalItem?"portalItem":"url"])):Object.assign(Object.assign({},O["esri.layers.Layer"](e)),I(e,["customParameters","effect","graphics","maxScale","minScale","refreshInterval","style"],M)),"esri.layers.support.ExpressionInfo":e=>I(e,["expression","title"],M),"esri.layers.support.FeatureTemplate":e=>I(e,["description","drawingTool","name","prototype","thumbnail","contentType","imageData","height","width"],M),"esri.layers.support.Field":e=>I(e,["type","alias","defaultValue","description","domain","editable","length","name","nullable","valueType"],M),"esri.layers.support.LabelClass":e=>I(e,["allowOverrun","deconflictionStrategy","labelExpression","labelExpressionInfo","labelPlacement","labelPosition","maxScale","minScale","repeatLabel","repeatLabelDistance","symbol","useCodedValues","where"],M),"esri.layers.support.LabelExpressionInfo":e=>I(e,["expression","title"],M),"esri.networks.UtilityNetwork":e=>I(e,["type","dataElement","fullExtent","id","layerUrl","sharedNamedTraceConfigurations","spatialReference","title"],M),"esri.portal.PortalItem":e=>I(e,["id","url"],M),"esri.renderers.SimpleRenderer":e=>I(e,["type","label","symbol","visualVariables"]),"esri.renderers.visualVariables.VisualVariable":e=>I(e,["type","field","legendOptions","valueExpression","valueExpressionTitle"],M),"esri.support.BasemapStyle":e=>I(e,["id","language","places","serviceUrl","worldview"],M),"esri.symbols.Font":e=>I(e,["decoration","family","size","style","weight"]),"esri.symbols.MarkerSymbol":e=>I(e,["type","angle","xoffset","yoffset"]),"esri.symbols.PictureMarkerSymbol":e=>Object.assign(Object.assign({},O["esri.symbols.MarkerSymbol"](e)),I(e,["height","url","width"])),"esri.symbols.SimpleFillSymbol":e=>I(e,["style","color","outline","type"]),"esri.symbols.SimpleLineSymbol":e=>I(e,["type","cap","color","join","marker","miterLimit","style","width"]),"esri.symbols.SimpleMarkerSymbol":e=>Object.assign(Object.assign({},O["esri.symbols.MarkerSymbol"](e)),I(e,["color","outline","path","size","style"])),"esri.symbols.TextSymbol":e=>I(e,["type","angle","backgroundColor","borderLineColor","borderLineSize","color","font","haloColor","haloSize","horizontalAlignment","kerning","lineHeight","lineWidth","rotated","text","verticalAlignment","xoffset","yoffset"]),"esri.symbols.support.ElevationInfo":e=>I(e,["mode","offset","featureExpressionInfo","unit"]),"esri.webmap.InitialViewProperties":e=>I(e,["background","spatialReference","timeExtent","timeZone","viewpoint"])};var L=function(e,t,a,r){return new(a||(a=Promise))((function(s,i){function o(e){try{l(r.next(e))}catch(e){i(e)}}function n(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,n)}l((r=r.apply(e,t||[])).next())}))};function C(r){var s;const[i,n]=e.React.useState(!1),[l,c]=e.React.useState(),m=e=>`setFilter-${e}`,f=e=>e.id.startsWith("jimu-draw-groupLayer-"),w=e=>e.id.startsWith("jimu-draw-layer-"),h=e=>e.id.startsWith("jimu-draw-measurements-layer-"),S=()=>L(this,void 0,void 0,(function*(){var t,a;const r=(0,e.getAppStore)().getState(),s=Object.values(r.appConfig.widgets).find((e=>"widgets/arcgis/draw/"==e.uri));if(!s)return void console.log("The Draw widget was not found in the application configuration.");const i=e.WidgetManager.getInstance();(null===(a=null===(t=r.widgetsRuntimeInfo)||void 0===t?void 0:t[s.id])||void 0===a?void 0:a.isClassLoaded)||(yield i.loadWidgetClass(s.id));const o=yield new Promise(((e,t)=>{const a=setTimeout((()=>{r.remove(),t("time out waiting for Drawings layer")}),2e4),r=l.view.map.layers.on("change",(t=>{if(t.added&&t.removed&&t.removed.some(f)){const o=t.added.find(f);o&&(clearTimeout(a),r.remove(),e(o),i.closeWidget(s.id))}})),o=l.view.map.layers.find(f);o?(clearTimeout(a),r.remove(),e(o)):i.openWidget(s.id)}));return console.assert(o instanceof b.default,"drawings layer is of the wrong type",o),yield o.load(),o})),M=e=>L(this,void 0,void 0,(function*(){console.log("restoreSession",e);const t=yield e.text();if(!t)return void console.log("No session found in the file.");let a;try{a=JSON.parse(t)}catch(e){return void console.warn("Shelve :: restoreSession ::",e)}console.log("file data",a),3===a.version?yield I(a):alert("Unsupported session version.")})),I=t=>L(this,void 0,void 0,(function*(){var a;const s=l.view,i=s.map;i.basemap=p.default.fromJSON(t.basemap),s.viewpoint=new g.default(t.viewpoint),e.MessageManager.getInstance().publishMessage({extent:s.extent,stationary:s.stationary,type:e.MessageType.ExtentChange,viewpoint:s.viewpoint,widgetId:r.id}),(()=>{l.clearSelectedFeatures();const t=e.DataSourceManager.getInstance(),a=[];for(const e of l.getAllJimuLayerViews())if(e.fromRuntime){l.removeJimuLayerView(e);const r=e.getLayerDataSource();t.destroyDataSource(r.id),a.push(r)}a&&e.MessageManager.getInstance().publishMessage({changeType:e.DataSourcesChangeType.Remove,dataSources:a,type:e.MessageType.DataSourcesChange,widgetId:r.id});for(const e of t.getDataSourcesAsArray())(null==e?void 0:e.updateQueryParams)&&e.updateQueryParams(null,m(e.id));l.view.map.removeMany(l.view.map.layers.filter((e=>!f(e))).toArray()),l.view.map.tables.removeAll(),e.MutableStoreManager.getInstance().clearState()})(),t.drawings&&(yield T(t.drawings));const o=t.layers.map(j),n={};for(const e of o)"feature"===e.type&&(yield O(e,null===(a=t.filters)||void 0===a?void 0:a[e.id],n));i.addMany(o.reverse(),0),e.MutableStoreManager.getInstance().updateStateValue("dataActions","setFilter",(0,e.Immutable)(n));const c=Object.entries(n).map((([e,t])=>e));console.log(c),c&&e.MessageManager.getInstance().publishMessage({dataSourceIds:c,type:e.MessageType.DataSourceFilterChange,widgetId:r.id})})),O=(a,s,i)=>L(this,void 0,void 0,(function*(){yield a.load();const o=l.getDataSourceIdByAPILayer(a),n={id:o,dataSourceJson:t.dataSourceJsonCreator.createDataSourceJsonByJSAPILayer(o,a)},c=yield e.DataSourceManager.getInstance().createDataSource(n),u=yield l.addLayerAndCreateJimuLayerView(a,c),d=m(o);let p=null;return s&&(i[o]=(0,e.Immutable)(s),s.applied&&(p={where:s.expression.sql,sqlExpression:s.expression})),c.updateQueryParams(p,d),yield e.MessageManager.getInstance().publishMessage({changeType:e.DataSourcesChangeType.Create,dataSources:[c],type:e.MessageType.DataSourcesChange,widgetId:r.id}),u})),C=()=>L(this,void 0,void 0,(function*(){if(!(l.view.map instanceof y.default))return void alert("Only 2D WebMap maps are supported.");const e=l.view.map;yield e.updateFrom(l.view);return{version:3,basemap:e.basemap.toJSON(),drawings:yield E(),layers:x(e.layers.filter((e=>!f(e)))),filters:P(),viewpoint:x(l.view.viewpoint)}})),E=()=>L(this,void 0,void 0,(function*(){const e=l.view.map.layers.find(f),t=null==e?void 0:e.layers.find(w),a=null==e?void 0:e.layers.find(h);return e&&t&&a?{shapes:x(t.graphics),measurements:x((yield a.queryFeatures()).features)}:null})),T=e=>L(this,void 0,void 0,(function*(){if(!e.shapes&&!e.measurements)return;const t=yield S();if(e.shapes){const a=null==t?void 0:t.layers.find(w);a&&(a.removeAll(),a.addMany(e.shapes.map((e=>new v.default(e)))))}if(e.measurements){const a=null==t?void 0:t.layers.find(h);a&&(yield a.applyEdits({addFeatures:e.measurements.map((e=>new v.default(e))),deleteFeatures:(yield a.queryFeatures()).features}))}})),P=()=>{var t,a;const r=null===(a=null===(t=e.MutableStoreManager.getInstance().getState())||void 0===t?void 0:t.dataActions)||void 0===a?void 0:a.setFilter;if(!r)return;const s={};for(const[e,t]of Object.entries(r)){s[l.getJimuLayerViewByDataSourceId(e).layer.id]={applied:t.applied,expression:t.expression}}return s},V=(e,t)=>{const a=new Blob([JSON.stringify(e)],{type:"application/json;charset=utf-8"});saveAs(a,t)};return r.useMapWidgetIds&&1===r.useMapWidgetIds.length?(0,e.jsx)("div",{className:"widget-shelve jimu-widget d-flex flex-column justify-content-center align-items-center w-100 h-100",style:{border:"3px dashed #adadad"},css:e.css`
        background-color: ${i?"#e1edfb":"inherit"};
        border-color: ${i?"#7eaee9":"#adadad"};
        * {
          pointer-events: ${i?"none":"auto"};
        }
      `,onDragEnter:()=>{n(!0)},onDragOver:e=>{e.preventDefault()},onDragLeave:()=>{n(!1)},onDrop:e=>L(this,void 0,void 0,(function*(){e.preventDefault(),e.stopPropagation(),n(!1);for(const t of e.dataTransfer.files)if("application/json"===t.type)return void(yield M(t))}))},(0,e.jsx)(a.Input,{id:"load-session",type:"file",accept:"application/json",className:"d-none",onChange:e=>L(this,void 0,void 0,(function*(){e.stopPropagation(),yield M(e.target.files[0])}))}),(0,e.jsx)("div",null,(0,e.jsx)("div",{className:"row justify-content-center p-2"},(0,e.jsx)(a.Button,{type:"secondary",className:"w-100",onClick:e=>L(this,void 0,void 0,(function*(){e.stopPropagation(),V(yield C(),"session.json")}))},(0,e.jsx)(o,null),"Save Session")),(0,e.jsx)("div",{className:"row justify-content-center p-2"},(0,e.jsx)(a.Button,{type:"secondary",className:"w-100",onClick:e=>{e.stopPropagation(),document.getElementById("load-session").click()}},(0,e.jsx)(u,null),"Load Session")),(0,e.jsx)("div",{className:"row justify-content-center p-2 text-muted",style:{fontSize:"large",pointerEvents:"none"}},"(or drop file here)")),(0,e.jsx)(d.JimuMapViewComponent,{useMapWidgetId:null===(s=r.useMapWidgetIds)||void 0===s?void 0:s[0],onActiveViewChange:e=>{e&&c(e)}})):"Select a map"}function E(e){m.p=e}})(),f})())}}}));