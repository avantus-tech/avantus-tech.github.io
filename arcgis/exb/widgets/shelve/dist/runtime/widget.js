System.register(["jimu-core","jimu-ui","jimu-arcgis","esri/Basemap","esri/WebMap","esri/Viewpoint","esri/layers/GroupLayer","esri/Graphic","esri/core/Collection","esri/layers/GraphicsLayer","esri/layers/FeatureLayer"],(function(e,t){var a={},s={},r={},i={},o={},n={},l={},c={},u={},d={},p={};return{setters:[function(e){a.DataSourceManager=e.DataSourceManager,a.DataSourcesChangeType=e.DataSourcesChangeType,a.Immutable=e.Immutable,a.MessageManager=e.MessageManager,a.MessageType=e.MessageType,a.MutableStoreManager=e.MutableStoreManager,a.React=e.React,a.WidgetManager=e.WidgetManager,a.classNames=e.classNames,a.css=e.css,a.dataSourceUtils=e.dataSourceUtils,a.getAppStore=e.getAppStore,a.jsx=e.jsx},function(e){s.Button=e.Button,s.Input=e.Input},function(e){r.JimuMapViewComponent=e.JimuMapViewComponent},function(e){i.default=e.default},function(e){o.default=e.default},function(e){n.default=e.default},function(e){l.default=e.default},function(e){c.default=e.default},function(e){u.default=e.default},function(e){d.default=e.default},function(e){p.default=e.default}],execute:function(){e((()=>{var e={420:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M6.973 11.484c0 .285.236.516.527.516a.52.52 0 0 0 .527-.516V1.976L10.6 4.473c.206.202.54.202.746 0a.51.51 0 0 0 0-.73L7.5 0 3.654 3.743a.51.51 0 0 0 0 .73c.206.202.54.202.746 0l2.573-2.497zM1 8v7h13V8h1v8H0V8z" clip-rule="evenodd"></path></svg>'},921:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8.027.516A.52.52 0 0 0 7.5 0a.52.52 0 0 0-.527.516v9.508L4.4 7.527a.535.535 0 0 0-.746 0 .51.51 0 0 0 0 .73L7.5 12l3.846-3.743a.51.51 0 0 0 0-.73.535.535 0 0 0-.746 0l-2.573 2.497zM1 8v7h13V8h1v8H0V8z" clip-rule="evenodd"></path></svg>'},692:e=>{"use strict";e.exports=i},89:e=>{"use strict";e.exports=c},948:e=>{"use strict";e.exports=n},359:e=>{"use strict";e.exports=o},702:e=>{"use strict";e.exports=u},633:e=>{"use strict";e.exports=p},620:e=>{"use strict";e.exports=d},750:e=>{"use strict";e.exports=l},686:e=>{"use strict";e.exports=r},244:e=>{"use strict";e.exports=a},321:e=>{"use strict";e.exports=s}},t={};function y(a){var s=t[a];if(void 0!==s)return s.exports;var r=t[a]={exports:{}};return e[a](r,r.exports,y),r.exports}y.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return y.d(t,{a:t}),t},y.d=(e,t)=>{for(var a in t)y.o(t,a)&&!y.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},y.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),y.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},y.p="";var m={};return y.p=window.jimuConfig.baseUrl,(()=>{"use strict";y.r(m),y.d(m,{__set_webpack_public_path__:()=>C,default:()=>L});var e=y(244),t=y(321),a=y(420),s=y.n(a),r=function(e,t){var a={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(a[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(s=Object.getOwnPropertySymbols(e);r<s.length;r++)t.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(e,s[r])&&(a[s[r]]=e[s[r]])}return a};const i=t=>{const a=window.SVG,{className:i}=t,o=r(t,["className"]),n=(0,e.classNames)("jimu-icon jimu-icon-component",i);return a?e.React.createElement(a,Object.assign({className:n,src:s()},o)):e.React.createElement("svg",Object.assign({className:n},o))};var o=y(921),n=y.n(o),l=function(e,t){var a={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(a[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(s=Object.getOwnPropertySymbols(e);r<s.length;r++)t.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(e,s[r])&&(a[s[r]]=e[s[r]])}return a};const c=t=>{const a=window.SVG,{className:s}=t,r=l(t,["className"]),i=(0,e.classNames)("jimu-icon jimu-icon-component",s);return a?e.React.createElement(a,Object.assign({className:i,src:n()},r)):e.React.createElement("svg",Object.assign({className:i},r))};var u=y(686),d=y(692),p=y(359),f=y(948),g=y(750),b=y(89),v=y(702),w=y(620),h=y(633);const S=e=>{switch(typeof e){case"number":case"string":case"boolean":return e;case"object":break;default:return}if(null===e)return null;if(e instanceof Set)return Array.from(e).map(S);if(e instanceof Array||e instanceof v.default)return e.map(S);const t=I[e.declaredClass];return!t&&e.declaredClass&&console.log("No replacer found for ",e),t?t(e):e},x=e=>{let t;switch(e.type){case"graphics":t=w.default;break;case"group":t=g.default;break;case"feature":t=h.default;break;case"webmap":t=p.default;break;default:return e}return(e=window.structuredClone(e)).layers&&(e.layers=e.layers.map(x)),delete e.type,new t(e)},j=e=>e.filter((([e,t])=>null!=t)),M=(e,t,a)=>{const s=t.map((t=>[t,S(e[t])]));return Object.fromEntries(s&&a?a(s):s)},I={"esri.Basemap":e=>e.portalItem?M(e,["portalItem","title"]):M(e,["baseLayers","id","referenceLayers","spatialReference","style","title"],j),"esri.Camera":e=>M(e,["fov","heading","layout","position","tilt"]),"esri.CameraLayout":e=>M(e,["column","columns","row","rows","tilt"]),"esri.Color":e=>M(e,["r","g","b","a"]),"esri.Graphic":e=>M(e,["aggregateGeometries","attributes","geometry","popupTemplate","symbol","visible"]),"esri.Ground":e=>M(e,["type","layers","navigationConstraint","opacity","surfaceColor"],j),"esri.Viewpoint":e=>M(e,["camera","rotation","scale","targetGeometry"]),"esri.WebMap":e=>Object.assign({type:"webmap"},M(e,["applicationProperties","authoringApp","authoringAppVersion","basemap","bookmarks","floorInfo","geotriggersInfo","ground","initialViewProperties","ipsInfo","layers","presentation","sourceVersion","tables","utilityNetworks","widgets"],j)),"esri.geometry.Extent":e=>M(e,["type","mmax","mmin","spatialReference","xmax","xmin","ymax","ymin","zmax","zmin"]),"esri.geometry.Geometry":e=>M(e,["type","hasM","hasZ","spatialReference"]),"esri.geometry.Multipoint":e=>Object.assign(Object.assign({},I["esri.geometry.Geometry"](e)),M(e,["points"])),"esri.geometry.Point":e=>M(e,["type","latitude","longitude","m","spatialReference","x","y","z"]),"esri.geometry.Polygon":e=>Object.assign(Object.assign({},I["esri.geometry.Geometry"](e)),M(e,["curveRings","rings"])),"esri.geometry.Polyline":e=>Object.assign(Object.assign({},I["esri.geometry.Geometry"](e)),M(e,["curvePaths","paths"])),"esri.geometry.SpatialReference":e=>M(e,["imageCoordinateSystem","wkid","wkt","wkt2"],j),"esri.layers.FeatureLayer":e=>e.url||e.portalItem?Object.assign(Object.assign({},I["esri.layers.Layer"](e)),M(e,["layerId","legendEnabled","popupEnabled",e.portalItem?"portalItem":"url"],j)):Object.assign(Object.assign({},I["esri.layers.Layer"](e)),M(e,["attributeTableTemplate","charts","customParameters","elevationInfo","dateFieldsTimeZone","displayField","displayFilterEnabled","displayFilterInfo","dynamicDataSource","editingEnabled","effect","featureEffect","featureReduction","fields","floorInfo","formTemplate","fullExtent","gdbVersion","geometryType","hasM","hasZ","historicMoment","labelingInfo","labelsVisible","layerId","legendEnabled","maxScale","minScale","objectIdField","orderBy","outFields","popupEnabled","popupTemplate","refreshInterval","renderer","returnM","returnZ","screenSizePerspectiveEnabled","source","spatialReference","templates","timeExtent","timeInfo","timeOffset","trackInfo","typeIdField","types","useViewTime"],j)),"esri.layers.GraphicsLayer":e=>Object.assign(Object.assign({},I["esri.layers.Layer"](e)),M(e,["effect","elevationInfo","graphics","maxScale","minScale","screenSizePerspectiveEnabled"],j)),"esri.layers.GroupLayer":e=>Object.assign(Object.assign({},I["esri.layers.Layer"](e)),M(e,["blendMode","effect","layers","maxScale","minScale","portalItem","tables","visibilityMode"],j)),"esri.layers.Layer":e=>M(e,["type","blendMode","fullExtent","id","listMode","opacity","title","visibilityTimeExtent","visible"],j),"esri.layers.TileLayer":e=>Object.assign(Object.assign({},I["esri.layers.Layer"](e)),M(e,[e.portalItem?"portalItem":"url"])),"esri.layers.VectorTileLayer":e=>e.portalItem||e.url?Object.assign(Object.assign({},I["esri.layers.Layer"](e)),M(e,[e.portalItem?"portalItem":"url"])):Object.assign(Object.assign({},I["esri.layers.Layer"](e)),M(e,["customParameters","effect","graphics","maxScale","minScale","refreshInterval","style"],j)),"esri.layers.support.ExpressionInfo":e=>M(e,["expression","title"],j),"esri.layers.support.FeatureTemplate":e=>M(e,["description","drawingTool","name","prototype","thumbnail","contentType","imageData","height","width"],j),"esri.layers.support.Field":e=>M(e,["type","alias","defaultValue","description","domain","editable","length","name","nullable","valueType"],j),"esri.layers.support.LabelClass":e=>M(e,["allowOverrun","deconflictionStrategy","labelExpression","labelExpressionInfo","labelPlacement","labelPosition","maxScale","minScale","repeatLabel","repeatLabelDistance","symbol","useCodedValues","where"],j),"esri.layers.support.LabelExpressionInfo":e=>M(e,["expression","title"],j),"esri.networks.UtilityNetwork":e=>M(e,["type","dataElement","fullExtent","id","layerUrl","sharedNamedTraceConfigurations","spatialReference","title"],j),"esri.portal.PortalItem":e=>M(e,["id","url"],j),"esri.renderers.SimpleRenderer":e=>M(e,["type","label","symbol","visualVariables"]),"esri.renderers.visualVariables.VisualVariable":e=>M(e,["type","field","legendOptions","valueExpression","valueExpressionTitle"],j),"esri.support.BasemapStyle":e=>M(e,["id","language","places","serviceUrl","worldview"],j),"esri.symbols.Font":e=>M(e,["decoration","family","size","style","weight"]),"esri.symbols.MarkerSymbol":e=>M(e,["type","angle","xoffset","yoffset"]),"esri.symbols.PictureMarkerSymbol":e=>Object.assign(Object.assign({},I["esri.symbols.MarkerSymbol"](e)),M(e,["height","url","width"])),"esri.symbols.SimpleFillSymbol":e=>M(e,["style","color","outline","type"]),"esri.symbols.SimpleLineSymbol":e=>M(e,["type","cap","color","join","marker","miterLimit","style","width"]),"esri.symbols.SimpleMarkerSymbol":e=>Object.assign(Object.assign({},I["esri.symbols.MarkerSymbol"](e)),M(e,["color","outline","path","size","style"])),"esri.symbols.TextSymbol":e=>M(e,["type","angle","backgroundColor","borderLineColor","borderLineSize","color","font","haloColor","haloSize","horizontalAlignment","kerning","lineHeight","lineWidth","rotated","text","verticalAlignment","xoffset","yoffset"]),"esri.symbols.support.ElevationInfo":e=>M(e,["mode","offset","featureExpressionInfo","unit"]),"esri.webmap.InitialViewProperties":e=>M(e,["background","spatialReference","timeExtent","timeZone","viewpoint"])};var O=function(e,t,a,s){return new(a||(a=Promise))((function(r,i){function o(e){try{l(s.next(e))}catch(e){i(e)}}function n(e){try{l(s.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,n)}l((s=s.apply(e,t||[])).next())}))};function L(a){var s;const[r,o]=e.React.useState(!1),[n,l]=e.React.useState(),y=e=>`setFilter-${e}`,m=e=>e.id.startsWith("jimu-draw-groupLayer-"),v=e=>e.id.startsWith("jimu-draw-layer-"),w=e=>e.id.startsWith("jimu-draw-measurements-layer-"),h=()=>O(this,void 0,void 0,(function*(){var t,a;const s=(0,e.getAppStore)().getState(),r=Object.values(s.appConfig.widgets).find((e=>"widgets/arcgis/draw/"==e.uri));if(!r)return void console.log("The Draw widget was not found in the application configuration.");const i=e.WidgetManager.getInstance();(null===(a=null===(t=s.widgetsRuntimeInfo)||void 0===t?void 0:t[r.id])||void 0===a?void 0:a.isClassLoaded)||(yield i.loadWidgetClass(r.id));const o=yield new Promise(((e,t)=>{const a=setTimeout((()=>{s.remove(),t("time out waiting for Drawings layer")}),2e4),s=n.view.map.layers.on("change",(t=>{if(t.added&&t.removed&&t.removed.some(m)){const o=t.added.find(m);o&&(clearTimeout(a),s.remove(),e(o),i.closeWidget(r.id))}})),o=n.view.map.layers.find(m);o?(clearTimeout(a),s.remove(),e(o)):i.openWidget(r.id)}));return console.assert(o instanceof g.default,"drawings layer is of the wrong type",o),yield o.load(),o})),j=e=>O(this,void 0,void 0,(function*(){console.log("restoreSession",e);const t=yield e.text();if(!t)return void console.log("No session found in the file.");let a;try{a=JSON.parse(t)}catch(e){return void console.warn("Shelve :: restoreSession ::",e)}console.log("file data",a),3===a.version?yield M(a):alert("Unsupported session version.")})),M=t=>O(this,void 0,void 0,(function*(){var s;const r=n.view,i=r.map;i.basemap=d.default.fromJSON(t.basemap),r.viewpoint=new f.default(t.viewpoint),e.MessageManager.getInstance().publishMessage({extent:r.extent,stationary:r.stationary,type:e.MessageType.ExtentChange,viewpoint:r.viewpoint,widgetId:a.id}),(()=>{n.clearSelectedFeatures();const t=e.DataSourceManager.getInstance(),s=[];for(const e of n.getAllJimuLayerViews())if(e.fromRuntime){n.removeJimuLayerView(e);const a=e.getLayerDataSource();t.destroyDataSource(a.id),s.push(a)}s&&e.MessageManager.getInstance().publishMessage({changeType:e.DataSourcesChangeType.Remove,dataSources:s,type:e.MessageType.DataSourcesChange,widgetId:a.id});for(const e of t.getDataSourcesAsArray())(null==e?void 0:e.updateQueryParams)&&e.updateQueryParams(null,y(e.id));n.view.map.removeMany(n.view.map.layers.filter((e=>!m(e))).toArray()),n.view.map.tables.removeAll(),e.MutableStoreManager.getInstance().clearState()})(),t.drawings&&(yield E(t.drawings));const o=t.layers.map(x),l={};for(const e of o)"feature"===e.type&&(yield I(e,null===(s=t.filters)||void 0===s?void 0:s[e.id],l));i.addMany(o.reverse(),0),e.MutableStoreManager.getInstance().updateStateValue("dataActions","setFilter",(0,e.Immutable)(l));const c=Object.entries(l).map((([e,t])=>e));console.log(c),c&&e.MessageManager.getInstance().publishMessage({dataSourceIds:c,type:e.MessageType.DataSourceFilterChange,widgetId:a.id})})),I=(t,s,r)=>O(this,void 0,void 0,(function*(){yield t.load();const i=n.getDataSourceIdByAPILayer(t),o={id:i,dataSourceJson:e.dataSourceUtils.dataSourceJsonCreator.createDataSourceJsonByJSAPILayer(i,t)},l=yield e.DataSourceManager.getInstance().createDataSource(o),c=yield n.addLayerAndCreateJimuLayerView(t,l),u=y(i);let d=null;return s&&(r[i]=(0,e.Immutable)(s),s.applied&&(d={where:s.expression.sql,sqlExpression:s.expression})),l.updateQueryParams(d,u),yield e.MessageManager.getInstance().publishMessage({changeType:e.DataSourcesChangeType.Create,dataSources:[l],type:e.MessageType.DataSourcesChange,widgetId:a.id}),c})),L=()=>O(this,void 0,void 0,(function*(){if(!(n.view.map instanceof p.default))return void alert("Only 2D WebMap maps are supported.");const e=n.view.map;yield e.updateFrom(n.view);return{version:3,basemap:e.basemap.toJSON(),drawings:yield C(),layers:S(e.layers.filter((e=>!m(e)))),filters:T(),viewpoint:S(n.view.viewpoint)}})),C=()=>O(this,void 0,void 0,(function*(){const e=n.view.map.layers.find(m),t=null==e?void 0:e.layers.find(v),a=null==e?void 0:e.layers.find(w);return e&&t&&a?{shapes:S(t.graphics),measurements:S((yield a.queryFeatures()).features)}:null})),E=e=>O(this,void 0,void 0,(function*(){if(!e.shapes&&!e.measurements)return;const t=yield h();if(e.shapes){const a=null==t?void 0:t.layers.find(v);a&&(a.removeAll(),a.addMany(e.shapes.map((e=>new b.default(e)))))}if(e.measurements){const a=null==t?void 0:t.layers.find(w);a&&(yield a.applyEdits({addFeatures:e.measurements.map((e=>new b.default(e))),deleteFeatures:(yield a.queryFeatures()).features}))}})),T=()=>{var t,a;const s=null===(a=null===(t=e.MutableStoreManager.getInstance().getState())||void 0===t?void 0:t.dataActions)||void 0===a?void 0:a.setFilter;if(!s)return;const r={};for(const[e,t]of Object.entries(s)){r[n.getJimuLayerViewByDataSourceId(e).layer.id]={applied:t.applied,expression:t.expression}}return r},P=(e,t)=>{const a=new Blob([JSON.stringify(e)],{type:"application/json;charset=utf-8"});saveAs(a,t)};return a.useMapWidgetIds&&1===a.useMapWidgetIds.length?(0,e.jsx)("div",{className:"widget-shelve jimu-widget d-flex flex-column justify-content-center align-items-center w-100 h-100",style:{border:"3px dashed #adadad"},css:e.css`
        background-color: ${r?"#e1edfb":"inherit"};
        border-color: ${r?"#7eaee9":"#adadad"};
        * {
          pointer-events: ${r?"none":"auto"};
        }
      `,onDragEnter:()=>{o(!0)},onDragOver:e=>{e.preventDefault()},onDragLeave:()=>{o(!1)},onDrop:e=>O(this,void 0,void 0,(function*(){e.preventDefault(),e.stopPropagation(),o(!1);for(const t of e.dataTransfer.files)if("application/json"===t.type)return void(yield j(t))}))},(0,e.jsx)(t.Input,{id:"load-session",type:"file",accept:"application/json",className:"d-none",onChange:e=>O(this,void 0,void 0,(function*(){e.stopPropagation(),yield j(e.target.files[0])}))}),(0,e.jsx)("div",null,(0,e.jsx)("div",{className:"row justify-content-center p-2"},(0,e.jsx)(t.Button,{type:"secondary",className:"w-100",onClick:e=>O(this,void 0,void 0,(function*(){e.stopPropagation(),P(yield L(),"session.json")}))},(0,e.jsx)(i,null),"Save Session")),(0,e.jsx)("div",{className:"row justify-content-center p-2"},(0,e.jsx)(t.Button,{type:"secondary",className:"w-100",onClick:e=>{e.stopPropagation(),document.getElementById("load-session").click()}},(0,e.jsx)(c,null),"Load Session")),(0,e.jsx)("div",{className:"row justify-content-center p-2 text-muted",style:{fontSize:"large",pointerEvents:"none"}},"(or drop file here)")),(0,e.jsx)(u.JimuMapViewComponent,{useMapWidgetId:null===(s=a.useMapWidgetIds)||void 0===s?void 0:s[0],onActiveViewChange:e=>{e&&l(e)}})):"Select a map"}function C(e){y.p=e}})(),m})())}}}));